Image compression has become increasingly important due to the widespread use of mobile devices for capturing and sharing images. Lossy image compression techniques, which sacrifice image quality for reduced storage space and transmission costs, have gained popularity. Traditional codecs like JPEG, JPEG2000, and BPG have been outperformed by deep learning-based approaches. These approaches use autoencoder networks to optimize the rate-distortion trade-off. However, most existing algorithms rely on a uniform compression ratio across the entire image, despite the fact that all pixels are not equally important. Spatially adaptive compression, which can identify regions of interest (ROIs) for better compression performance, is desirable. Additionally, current models are typically optimized for a single compression rate and extending them to multiple rates is challenging. In this paper, we propose a variable-rate image compression network that uses an importance map with spatially adaptive continuous values. Our approach optimizes the rate-distortion trade-off by constraining image distortion with a real-valued quality map. We introduce spatially adaptive affine transform modules that perform pixel-wise feature transformations to compress images guided by the quality map. This allows us to compress images with arbitrary compression rates and obtain compressed images with spatially varying quality. We also propose a technique to automatically generate task-aware quality maps without retraining the models, allowing us to construct compressed images optimized for specific tasks. Compared to existing adaptive image compression techniques, our framework is more flexible and generalizable. While other variable-rate models have shown comparable performance, they handle only discrete levels of compression or suffer from improper quantization bin size selection. Our approach considers explicit spatial importance for image compression, unlike other approaches that make the quality of each patch roughly uniform or have limited binary mask-based compression capabilities. The main contributions of our approach are the proposal of a variable-rate image compression algorithm conditioned on a real-valued quality map, the design of an effective network architecture based on spatially adaptive feature transform, and the introduction of a method to estimate task-specific quality maps for image compression at test time. The rest of the paper discusses related literature, presents the proposed method, and provides experimental results and analysis.