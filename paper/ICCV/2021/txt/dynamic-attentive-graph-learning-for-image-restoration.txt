Abstract
Non-local self-similarity in natural images has been ver-ified to be an effective prior for image restoration. However, most existing deep non-local methods assign a fixed number of neighbors for each query item, neglecting the dynamics of non-local correlations. Moreover, the non-local correla-tions are usually based on pixels, prone to be biased due to image degradation. To rectify these weaknesses, in this pa-per, we propose a dynamic attentive graph learning model (DAGL) to explore the dynamic non-local property on patch level for image restoration. Specifically, we propose an im-proved graph model to perform patch-wise graph convo-lution with a dynamic and adaptive number of neighbors for each node. In this way, image content can adaptively balance over-smooth and over-sharp artifacts through the number of its connected neighbors, and the patch-wise non-local correlations can enhance the message passing pro-cess. Experimental results on various image restoration tasks: synthetic image denoising, real image denoising, im-age demosaicing, and compression artifact reduction show that our DAGL can produce state-of-the-art results with superior accuracy and visual quality. The source code is available at https://github.com/jianzhangcs/DAGL. 1.

Introduction
Image restoration (IR) is typically an ill-posed inverse problem aiming to restore a high-quality image (IHQ) from its degraded measurement (ILQ) corrupted by vari-ous degradation factors. The degradation process can be defined as ILQ = HIHQ + n, where H is a linear degra-dation matrix, and n represents additive noise [48, 55]. Ac-cording to H, IR can be categorized into many subtasks, e.g., denoising, compression artifact reduction, demosaic-ing, super-resolution, compressive sensing [49, 53, 54, 46].
The rise of deep learning has greatly facilitated the de-This work was supported in part by National Natural Science Founda-tion of China (61902009). (Corresponding author: Jian Zhang.) velopment of image restoration. Many deep learning-based methods [49, 50, 51, 33] have been proposed to solve this ill-posed problem. Despite the remarkable success, most methods focus on learning from a lot of external training data without fully utilizing the internal prior in images.
By contrast, many classic model-based methods are imple-mented based on various priors, e.g., total variation [26], sparse representation [9, 10, 47], and self-similarity [4, 7].
The self-similarity assumes that similar content would re-cur across the whole image, and the local content can be recovered with the help of similar items from other places.
Inspired by [4], non-local neural networks [40] utilized self-similarity via deep networks, which are subsequently in-troduced to many image restoration tasks [20, 52]. How-ever, these pixel-wise non-local methods are easily influ-enced by noisy signals within corrupted images. [18, 19] were proposed to establish long-range correlations on patch level. Nevertheless, the patch matching step is isolated from the training process. In N3Net [29], a differentiable
K-Nearest Neighbor (KNN) method was proposed. How-ever, restricted by the high complexity of channel-wise fea-ture fusion, N3Net can only perform the non-local opera-tion within a small search region (10 Ã— 10) and a small number of matching patches. Some very recent meth-ods [24, 23, 5] proposed more efficient patch-wise non-local methods. But they followed the same paradigm as existing non-local methods to construct fully connected correlations.
In general, the repeatability of different image content is distinct, causing different requirements of non-local cor-relations in restoring different image content. An early work [56] has well studied this property, finding that smooth image contents recur much more frequently than complex image details, and they should be treated differently.
Graph convolutional network (GCN) is a special non-local method designed to process the graph data by es-tablishing long-range correlations in non-Euclidean space.
However, the large domain gap limits the application of this flexible non-local method in computer vision community.
Recently, few works [36, 35, 21] proposed to apply GCN to image restoration tasks. Specifically, [36] and [35] are built
based on Edge-Conditioned Convolution (ECC) [32] for im-age denoising. However, they constructed the long-range correlations based on pixels and assigned a fixed number of neighbors for each graph node. In [21], a patch-wise GCN method is proposed for facial expression restoration. Nev-ertheless, the adjacency matrix is predefined based on the facial structure and isolated from the training process. In addition to ECC, graph attention network (GAT) [38] is a popular graph model combined with attention mechanism to identify the importance of different neighboring nodes.
Inspired by GAT, in this paper, we propose a novel dy-namic attentive graph learning model (DAGL) for image restoration.
In our proposed DAGL, the corrupted image is recovered in an image-specific and adaptive graph con-structed based on local feature patches. 2.