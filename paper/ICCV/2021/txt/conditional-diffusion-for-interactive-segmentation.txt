Abstract
In click-based interactive segmentation, the mask extrac-tion process is dictated by positive/negative user clicks; however, most existing methods do not fully exploit the user cues, requiring excessive numbers of clicks for sat-isfactory results. We propose Conditional Diffusion Net-work (CDNet), which propagates labeled representations from clicks to conditioned destinations with two levels of affinities: Feature Diffusion Module (FDM) spreads fea-tures from clicks to potential target regions with global simi-larity; Pixel Diffusion Module (PDM) diffuses the predicted logits of clicks within locally connected regions. Thus, the information inferred by user clicks could be generalized to proper destinations. In addition, we put forward Diversified
Training (DT), which reduces the optimization ambiguity caused by click simulation. With FDM,PDM and DT, CD-Net could better understand user’s intentions and make bet-ter predictions with limited interactions. CDNet achieves state-of-the-art performance on several benchmarks. 1.

Introduction
Interactive segmentation has been a topic of research for a long while; various forms of interactions have been ex-plored. Human could provide bounding boxes [26, 30, 15], scribbles [16, 6, 1], or clicks [27, 20, 32, 11] to express the segmentation intentions, which guide the algorithm for the mask extraction process. The segmentation target could be anything that users want, which requires interactive seg-mentation to be a flexible tool and makes it a challenging vision task. In this work, we address click-based interactive segmentation, and we aim to improve upon existing works by better understanding user’s intentions.
For click-based interactive segmentation, users places positive/negative clicks (red/ green points in Fig. 1) to in-dicate foreground/ background regions. In general, a user’s click contains two layers of information: the first layer is spatial – the location of the foreground/background could
*Corresponding Author (a) Baseline (b) CDNet (c) Baseline (d) CDNet
Figure 1. Comparison of baseline method and CDNet. Posi-tive /negative clicks are marked in red and green. Diffusion flows are visualized in colored arrows. As the red arrow denotes, CDNet propagates information from clicks to target destinations, while suppressing the invalid flow denoted by the white arrow. be indicated by the distribution of clicks; the second layer is visual – the label of regions around the clicks could be inferred by visual similarity. In a standard pipeline, the first step is encoding clicks into distance maps [32, 27, 11, 31],
Gaussian maps [20, 23, 21, 14], or super-pixels [22]; next, encoded maps is concatenated with the original image and fed into a segmentation network to make predictions. This kind of method exploits good use of spatial information but ignores the visual hint. Consequently, we see two problems: 1) like the example in Fig. 1 (a), the label of a click often fails to be generalized to target regions further away from clicks, even if parts of the target region has almost the same appearance as the click. 2) the labels could spill over to the wrong regions, even if the target has clear boundaries, as demonstrated in Fig. 1 (c).
To address the aforementioned issues, we explored to model the affinity between different locations and diffuse the representations from clicks to unlabeled regions. A straightforward solution is modeling the affinity simply based on feature similarity. However, it would lead to over-in Fig. 1 (b), the information should not generalization: propagate from A to C (under the assumption that the target is the bottom flamingo), even though they are visually simi-1
lar. To deal with over-generalization, constraining the diffu-sion within a instance/ semantic- level range around clicks is an option that can be thought of directly. Again, since the target was flexibly defined and could be either part, in-stance, or stuff, a fixed constrain would not be a cure-all. In general, it is a dilemma that we expect to enlarge the diffu-sion range and avoid over-generalization simultaneously.
Facing this challenge, we conduct an in-depth study of information diffusion and propose Conditional Diffu-sion Network (CDNet), which diffuses information from clicks and dynamically constrains the diffusion destination.
Specifically, two components are designed:
• Feature Diffusion Module (FDM) generates a con-ditional affinity map. It firstly considers feature sim-ilarity to diffuse the representations from clicks to all unlabeled regions. We then constrain the diffusion des-tination by a primitive prediction of foreground/ back-ground per the distribution of clicks and the content of the image. FDM propagates features in full-image with a global perspective.
• Pixel Diffusion Module (PDM) constructs a condi-tional diffusion source on the predicted logits, and leverages color similarity to diffuse the labels of clicks.
It constrains the diffusion in local regions with uniform color to avoid over-generalization. Meanwhile, the dif-fusion is carried out iteratively to enlarge the range of destination. PDM mainly refines the details.
FDM and PDM work in synergy to extract representations with both high-level and low-level consistency in a coarse-to-fine manner. To better train CDNet, we develop a practi-cal training regime called Diversified Training (DT), which eases the optimization ambiguity caused by click simula-tion. Combing FDM/PDM/DT together, CDNet better ex-ploits the information contained in clicks by diffusing the representations of clicks to correct destinations and makes better predictions with fewer clicks.
Large amounts of experiments have been conducted on
GrabCut [26], Berkeley [24], SBD [8], and DAVIS [25] datasets. Results prove the effectiveness of our method and show that our CDNet achieves state-of-the-art performance.
Our contributions could be summarized as follows: 1) We formulate click-based interactive segmentation as a process of conditional diffusion and propose CDNet, which predicts better segmentation results with fewer clicks. 2) We design
FDM and PDM, which propagate the labeled information of clicks to enhance unlabeled regions on different levels. 3) To better train CDNet, we develop Diversified Training, which reduces the optimization ambiguity caused by click simulation. 2.