Abstract
In this paper, we introduce a deep multi-view stereo (MVS) system that jointly predicts depths, surface normals and per-view confidence maps. The key to our approach is a novel solver that iteratively solves for per-view depth map and normal map by optimizing an energy potential based on the locally planar assumption. Specifically, the algorithm updates depth map by propagating from neigh-boring pixels with slanted planes, and updates normal map with local probabilistic plane fitting. Both two steps are monitored by a customized confidence map. This solver is not only effective as a post-processing tool for plane-based depth refinement and completion, but also differentiable such that it can be efficiently integrated into deep learn-ing pipelines. Our multi-view stereo system employs multi-ple optimization steps of the solver over the initial predic-tion of depths and surface normals. The whole system can be trained end-to-end, decoupling the challenging problem of matching pixels within poorly textured regions from the cost-volume based neural network. Experimental results on ScanNet and RGB-D Scenes V2 demonstrate state-of-the-art performance of the proposed deep MVS system on multi-view depth estimation, with our proposed solver con-sistently improving the depth quality over both conventional and deep learning based MVS pipelines. Code is available at https://github.com/thuzhaowang/idn-solver. 1.

Introduction
Dense multi-view stereo (MVS) has been a long-standing fundamental topic in computer vision. The key idea of most existing techniques is to compare the similar-ity of image patches at different depth hypotheses, densely matching pixels across images. While great improvement has been witnessed over decades, it is still a hard problem to accurately estimate dense geometry from posed images
*Equal contribution
Figure 1. By integrating the proposed iterative solver into end-to-end training, our method decouples the challenging problem of estimating depth values within poorly textured regions from the initial network predictions, getting the network to focus more on reliable estimation on well textured pixels. This improves depth quality on both textured (blue) and texture-less (red) regions. Note that on texture-less areas (red box on (c)(d)), the network jointly trained with the solver only focuses on predicting reliable geome-try on neighboring areas, leaving the poorly textured pixels to be resolved with the iterative solver module. in many real-world scenarios, especially in indoor environ-ments, where one of the most typical reasons of failure is the existence of texture-less areas (e.g. walls), which incur significant ambiguities to the matching step, as a number of different depths all result in low matching costs.
There have been various attempts to tackle this crucial problem. Global optimization [19, 5, 50] is one possible di-rection to resolve the ambiguities. Those methods initially assume a fixed set of superpixels and apply Markov random field with slanted-plane models. The optimization prefers globally smoothed geometry with locally planar surfaces and achieves promising performance. However, global op-timization methods suffer from large computational com-plexity and the performance is also limited by the quality of superpixels and handcrafted dense features.
With the recent success of deep learning, learning-based
methods have achieved great performance on datasets due to the improved quality of learned features and depth pri-ors. Typically, a cost-volume based architecture [51, 47] is trained end-to-end with a pixelwise loss function on depths.
While the ambiguities incurred by the texture-less areas still exist in the built cost volumes, several methods propose to utilize surface normals, either jointly predicted [38, 29] or online fitted [52, 33], to help train the depth predictions, aiming to implicitly enrich the network with locally planar priors by directly supervising the local structure of the pre-dicted depth map. However, it is still a difficult problem to successfully learn such priors and accurately predict depths on texture-less areas directly from the ambiguous cost vol-umes built on warped patches.
In this paper, we propose a novel deep multi-view stereo system that decouples the locally planar priors from the cost volume based depth/normal prediction networks. The key to our proposed system is a differentiable confidence-based solver that iteratively solves for depth map and normal map by optimizing an energy potential that prefers locally pla-nar surfaces. For each optimization iteration, the solver updates depth map by propagating from neighboring pix-els with slanted planes, and updates normal map with local probabilistic plane fitting. A customized confidence map can be used to monitor both two steps.
Our deep MVS system firstly predicts depth, normal and confidence jointly and then applies multiple optimization steps of our depth-normal solver upon the initial predic-tions. Those multiple steps enable long-range propagation of reliable depths and normals. The whole system can be trained end-to-end, guiding the depth/normal network to fo-cus more on confident depth/normal predictions on textured areas and leave the poorly textured regions to be resolved with the solver. For the solver module, a hybrid confidence map combining the deep confidence prediction and the con-ventional geometric reprojection check can be used to sta-bilize the optimization process at inference.
The proposed system combines the advantages of slanted-plane models [4] and learning-based techniques.
With end-to-end training, the initial depth prediction is guided to focus only on reliable estimation over partial re-gions rather than the whole image (as shown in Fig. 1). Ex-perimental results on ScanNet and RGB-D Scenes V2 show that our novel deep MVS achieves state-of-the-art perfor-mance in terms of accuracy on depths and surface normals, with the proposed solver consistently improving the depth quality over both conventional and deep MVS pipelines. 2.