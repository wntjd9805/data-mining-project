Abstract
This paper studies the task of inpainting man-made scenes. It is very challenging due to the difficulty in preserv-ing the visual patterns of images, such as edges, lines, and junctions. Especially, most previous works are failed to re-store the object/building structures for images of man-made scenes. To this end, this paper proposes learning a Sketch
Tensor (ST) space for inpainting man-made scenes. Such a space is learned to restore the edges, lines, and junctions in images, and thus makes reliable predictions of the holis-tic image structures. To facilitate the structure refinement, we propose a Multi-scale Sketch Tensor inpainting (MST) network, with a novel encoder-decoder structure. The en-coder extracts lines and edges from the input images to project them into an ST space. From this space, the decoder is learned to restore the input images. Extensive experi-ments validate the efficacy of our model. Furthermore, our model can also achieve competitive performance in inpaint-ing general nature images over the competitors. 1.

Introduction
As a long-standing problem, image inpainting has been studied to address the problem of filling in the missing parts of the images being semantically consistent and visually re-alistic with plausible results. Thus, image inpainting is use-ful to many real-world applications, e.g. image restoration, image editing, and object removal [6].
Intrinsically as an inverse problem, the inpainting is chal-lenging in both restoring the missed global structure (se-mantically consistent), and generating realistic regions lo-cally coherent to unmasked regions (visually consistent).
Especially, it is hard to reconstruct the missed image re-gions from the complex man-made scenes and structures, due to the difficulty in preserving the prominent low-level visual patterns, such as edges, line segments, and junctions, as shown in Fig. 1. To this end, this paper particularly fo-cuses on learning to reconstruct these visual patterns for im-age inpainting, and proposes a method of the best merits in repairing the masked regions of man-made scene images, such as images with indoor and outdoor buildings.
Both traditional approaches [2, 8, 19] and deep learn-ing methods [24, 44, 40, 17, 43, 21] had made great ef-forts on reconstructing the structures of images in produc-ing visually realistic results. However, these methods are still challenged by producing structurally coherent results, especially in the inpainting of man-made scenes. Typi-cally, inpainting approaches may suffer from the follow-ing problems. (1) Missing critical structures. Traditional synthesis-based approaches are normally unable to model
the critical structures as in Fig. 1(b). On the other hand, recent learning-based inpainting methods utilize auxiliary information to support the inpainting, e.g., edges [28, 20], and segmentation [32, 22], predominantly inpainting lo-cal visual cues, rather than holistic structures of man-made scenes. For example, the results of EdgeConnect [28] with canny edges [5] in Fig. 1(d) suffer from broken and blurry line segments and lose connectivity of building structures. (2) Unreliable pattern transfer. The learning-based auxil-iary detectors will transfer and magnify the unreliable im-age priors or patterns to the masked image regions, which (3) Trading off causes degraded inpainting results [22]. performance and efficiency. The auxiliary-based inpainting methods usually consume more computation, due to addi-tional components or training stages [28, 20, 39]. But these methods still have artifacts in junction regions as framed with red dotted lines in Fig. 1(c)(d). Therefore, the design of a more effective network is expected to efficiently en-hance the inpainting performance.
To address these issues, our key idea is to learn a Sketch
Tensor (ST) space by an encoder-decoder model. (1) The encoder learns to infer both local and holistic critical struc-tures of input images, including canny edges and composi-tional lines. The image is encoded as the binarized ‘sketch’ style feature maps, dubbed as sketch tensor. The decoder takes the restored structure to fill in holes of images. (2)
For the first time, the idea of parsing wireframes [14] is re-purposed to facilitate inpainting by strengthening the holis-tic structures of man-made scenes with more effective and flexible holistic structures. We propose a Line Segment
Masking (LSM) algorithm to effectively train the wireframe parser, which alleviates unreliable structure guidance from corrupted images and the heavy computation of auxiliary detectors during the training phase. Besides, LSM also leverage the separability of line segments to extend the pro-posed model to obtain better object removal results. (3)
Most importantly, we significantly boost the training and in-ference process of previous inpainting architectures. Thus, a series of efficient modules are proposed, which include partially gated convolutions, efficient attention module, and
Pyramid Decomposing Separable (PDS) blocks. Critically, we present PDS blocks to help better learn binary line and edge maps. Our proposed modules make a good balance of model performance and training efficiency.
Formally, this paper proposes a novel Multi-scale Sketch
Tensor inpainting (MST) network with an encoder-decoder structure. The encoder employs LSM algorithm to train an hourglass wireframe parser [38] and a canny detector to ex-tract line and edge maps. These maps concatenated with input images are projected into ST space by Pyramid Struc-ture Sub-encoder (PSS), which is sequentially constructed by 3 partially gated convolution layers, 8 dilated residual block layers with an efficient attention module, and 3 pyra-mid decomposing block layers as in Fig. 2. The image is encoded as a third-order sketch tensor in ST space, repre-senting local and holistic structures. Finally, the decoder is stacked by two groups of 3 partially gated convolution lay-ers for both ends with 8 residual block layers, which will re-project the sketch tensor into the restored image.
We highlight several contributions here. (1) We propose learning a novel sketch tensor space for inpainting tasks.
Such a space is learned to to restore the critical missed struc-tures and visual patterns, and makes reliable predictions of the holistic image structures. Essentially, the skech ten-sor has good interpretability of input images, as empirically shown in experiments. (2) For the first time, the wireframe parsing has been re-purposed to extract lines and junctions for inpainting. A novel line segment masking algorithm is proposed to facilitate training our inpainting wireframe parser. (3) We introduce the novel partially gated convolu-tion and efficient attention module to significantly improve model performance without incurring additional expensive computational cost than competitors, such as EdgeConnect. (4) A novel pyramid decomposing separable block is pro-posed to address the issue of effectively learning sparse binary edge and line maps. (5) Extensive experiments on the dataset of both man-made and natural scenes, including
ShanghaiTech [14], Places2 [48], and York Urban [4]. show the efficacy of our MST-net, over the competitors. 2.