Abstract
Training a single deep blind model to handle differ-ent quality factors for JPEG image artifacts removal has been attracting considerable attention due to its conve-nience for practical usage. However, existing deep blind methods usually directly reconstruct the image without pre-dicting the quality factor, thus lacking the flexibility to con-trol the output as the non-blind methods. To remedy this problem, in this paper, we propose a flexible blind convo-lutional neural network, namely FBCNN, that can predict the adjustable quality factor to control the trade-off be-tween artifacts removal and details preservation. Specifi-cally, FBCNN decouples the quality factor from the JPEG image via a decoupler module and then embeds the pre-dicted quality factor into the subsequent reconstructor mod-ule through a quality factor attention block for flexible con-trol. Besides, We find existing methods are prone to fail on non-aligned double JPEG images even with only one pixel shift, and we thus propose a double JPEG degrada-tion model to augment the training data. Extensive experi-ments on single JPEG images, more general double JPEG images and real-world JPEG images demonstrate that our proposed FBCNN achieves favorable performance against state-of-the-art methods in terms of both quantitative met-rics and visual quality. 1.

Introduction
JPEG [39] is one of the most widely-used image com-pression algorithms and formats due to its simplicity and fast encoding/decoding speeds. JPEG compression splits an image into 8 × 8 blocks and applies discrete cosine trans-form (DCT) to each block. The DCT coefficients are then divided by a quantization table and rounded to the nearest integer. The elements in the quantization table control the compression ratio and the rounding operation is the only lossy operation in the whole process. The quantization ta-*Corresponding author. ble is usually represented by an integer called quality factor (QF) ranging from 0 to 100, where a lower quality factor means less storage size but more lost information. Inspired by the success of deep neural networks (DNNs) for image classification [25, 37], researchers began to resort to DNNs for JPEG artifacts removal and have achieved notable aca-demic success.
However, existing methods for JPEG artifacts removal (1) generally have four limitations in real applications:
Most existing DNNs based methods [6, 7, 11, 28, 54] trained a specific model for each quality factor, lacking the flexibility to learn a single model for different JPEG quality factors. (2) DCT based methods [13, 17, 53] need to obtain the DCT coefficients or quantization table as input, which is only stored in JPEG format. Besides, when images are compressed multiple times, only the most recent compres-sion information is stored. (3) To solve the first problem, some recent work [13, 15, 50] resort to training a single model for a large range of quality factors. However, these blind methods can only provide a deterministic reconstruc-tion result for each input, ignoring the need for user pref-erences. (4) Existing methods are all trained with synthetic images which assumes that the low-quality images are com-pressed only once. However, most images from the Internet are compressed multiple times. Despite some progresses for real recompressed images, e.g., from Twitter [11, 15], a de-tailed and complete study on double JPEG artifacts removal is still missing.
To tackle the above problems, we design a flexible blind convolutional neural network, namely FBCNN, for real
JPEG image restoration. Our FBCNN is a single model that can deal with JPEG images with different quality factors. In addition, FBCNN can work independent of the image for-mats, as it directly processes images in pixel-domain, with-out the need to access the metadata of images. By further decoupling the latent quality factor from the input JPEG image, we can use this important parameter to guide the artifacts removal process. As a controllable variable with clear physical meaning, the predicted quality factor can also be adjusted via interactive selection to achieve a balance
between artifacts removal and details preservation. To ad-dress the problems with real-world JPEG images, we pro-vide a detailed study on the restoration of images with dou-ble JPEG compression. We find that existing blind methods are prone to fail when the 8 × 8 blocks of double JPEG compression are not aligned and QF1 ≤ QF2. However, our quality factor predictor can help to explain the behavior of current blind methods under unseen scenarios. We provide comprehensive empirical evidence showing that blind meth-ods work are easy to be misled by the unseen compound ar-tifacts, resulting in an unpleasant reconstructed output. By correcting the predicted quality factor, FBCNN instead can boost the performance on complex double JPEG images.
To obtain a fully blind model, we further propose two solu-tions: correcting QF to the smaller one which can be esti-mated by our dominant QF estimation method or augment-ing the training data with non-aligned double JPEG images.
To summarize, the main contributions of this paper are: (1) A flexible blind convolutional neural network for
JPEG artifacts removal (FBCNN) is proposed. FBCNN can predict the latent quality factor to guide the image restora-tion. The predicted quality factor can be adjusted manually to control the preference between artifacts removal and de-tails preservation according to the user’s needs. (2) We perform a thorough analysis of double JPEG im-ages and provide solutions to take a step towards the restora-tion of real images. To the best of our knowledge, this is the first attempt to handle double non-aligned JPEG compres-sion. We hope that the community will gradually begin to consider this more challenging and realistic scenario. (3) We demonstrate the effectiveness of FBCNN on syn-thetic and real JPEG images with complex degradation set-tings. Our proposed FBCNN provides a useful solution for practical applications. 2.