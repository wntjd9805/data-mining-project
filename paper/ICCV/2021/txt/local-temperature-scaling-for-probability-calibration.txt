Abstract
For semantic segmentation, label probabilities are often uncalibrated as they are typically only the by-product of a segmentation task. Intersection over Union (IoU) and Dice score are often used as criteria for segmentation success, while metrics related to label probabilities are not often ex-plored. However, probability calibration approaches have been studied, which match probability outputs with exper-imentally observed errors. These approaches mainly fo-cus on classiﬁcation tasks, but not on semantic segmenta-tion. Thus, we propose a learning-based calibration method that focuses on multi-label semantic segmentation. Specif-ically, we adopt a convolutional neural network to predict local temperature values for probability calibration. One advantage of our approach is that it does not change pre-diction accuracy, hence allowing for calibration as a post-processing step. Experiments on the COCO, CamVid, and
LPBA40 datasets demonstrate improved calibration perfor-mance for a range of different metrics. We also demonstrate the good performance of our method for multi-atlas brain segmentation from magnetic resonance images. 1.

Introduction
With the development of deep convolutional neural net-works (CNNs), the accuracy of semantic segmentation has improved dramatically [9, 43]. However, ideally seman-tic segmentation networks should not only be accurate, but should also indicate when they are likely incorrect. For example, an autonomous driving system might use deep convolutional neural networks to analyze a real-time scene from a camera [5], the associated semantic segmentation of street scenes should provide accurate detections of pedes-trians and other vehicles, and the system should recognize when such predictions are unreliable. Another example is the segmentation of brain tumors with a CNN [22]. If the segmentation network can not conﬁdently segment critical regions of the brain, then a medical expert should decide or be alerted to such doubtful regions. Thus, it is important for semantic segmentation networks to generate both accurate label predictions and accurate conﬁdence measures.
However, due to overﬁtting, CNNs for semantic seg-mentation tend to be overconﬁdent about predicted la-bels [17, 20, 29, 41]. Approaches for joint prediction and calibration exist [36, 44, 48, 52]. However, they require changing the learning task and typically strive for calibra-tion, but do not guarantee it. An alternative approach is to calibrate the resulting probabilities of a model via post-processing so that they better reﬂect the true probabilities of being correct. This is the kind of approach we consider here as it easily applies to pre-trained networks and can even benﬁt joint prediction/calibration approaches. Probability calibration, ﬁrst studied for classiﬁcation [58], generally ad-dresses this problem via a hold-out validation dataset.
Existing calibration approaches still have several limi-tations: (1) Most of the probability calibration approaches are designed for classiﬁcation, thus are not guaranteed to work well for semantic segmentation (where it is also more challenging to annotate on a pixel/voxel level); (2) While there is limited work discussing probability calibration for semantic segmentation, this work either only applies to spe-ciﬁc types of models (e.g., Bayesian neural networks [29]) or only implicitly improves calibration performance (e.g., via model ensembling [47] or multi-task learning [31]); (3)
Most methods are designed to work for binary classiﬁca-tions and approach multi-class problems by a decomposi-tion into k one-vs-rest binary calibrations (where k denotes the number of classes). However, such a decomposition does not guarantee overall calibration (only for the individ-ual subproblems before normalization) and the classiﬁca-tion accuracy of the trained model may change after cali-bration as the probability order of labels may change.
Our goal is to develop a post-processing calibration method for multi-label semantic segmentation, which re-tains label probability order and, therefore, a model’s seg-mentation accuracy. Our work is inspired by temperature scaling (TS) [20] for classiﬁcation probability calibration.
As TS determines only one global scaling constant, it can-not capture spatial miscalibration changes in images. We therefore (1) extend TS to multi-label semantic segmenta-tion and (2) make it adaptive to local image changes.
Our contributions are: (1) Spatially localized proba-bility calibration: We propose a learning-based local TS method that predicts a separate temperature scale for each pixel/voxel. (2) Completely separated accuracy-preserving post-processing: Our approach is completely separated from the segmentation task, leaving the prediction accuracy unchanged. (3) Theoretical justiﬁcation: We provide a the-oretical analysis for the effectiveness of our approach. (4)
Comprehensive analysis: We provide deﬁnitions and eval-uation metrics for probability calibration for semantic seg-mentation and validate our approach both qualitatively and quantitatively. (5) Practical application: We successfully apply our calibrated probabilities for multi-atlas segmenta-tion label fusion in the ﬁeld of medical image analysis. 2.