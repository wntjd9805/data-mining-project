Abstract
Localizing individuals in crowds is more in accordance with the practical demands of subsequent high-level crowd analysis tasks than simply counting. However, existing localization based methods relying on intermediate rep-resentations (i.e., density maps or pseudo boxes) serving as learning targets are counter-intuitive and error-prone.
In this paper, we propose a purely point-based framework for joint crowd counting and individual localization. For this framework, instead of merely reporting the absolute counting error at image level, we propose a new metric, called density Normalized Average Precision (nAP), to pro-vide more comprehensive and more precise performance evaluation. Moreover, we design an intuitive solution un-der this framework, which is called Point to Point Network (P2PNet). P2PNet discards superﬂuous steps and directly predicts a set of point proposals to represent heads in an image, being consistent with the human annotation results.
By thorough analysis, we reveal the key step towards im-plementing such a novel idea is to assign optimal learn-ing targets for these proposals. Therefore, we propose to conduct this crucial association in an one-to-one match-ing manner using the Hungarian algorithm. The P2PNet not only signiﬁcantly surpasses state-of-the-art methods on popular counting benchmarks, but also achieves promis-ing localization accuracy. The codes will be available at:
TencentYoutuResearch/CrowdCounting-P2PNet. 1.

Introduction
Among all the related concrete tasks of crowd analysis, crowd counting is a fundamental pillar, aiming to estimate the number of individuals in a crowd. However, simply giv-ing a single number is obviously far from being able to sup-port the practical demands of subsequent higher-level crowd
∗Equal contribution. †Corresponding author.
Figure 1. Illustrations for the comparison of our pipeline with ex-isting methods, in which the predictions are marked in Red while the ground truths are marked as Green. Top ﬂow: The dominated density map learning based methods fail to provide the exact lo-cations of individuals. Middle ﬂow: The estimated inaccurate ground truth bounding boxes make the detection based methods error-prone, such as the missing detections as indicated, especially for the NMS-like process. Bottom ﬂow: Our pipeline directly pre-dicts a set of points to represent the locations of individuals, which is simple, intuitive and competitive as demonstrated, bypassing those error-prone steps. Best viewed in color. analysis tasks, such as crowd tracking, activity recognition, abnormality detection, ﬂow/behavior prediction, etc.
In fact, there is an obvious tendency in this ﬁeld for more challenging ﬁne-grained estimation (i.e., the locations of individuals) beyond simply counting. Speciﬁcally, some approaches cast crowd counting as a head detection prob-lem, but leaving more efforts on labor-intensive annotation for tiny-scale heads. Other approaches [26, 30] attempted to generate the pseudo bounding boxes of heads with only
point annotations provided, which however appears to be tricky or inaccurate at least. Also trying to directly lo-cate individuals, several methods [14, 20] got stuck in sup-pressing or splitting over-close instance candidates, mak-ing themselves error-prone due to the extreme head scale variation, especially for highly-congested regions. To es-chew the above problems, we propose a purely point-based framework for jointly counting and localizing individuals in crowds. This framework directly uses point annotations as learning targets and simultaneously outputs points to locate individuals, beneﬁting from the high-precision localization property of point representation and its relatively cheaper annotation cost. The pipeline is illustrated in Figure 1.
Additionally, in terms of the evaluation metrics, some farsighted works [7, 32] encourage to adopt patch-level met-rics for ﬁne-grained evaluation, but they only provide a rough measure for localization. Other existing localization aware metrics either ignore the signiﬁcant density variation across crowds [26, 30] or lack the punishment for dupli-cate predictions [30, 35]. Instead, we propose a new met-ric called density Normalized Average Precision (nAP) to provide a comprehensive evaluation metric for both local-ization and counting errors. The nAP metric supports both box and point representation as inputs (i.e., predictions or annotations), without the defects mentioned above.
Finally, as an intuitive solution under this new frame-work, we develop a novel method to directly predict a set of point proposals with the coordinates of heads in an image and their conﬁdences. Speciﬁcally, we propose a Point-to-Point Network (P2PNet) to directly receive a set of anno-tated head points for training and predict points too dur-ing inference. Then to make such an idea work correctly, we delve into the ground truth target assignation process to reveal the crucial of such association. The conclusion is that either the case when multiple proposals are matched to a single ground truth, or the opposite case, can make the model confused during training, leading to over-estimated or under-estimated counts. So we propose to perform an one-to-one matching by Hungarian algorithm to associate the point proposals with their ground truth targets, and the unmatched proposals should be classiﬁed as negatives. We empirically show that such a matching is beneﬁcial to im-proving the nAP metric, serving as a key component for our solution under the new framework. This simple, intuitive and efﬁcient design yields state-of-the-art counting perfor-mance and promising localization accuracy.
The major contributions of this work are three-fold: 1. We propose a purely point-based framework for joint counting and individual localization in crowds. This frame-work encourages ﬁne-grained predictions, beneﬁting the practical demands of downstream tasks in crowd analysis. 2. We propose a new metric termed density Normalized
Average Precision to account for the evaluation of both lo-calization and counting, as a comprehensive evaluation met-ric under the new framework. 3. We propose P2PNet as an intuitive solution following this conceptually simple framework. The method achieves state-of-the-art counting accuracy and promising localiza-tion performance, and might also be inspiring for other tasks relying on point predictions. 2.