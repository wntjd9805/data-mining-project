Abstract
Due to the stochasticity of human behaviors, predict-ing the future trajectories of road agents is challenging for autonomous driving. Recently, goal-based multi-trajectory prediction methods are proved to be effective, where they
ﬁrst score over-sampled goal candidates and then select a ﬁnal set from them. However, these methods usually in-volve goal predictions based on sparse pre-deﬁned anchors and heuristic goal selection algorithms. In this work, we propose an anchor-free and end-to-end trajectory predic-tion model, named DenseTNT, that directly outputs a set of trajectories from dense goal candidates.
In addition, we introduce an ofﬂine optimization-based technique to pro-vide multi-future pseudo-labels for our ﬁnal online model.
Experiments show that DenseTNT achieves state-of-the-art performance, ranking 1st on the Argoverse motion forecast-ing benchmark and being the 1st place winner of the 2021
Waymo Open Dataset Motion Prediction Challenge. 1.

Introduction
For a safe and smooth autonomous driving system, an essential technology is to predict the future behaviors of road participants. For example, knowing whether other ve-hicles intend to cut in better helps us to make brake deci-sions. However, motion prediction is a highly challenging task due to the inherent stochasticity and multimodality of human behaviors.
To model this high degree of uncertainty, some ap-proaches predict multiple future trajectories by sampling from the distribution represented by the latent variables, e.g.
VAEs [18, 36] and GANs [12]. Other approaches generate a set of trajectories but only perform regression on the closest one during training [12, 20, 8], namely using variety loss.
However, sampling-based methods cannot output the like-lihood of the predicted futures and the variety loss lacks interpretability on the outputs.
More recently, goal-based methods [39, 30, 37] have gained popularity and achieved state-of-the-art perfor-*Corresponding to: hangzhao@mail.tsinghua.edu.cn
Figure 1. A typical goal-based trajectory prediction pipeline is shown in the upper part of the ﬁgure. Existing goal prediction methods (lower left) ﬁrst deﬁne sparse goal anchors heuristically, and regress and classify these anchors to estimate the goals; then rules like non-maximum suppression (NMS) are used for goal se-lection. In contrast, our method (lower right) estimates the prob-abilities of dense goal candidates without relying on the heuris-tic anchors (anchor-free). And it gets rid of rule-based post-processing by generating a set of goals in an end-to-end manner. mance. Their key observation is that the goal (endpoint) carries most of the uncertainty of a trajectory, therefore they
ﬁrst predict the goal(s) of an agent, and then further com-plete the corresponding full trajectory for each goal. The
ﬁnal goal positions are obtained by classifying and regress-ing predeﬁned sparse anchors, as shown in the lower-left part of Figure 1. For example, TNT [39] deﬁnes anchors as the points sampled on the lane centerlines; some others [37] take the lane segments as anchors and predicted a goal for each lane segment. Another technique commonly adopted by these methods is to apply a rule-based algorithm to select a ﬁnal small number of goals. The most notable algorithm is non-maximum suppression (NMS) [39], where only locally high-scored goals are selected.
The limitations of these methods are two-folds. First, the prediction performance of these methods heavily de-pends on the quality of the goal anchors. Since an anchor can only generate one goal, a model cannot make multiple trajectory predictions around one anchor. Besides, sparse
anchor-based methods cannot capture ﬁne-grained informa-tion, i.e. different positions on the same lane segment con-tain different local information, such as the relative distance to the nearest lane boundary. Moreover, after estimating the probability of the sparse goals, NMS is used to heuristi-cally select the goal set, which is a greedy algorithm and is not guaranteed to ﬁnd the optimal solution given the multi-modal nature of the problem.
To address these issues, we propose DenseTNT, an anchor-free and end-to-end multi-trajectory prediction method. DenseTNT ﬁrst generates dense goal candidates with their probabilities from the scene context; from the goal probabilities, it further employs a goal set predictor to produce a ﬁnal set of trajectory goals. Compared to the pre-vious methods, DenseTNT better models goal candidates and gets rid of post-processing.
Goal set prediction in DenseTNT is a multi-label predic-tion problem and requires multiple labels as training targets.
However, unlike object detection, which innately has mul-tiple label boxes as supervision [2], in trajectory prediction we only observe one ground truth future out of many pos-sible futures in each training sample, making it extremely challenging to supervise the model. To tackle this problem, we devise an ofﬂine model to provide multi-future pseudo-labels for our online model. Compared with the above on-line model, the ofﬂine model uses an optimization algorithm instead of the goal set predictor for goal set prediction. The optimization algorithm ﬁnds an optimal goal set from the probability distribution of the goals; and then the set of goals are used as pseudo-labels for the training of the on-line model.
DenseTNT achieves state-of-the-art performance in au-tonomous driving trajectory prediction tasks, ranking 1st on the Argoverse motion forecasting benchmark and 1st in the 2021 Waymo Open Dataset Motion Prediction Challenge. 2.