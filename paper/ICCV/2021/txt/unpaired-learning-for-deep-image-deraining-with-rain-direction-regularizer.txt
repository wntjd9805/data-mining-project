Abstract
We present a simple yet effective unpaired learning based image rain removal method from an unpaired set of syn-thetic images and real rainy images by exploring the prop-erties of rain maps. The proposed algorithm mainly consists of a semi-supervised learning part and a knowledge dis-tillation part. The semi-supervised part estimates the rain map and reconstructs the derained image based on the well-established layer separation principle. To facilitate rain re-moval, we develop a rain direction regularizer to constrain the rain estimation network in the semi-supervised learning part. With the estimated rain maps from the semi-supervised learning part, we ﬁrst synthesize a new paired set by adding to rain-free images based on the superimposition model.
The real rainy images and the derained results constitute another paired set. Then we develop an effective knowl-edge distillation method to explore such two paired sets so that the deraining model in the semi-supervised learning part is distilled. We propose two new rainy datasets, named
RainDirection and Real3000, to validate the effectiveness of the proposed method. Both quantitative and qualitative experimental results demonstrate that the proposed method achieves favorable results against state-of-the-art methods in benchmark datasets and real-world images. 1.

Introduction
Single image deraining aims to estimate a rain-free im-age from a rainy image. It is a classical image processing problem, which has been an active research topic in the vi-sion and graphics communities within the last decade. As numerous real-world tasks (e.g., trafﬁc detection and envi-ronmental monitoring) require high-quality images, and the rainy environment usually leads to deprecated images, it is of great interest to develop an effective algorithm to recover rain-free images.
Rain is a complex atmospheric phenomenon.
Images with rain may lose color ﬁdelity and suffer visual occlusions as a result of rain streaks (drops) move through the back-ground scene. Mathematically, the raining process can be formulated by the following linear superimposition model: (1) where O is the rainy image, B is the rain-free image, and
O(x) = B(x) + R(x),
R is the rain map, which describes the distribution and mo-tion of the rain. x denotes the pixel coordinate. As only O is available, we need to recover B and R simultaneously. This problem is highly ill-posed because many different pairs of
B and R give rise to the same O, e.g., a nearly all-zeros matrix for R and a rainy image for B, where the networks do not succeed in estimating the rain map due to the com-plicated distribution and motion of the rain.
To make image deraining problem well-posed, existing methods usually make some assumptions on the rain map and rain-free image. For example, the low rank representa-tion model [1], the sparse representation model [14], Gaus-sian mixture model [11] have been proposed to model the rain maps or rain-free images to help rain removal. Jiang et al. [7] explore gradient operators based on the sparsity prior for rain maps. Instead of making some assumptions on the rain map and rain-free image, several methods fo-cus on developing end-to-end trainable networks for image deraining [2, 3, 30, 22, 19, 10]. To better explore the do-main knowledge, several deep learning-based methods im-pose constraints on the rain map or/and derained images in different perspectives, e.g., joint rain location detection in
[26], rain density label assigned in [29], rain kernels de-scribing the repetitive local patterns of rain streaks in [21].
These methods usually need paired data to train deep neu-ral networks. However, the pixel-wise content loss used in these methods tends to smooth details, while GAN based losses may generate fake structures. In [19, 13], Negative
SSIM loss is used to model the local structure similarity be-tween the derained image and ground truth one. However, the approach of only imposing constraints on the derained images neglects the distribution and motion of rain streaks.
Thus, it is necessary to explore the properties of the rain map for better rain removal.
We ﬁnd that the rain map of the natural rainy images usually has a linear shape with similar directions in a local image patch. The rain map is usually of high contrast with sharp edges as the pixels covered by rain present high inten-sity while the pixels without rain is close to zeros. Therefore we propose a rain direction regularizer to model the prop-erties of the rain map for the rain map estimation so that consistent and sharp rain structures can be preserved. The
proposed rain direction regularizer extracts gradient, which corresponding parallel and perpendicular directions of the rain maps to truthfully preserve the local consistency and sharpness of structures of rain maps.
To further improve the generalization ability for handling real rainy images, several methods [23, 28, 24, 13] reveal the gap existed between the synthetic and real rainy images due to the complicated situations of real rain inﬂuenced by the distribution and motion of the rain. Wang et al. [22] construct a paired real rain dataset by fusing rainy image sequences. However, we observe that structure and detail disalignment are bring into this dataset. Lin et al. [13] syn-thesize real rain maps with ﬁltered images to distill a rain map estimation network, yet the derained results are infe-rior to contemporaneous state-of-the-art methods according to their released experimental results.
To handle real images, we develop a semi-supervised learning method with the knowledge distillation strategy.
The semi-supervised learning estimates rain maps and de-rained images constrained by the rain direction regularizer.
With the estimated rain maps, we can synthesize a new paired set by applying the estimated rain maps to refer-ence clear images based on the raining model (1). Then, the knowledge distillation part distills the derained model in the semi-supervised learning part to facilitate rain re-moval tasks. In addition, considering the unavailability of the rain direction label of existing datasets, we construct a new dataset RealDirection, of which each rainy image is assigned with a direction label. A Real3000 dataset is also proposed as the existing publicly available real rainy dataset is small-scale. We conduct comprehensive experiments and show that the proposed method achieves promising results for rain removal tasks.
The main contributions of this work are as follows:
• We propose a simple and effective rain direction regu-larizer to preserve the structures and sharpness of the rain maps based on the local properties of rain maps.
• We develop an unpaired learning method for rain re-moval by incorporating semi-supervised learning and knowledge distillation strategy. Given an unpaired set of synthetic and real rainy images. The semi-supervised learning part estimates rain maps and de-rained images. The derained results are further im-proved by the knowledge distillation part.
• We propose the RainDirection dataset and Real3000 dataset to train the proposed method. Both quantitative and qualitative evaluations on the benchmark datasets and real-world images demonstrate the effectiveness of the proposed method. 2.