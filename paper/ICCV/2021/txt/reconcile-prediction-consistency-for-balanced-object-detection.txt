Abstract
Classiﬁcation and regression are two pillars of object detectors. In most CNN-based detectors, these two pillars are optimized independently. Without direct interactions be-tween them, the classiﬁcation loss and the regression loss can not be optimized synchronously toward the optimal di-rection in the training phase. This clearly leads to lots of inconsistent predictions with high classiﬁcation score but low localization accuracy or low classiﬁcation score but high localization accuracy in the inference phase, especially for the objects of irregular shape and occlusion, which severely hurts the detection performance of existing detectors after N-MS. To reconcile prediction consistency for balanced object detection, we propose a Harmonic loss to harmonize the op-timization of classiﬁcation branch and localization branch.
The Harmonic loss enables these two branches to supervise and promote each other during training, thereby producing consistent predictions with high co-occurrence of top classiﬁ-cation and localization in the inference phase. Furthermore, in order to prevent the localization loss from being dominat-ed by outliers during training phase, a Harmonic IoU loss is proposed to harmonize the weight of the localization loss of different IoU-level samples. Comprehensive experiments on benchmarks PASCAL VOC and MS COCO demonstrate the generality and effectiveness of our model for facilitating existing object detectors to state-of-the-art accuracy. 1.

Introduction
Object detection serves as a prerequisite for a broad set of downstream vision applications, such as person re-identiﬁcation [3], instance segmentation [9] and action recog-nition [8]. With the foundation of deep neural networks, object detection has achieved signiﬁcant advances in recent years. On the whole, all the detectors that use deep CNN can be divided into two categories: (1) The multi-stage approach-es, including [7, 22, 15, 1, 14, 30]. For the multi-stage object detectors, multi-stage classiﬁcation and localization are ap-plied sequentially, which make these models more powerful
Figure 1. Irregular (e.g., tail) and occluded (e.g., background) object detection outputs of the baseline detector and our detector trained with Harmonic loss. The red bounding boxes denote the ground-truth. The baseline detector (a) produces inconsistent bounding boxes with high classiﬁcation score but low localization IoU (the blue bbox), or low classiﬁcation score but high localization IoU (the yellow bbox), which will hurt the detection accuracy after NMS (i.e., suboptimal blue bbox is selected). Our detector (b) produces bounding boxes with high co-occurrence of top classiﬁcation and localization by harmonizing the optimization of these two branches, leading to better detection results after NMS. on classiﬁcation and localization tasks. So these approaches have achieved top performance on benchmark datasets. (2)
The one-stage approaches, including [19, 21, 16, 29, 26].
The one-stage approaches apply object classiﬁers and regres-sors in a dense manner without object-based pruning. The main advantage of the one-stage detectors is their inference efﬁciency, but the detection accuracy is usually inferior to the two-stage approaches.
Modern CNN-based object detectors divide the object detection task into two branches, classiﬁcation branch and regression branch, which are trained with independent objec-tive functions without knowing each other explicitly. Specif-ically, a classiﬁcation loss (e.g., cross-entropy loss [7]) is adopted to optimize the classiﬁer and a distance loss (e.g., smoothL1 loss [7]) is used to optimize the regressor. How-ever, since the correlation between classiﬁcation task and localization task is ignored in existing detectors, the opti-mization of the classiﬁer and the regressor often can not be synchronous. Speciﬁcally, the classiﬁcation loss drives the model to learn as high classiﬁcation score as possible for all the positive examples regardless of the localization accuracy, and the regression loss enables the model to output accurate regression offset for each anchor without taking into account the classiﬁcation score during training. As a result, this leads to serious prediction inconsistency between classiﬁcation and regression. Speciﬁcally, the detector outputs lots of inconsistent detection results that have high classiﬁcation score but low IoU or low classiﬁcation score but high IoU in the inference phase. As shown in Fig. 1 (a), we show a representative example of inharmonious bounding boxes detected by the baseline. Two inharmonious candidates (a blue bbox and a yellow bbox) are produced by the baseline.
Clearly after the NMS procedure, the yellow one with high
IoU but low classiﬁcation score will be suppressed by the less accurate blue one. This means that, for this instance, the detector will end up with a clearly suboptimal detection result (i.e., blue bbox), but not the optimal one (i.e., yellow bbox). Since classiﬁcation loss and regression loss are in-dependently optimized for each positive sample throughout the training phase, such inconsistency is very common in the testing phase, especially for the objects of irregular shape and occlusion, which will hurt the overall detection perfor-mance. However, the prediction inconsistency between tasks is paid less attention in object detection community.
In order to reconcile prediction consistency, we propose a mutually supervised loss, called Harmonic loss, to jointly optimize the classiﬁcation and regression branches toward the optimal direction. In the training phase, the classiﬁcation branch will continuously supervise the optimization status of the regression branch through a harmonic factor related to the classiﬁcation loss, and vice versa. By plugging and playing the Harmonic loss into existing detectors, the network will become training-aware and reduce the training imbalance across tasks by mutual interaction. That is, the easily-trained branch will learn to dynamically facilitate the learning of the other branch towards a progressively harmonic state.
As a result, the detectors produce the bounding boxes with high co-occurrence of top classiﬁcation and localization in the testing, thereby alleviating the prediction inconsistency between these two tasks, as is shown in Fig. 1 (b).
Furthermore, during the training phase of the detectors, only positive samples are used to optimize the regression branch, but the IoU distribution of all the positive samples is seriously imbalanced (Please see Fig.3 (a) in the method section). Generally, the number of samples at low IoU lev-els is signiﬁcantly larger than that at high IoU levels. This will cause that the localization losses of existing detectors, especially one-stage detectors, are dominated by outliers (low IoU levels) during training phase, which enables the detection model to be biased toward the outliers. In order to alleviate the bias, motivated by focal loss [16], we propose a simple but effective Harmonic IoU (HIoU) loss to dynami-cally harmonize the contribution of each kind of examples in training phase. We up-weight the weights of localization loss of examples with high IoU while suppressing the weights of examples with low IoU by a dynamic scaling factor. By embedding this HIoU loss into our proposed Harmonic loss, the contribution of each level of samples is balanced and the training is more effective and stable.
By embedding the HIoU loss into our proposed Harmonic loss, a Harmonic detection (HarmonicDet) loss is formulated.
We plug and play our HarmonicDet loss into both two-stage and single-stage detection frameworks on the PASCAL VOC
[6] and MS COCO [17] benchmarks. The detection results demonstrate the effectiveness and generality of our approach in improving existing detectors.
In summary, this paper makes three contributions: 1. We propose a Harmonic loss to jointly optimize the classiﬁcation and regression branch toward the opti-mal direction in the training phase, thereby reconciling prediction consistency between classiﬁcation and local-ization in the testing phase. 2. We introduce a Harmonic IoU (HIoU) loss to har-monize the weight of the localization loss of different
IoU-level samples, which prevents the localization loss from being dominated by outliers and ensures accurate bounding box regression ability of the detector. 3. The proposed losses can be easily plugged and played into different state-of-the-art detection algorithms, achieving signiﬁcant performance gains on the PAS-CAL VOC dataset and MS COCO dataset. 2.