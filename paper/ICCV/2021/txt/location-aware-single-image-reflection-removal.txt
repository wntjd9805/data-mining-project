Abstract
This paper proposes a novel location-aware deep-learning-based single image reﬂection removal method.
Our network has a reﬂection detection module to regress a probabilistic reﬂection conﬁdence map, taking multi-scale Laplacian features as inputs. This probabilistic map tells if a region is reﬂection-dominated or transmission-dominated, and it is used as a cue for the network to control the feature ﬂow when predicting the reﬂection and trans-mission layers. We design our network as a recurrent net-work to progressively reﬁne reﬂection removal results at each iteration. The novelty is that we leverage Laplacian kernel parameters to emphasize the boundaries of strong reﬂections.
It is beneﬁcial to strong reﬂection detection and substantially improves the quality of reﬂection removal results. Extensive experiments verify the superior perfor-mance of the proposed method over state-of-the-art ap-proaches. Our code and the pre-trained model can be found at https://github.com/zdlarr/Location-aware-SIRR. 1.

Introduction
Reﬂections often occur when images are photographed through reﬂective and transparent media (e.g., glass). Re-moving undesired reﬂections enhances the image quality and beneﬁts many follow-up computer vision tasks, such as image classiﬁcation. In reﬂection removal, an image I with reﬂections can be modeled as the weighted additive com-position of a transmission layer T and a reﬂection layer R.
Precisely, following the alpha blending model in [4, 23, 57], we express the composition procedure as:
T + R,
I = W where W here is an alpha blending mask and indicates the element-wise multiplication. This model is designed to approximate the complex physical mechanisms involved in forming images with reﬂections. (1)
◦
◦
The task of single image reﬂection removal (SIRR) is to
It is an ill-posed prob-recover T from a given image I.
∗Corresponding author. (a) Input (b) Zhang et al. [57] (c) RMNet [47] (d) ERRNet [46] (e) CoRRN [44] (f) IBCLN [23] (g) RCMap (h) Ours (i) Ground truth
Figure 1. State-of-the-art methods (b,c,d,e,f) typically fail to re-cover high-quality transmission layers from strong reﬂections, e.g., the highlights. Our method addresses this problem by learn-ing the reﬂection conﬁdence map (RCMap) for the detection of the reﬂection-dominated regions (g) and reﬂection removal (h). Im-ages (a) and (i) are from [46]. lem since the number of unknowns is much more than the number of equations derived from Eq. 1. Therefore, priors are necessary to constrain the solution space, such as natural image gradient sparsity [21, 22], ghosting cues for thick glasses [34], and relative smoothness that as-sumes the refection layer is smoother than the transmis-sion layer [24, 52]. To disambiguate the restoration of
T and R in the gradient domain, several works propose
ﬁrst to determine the locations of reﬂection-dominated and transmission-dominated pixels, and then exploit different constraints at different locations to improve the reﬂection removal results [21, 40, 42]. While these methods are sen-sitive to the selection of hyperparameters, for instance, the commonly used gradient magnitude threshold, the detected location information is proven to be useful to handle strong reﬂections. Therefore, such location information is ex-pected to be beneﬁcial for the neural networks to learn how the reﬂection information is encoded in the features. How-ever, it is rarely investigated in deep learning-based SIRR
methods [4, 15, 18, 23, 46, 47, 50, 57]. This might cause ambiguities when strong reﬂections appear. We observe that state-of-the-art SIRR methods typically fail to recover high-quality transmission layers in such cases.
This paper proposes a location-aware deep learning-based SIRR method for generic reﬂection removal. Our network incorporates a novel reﬂection detection module (RDM) to detect reﬂection-dominated regions via learn-ing multi-scale Laplacian features. The output of RDM is a probabilistic reﬂection conﬁdence map (RCMap), which controls the subsequent feature ﬂow, resulting in signiﬁ-cantly improved SIRR results. Although this detection-and-removal strategy has been explored in shadow analysis [3, 12, 13, 16, 31, 45] and rain removal [6, 17, 30, 51, 54, 55] tasks, they mainly exploit features learned in the RGB do-main, which are different from our approach in two aspects.
First, motivated by the relative smoothness prior in [24], which assumes that the characteristics of T and R in the gradient domain are different, we use the learned Lapla-cian kernel to emphasize the boundaries of strong reﬂec-tions and suppress low-frequency reﬂections, which is ben-eﬁcial to improve the quality of RCMaps. Second, RDM is trained without ground-truth reﬂection-dominated region masks. This can avoid the difﬁculty of deﬁning or labeling reﬂection-dominated regions. The inverse RCMap, i.e., 1 -RCMap, can serve as the weight map W in Eq. 1 and be used to indicate the transmission-dominated regions. It mo-tivates us to use Eq. 1 as a loss to control the RDM training.
Our proposed network iteratively restores the transmis-sion layer from the corrupted input. In each iteration, we formulate the restoration process in a removal-by-detection manner.
It ﬁrst detects the reﬂection-dominated regions based on the RCMap and then predicts the whole reﬂec-tion layer by suppressing the transmission information. Af-terwards, it restores the transmission layer by jointly lever-aging the transmission-dominant regions and the predicted reﬂection layer. Such a network design decomposes the complicated SIRR problem into sub-problems and consid-ers the mutual dependence between reﬂection and transmis-sion. As illustrated in Fig. 1, our network can effectively remove strong reﬂected highlights.
In summary, the main contributions of our work are:
• We propose a novel SIRR method that iteratively re-stores the transmission layer from the corrupted input image. At each iteration, the restoration process is for-mulated in a removal-by-detection sequential manner. reﬂection detection module (RDM) to locate the reﬂection-dominated regions. It learns a group of multi-scale Laplacian kernel param-eters to exploit reﬂection boundary information.
• We propose a novel
• Extensive experiments the proposed location-aware neural network outperforms state-of-the-art SIRR methods in removing strong reﬂections. show that 2.