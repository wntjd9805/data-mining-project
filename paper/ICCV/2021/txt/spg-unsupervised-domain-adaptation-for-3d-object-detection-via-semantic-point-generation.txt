Abstract
In autonomous driving, a LiDAR-based object detector should perform reliably at different geographic locations and under various weather conditions. While recent 3D de-tection research focuses on improving performance within a single domain, our study reveals that the performance of
In modern detectors can drop drastically cross-domain. this paper, we investigate unsupervised domain adapta-tion (UDA) for LiDAR-based 3D object detection. On the
Waymo Domain Adaptation [49] dataset, we identify the de-teriorating point cloud quality as the root cause of the per-formance drop. To address this issue, we present Semantic
Point Generation (SPG), a general approach to enhance the reliability of LiDAR detectors against domain shifts. Specif-ically, SPG generates semantic points at the predicted fore-ground regions and faithfully recovers missing parts of the foreground objects, which are caused by phenomena such as occlusions, low reflectance, or weather interference. By merging the semantic points with the original points, we ob-tain an augmented point cloud, which can be directly con-†Work done during internship at Waymo LLC. sumed by modern LiDAR-based detectors. To validate the wide applicability of SPG, we experiment with two repre-sentative detectors, PointPillars [22] and PV-RCNN [45].
On the UDA task, SPG significantly improves both detectors across all object categories of interest and at all difficulty levels. SPG can also benefit object detection in the original domain. On the Waymo Open Dataset [49] and KITTI [17],
SPG improves 3D detection results of these two methods across all categories. Combined with PV-RCNN [45], SPG achieves state-of-the-art 3D detection results on KITTI. 1.

Introduction
A robust autonomous driving system requires its
LiDAR-based detector to reliably handle different environ-mental conditions, e.g., geographic locations and weather conditions. While 3D detection has received increasing in-terest in recent years, most existing works [69, 6, 9, 10, 15, 21, 22, 23, 24, 26, 27, 33, 37, 38, 45, 46, 47, 48, 57, 58, 59, 61, 62, 56, 68] have focused on the performance in a single domain, where training and test data are captured in simi-lar conditions. It is still an open question how to generalize a 3D detector to different domains, where the environment
Dataset
Rainy frames 0.5 %
OD Val 0.0 %
Kirk Dry
Kirk Val 100.0%
Avg. number of missing points per frame 23.0K 25.1K 42.8K
Avg. number of points per vehicle 306.2 303.6 222.3 3D L1
AP 56.54 55.98 34.74
Table 1: The statistics of OD and Kirk. Each frame contains at most 163.8K points. Kirk Dry is formed by frames with dry weather in Kirk training set. there are twice amount of missing LiDAR points per frame in Kirk validation set than in OD or Kirk Dry (see Table 1).
As a result, vehicles in Kirk receive around 27% fewer Li-DAR point observations than those in OD (see statistics and more details in the supplemental). In Figure 2, we visualize two range images from OD and Kirk, respectively. We can observe that in the rainy weather, a significant number of points are missing and the distribution of missing points is more irregular compared to the dry weather.
To conclude, the major domain gap between OD and
Kirk is the deteriorating point cloud quality, which is caused by the rainy weather condition. In the target domain, we name this phenomenon as the “missing point” problem. (a) OD RGB Image (b) Kirk RGB Image 1.2. Previous Methods to Address the Domain Gap (c) OD Range Image (d) Kirk Range Image
Figure 2: Examples of RGB and range image (intensity chan-nel) in OD validation set and Kirk validation set. The dark regions in the range images indicate missed LiDAR returns.
The regions of “missing points” are irregular in shape. varies significantly. In this paper, we address the domain gap caused by the deteriorating point cloud quality and aim to improve 3D object detection in the setting of unsuper-vised domain adaptation (UDA). We use the Waymo Do-main Adaptation dataset [49] to analyze the domain gap and introduce semantic point generation (SPG), a general ap-proach to enhance the reliability of LiDAR detectors against domain shift. SPG is able to improve detection quality in both the target domain and the source domain and can be naturally combined with modern LiDAR-based detectors. 1.1. Understanding the Domain Gap
Waymo Open Dataset (OD) is mainly collected in Cal-ifornia and Arizona, and Waymo Kirkland Dataset (Kirk)
[49] is collected in Kirkland. We consider OD as the source domain and Kirk as the target domain. To understand the possible domain gap, we take a PointPillars [22] model trained on the OD training set and compare its 3D vehicle detection performance on OD validation set and those on
Kirk validation set. We observe a drastic performance drop of 21.8 points in 3D average precision (AP) (see Table 1).
We first confirm that there is no significant difference in object size between two domains. Then by investigating the meta data in the datasets, we find that only 0.5% of Li-DAR frames in OD are collected under rainy weather, but almost all frames in Kirk share the rainy weather attribute.
To rule out other factors, we extract all dry weather frames in Kirk training set and form a “Kirk Dry” dataset. Because the the rain drop changes the surface property of objects,
Multiple studies propose to align the features across do-mains. Most of them focus on 2D tasks [34, 16, 51, 13] or object-level 3D tasks [67, 41]. Applying feature alignment
[8, 19, 32] requires a redesign of the model or loss of a detector. Our goal is to seek a general solution to benefit re-cently reported LiDAR-based detectors[22, 45, 69, 46, 18].
Another direction is to apply transformations to the data from one domain to match the data from another domain. A naive approach is to randomly down-sample the point cloud but this not only fails to satisfactorily simulate the pattern of missing points (Figure 2d) but also hurts the performance on the source domain. Another approach is to up-sample the point cloud [65, 63, 25] in the target domain, which can increase point density around observed regions. However, those methods have a limited capability in recovering the 3D shape of very partially observed objects. Moreover, up-sampling the entire point cloud will lead to a significantly higher latency. A third approach is to leverage style transfer techniques: [70, 36, 11, 19, 44, 20, 43] render point clouds as 2D pseudo images and enforce the renderings from dif-ferent domains to be resemblant in style. However, these methods introduce an information bottleneck during raster-ization [69] and they are not applicable to modern point-based 3D detectors [45]. 1.3. SPG for Closing the Domain Gap
The “missing point” problem deteriorates the point cloud quality and reduces the number of point observations, thus undermining the detection performance. To address this is-sue, we propose Semantic Point Generation (SPG). Our ap-proach aims to learn the semantic information of the point cloud and performs foreground region prediction to identify voxels that are inside foreground objects. Based on the pre-dicted foreground voxels, SPG generates points to recover the foreground regions. Since these points are discrimina-tively generated at foreground objects, we denote them by semantic points. These semantic points are merged with the original points into an augmented point cloud, which is
then fed to a 3D detector.
The contributions of this paper are two-fold: 1. We present an in-depth analysis of unsupervised domain adaptation (UDA) for LiDAR 3D detectors across differ-ent geographic locations and weather conditions. Our study reveals that the rainy weather can severely deteriorate the quality of LiDAR point clouds and lead to drastic perfor-mance drop for modern detectors. 2. We propose semantic point generation (SPG). To our best knowledge, it is the first learning-based model that targets
UDA for point cloud 3D detection. Specifically, SPG has the following merits:
• SPG can generate semantic points that faithfully recover the foreground regions suffering from the “missing point” problem. SPG can significantly improve performance over poor-quality point clouds in the target domain while also benefiting source domain, for representative 3D de-tectors, including PointPillars [22] and PV-RCNN [45].
• SPG also improves the performance for the general 3D object detection task. We verify its effectiveness on
KITTI [17] for the aforementioned 3D detectors.
• SPG is a general approach and can be easily combined with modern off-the-shelf LiDAR-based detectors.
• Our approach is light-weight and efficient.
Introducing less than 6% additional points, SPG only adds a marginal complexity to a 3D detector. 2.