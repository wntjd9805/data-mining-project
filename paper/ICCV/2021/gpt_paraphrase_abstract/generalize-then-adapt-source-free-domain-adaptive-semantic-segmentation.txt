Unsupervised domain adaptation (DA) in semantic segmentation has received significant attention. However, previous approaches require access to both labeled source and unlabeled target data simultaneously, which is not suitable for source-free adaptation scenarios. In this study, we propose a solution to enable source-free DA by dividing the task into two parts: a) source-only domain generalization and b) source-free target adaptation. For the domain generalization, we develop a multi-head framework that is trained with an extended multi-source dataset to achieve a balance between generalization and specificity. For the target adaptation, we utilize the multi-head framework to extract reliable pseudo-labels from the target data for self-training. To enhance the quality of these pseudo-labels, we introduce a novel conditional prior-enforcing auto-encoder that discourages spatial irregularities. Our experimental results on the GTA5→Cityscapes and SYNTHIA→Cityscapes benchmarks demonstrate our superiority over previous approaches, even those that are not source-free. Furthermore, we show that our method is compatible with online adaptation, allowing deployment in dynamically changing environments.