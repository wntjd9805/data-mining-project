This paper proposes a novel approach for automatic few-shot font generation (AFFG) that reduces the need for manual font design by generating new fonts with only a few reference glyphs. The traditional AFFG paradigm of style-content disentanglement is limited in capturing the diverse local details of different fonts. To address this limitation, the paper introduces a component-based approach that aggregates styles from character similarity-guided global features and stylized component-level representations. The approach calculates similarity scores between the target character and reference samples, using the distance along corresponding channels from the content features, and assigns them as weights for aggregating global style features. To capture local styles more effectively, a cross-attention-based style transfer module is used to transfer the styles of reference glyphs to the components. These components are self-learned discrete latent codes obtained through vector quantization without manual definition. The proposed AFFG method successfully obtains a complete set of component-level style representations while also controlling the global glyph characteristics. Experimental results demonstrate the effectiveness and generalization of the method across different linguistic scripts and its superiority compared to other state-of-the-art methods. The source code for the method is available at https://github.com/awei669/VQ-Font.