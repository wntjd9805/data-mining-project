This study presents the EGC (energy-based classifier and generator), which addresses the challenge of simultaneously learning image classification and generation using the same network parameters. Existing approaches often excel in one task but perform poorly in the other. Unlike conventional classifiers that produce a label given an image, EGC utilizes a forward pass classification model that yields a joint distribution of the image and label. This enables a diffusion model in the backward pass by marginalizing out the label, allowing for the estimation of the score function. EGC can also be adapted for unsupervised learning by considering the label as a latent variable. The results demonstrate that EGC achieves competitive generation performance on ImageNet-1k, CelebA-HQ, and LSUN Church datasets, while also achieving superior classification accuracy and robustness against adversarial attacks on CIFAR-10. This work represents a significant step forward in simultaneously mastering both image classification and generation using a unified network parameter set. The authors believe that EGC bridges the gap between discriminative and generative learning. The code for EGC will be made available at https://github.com/GuoQiushan/EGC.