Abstract 1.

Introduction
Medical image registration is a critical task that es-timates the spatial correspondence between pairs of im-ages. However, current traditional and deep-learning-based methods rely on similarity measures to generate a deforming field, which often results in disproportionate vol-ume changes in dissimilar regions, especially in tumor re-gions. These changes can significantly alter the tumor size and underlying anatomy, which limits the practical use of image registration in clinical diagnosis. To address this is-sue, we have formulated image registration with tumors as a constraint problem that preserves tumor volumes while maximizing image similarity in other normal regions. Our proposed strategy involves a two-stage process. In the first stage, we use similarity-based registration to identify po-tential tumor regions by their volume change, generating a soft tumor mask accordingly. In the second stage, we pro-pose a volume-preserving registration with a novel adap-tive volume-preserving loss that penalizes the change in size adaptively based on the masks calculated from the previous stage. Our approach balances image similarity and volume preservation in different regions, i.e., normal and tumor re-gions, by using soft tumor masks to adjust the imposition of volume-preserving loss on each one. This ensures that the tumor volume is preserved during the registration process.
We have evaluated our strategy on various datasets and net-work architectures, demonstrating that our method success-fully preserves the tumor volume while achieving compara-ble registration results with state-of-the-art methods. Our codes is available at: https://dddraxxx.github. io/Volume-Preserving-Registration/.
*Corresponding authors
Fixed Image
Similarity-Based Registration
Moving Image
Volume-Preserving Registration
Figure 1. Red boxes represent the location of tumors in the mov-ing image before warped.
In image registration with tumors, similarity-based registration typically leads to significant alter-ations in tumor size while our volume-preserving registration is capable of preserving tumor anatomy.
Deformable image registration is a fundamental task that estimates non-linear spatial correspondences between two images. It is useful for medical image studies that involve 3D images of organs or tissues, such as MR brain scans and
CT liver scans. Recently, a wide range of deep-learning-based methods are proposed in the field, with better perfor-mance and obvious speed-ups in inference time compared to the traditional registration methods [5, 38, 32, 14, 15].
Currently, most of the learning-based methods [5, 38] train a registration model to achieve high similarity in either
image intensity [38, 5] or anatomy label maps [14]. While this is useful in various medical applications, such as atlas-based segmentation and image fusion [8], problem emerges, however, when studying images with tumors [4, 12, 24].
Tracking tumor growth is a core task in cancer treatment, which can be used to evaluate the outcomes of radiotherapy and chemotherapy, and plan optimal postoperative treat-ment [12]. The process requires registration to align the anatomy of images from different periods of the patient, while preserving tumor properties e.g., the size. Traditional models using regular registration have struggled to accom-plish this task [12]. We have observed that this remains an issue for current learning-based methods, and a viable solu-tion has yet to be proposed.
As shown in Figure 1, the volume of tumors significantly reduces when using popular unsupervised registration net-works to align tumor images with atlas images. The issue is widespread since mainstream registration networks focus on optimizing the similarity between image pairs while ig-noring tumor regions. Tumor regions often lack correspond-ing parts, and even for images of the same patient, the size and location of tumors may vary greatly. This can happen because tumors can change shape, size, location, or disap-pear over time. Therefore, in deformable settings, the size of tumors will change disproportionately to maximize the image similarity. This problem may be more severe when the registration network has better warping ability, leading to better performance in evaluations from previous works, as confirmed by our experiments in Section 4. The dispro-portionate change of tumor volume in deformable registra-tion is lethal for clinical evaluation of tumor growth and greatly hinders the application of registration in clinics.
In this paper, we re-formulate the deformable registra-tion problem as a constraint problem that preserves the properties of tumors in the original images, i.e., the shape and the size of the tumor, while maximizing image simi-larity in non-tumor regions. For instance, in tumor image registration with atlas, besides the alignment of anatomi-cal structures, the tumor should have similar morphing be-haviours as its surrounding organs, i.e., the size of it should change proportionally to the size of the organ. However, this poses two major challenges for our strategy. Firstly, due to the limited availability of annotated data, most ex-isting registration methods resort to unsupervised learning.
Therefore, a key question is how to identify tumor regions in the unsupervised setting. Second, after the tumor regions have been identified, the challenge still remains of preserv-ing tumor volumes while simultaneously maximizing simi-larity in other regions. Finding a way to balance these two competing objectives is crucial for achieving effective tu-mor image registration.
To tackle the challenges, we propose a novel two-stage strategy that operates in an unsupervised manner. In the first stage, we leverage a similarity-based registration network to identify regions that undergo excessive volume change dur-ing registration. Such regions are indicative of the presence of tumors, as tumors tend to exhibit larger changes in vol-ume due to a lack of correspondence between image pairs.
The outcome of the first stage is a soft tumor mask that dis-tinguishes normal and possible tumor regions. In the sec-ond stage, we introduce an adaptive volume-preserving loss to train a volume-preserving registration network. Based on the soft tumor mask obtained from the first stage, this loss is designed to adaptively penalize volume changes in different regions of the image. Possible tumor regions are assigned larger loss weights, and similarity loss weights are adjusted accordingly in the opposite direction. The application of the adaptive volume-preserving loss effectively balances simi-larity and volume preservation in different parts of the im-age.
It should be noted that the soft masks from stage one do not need to be highly accurate to achieve desirable results, as our stage two is robust, which is demonstrated by our ab-lation experiments in section 4. In addition to evaluating the robustness of our proposed strategy on various datasets and frameworks, including CNN and transformer, as well as dif-ferent types of imaging data such as brain and abdominal,
MRI and CT images, we have also introduced the Square
Tumor Size Ratio (STSR) metric to measure the preserva-tion of tumor volumes. The results demonstrate that our methods achieve comparable warping performance metrics such as Dice coefficient and average landmark distances while effectively preserving tumor properties as measured by the STSR.
To conclude, our contribution includes: (1) We have re-formulated image registration with tumors as a constraint problem that preserves tumor volumes while maximizes im-age similarity in other normal regions. (2) We have de-signed a two-stage process that the first stage performs reg-ular registration to estimate tumor regions, and the second stage performs volume-preserving registration on tumor re-gions based on the adaptive volume-preserving loss. (3) We have proposed the STSR metric to measure the preserva-tion of tumor volumes in registration, and have evaluated the effectiveness of our strategy on different network archi-tectures and various datasets. 2.