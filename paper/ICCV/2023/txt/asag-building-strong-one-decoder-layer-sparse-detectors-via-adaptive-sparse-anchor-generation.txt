Abstract
Recent sparse detectors with multiple, e.g. six, decoder layers achieve promising performance but much inference time due to complex heads. Previous works have explored using dense priors as initialization and built one-decoder-layer detectors. Although they gain remarkable accelera-tion, their performance still lags behind their six-decoder-layer counterparts by a large margin. In this work, we aim to bridge this performance gap while retaining fast speed.
We find that the architecture discrepancy between dense and sparse detectors leads to feature conflict, hamper-ing the performance of one-decoder-layer detectors. Thus we propose Adaptive Sparse Anchor Generator (ASAG) which predicts dynamic anchors on patches rather than grids in a sparse way so that it alleviates the feature con-flict problem. For each image, ASAG dynamically selects which feature maps and which locations to predict, form-ing a fully adaptive way to generate image-specific anchors.
Further, a simple and effective Query Weighting method eases the training instability from adaptiveness. Exten-sive experiments show that our method outperforms dense-initialized ones and achieves a better speed-accuracy trade-off. The code is available at https://github.com/ iSEE-Laboratory/ASAG. 1.

Introduction
Object detection is a fundamental and challenging com-puter vision task. Different from traditional CNN-based dense object detectors [27, 10, 20, 21, 32, 40] using sliding-window paradigm, query-based sparse detectors [2, 43, 31, 9] use hundreds of object queries to search through the whole image, each representing an object or background.
They get rid of some traditional hand-crafted components
* denotes the corresponding authors.
Figure 1: Comparing one-decoder-layer detectors with six-decoder-layer counterparts on FPS and AP with various de-coder types. ASAGs achieve a better speed-accuracy trade-off. Best viewed in color. and procedures, e.g., anchors and Non-Maximum Suppres-sion (NMS), which greatly simplifies the detection pipeline and makes the detector fully end-to-end trainable. With the help of powerful transformer encoder-decoder architecture, sparse detectors show promising performance.
However, sparse detectors cost more inference time since they need n decoder layers (typically n = 6) to pro-gressively refine bounding boxes, leading to a more com-plex head. Inference with only one decoder layer achieves a much faster speed, such as AdaMixer [9] (43 V.S. 22 FPS) and Sparse RCNN [31] (43 V.S. 25 FPS). The more com-plex the decoder is, the larger the FPS gap is. Unfortunately, simply discarding the extra decoder layers results in a sig-nificant performance drop.
Recently, several methods [36, 41] have attempted to bridge the performance gap between one- and six-decoder-layer detectors. Efficient DETR [36] finds that image-agnostic box and content queries should be blamed for a severe drop in performance when using one decoder layer.
Thus, both methods utilize an extra dense box prediction step before the decoder to provide proper query initializa-tion. However, they fail to achieve comparable results to detectors with six decoder layers, for example Featurized
Query RCNN [41] is lower than Sparse RCNN [31] by 1.5AP with 100 queries. We find that the features cor-responding to dense and sparse detectors are significantly different. Such feature conflict hampers the performance of one-decoder-layer detectors, demonstrated in Section 3.
Thus, although these methods achieve remarkable accelera-tion, it still has much room to narrow the performance gap.
In this work, we aim to build a fully sparse one-decoder-layer detector, narrowing the performance gap between one-and six-decoder-layer detectors and retaining the fast speed.
The key difference between our method and other dense ini-tialization methods is that we use patches as the basic pre-diction units, which can be the whole or part of an image.
Sparsely predicting on patches alleviate the feature discrep-ancy caused by predicting on grids and enjoys global recep-tive fields. Further, we propose to loose the constraint that each image should use a fixed number of queries to detect objects so that more complex images detect objects with more queries and vice versa. Based on these two precondi-tions, we propose initializing image-specific queries using
Adaptive Sparse Anchor Generator (ASAG), which is fully adaptive to each image in both anchorsâ€™ locations and num-bers. We further design Adaptive Probing to adaptively crop patches on possible locations on different feature map lev-els. It runs in a top-down and coarse-to-fine way and greatly enhances the ability to detect small objects. Finally, an ef-fective Query Weighting method is proposed to handle the instability coming from adaptiveness.
We conduct extensive experiments on the COCO [22] dataset with various decoder types. As shown in Figure 1, our model ASAG-S outperforms dense-initialized Query
RCNN [41] by 2.6 AP with fewer FLOPs and the same de-coder. We also retain the fast speed of one-decoder-layer detectors, thus achieving a better speed-accuracy trade-off. 2.