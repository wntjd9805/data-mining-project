Abstract
Curvilinear object segmentation is critical for many ap-plications. However, manually annotating curvilinear ob-jects is very time-consuming and error-prone, yielding in-sufficiently available annotated datasets for existing super-vised methods and domain adaptation methods. This pa-per proposes a self-supervised curvilinear object segmen-tation method (FreeCOS) that learns robust and distinc-tive features from fractals and unlabeled images. The key contributions include a novel Fractal-FDA synthesis (FFS) module and a geometric information alignment (GIA) ap-proach. FFS generates curvilinear structures based on the parametric Fractal L-system and integrates the generated structures into unlabeled images to obtain synthetic train-ing images via Fourier Domain Adaptation. GIA reduces the intensity differences between the synthetic and unla-beled images by comparing the intensity order of a given pixel to the values of its nearby neighbors. Such image alignment can explicitly remove the dependency on abso-lute intensity values and enhance the inherent geometric characteristics which are common in both synthetic and real images. In addition, GIA aligns features of synthetic and real images via the prediction space adaptation loss (PSAL) and the curvilinear mask contrastive loss (CMCL).
Extensive experimental results on four public datasets, i.e.,
XCAD, DRIVE, STARE and CrackTree demonstrate that our method outperforms the state-of-the-art unsupervised meth-ods, self-supervised methods and traditional methods by a large margin. The source code of this work is available at https://github.com/TY-Shi/FreeCOS. 1.

Introduction
Automatically segmenting curvilinear structures (such as vascular trees in medical images and road systems in aerial photography) is critical for many applications, in-cluding retinal fundus disease screening [2, 14], diagnosing
†Corresponding author. coronary artery disease [38], road condition evaluation and maintenance [51]. Despite a plethora of research works in the literature, accurately segmenting curvilinear objects re-mains challenging due to their complex structures with nu-merous tiny branches, tortuosity shapes, ambiguous bound-aries due to imaging issues and noisy backgrounds.
Most recent methods [39, 10, 36, 42, 18, 29, 7, 28, 6, 35] leverage supervised deep learning for curvilinear object seg-mentation and have achieved encouraging results. However, those methods require a large number of pixel-wise manual annotations for training which are very expensive to obtain and error-prone due to poor image quality, annotator’s fa-tigue and lack of experience. Although, there are several publically available annotated datasets for curvilinear object segmentation [37, 17, 51, 25], the large appearance vari-ations between different curvilinear object images, e.g., X-ray coronary angiography images vs. retinal fundus images, yields significant performance degradation for supervised models across different types of images (even across the same type of images acquired using different equipments).
As a result, expensive manual annotations are inevitably de-manded to tune the segmentation model for a particular ap-plication. Potential solutions to alleviate the annotation bur-den include domain adaption [8, 32] and unsupervised seg-mentation [9, 19, 24, 11, 9, 1]. However, the effectiveness of domain adaptation is largely dependent on the quality of annotated data in the source domain and constrained by the gap between the source and target domain. Existing unsu-pervised segmentation methods [9, 19] can hardly achieve satisfactory performance for curvilinear objects due to their thin, long, and tortuosity shapes, complex branching struc-tures, and confusing background artifacts.
Despite the high complexity and great variety of curvi-linear structures in different applications, they share some common characteristics (i.e., the tube-like shape and the branching structure). Thus, existing studies [47, 46, 48] have demonstrated that several curvilinear structures (e.g., arterial trees of the circulation system) can be generated via the fractal systems with proper branching parameters to mimic the fractal and physiological characteristics, and
some observed variability. These results motivate us to use the generated curvilinear objects via the fractal sys-tems to explicitly encode geometric properties and varieties (i.e., different diameters and lengths of branches, and dif-ferent branching angles) into training samples and to as-sist feature learning of a curvilinear structure segmentation model. However, such formulas generated training samples can hardly mimic the appearance patterns within curvilinear objects, the transition regions between curvilinear objects and backgrounds, which are also key information for learn-ing a segmentation model and contained in easily-obtained unlabeled target images. This paper asks the question, how to combine fractals and unlabeled target images to encode sufficient and comprehensive visual cues for learning robust and distinctive features of curvilinear structures?
The main contribution of this paper is a self-supervised segmentation method based on a novel Fractal-FDA syn-thesis (FFS) module and a geometric information alignment (GIA) approach. Specifically, curvilinear structures are syn-thesized by the parametric fractal L-Systems [47] and serve as segmentation labels of synthetic training samples. To simulate appearance patterns in the object-background tran-sition regions and background regions, we apply Fourier
Domain Adaptation [45] (FDA) to fuse synthetic curvilinear structures and unlabeled target images. The synthetic im-ages via our FFS module can effectively guide learning dis-tinctive features to distinguish curvilinear objects and back-grounds. To further improve the robustness to differences between intensity distributions of synthetic and real target images, we design a novel geometric information alignment (GIA) approach which aligns information of synthetic and target images at both image and feature levels. Specifically,
GIA first converts each training image (synthetic and target images) into four geometry-enhanced images by compar-ing the intensity order of a given pixel to the values of its nearby neighbors (i.e., along with the up, down, left and right directions). In this way, the four converted images do not depend on the absolute intensity values but the relative intensity in order to capture the inherent geometric charac-teristic of the curvilinear structure, reducing the intensity differences between synthetic and target images. Then, we extract features from the 4-channel converted images and propose two loss functions, i.e., a prediction space adap-tation loss (PSAL) and a curvilinear mask contrastive loss (CMCL), to align the geometric features of synthetic and target images. The PSAL minimizes the distance between the segmentation masks of the target images and synthetic curvilinear objects and the CMCL minimizes the distance between features of segmented masks and synthetic objects.
The FreeCOS based on FFS and GIA approaches ap-plies to several public curvilinear object datasets, including
XCAD [25], DRIVE [37], STARE [17] and CrackTree [51].
Extensive experimental results demonstrate that FreeCOS outperforms the state-of-the-art self-supervised [25, 21], unsupervised [9, 19], and traditional methods [13, 22]. To summarize, the main contributions of this work are as fol-lows:
• We propose a novel self-supervised curvilinear feature learning method which intelligently combines tree-like fractals and unlabeled images to assist in learning ro-bust and distinctive feature representations.
• We propose Fractal-FDA synthesis (FFS) and geomet-ric information alignment (GIA), which are the two key enabling modules of our method. FFS integrates the synthetic curvilinear structures into unlabeled im-ages to guide learning distinctive features to distin-guish foregrounds and backgrounds. GIA enhances geometric features and meanwhile improves the fea-ture robustness to intensity differences between syn-thetic and target unlabeled images.
• We develop a novel self-supervised segmentation net-work that can be trained using only target images and fractal synthetic curvilinear objects. Our network performs significantly better than state-of-the-art self-supervised/unsupervised methods on multiple public datasets with various curvilinear objects. 2.