Abstract
Effective image restoration with large-size corruptions, such as blind image inpainting, entails precise detection of corruption region masks which remains extremely challeng-ing due to diverse shapes and patterns of corruptions. In this work, we present a novel method for automatic corrup-tion detection, which allows for blind corruption restoration without known corruption masks. Specifically, we develop a hierarchical contrastive learning framework to detect cor-rupted regions by capturing the intrinsic semantic distinc-tions between corrupted and uncorrupted regions. In par-ticular, our model detects the corrupted mask in a coarse-to-fine manner by first predicting a coarse mask by con-trastive learning in low-resolution feature space and then refines the uncertain area of the mask by high-resolution contrastive learning. A specialized hierarchical interaction mechanism is designed to facilitate the knowledge prop-agation of contrastive learning in different scales, boost-ing the modeling performance substantially. The detected multi-scale corruption masks are then leveraged to guide the corruption restoration. Detecting corrupted regions
*These authors contributed equally to this work.
†Corresponding authors. by learning the contrastive distinctions rather than the se-mantic patterns of corruptions, our model has well gener-alization ability across different corruption patterns. Ex-tensive experiments demonstrate following merits of our model: 1) the superior performance over other methods on both corruption detection and various image restora-tion tasks including blind inpainting and watermark re-moval, and 2) strong generalization across different cor-ruption patterns such as graffiti, random noise or other im-age content. Codes and trained weights are available at https://github.com/xyfJASON/HCL. 1.

Introduction
An essential yet challenging step for image restoration with large-size corruptions, such as blind image inpaint-ing, watermark removal or shadow removal, is to detect the corruption region masks in pixel level precisely. The difficulties lie in the diverse shapes and appearance of cor-ruptions, which can be hardly modeled in a uniform pat-tern. As a result, blind image inpainting remains a challeng-ing task although image inpainting with known corruption masks [27, 11, 13, 32] has achieved remarkable progress.
A straightforward way for corruption detection is to for-mulate it as a segmentation task and predict the corruption mask by pixel-wise binary classification. A prominent ex-ample following such modeling paradigm is VCNet [42], a state-of-the-art method for blind image inpainting, which regards corruptions as target objects and learns to recognize the semantic patterns of corruptions for detection. While
VCNet can successfully detect the corruptions with uniform patterns, it has two potential limitations. First, the corrup-tion may exhibit diverse patterns due to its potentially irreg-ular appearance nature, which VCNet can hardly deal with.
Second, it is challenging for VCNet to handle the corrup-tion patterns that are distinct from those appearing in train-ing data, thus it has limited generalization w.r.t. different corruption patterns.
In this work, we propose a novel model for image corrup-tion detection to circumvent the aforementioned limitations of VCNet. Instead of recognizing the semantic patterns of corruptions as VCNet does, we apply metric learning to learn an embedding space in which our model can capture the contrastive semantic distinctions between the corrupted and uncorrupted regions. To this end, we design a hierarchi-cal contrastive learning framework for detecting corrupted regions, which predicts the corruption mask in a coarse-to-fine manner. To be specific, it first predicts a coarse mask by lightweight contrastive learning in a low-resolution fea-ture space. Then it refines the uncertain pixels with low confidence in the predicted mask by high-resolution con-trastive learning based on fine-grained features. Note that only a small fraction of predicted masks need to be refined, thus the refining process can be performed quite efficiently.
To facilitate the knowledge propagation and consistency of contrastive learning between different scales, we propose a specialized hierarchical interaction mechanism. As a result, the high-resolution contrastive learning can inherit useful knowledge from the low-resolution contrastive learning to achieve precise prediction of corruption masks quite effi-ciently. The detected multi-scale corruption masks are fur-ther used to guide the restoration of the corrupted regions, which also follows a coarse-to-fine generative process.
Unlike VCNet recognizing the semantic patterns of cor-ruptions, our model focuses on capturing the contrastive se-mantic distinctions between corrupted and uncorrupted re-gions. Thus our model has well generalization ability across different corruption patterns, As shown in Figure 1. To con-clude, we make following contributions.
• We design a hierarchical contrastive learning framework to detect multi-scale corruption masks by learning the contrastive semantic distinctions between corrupted and uncorrupted regions.
• Integrating the proposed hierarchical contrastive learn-ing module, we develop a general-purpose blind image restoration model to perform high-quality image restora-tion without known corruption masks.
• Extensive experiments validate the effectiveness of our model both quantitatively and qualitatively in three as-pects: 1) superior performance on corruption detection (Section 4.2), 2) favorable performance compared to the specialized methods on two challenging image restoration tasks including blind image inpainting and watermark re-moval (Section 4.3), and 3) strong generalizability across different corruption patterns (Section 4.2 and 4.3.1). 2.