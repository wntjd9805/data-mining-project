Abstract
Survival prediction is a complicated ordinal regression task that aims to predict the ranking risk of death, which generally benefits from the integration of histology and ge-nomic data. Despite the progress in joint learning from pathology and genomics, existing methods still suffer from challenging issues: 1) Due to the large size of patholog-ical images, it is difficult to effectively represent the gi-gapixel whole slide images (WSIs). 2) Interactions within tumor microenvironment (TME) in histology are essential for survival analysis. Although current approaches attempt to model these interactions via co-attention between histol-ogy and genomic data, they focus on only dense local simi-larity across modalities, which fails to capture global con-sistency between potential structures, i.e. TME-related in-teractions of histology and co-expression of genomic data.
To address these challenges, we propose a Multimodal Opti-mal Transport-based Co-Attention Transformer framework with global structure consistency, in which optimal trans-port (OT) is applied to match patches of a WSI and genes embeddings for selecting informative patches to represent the gigapixel WSI. More importantly, OT-based co-attention provides a global awareness to effectively capture struc-tural interactions within TME for survival prediction. To overcome high computational complexity of OT, we propose a robust and efficient implementation over micro-batch of
WSI patches by approximating the original OT with unbal-anced mini-batch OT. Extensive experiments show the supe-riority of our method on five benchmark datasets compared to the state-of-the-art methods. The code is released1. 1.

Introduction
Survival prediction is a complex ordinal regression task that aims to estimate the relative risk of death in can-cer prognosis, which generally integrates the manual as-*Corresponding author 1https://github.com/Innse/MOTCat
Figure 1. Comparison between (a) Co-Attention and (b) OT-based
Co-Attention, where (a) learns weights of instances by dense at-tention, and (b) identifies informative instances by optimal trans-port matching flow from a global perspective, which enforces con-sidering potential structures of each modality, i.e. interactions within WSIs and co-expression within genomics. sessment of qualitative morphological information from pathology data and quantitative molecular profiles from genomic data in clinical settngs [6, 55, 4]. Despite re-cent advances in multimodal learning for histology and ge-nomics [5, 55, 27, 34], there still exists several open issues.
Among others, one daunting challenge is to capture key in-formation from heterogeneous modalities for effective fu-sion. Particularly, due to the large size of about 500,000 Ã— 500,000 pixels, it is challenging to effectively represent gi-gapixel whole slide images without losing key information.
Furthermore, visual concepts of tumor microenvironment (TME) within pathological images are verified to have sig-nificant associations with survival analysis in various cancer types [42, 1, 25], e.g. cellular components including fibrob-last cells and various immune cells that can alter cancer cell behaviors [33]. However, the TME-related patches occupy only a tiny proportion of the entire WSI, leading to a fine-grained visual recognition problem [54] that is indiscernible
by conventional multimodal learning.
Recently attention-based multiple instance learning (MIL) [19, 26] has provided a typical solution to identify informative instances, in which a WSI is formulated as a bag of patches (instances) and an attention score is assigned for each instance as a weight for selection. In multimodal learning, genomic data has been applied to guide the selec-tion of TME-related instances by co-attention mechanism across modalities [5], as genes expression might correspond to some morphological characteristics revealed in patholog-ical TME [29, 38]. They [5] densely calculate similarity scores for each pair of pathology and genomic instances as weights of selection to capture fine-grained visual informa-tion in WSIs, as shown in Fig. 1 (a). However, this type of approaches with a local view may not thoroughly learn information about TME, since they ignore global potential structure [55] within modality, e.g. interactions within TME for histology and co-expression for genomics [31, 51].
Fruitful works [31, 33, 5] demonstrate that the interac-tions within TME are important indicators affecting survival outcomes, e.g. co-occurrence of tumor cells with tumor-infiltrating lymphocytes (TILs) of the immune system is a positive prognostic indicator. However, these collaborative components in TME might be spatially dispersed through-out the entire WSI, which indicates long-range structural associations in WSI, as shown in Fig. 1 (b). On the other hand, genes co-expression [49, 55] also suggests a poten-tial structure. There might be intrinsic consistency between these two potential structures [55, 31], as some studies have verified that genomic mutations can alter normal functions and biological processes of TILs within TME [51, 47]. By leveraging the global consistency between their potential structures to match histology and genomic data, it is more likely to identify TME-related patches from WSIs. How-ever, existing co-attention-based multimodal learning fo-cuses on only dense local similarity, neglecting the global coherence of potential structures.
To address these challenges, we propose a Multimodal
Optimal Transport-based Co-Attention Transformer (MOTCat) framework with global structure consistency, in which optimal transport-based co-attention is applied to match instances between histology and genomics from a global perspective, as shown in Fig. 1 (b). Optimal trans-port (OT) [11, 3, 41], as a structural matching approach, is able to generate an optimal matching solution with the overall minimum matching cost, based on local pairwise cost between instances of histology and genomics. As a result, instances of a WSI that have high global structure consistency with genes co-expressions can be identified to represent the WSI. These instances might be more strongly associated with TME that contributes to survival prediction.
In this way, the aforementioned two challenges can be addressed by OT-based Co-Attention simultaneously.
Compared with the conventional co-attention mecha-nism, the advantages of the proposed OT-based co-attention are three-fold. First, optimal transport provides the in-stances matching process with global awareness. Marginal constraints of total mass equality enforce a trade-off of in-stances within modality for transporting during optimiza-tion, instead of only considering the local similarity of pair-wise instances as conventional co-attention does.
It en-ables the modeling of structural interactions of WSIs and co-expressions of genomics, which is beneficial to survival prediction. Second, the learned patch-level attention score is not a rigorous metric for selecting informative instances under weak supervision [48], i.e. slide-level survival time, especially with only a small number of WSI samples. As an alternative, the optimal matching flow is the rigorous closed-form solution to OT problem without accessing any label, achieved by solving the Linear Programming prob-lem. Last, the optimal matching flow provides a transforma-tion between two modalities under preserving the potential structure, which reduces cross-modal heterogeneity gap.
Nevertheless, due to a massive number of patches from gigapixel WSIs, OT-based co-attention might suffer from high computational complexity, preventing from applying
OT to pathology data in practice. To address this, we pro-pose a robust and efficient implementation of OT-based co-attention for matching histology and genomics. Specifi-cally, we split all instances of a WSI into a subset termed
Micro-Batch and get the averaged result as a proxy to ap-proximate the solution to the original OT problem over all instances by unbalanced optimal transport [13], which can provide a more robust approximation to the subset sampling with the theoretical and experimental guarantee.
It is worth noting that the proposed method is a gener-alized multimodal learning framework that captures poten-tial structure across modalities with global structure consis-tency. The contributions of this work are summarized as follows: (1) we propose a novel multimodal OT-based Co-Attention Transformer with global structure consistency, where OT-based co-attention is used to identify informa-tive instances by global optimal matching, which allows modeling interactions of histology and co-expression of ge-nomics. (2) We propose a robust and efficient implementa-tion of OT-based co-attention over Micro-Batch. (3) Exten-sive experiments on five benchmark datasets show signifi-cant improvement over state-of-the-art methods. 2.