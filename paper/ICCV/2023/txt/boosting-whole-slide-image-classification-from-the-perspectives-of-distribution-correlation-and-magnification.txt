Abstract
Bag-based multiple instance learning (MIL) methods have become the mainstream for Whole Slide Image (WSI) classiﬁcation. However, there are still three important is-sues that have not been fully addressed: (1) positive bags with a low positive instance ratio are prone to the inﬂuence of a large number of negative instances; (2) the correla-tion between local and global features of pathology images has not been fully modeled; and (3) there is a lack of ef-fective information interaction between different magniﬁca-In this paper, we propose MILBooster, a powerful tions. dual-scale multi-stage MIL framework to address these is-sues from the perspectives of distribution, correlation, and magniﬁcation. Speciﬁcally, to address issue (1), we pro-pose a plug-and-play bag ﬁlter that effectively increases the positive instance ratio of positive bags. For issue (2), we propose a novel window-based Transformer architec-ture called PiceBlock to model the correlation between lo-cal and global features of pathology images. For issue (3), we propose a dual-branch architecture to process dif-ferent magniﬁcations and design an information interac-tion module called Scale Mixer for efﬁcient information interaction between them. We conducted extensive exper-iments on four clinical WSI classiﬁcation tasks using three datasets. MILBooster achieved new state-of-the-art per-formance on all these tasks. Codes will be available at https://github.com/miccaiif/MILBooster. 1.

Introduction
Computer-aided diagnosis based on pathology Whole
Slide Images (WSIs) has important clinical signiﬁcance, but using deep-learning techniques in WSI classiﬁcation faces great challenges [29, 38, 23, 26, 21]. On one hand, WSIs are very large, typically being muti-gigapixel images, so they must be divided into many small patches to be processed by
∗Co-ﬁrst author. †Co-corresponding author.
Figure 1. Motivation of our proposed bag ﬁlter. Left ﬁgure: the positive instance ratio of the middle positive bag is low so its bag feature is biased towards negative instances and it is mis-classiﬁed.
Right ﬁgure: after ﬁltering a large number of negative instances (and possibly some positive instances), the bag feature of the mid-dle positive bag is rectiﬁed, and it is correctly classiﬁed. deep neural networks. On the other hand, although the la-bel of the whole slide can often be obtained, obtaining ﬁne-grained annotations for the huge number of small patches is extremely expensive, which makes supervised learning at the patch level infeasible. Therefore, WSI classiﬁcation is usually formulated as a Multiple Instance Learning (MIL) problem [34, 9, 6, 22, 24], in which each slide is treated as a bag and the patches cut from the slide are treated as in-stances of the bag. In the MIL formulation, all instances in a negative bag are negative, while at least one instance in a positive bag is positive. The goal of WSI classiﬁcation is to accurately classify each bag, while the label of each instance is unavailable.
Deep learning-based MIL methods can generally be di-vided into instance-based methods [3, 10, 30, 15, 41] and bag-based methods [14, 13, 45, 43, 36, 17, 44, 35, 18, 7, 24, 19]. Instance-based methods typically assign a pseudo-label to each instance, and then train an instance classiﬁer to predict the positive score of instances. Finally, bag classiﬁ-cation is achieved by aggregating the positive scores of all instances in a bag. Since the true label of each instance is unknown, the pseudo-labels used in this method often con-tain a large amount of noise, which limits their performance
[30, 17, 32, 25, 31]. Bag-based methods ﬁrst extract fea-tures for each instance, and then use aggregation functions to aggregate the instance features to obtain the bag feature, which is used to train a bag classiﬁer based on the true label of the bag. By aggregating features at the bag level, bag-based methods avoid the problem of noisy instance labels, and can often achieve higher classiﬁcation performance.
However, there are still three important problems that have not been fully addressed. (1) The aggregated bag feature tends to be biased towards the negative side when the posi-tive instance ratio is low in a positive bag, which increases the risk of decision error. As shown in Figure 1, intuitively, when the positive instance ratio in a positive bag is low, the aggregated bag feature is easily affected by the massive negative instances, which increases the difﬁculty of training the bag classiﬁer and inferencing on test bags. If a large number of negative instances can be removed from positive bags, both training and inferencing will become easier. (2)
The correlation between local and global features has not been fully modeled. As shown in Figure 2 (A), classical attention-based methods [14, 36] assume that each instance in a bag is independent, hence lacking correlation modeling among instances [35]. Recent studies [35, 18, 7] have used
Vision Transformer (ViT) frameworks [11] to model the re-lationship between instances, but they neglect the modeling of local context. In pathology images, tumors are often dis-tributed in a continuous region with an area much larger than the patch size, so proper modeling of regional context of patches is essential. (3) There is a lack of effective infor-mation interaction between different magniﬁcation levels.
In clinical practice, pathologists often zoom in and out on
WSIs to make a diagnosis of tumors [1, 12, 39], which indi-cates the need of examining WSIs at different magniﬁcation levels. However, most existing studies only work on a single level. As shown in Figure 2 (B), several recent studies have proposed methods such as feature concatenation [17] and weighted fusion [13] for combining multi-magniﬁcation in-formation, but they are too simple to effectively fuse infor-mation of different magniﬁcations.
To tackle the aforementioned problems, we propose
MILBooster, a powerful dual-scale, multi-stage MIL frame-work that signiﬁcantly enhances the performance of WSI classiﬁcation from three aspects: distribution, correlation, and magniﬁcation. In MILBooster, we propose bag ﬁlter to effectively address problem (1) from the perspective of fea-ture distribution modeling. Speciﬁcally, the bag ﬁlter is a plug-and-play pre-processing module that is applied to both training and test sets to effectively increase the positive in-stance ratio in positive bags and eliminate the negative im-pact of a large number of negative instances on feature ag-gregation. For problem (2), we propose a window-based
PiceBlock (Part Interact with Entirety Block) to model the correlation between local and global features in pathol-ogy images. In PiceBlock, we arrange the features accord-ing to the position of their corresponding patches and di-vide the feature map into several windows. We design a
Self-window Transformer Block (SWTB) to model the cor-relation of instance features within each window, a Self-Window Merging Block (SWMB) to merge the instance features within each window into a region feature, and a
Cross-window Transformer Block (CWTB) to model the correlation between each instance and each region feature.
In this way, PiceBlock achieves efﬁcient modeling of the correlation between local features and global features. For problem (3), we propose a dual-scale interaction module called Scale Mixer to achieve efﬁcient information interac-tion between different magniﬁcations. For the two scales (high scale and low scale) being used, the Scale Mixer takes the feature map of either the high or the low scale as the main information and partitions the feature map of the other scale into windows for interaction with the main informa-tion using SWMB and CWTB. The output feature maps of
SWMB and CWTB are then fused with the main informa-tion ﬂow for enhancement.
We conducted extensive single-scale and dual-scale ex-periments on four clinical tasks across three datasets con-taining different types of cancer. The results showed that
MILBooster can signiﬁcantly improve the performance of
WSI classiﬁcation and achieve new SOTA. 2.