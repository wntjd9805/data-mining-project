Abstract
To represent the biological variability of clinical neu-roimaging populations, it is vital to be able to combine data across scanners and studies. However, different MRI scan-ners produce images with different characteristics, resulting in a domain shift known as the ‘harmonisation problem’.
Additionally, neuroimaging data is inherently personal in nature, leading to data privacy concerns when sharing the data. To overcome these barriers, we propose an Unsu-pervised Source-Free Domain Adaptation (SFDA) method,
SFHarmony. Through modelling the imaging features as a
Gaussian Mixture Model and minimising an adapted Bhat-tacharyya distance between the source and target features, we can create a model that performs well for the target data whilst having a shared feature representation across the data domains, without needing access to the source data for adaptation or target labels. We demonstrate the performance of our method on simulated and real domain shifts, showing that the approach is applicable to classi-fication, segmentation and regression tasks, requiring no changes to the algorithm. Our method outperforms ex-isting SFDA approaches across a range of realistic data scenarios, demonstrating the potential utility of our ap-proach for MRI harmonisation and general SFDA prob-lems. Our code is available at https://github.com/ nkdinsdale/SFHarmony. 1.

Introduction
Deep learning (DL) models have proved to be power-ful tools for neuroimage analysis. However, the major-ity of neuroimaging datasets remain small, posing a chal-lenge for the training of sophisticated architectures with many parameters. Thus, it is common practice to com-bine data from multiple sites and MRI scanners, both to increase the amount of data available for training, and to represent the breadth of biological variability that can be expected in diverse populations. However, the combina-tion of data across MRI scanners with different acquisi-tion protocols and hardware leads to an increase in non-biological variance [25, 26, 50], which can be large enough to mask the biological signals of interest [49], even after careful pre-processing with state-of-the-art neuroimaging pipelines [23]. The development of harmonisation meth-ods is therefore vital to enable the joint unbiased analysis of neuroimaging data from different scanners and studies.
The key goal for harmonisation methods is to be discrim-inative for the main task of interest whilst creating shared feature representations of the data across acquisition scan-ners, clearly mirroring the goal of domain adaptation (DA)
[15]. The majority of deep learning based harmonisation methods are based on DA methods, either using adversar-ial approaches to create shared feature embeddings [15,24], or using generative approaches to create harmonised im-ages [11, 63].
However, the vast majority of existing methods fail to be applicable in many realistic data scenarios. For exam-ple, MR images are inherently personal information so their sharing is protected by legislation, such as GDPR [9] and
HIPAA [39]. Thus, the assumption of centralised data stores for model training is infeasible, particularly when working with clinical imaging data, which will be essential in or-der to produce representative models [14, 52]. Distributed learning offers a promising solution, but the few proposed distributed harmonisation methods [8,16] assume the simul-taneous presence of the source and target data. The source data may not be available for the adaptation phase, for in-stance, due to confidentiality agreements, loss of the source
Figure 1. Schematic of the proposed SFHarmony method. The method fits a GMM to the source features, shares these via a global model store, and then completes SFDA by aligning the source and target feature distributions utilising a modified Bhattacharyya distance. Qs is the source feature representation and Qt is the target feature representation, and the figure shows the GMM setup, for a single feature i, when we are working with K, the number of components, being 2. This trivially generalises to more or less components. data, or computational constraints [3]. Further, federated
DA methods such as [16] would require retraining of the model to incorporate any new sites, which is infeasible and computationally expensive.
Therefore, we explore an unsupervised DA setting where only the source model, instead of the source data, is pro-vided to the unlabelled target domain for harmonisation, known as Source Free Domain Adaptation (SFDA). This setting inherently protects individual privacy, whilst allow-ing the efficient incorporation of new sites without requiring target labels. We propose a simple yet effective solution, termed SFHarmony, which aims to match feature embed-dings from the source and target, through characterising the embeddings as a Gaussian Mixture model (GMM) and the use of a modified Bhattacharyya distance [4]. This requires no modifications to the training of the source model, and the only additional communication is of summary statistics of the source feature embedding, allowing it to be simply applied to existing architectures. The summary statistics contain no information about individuals.
Our contributions are as follows: 1) We propose a new method for SFDA, SFHarmony, based on aligning feature embeddings, utilising a modified Bhattacharyya distance, requiring no changes to source training; 2) We demon-strate the method’s applicability to classification, segmen-tation and regression tasks, and show that the approach outperforms existing SFDA methods for domain shifts ex-perienced when working with neuroimaging data; 3) We demonstrate the robustness of the method to additional chal-lenges likely to be faced when working with real world imaging data: differential privacy and label imbalance. 2.