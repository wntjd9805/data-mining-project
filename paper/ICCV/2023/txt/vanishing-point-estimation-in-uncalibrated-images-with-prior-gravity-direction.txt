Abstract
We tackle the problem of estimating a Manhattan frame, i.e. three orthogonal vanishing points, and the unknown fo-cal length of the camera, leveraging a prior vertical direc-tion. The direction can come from an Inertial Measurement
Unit that is a standard component of recent consumer de-vices, e.g., smartphones. We provide an exhaustive analysis of minimal line configurations and derive two new 2-line solvers, one of which does not suffer from singularities af-fecting existing solvers. Additionally, we design a new non-minimal method, running on an arbitrary number of lines, to boost the performance in local optimization. Combining all solvers in a hybrid robust estimator, our method achieves increased accuracy even with a rough prior. Experiments on synthetic and real-world datasets demonstrate the superior accuracy of our method compared to the state of the art, while having comparable runtimes. We further demonstrate the applicability of our solvers for relative rotation estima-tion. The code is available at https://github.com/ cvg/VP-Estimation-with-Prior-Gravity. 1.

Introduction
Projecting parallel lines of the world into a perspective image reveals a common intersection point: their vanishing point (VP). Estimating VPs from a single image is a long-standing task in vision, as they provide critical information about the 3D structure of the scene [39]. Vanishing points are relevant in many vision applications, such as camera ro-tation estimation [11, 13, 18], calibration [10], single-view reconstruction [22], wireframe parsing [35, 48].
Vanishing point estimation methods can be categorized into two main paradigms: unconstrained VP detection dis-covering an undefined number of VPs [5, 34, 45, 24], and approaches that make the Manhattan world assump-tion [11, 7, 46, 28], i.e., there are three dominant and or-thogonal directions in the world. We opt in this paper for the second option, assuming a Manhattan world. This scenario is particularly relevant in human-made environments, where most applications leveraging VPs take place. By making this assumption, we can directly estimate the three orthog-onal directions, significantly reducing the search space and simplifying the robust estimation problem. Although it is possible to detect an unconstrained number of VPs and later orthogonalize them [13], directly looking for a set of 3 or-thogonal VPs is more efficient and accurate in practice [7].
Vanishing point detection has been extensively studied in the past. We distinguish five main directions of research: exhaustive search methods [32, 36, 6, 31, 33], expectation-maximization-based [3, 13], optimization-based [8, 41], deep learning-based [4, 47, 29, 40] and RANSAC-based ones [2, 44, 43, 7, 46]. Due to their robustness to outliers, we adopt the strand of research based on RANSAC in this
paper [19]. To make RANSAC fast and accurate, minimal solvers are recommended in the model estimation step. For the Manhattan world assumption, the minimum number of lines to estimate the 3 VPs from a calibrated image is 3 [7].
In the uncalibrated case with unknown focal lengths and known principal point, 4 lines are needed to recover the 3
VPs and the focal length [43, 46]. Assuming the principal point to be in the center of the image is a common prac-tice [43, 46, 33], which leads to accurate focal lengths [23].
In this paper, we focus on estimating three orthogo-nal VPs in an uncalibrated image, given a known direc-tion. Specifically, we consider the case of a vertical prior (i.e., gravity direction) but the same theory applies to other common directions, such as the horizon line. Nowadays, most commercial devices, including smartphones and AR glasses, come with built-in Inertial Measurement Units (IMU) measuring the gravity direction with good precision.
Moreover, people tend to take pictures upright, providing a prior that vertical lines should roughly align with the grav-ity direction. This known direction is a rich signal for VP detection, as it gives one VP in the calibrated setting [7].
Assuming unknown focal lengths and known vertical di-rection is a practical problem with numerous real-world ap-plications. For example, it is crucial for camera systems that are re-calibrating on-the-fly or that allow zooming in and out. An application for this task is autonomous driving, where the camera always stays upright, but its calibration may drift after several months of use, requiring an online calibration. Furthermore, tourist pictures found on social media are often taken roughly upright, without any avail-able camera calibration. Finally, vanishing points provide strong constraints on the 3D rotation when calculating the relative pose of an image pair. This is particularly useful when the cameras undergo pure rotation, where traditional fundamental matrix-based solutions fail [20].
We propose two new minimal solvers that address line configurations not discussed in prior work [30]. The solvers estimate the camera rotation and focal length from a pair of lines. Importantly, one of the proposed solvers is not af-fected by a singularity that makes other methods unstable when dealing with perfectly upright images. To enable es-timation from any number of lines, we also present a new non-minimal solver that can be used for local optimization in RANSAC. Moreover, we combine all the proposed and existing solvers in a hybrid RANSAC [9] framework, illus-trated in Figure 1, that adaptively decides when to use the gravity prior. In summary, our contributions are as follows:
• We provide all line configurations leading to minimal problems for VP estimation given known gravity but unknown focal length.
• We derive solutions for configurations not previously discussed in the literature, one of which overcomes a common singularity of previous solvers.
• We propose a new non-minimal solver to boost perfor-mance in the local optimization of RANSAC.
• We combine all the existing configurations into a hy-brid RANSAC framework to increase robustness to sit-uations with only a rough gravity prior.
The proposed methods are evaluated on large-scale and real-world datasets, demonstrating superior accuracy com-pared to the state of the art when the gravity direction is known. When we are only given a rough prior, the hybrid solution efficiently uses all solvers together to obtain results more accurately than by previous solvers. Furthermore, we demonstrate that such an approach is highly beneficial for relative rotation estimation in a pair of cameras. 2. Uncalibrated Vanishing Point Estimation
In this work, we make the Manhattan world assumption.
We are looking for 3 orthogonal vanishing points from a single image with a pinhole camera model. While the prin-cipal point is assumed to be in the center of the image, we consider the focal length unknown, but the gravity direc-tion to be known (e.g., from an IMU) or we have a rough prior on it (e.g., the image is upright). In this section, we first discuss existing work [30] (2.1) and introduce two new solvers (2.2 and 2.3). Then, we describe a new non-minimal solver in Section 2.4. Finally, a hybrid RANSAC approach is designed to combine all solvers in Section 2.5.
Theoretical