Abstract
Crowd counting has recently attracted significant atten-tion in the field of computer vision due to its wide appli-cations to image understanding. Numerous methods have been proposed and achieved state-of-the-art performance for real-world tasks. However, existing approaches do not perform well under adverse weather such as haze, rain, and snow since the visual appearances of crowds in such scenes are drastically different from those images in clear weather of typical datasets. In this paper, we propose a method for ro-bust crowd counting in adverse weather scenarios. Instead of using a two-stage approach that involves image restora-tion and crowd counting modules, our model learns effective features and adaptive queries to account for large appear-ance variations. With these weather queries, the proposed model can learn the weather information according to the degradation of the input image and optimize with the crowd counting module simultaneously. Experimental results show that the proposed algorithm is effective in counting crowds under different weather types on benchmark datasets. The source code is available in our project page. 1.

Introduction
Crowd counting aims to estimate the number of persons in a scene. With the advances of deep learning and construction of large-scale datasets [69, 19, 45, 54], this topic has become an important topic with numerous applications. State-of-the-art approaches are mainly based on convolutional neural networks (CNNs) [22, 24, 31, 57, 50, 13, 1, 27, 29] and transformers [48, 47, 37, 26]. While these approaches count crowds effectively on normal images, they typically do not perform well under adverse weather conditions such as haze, rain, and snow. However, adverse weather is a common and inevitable scenario that causes large appearance variations of crowd scenes, thereby significantly affecting the perfor-mance of methods developed for clear weather. As shown in Figure 1, the state-of-the-art crowd counting method [29]
* indicates equal contribution.
Figure 1. Performance of State-of-the-art crowd counting methods under adverse and clear weather on the JHU-Crowd++ [45] dataset using mean absolute error (MAE). The
MAN method [29] achieves low MAE in clear scenes but high MAE in adverse weather. On the other hand, the two-stage method, based on Unified [8] and MAN [29]), performs slightly better in adverse weather but slightly worse in clear scenes. Overall, the proposed
AWCC-Net performs favorably in both scenarios. performs well only under good weather conditions. Thus, it is of great importance to develop robust crowd counting methods for adverse weather conditions.
To solve the crowd counting problem under adverse weather, a plausible solution is to consider a two-stage model. Specifically, this strategy pre-processes images us-ing the state-of-the-art image restoration modules [8, 49] and then applies the state-of-the-art crowd counting method [29].
However, this two-stage method may not perform well due to several factors. First, adopting existing image restoration methods does not always facilitate the crowd counting task significantly since these methods are designed to restore im-age contents rather than visual classification or regression.
As shown in Figure 1, a two-stage approach does not ad-dress this problem effectively. Second, this strategy requires to collect and label images under adverse weather conditions for the restoration process. In addition, a two-stage strategy may increase computational complexity significantly.
In this work, we propose a method based on a trans-former to robustly count crowds under adverse and clear scenes without exploiting typical image restoration modules.
We develop the adverse weather crowd counting network (AWCC-Net) which leverages learned weather queries for robust crowd counting. In our model, the weather queries are adopted to match the keys and values extracted from the VGG encoder [43] based on the cross-attention design.
However, the learned weather queries cannot well represent the weather information without appropriate constraints. To improve this situation, we present a contrastive weather-adaptive module to improve the learned weather queries.
This adaptive module computes a weight vector which is combined with the learned weather bank to construct input-dependent weather queries. We use the proposed contrastive loss to enforce the learned weather queries to be weather-related. With this weather-adaptive module, more robust weather queries can be learned which help the network un-derstand and adapt to the various weather degradation types in the input image.
Extensive experimental results show that the proposed
AWCC-Net model performs robustly and favorably against the state-of-the-art schemes for crowd counting under ad-verse weather conditions without weather annotations. We make the following contributions in this work:
• We present the AWCC-Net for crowd counting under adverse weather. Our method is based on a transformer architecture that can learn weather-aware crowd count-ing.
• We propose a module to constrain the learned queries to be weather-relevant, thereby improving model ro-bustness under adverse weather. 2.