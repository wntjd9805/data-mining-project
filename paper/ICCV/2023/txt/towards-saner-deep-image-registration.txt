Abstract
With recent advances in computing hardware and surges of deep-learning architectures, learning-based deep image registration methods have surpassed their traditional coun-terparts, in terms of metric performance and inference time.
However, these methods focus on improving performance measurements such as Dice, resulting in less attention given to model behaviors that are equally desirable for registra-tions, especially for medical imaging. This paper investi-gates these behaviors for popular learning-based deep reg-istrations under a sanity-checking microscope. We ﬁnd that most existing registrations suffer from low inverse consis-tency and nondiscrimination of identical pairs due to overly optimized image similarities. To rectify these behaviors, we propose a novel regularization-based sanity-enforcer method that imposes two sanity checks on the deep model to reduce its inverse consistency errors and increase its dis-criminative power simultaneously. Moreover, we derive a set of theoretical guarantees for our sanity-checked image registration method, with experimental results supporting our theoretical ﬁndings and their effectiveness in increasing the sanity of models without sacriﬁcing any performance. 1.

Introduction
Learning maps between images or spaces, i.e. registra-tion, is an important task, and has been widely studied in various ﬁelds, such as computer vision [15, 33], medical imaging [20, 52], and brain mapping [35, 47]. With re-cent advances in modern computing hardware and deep-learning techniques, learning-based deep image registra-tion methods have surpassed their traditional counterparts, both in terms of metric performance and inference time.
Different from the traditional style of optimizing on sin-gle image pair [12, 32, 7, 11, 2, 28, 19] using diffeomor-phic formulations, such as elastic [4, 38], ﬂuid mechan-ics [7, 18, 43] or B-spline [36], existing deep registra-tions [42, 6, 13, 29, 23, 10, 41, 25, 9] focus on maximizing
Figure 1. FV-SDice-Dice comparisons of deep registrations on
IXI Brain dataset. The vertical axis is FV (% of folded voxels), the horizontal axis is SDice (Self-Dice), and the circle size is Dice.
Both sanity-checked models (VM-ESC and TMBS-ESC) achieve better diffeomorphism, competitive registration performance, and signiﬁcantly improved self-sanity, compared to other models, in-cluding models with inverse consistency (ICNet [50], ICON [16]). image similarities between transformed moving images and
ﬁxed images. Despite the effectiveness of this approach, it inevitably leads to over-optimization of image similarities and thus introduces non-smooth mappings [6, 50, 16, 9], where smooth transformation maps are typically desirable, especially in the medical imaging domain.
To tackle the over-optimized issue, popular remedies [4, 36, 44, 37, 49, 45, 39, 40] utilize add-ons such as Large De-formations Diffeomorphic Metric Mapping (LDDMM) [7], vector Stationary Velocity Field (vSVF) [39], B-spline [36],
Elastic [4] or Demons [43] to enforce diffeomorphism, re-quiring costly and iterative numerical optimizations [8, 49, 39]. Other methods [13, 17] seek probabilistic formulation for the registration but can lead to inferior performance [9].
Nonetheless, these methods operate only on one mapping in the direction from moving to ﬁxed images, yet disregard-ing the relationship between different mappings from both directions, as shown in Appendix1 Fig. A1.
*Corresponding author 1Appendix goes https://arxiv.org/pdf/2307.09696.pdf
Recent studies [50, 16, 31] have made great progress inverse consistency, for in modeling the relationship, i.e. different mappings.
[50, 16] explicitly enforce the re-lationship in a strict form for ideal inverse consistency.
However, for applications such as brain tumor registra-tion [3], where there are regions with no valid correspon-dences, it is impractical to apply in such a strict man-ner. To select valid correspondences, [31] utilize mean er-rors of similar anatomical locations as thresholds. How-ever, it is always tricky to determine similar anatomical lo-cations, especially for unsupervised registrations in med-ical imaging [6, 13, 41]. Different from previous meth-ods [50, 16, 31], we introduce two straightforward yet ef-fective constraints, namely, self-sanity check to reduce er-ror while registering identical pairs and cross-sanity check to ensure inverse consistency. Using our sanity checks, we test a wide range of registration models and ﬁnd that de-spite better performance such as Dice, most models are suf-fering from over-optimization of image similarities, lead-ing to folded transformations and low sanity awareness, as shown in Fig. 1. Moreover, our sanity checks can be ap-plied to different registration models, where the extensive experiments certify that our method improves their sanity awareness, without sacriﬁcing any performance.
Our ﬁndings are ﬁve-fold: (1) We ﬁnd that despite bet-ter performance such as Dice, most models produce non-smooth transformations and are less aware of sanity errors due to over-optimization on image similarities; (2) We pro-pose two novel sanity checks for the registration model training and derive corresponding theoretical foundations; (3) Our sanity checks not only help reduce the sanity er-rors of existing models but also assist them to produce more regular maps without diffeomorphic add-ons; (4) Our pro-posed sanity-checks are model-agnostic. It can be deployed to various models and is only needed during training so that it does genereate no side effects for inference; (5) Experi-ments on IXI [1], OASIS [26], and BraTSReg [3] datasets verify our ﬁndings and show on par or better performance. 2.