Abstract
Unsupervised surface anomaly detection aims at dis-covering and localizing anomalous patterns using only anomaly-free training samples. Reconstruction-based mod-els are among the most popular and successful methods, which rely on the assumption that anomaly regions are more difficult to reconstruct. However, there are three major chal-lenges to the practical application of this approach: 1) the reconstruction quality needs to be further improved since it has a great impact on the final result, especially for images with structural changes; 2) it is observed that for many neu-ral networks, the anomalies can also be well reconstructed, which severely violates the underlying assumption; 3) since reconstruction is an ill-conditioned problem, a test instance may correspond to multiple normal patterns, but most cur-rent reconstruction-based methods have ignored this criti-cal fact. In this paper, we propose DiffAD, a method for unsupervised anomaly detection based on the latent diffu-sion model, inspired by its ability to generate high-quality and diverse images. We further propose noisy condition embedding and interpolated channels to address the afore-mentioned challenges in the general reconstruction-based pipeline. Extensive experiments show that our method achieves state-of-the-art performance on the challenging
MVTec dataset, especially in localization accuracy. 1.

Introduction
With the great success of deep neural networks in various computer vision tasks, their application in surface anomaly detection, which aims to detect anomalous patterns that de-viate from normal samples, has also received unprecedented attention. However, unlike traditional supervised computer
*Equal contribution
†Tao Dai and Naiqi Li are the corresponding authors.
Figure 1. The reconstructed samples Ir of traditional autoencoder-based methods often fail into direct copies of the anomalous inputs
Ia (medium), especially for samples with structural deformations (top). With our DiffAD, the generated samples are semantically anomaly-free while keeping consistent in other non-anomalous re-gions (bottom), yielding pleasing detection and localization results
Mo, closely matching the ground truth (GT). vision tasks such as image recognition, anomalous samples are quite rare in real-world scenarios. Therefore, unsuper-vised methods for anomaly detection are of great signifi-cance in practice.
Reconstruction-based models are among the most pop-ular and successful methods of unsupervised anomaly de-tection. Based on the assumption that anomaly regions are more difficult to reconstruct, they try to detect anomalies by comparing the input images with their reconstructed coun-terparts.
To address the absence of anomalous samples, data aug-mentation techniques are widely used in the reconstruction-based framework. For instance, DRAEM [32] synthesizes anomalous samples by blending predefined texture images with normal training instances. Utilizing the synthetic anomalous samples, an autoencoder-based reconstructive
sub-network is trained to repair the anomalous regions while keeping the non-anomalous parts unchanged. Both the reconstructive and original images are concatenated and fed to a following discriminative sub-network, which pro-duces a segmentation map as the final anomaly detection result.
However, there are three major challenges to the prac-tical application of this approach. First, though current re-construction networks are good at repairing textural anoma-lies, they are vulnerable to structural changes in the images.
Considering the significant impact of reconstruction qual-ity on the final result, it is necessary to explore more recent and state-of-the-art models for image reconstruction. Sec-ond, it is observed that for many neural networks, anomalies can also be well reconstructed, which violates the under-lying assumption. Specifically, the reconstruction network may return a direct copy of the input image with anoma-lies, resulting in detection failure. Third, since reconstruc-tion is an ill-conditioned problem, a test instance may cor-respond to multiple normal patterns. However, most current reconstruction-based methods ignore this important fact, so it is necessary to take into account the diversity of recon-structions.
In this paper, we propose DiffAD, a novel reconstruction-based method for anomaly detection, which simultaneously addresses the challenges mentioned above. Our method uti-lizes the recently proposed diffusion model (DM) as the reconstruction component. The denoising diffusion proba-bilistic model [11] is a parameterized Markov chain trained to produce samples by learning to reverse a diffusion pro-cess, which gradually adds noise to the training data until the original signal is destroyed. At the sampling stage, it is capable of generating high-quality and diverse samples from random Gaussian noise. To ameliorate the heavy com-putation burden of diffusion models, we use the latent diffu-sion model (LDM) [22] which is trained in the learned latent space. Our method introduces noisy condition embedding, which diffuses the latent representation of the test image with noise before it is used to condition the generation pro-cess. This avoids the reconstruction network from synthe-sizing a direct copy of the anomalous region and forces it to use global information, thus making the normal and anoma-lous parts more distinctive. Furthermore, we proposed the interpolated channels in the anomaly detection pipeline. Its basic idea is to interpolate the latent features generated by the diffusion model and that of the original input to pro-duce additional channels, which are concatenated with the original and the reconstructed images before being sent to the segmentation sub-network. Intuitively, the interpolated channels make our model aware of diversity during recon-struction.
Extensive experiments on the MVTec-AD dataset [2] demonstrate the effectiveness of our approach by improv-ing performance on the tasks of both anomaly detection and anomaly localization. The main contributions of our method are summarized as follows:
• We propose a novel method for unsupervised anomaly detection called DiffAD. To the best of our knowledge, this is the first reconstruction-based method that takes advantage of the latent diffusion model.
• We propose noisy condition embedding, which main-tains the distinction between normal and anomalous regions during reconstruction.
• We propose interpolated channels, which make our model aware of the diversity during reconstruction and ameliorate the distractions brought by the pixel-level differences between the reconstructed and original im-ages.
• Extensive experiments demonstrate that our proposed method is effective and can greatly improve anomaly detection and localization performance on the MVTec-AD dataset. 2.