Abstract
In the real world, image degradations caused by rain often exhibit a combination of rain streaks and raindrops, thereby increasing the challenges of recovering the under-lying clean image. Note that the rain streaks and raindrops have diverse shapes, sizes, and locations in the captured im-age, and thus modeling the correlation relationship between irregular degradations caused by rain artifacts is a nec-essary prerequisite for image deraining. This paper aims to present an efficient and flexible mechanism to learn and model degradation relationships in a global view, thereby achieving a unified removal of intricate rain scenes. To do so, we propose a Sparse Sampling Transformer based on Uncertainty-Driven Ranking, dubbed UDR-S2Former.
Compared to previous methods, our UDR-S2Former has three merits. First, it can adaptively sample relevant im-age degradation information to model underlying degra-dation relationships. Second, explicit application of the uncertainty-driven ranking strategy can facilitate the net-work to attend to degradation features and understand the reconstruction process. Finally, experimental results show that our UDR-S2Former clearly outperforms state-of-the-art methods for all benchmarks. 1.

Introduction
Rain is a ubiquitous condition that negatively impacts
In real-world rain various computer vision tasks [2, 70]. scenes, raindrops and rain streaks are irregularly superim-posed on clean images.
Image deraining is employed to restore the clean images from the complex rain degrada-tions. According to previous work [48], the imaging model
*Equal contributions.
†Lei Zhu (leizhu@ust.hk) is the corresponding author.
Figure 1: Illustration of the breakdown of complex rain degrada-tion relationships and the thumbnails of our main ideas. Colored places indicate degradations. Two-way arrows represents model-ing between degradations. of precipitation, inclusive of rain streaks and raindrops, can be expressed as:
Rds = (1 − Mr) ⊙ (B + S) + ηD, (1) where B and S denote the clean background and rain streak map. Mr is a binary mask used to judge whether the pixel belongs to the raindrops or the background. D is the rain-drops and η means global atmospheric lighting coefficient.
As noted by CCN [48], removing rain streaks and rain-drops in a unified manner cannot be achieved by simply combining separate methods for removing either. This is due to the complex nature of the physical models involved and the wide array of possible degradation combinations.
Previous models developed to address singular forms of degradations [11, 12, 36, 49, 50, 55, 62] face notable obsta-cles when dealing with irregularly dispersed and diverse rain degradation types.
Specifically, current SOTA methods for image deraining primarily concentrate on using ViTs due to their abilities to model long-range dependencies [27, 40, 57, 58]. Among these methods, window-based self-attention [40, 57, 58] has gained popularity due to its computational efficiency. How-ever, as shown in Fig.1, we argue that utilizing window-Figure 2: The uncertainty maps (bottom row) correspond to both real and synthetic samples (top row), with more significant uncertainty appearing in areas with severe and complicated degradations. This observation motivates us to use uncertainty explicitly to represent knowledge about degradation and to improve the model’s understanding of degradation restoration. based self-attention mechanisms can lead to incomplete degradation coverage, causing the breakdown of degrada-tion relationships for unified rain degradation removal due to fixed window segmentation. This problem can be particu-larly pronounced when dealing with large raindrops or rain streaks at long distances simultaneously. However, in the case of complicated degradations, it is imperative to model the relationships between related forms of degradations.
Furthermore, with respect to the dense prediction task of rain removal, the density, shape, position, and size of rain-drops and streaks are all uncertain, rendering it arduous for the network to restore clean images from diverse degrada-tions. The CCN [48] requires using expensive and inflex-ible NAS to select an optimal architecture that effectively handles rain streaks and raindrops precisely.
Inspired by uncertainty modeling [34] for image restoration, incorpo-rating uncertainty learning can enhance the performance by reducing the error in model parameters [19], or serve as a regular term constraint to enhance the prediction quality of regions characterized by high uncertainty [44, 53]. Never-theless, the mentioned design paradigm overlooks the im-portance of explicitly excavating uncertainty maps in facil-itating the network’s modeling of degradation features. For intricate rain scenes, we claim that learning uncertainty es-timation can in turn affect the network to better focus on the complicated rain degradation areas. As depicted in Fig.2, the uncertainty map of the image exhibits greater concentra-tion within the degraded region. It is our contention that by fully leveraging the properties of this uncertainty map, we can more effectively model the relationships of degradation and drive the network for the understanding of degradation restoration.
Specifically, to address the problems above, we first de-sign the Sparse Sampling Attention to deal with compli-cated rain scenes. It sparsely learns the relevant degradation relationships from the entire image, thereby alleviating the drawback of large-scale degradation modeling in window-based attention. Concurrently, we leverage the uncertainty map to guide feature learning for capturing more discrim-inative sampling features. To be exact, in order to fully leverage uncertainty information to promote the sampling of degradation features, we propose a novel ranking strat-egy and present a Constraint Matrix based on it. Such de-sign further restricts the degree of attention to various rain degradations in the sampling process, boosting the model-ing of relationships between degradations. Moreover, when restoring partially degraded regions, we consider the inter-nal difference of the uncertainty map and use the ranking of the Correlation Map to strengthen the network to restore the degraded area by leveraging clean cues within the local regions.
Overall, our contributions can be summarized as follows:
• An uncertainty-driven sparse sampling transformer that fully models the global degradation relationships in an efficient manner is proposed to remove diverse rain streaks and raindrops.
• We introduce a ranking strategy in the uncertainty map to enable the model to emphasize various rain degra-dation features in the sampling process through a con-structed constraint matrix.
• To enhance local reconstruction, we utilize the internal discrepancies within the uncertainty map to stimulate the network to extract credibly clean information. 2.