Abstract
Semantic segmentation models classify pixels into a set of known (“in-distribution”) visual classes. When deployed in an open world, the reliability of these models depends on their ability to not only classify in-distribution pixels but also to detect out-of-distribution (OoD) pixels. Historically, the poor OoD detection performance of these models has motivated the design of methods based on model re-training using synthetic training images that include OoD visual ob-jects. Although successful, these re-trained methods have two issues: 1) their in-distribution segmentation accuracy may drop during re-training, and 2) their OoD detection accuracy does not generalise well to new contexts outside the training set (e.g., from city to country context). In this paper, we mitigate these issues with: (i) a new residual pattern learning (RPL) module that assists the segmenta-tion model to detect OoD pixels with minimal deterioration to inlier segmentation accuracy; and (ii) a novel context-robust contrastive learning (CoroCL) that enforces RPL to robustly detect OoD pixels in various contexts. Our ap-proach improves by around 10% FPR and 7% AuPRC pre-vious state-of-the-art in Fishyscapes, Segment-Me-If-You-Can, and RoadAnomaly datasets.
1.

Introduction
Semantic segmentation is a fundamental computer vi-sion task that classifies each image pixel into a set of in-distribution visual classes (or inliers) [11]. Despite its suc-cess in closed-set benchmarks, many real-world applica-tions need to be able to cope with open-world scenarios, in which closed-world segmentation models will mistak-enly estimate out-of-distribution (OoD) visual objects (or anomalies) as one of the in-distribution classes. For some use-cases, such as autonomous driving, such errors could be catastrophic [11, 42]. One possible way to mitigate this risk is based on the development of pixel-wise OoD de-tection methods that work together with an in-distribution segmentation model to produce an OoD map on top of the closed-set segmentation mask [14, 17, 30]. Generally, this can be achieved by measuring the in-distribution seg-mentation uncertainty using classification entropy [9], log-its [17] or posterior distribution [14, 31] by freezing the in-lier segmentation model. Even though those approaches do not jeopardize the inlier performance, they tend to produce low uncertainty for hard OoD pixels that share similar pat-terns with in-distribution objects, leading to unsatisfactory performance when dealing with complex scenes, as shown in Fig. 1, row 2 (labelled as ’Softmax’).
Different from the OoD detection methods above, state-of-the-art (SOTA) OoD pixel detectors are based on meth-ods that re-train the inlier segmentation models with OoD data [4, 10, 35]. Such OoD data is obtained from Out-lier Exposure (OE) [15], which introduces additional OoD images [4] or synthetically mixes OoD objects to training images [10, 35]. Then, the closed-set model is re-trained to optimise the OE pixels via entropy maximisation [4] or abstention learning [35]. Such re-training boosts im-proves the pixel-wise OoD detection accuracy, but unlike the approaches that freeze the inlier segmentation [14, 17], it can worsen the in-distribution segmentation accuracy. For example, pixels from minority categories (e.g., “fence”,
“sidewalks”) can be mis-classified as majority classes (e.g.,
“road”). We argue that the ability to detect anoma-lies should be achieved with minimal detriment to the closed-set segmentation accuracy. Another critical issue that affects OoD pixel detectors is their narrow context re-liability [4, 9, 10, 17, 35], where context is defined by the in-distribution pixels that represent the scene surroundings, such as city (column 1) and country (columns 2-5) contexts in Fig. 1. This is because entropy or energy-based optimi-sation algorithms [4, 9, 35] train pixel-wise anomaly scores independently, but ignore the relationships between OoD and contexts, leading to over-confident minimisation of in-lier uncertainty and a weak maximisation of outlier pixels.
Therefore, an anomaly detector can incorrectly classify in-liers with unfamiliar patterns as outliers in new contexts, or misclassify OoD pixels within small anomalies as inliers.
For example, although the SOTA PEBAL [35] (Fig. 1, row 3) barely detects the tiny anomaly in the city context of col-umn 1, it ignores the outlier in column 2 and mis-detects anomalies in many inliers in columns 3-5, when the con-text changes from city to country. Given that such context changes are common and unpredictable in real-world sce-narios, it is important to develop a pixel-wise OoD detec-tor that can generalise to various contexts.
In this paper, we address the points above with a new pixel-wise OoD detection module, called Residual Pattern
Learning (RPL), which consists of an external module at-tached to a frozen closed-set segmentation network. RPL is trained to learn the residual pattern of anomalies based on intermediate features and induce the (frozen) segmenta-tion classifier to produce high uncertainty for the potentially anomalous regions. By not re-training the segmentation model, RPL guarantees high accuracy in detecting OoD pix-els while minimising the impact on the closed-set segmen-tation performance. The effective training of RPL depends on our proposed positive energy loss that focuses only on the energy score of anomalies to deal with the imbalanced distribution of inlier and outlier samples in pixel-wise OoD detection. Moreover, we address open-world context ro-bustness with our new context-robust contrastive learning (CoroCL), which optimises the pixel-wise embeddings by exploring the relationship between anomalies and inliers in different contexts. To summarise, our contributions are: 1. The residual pattern learning (RPL) module that in-duces the closed-set segmentation model to detect po-tential anomalies, which is a novel perspective for pixel-wise OoD detection; 2. A context-robust contrastive learning (CoroCL) that is designed to generalise the detection of OoD pixels to new contexts (see Fig. 1, row 4); and 3. A novel positive energy loss function that deals with the imbalanced distribution of inliers and outliers by focusing only on the energy score of anomalies.
Our approach is shown to be the most accurate method in various scene contexts, yielding improvements of around 10% FPR and 7% AuPRC over the SOTA results in
Fishyscapes, Segment-Me-If-You-Can, and RoadAnomaly datasets. Our approach is also shown to be the most stable method in various scene contexts and to be easily integrated to other SOTAs, such as Meta-OoD [4] and PEBAL [35]. 2.