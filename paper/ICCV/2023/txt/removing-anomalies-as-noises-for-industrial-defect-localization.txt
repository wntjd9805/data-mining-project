Abstract
Unsupervised anomaly detection aims to train models with only anomaly-free images to detect and localize un-seen anomalies. Previous reconstruction-based methods have been limited by inaccurate reconstruction results. This work presents a denoising model to detect and localize the anomalies with a generative diffusion model. In particular, we introduce random noise to overwhelm the anomalous pixels and obtain pixel-wise precise anomaly scores from the intermediate denoising process. We find that the KL di-vergence of the diffusion model serves as a better anomaly score compared with the traditional RGB space score. Fur-thermore, we reconstruct the features from a pre-trained deep feature extractor as our feature level score to improve localization performance. Moreover, we propose a gradi-ent denoising process to smoothly transform an anomalous image into a normal one. Our denoising model outperforms the state-of-the-art reconstruction-based anomaly detection methods for precise anomaly localization and high-quality normal image reconstruction on the MVTec-AD benchmark. 1.

Introduction
Anomaly detection is a critical computer vision task that has great application values in industry and medicine. De-spite its importance, collecting and annotating anomalous data can be prohibitively expensive. Unsupervised anomaly detection recently garnered significant attention. Different from few-shot segmentation [12, 33, 32], it aims to learn normal data distribution without access to anomalous sam-ples and ground-truth annotations in training. At inference, anomalies are detected and localized based on their devia-tion from the learned distribution of normal data.
Classical reconstruction-based unsupervised anomaly detection methods [1, 2, 5, 20] assume the autoencoder model trained with only normal data fail to reconstruct anomalous regions. However, this approach is not without limitations, as some anomalies can still be reconstructed, leading to the inferior performance of these classical meth-ods. DRAEM [40] proposes to generate pseudo anomalies
Figure 1: Comparing reconstructed normal images (rows 1
& 3) and anomaly detection results (rows 2 & 4) produced by different methods. Our method can produce high-quality reconstructions without obvious artifacts (DRAEM [40]) and blurring (UniAD [36]) and locate anomalies more pre-cisely. to train an autoencoder to reconstruct the anomalous data to be anomaly-free. However, it performs poorly when the real anomalies differ significantly from the pseudo ones.
Denoising autoencoders [17] are used for medical anomaly detection. The anomaly score is measured naively by the difference between the input and reconstructed images in pixel space. The reconstruction from noisy images is chal-lenging and introduces great noise to the results, making it unsuitable for complex industrial anomaly detection and localization. Recently, methods [18, 22, 36, 37] propose transformer structures for the reconstruction model to pre-vent the autoencoder from collapsing into an identity func-tion. The models produce blurred results with relatively poor anomaly localization performance compared with the state-of-the-art.
In this work, we propose a new reconstruction-based ap-proach for anomaly detection, achieving precise anomaly localization and top reconstruction quality; see Fig. 1. Our key idea is to formulate the anomaly detection task as a noise or anomaly removal problem. First, we introduce ran-dom noises into the input image and train an autoencoder as a denoising model. The anomalous pixels are considered as noises and will not be excluded from the reconstruction.
The previous reconstruction-based methods directly recon-struct the input with noisy images, leading to large recon-struction errors and suboptimal anomaly detection perfor-mance. We leverage a diffusion model [15] for denoising and reconstruction. We inspect the intermediate stages of the diffusion model and measure the reconstruction error of each step for accurate anomaly localization. Moreover, we require the model to reconstruct the input features and de-tect anomalies in both pixel and feature space.
We further propose a gradient denoising process for re-constructing normal images from anomalous ones and pro-vide an interpretable explanation of the anomaly detection results. Our process smoothly transforms an anomalous im-age into a normal image while preserving the structural ap-pearance and high-frequency details of the normal regions.
It is achieved by consistently denoising the gradients from a pre-trained deep feature extractor. Our approach is shown to outperform existing methods in terms of reconstruction quality and anomaly detection accuracy. 2.