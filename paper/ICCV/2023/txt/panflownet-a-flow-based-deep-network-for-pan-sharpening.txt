Abstract
Pan-sharpening aims to generate a high-resolution mul-tispectral (HRMS) image by integrating the spectral in-formation of a low-resolution multispectral (LRMS) image with the texture details of a high-resolution panchromatic (PAN) image.
It essentially inherits the ill-posed nature of the super-resolution (SR) task that diverse HRMS im-ages can degrade into an LRMS image. However, existing deep learning-based methods recover only one HRMS im-age from the LRMS image and PAN image using a deter-ministic mapping, thus ignoring the diversity of the HRMS image. In this paper, to alleviate this ill-posed issue, we pro-pose a flow-based pan-sharpening network (PanFlowNet) to directly learn the conditional distribution of HRMS im-age given LRMS image and PAN image instead of learning a deterministic mapping. Specifically, we first transform this unknown conditional distribution into a given Gaussian dis-tribution by an invertible network, and the conditional dis-tribution can thus be explicitly defined. Then, we design an invertible Conditional Affine Coupling Block (CACB) and further build the architecture of PanFlowNet by stacking a series of CACBs. Finally, the PanFlowNet is trained by maximizing the log-likelihood of the conditional distribu-tion given a training set and can then be used to predict diverse HRMS images. The experimental results verify that the proposed PanFlowNet can generate various HRMS im-ages given an LRMS image and a PAN image. Addition-ally, the experimental results on different kinds of satel-lite datasets also demonstrate the superiority of our Pan-FlowNet compared with other state-of-the-art methods both visually and quantitatively. Code is available at Github. 1.

Introduction
With the rapid development of satellite sensors, remote sensing images have become widely used in various appli-cations, such as environmental monitoring [4], classifica-*corresponding author (a) Traditional deep learning-based approaches generate an HRMS image from LRMS and PAN images through deterministic map-ping. (b) Our proposed PanFlowNet can learn the conditional distribu-tion of HRMS images, and thus it can generate diverse HRMSs from LRMS and PAN images as well as noise.
Figure 1: Comparison between traditional deep learning-based methods and our proposed PanFlowNet. tion [8], and target detection [17, 56]. Satellites capture multispectral (MS) and panchromatic (PAN) images simul-taneously with complementary information for each modal-ity that PAN images have a high spatial solution [20] and
MS images contain rich spectral information [42]. MS sen-sors reduce the spatial resolution while ensuring spectral richness for MS images [55]. To obtain an MS image with both high spectral and spatial resolution, the pan-sharpening technique that aims to fuse the MS and PAN images has at-tracted a large amount of attention.
The past decades have witnessed the explosive growth of research works in the pan-sharpening field.
In terms of the quality of the generated fusion results, the focuses have been mainly on model-based [42, 44, 35] and deep learning (DL)-based [13, 19, 45, 47, 52, 58, 59] meth-ods. Model-based methods usually optimize a mathemat-ical model that preserves spectral and spatial information, and most of them follow the assumption that the PAN im-age (or its gradient) can be modelled as a linear combination among all bands (or their gradients) of high-resolution mul-tispectral (HRMS) images. However, they are highly de-pendent on the assumptions about the relationship between
HRMS and PAN images [3]. Unfortunately, previous work did not accurately establish this relationship, which limits the further improvement of pan-sharpening. Besides, the model-based methods are challenging in optimization, lim-iting their practical applications.
In the era of deep learning, convolutional neural net-works (CNN) have emerged as a significant tool for pan-sharpening. CNN-based methods train the network by minimizing the distance between the fused result and the
HRMS reference image. Because of the strong nonlinear fit-ting ability of neural networks, this kind of method always achieves excellent performance. However, pan-sharpening is essentially an ill-posed problem since a given LRMS image can be degraded from infinitely many compatible
HRMS images. This poses severe challenges when design-ing DL-based pan-sharpening approaches. Although exist-ing CNN-based methods can obtain excellent results, they only learn a deterministic mapping from LRMS and PAN images to HRMS images, as shown in Fig. 1a, and thus the ill-posed issue is not well addressed.
To solve the above issues and generate more diverse re-alistic images, in this paper, we propose a novel neural ar-chitecture for pan-sharpening, called PanFlowNet, which directly learns the conditional distribution of the HRMS im-age given the input LRMS image and PAN image instead of learning a deterministic mapping. Specifically, we first transform a sample of the unknown conditional distribution into a sample of a given Gaussian distribution using an in-vertible network. Thus the conditional distribution can be explicitly defined by the product of the Gaussian distribu-tion and the determinant of the Jacobian matrix. To build the invertible network, we first design an invertible Con-ditional Affine Coupling Block (CACB) and then stack a series of CACBs to construct the network architecture of
PanFlowNet. Finally, our PanFlowNet can be trained by minimizing the negative log-likelihood of the conditional distribution on a training set. Once the training is finished, we can generate diverse HRMSs by inputting the LRMS and PAN images as well as different noise samples of the given Gaussian distribution into the PanFlowNet, as shown in Fig. 1b.
In summary, the contributions of our work are as follows:
• We propose a flow-based deep network (i.e., Pan-FlowNet) for pan-sharpening. This network can accu-rately learn the conditional distribution of HRMS im-ages given the corresponding LRMS and PAN images.
To the best of our knowledge, this is the first attempt to learn an explicit distribution by employing the gen-erative flow model for the pan-sharpening task.
• The proposed PanFlowNet can generate diverse
HRMSs given the LRMS and PAN images as well as the Gaussian noise sample and thus can alleviate the ill-posed issue to some extent. Besides, the generated
HRMS images are diverse since each HRMS image fo-cuses on a different detailed part of the ground truth.
• We extend the vanilla flow model to a probabilistic multi-conditional flow model to adapt to the multi-conditionality of the pan-sharpening task. Extensive experiments over different satellite datasets demon-strate that our method can outperform existing state-of-the-art approaches both visually and quantitatively. 2.