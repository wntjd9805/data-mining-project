Abstract (cid:43)(cid:15)(cid:22)(cid:3)(cid:15)(cid:93)(cid:69)(cid:107)(cid:90)(cid:73)(cid:91)(cid:106) (cid:33)(cid:93)(cid:89)(cid:73)(cid:69)(cid:107)(cid:89)(cid:73)(cid:3)(cid:81)(cid:90)(cid:60)(cid:79)(cid:73)
The automatic analysis of chemical literature has im-mense potential to accelerate the discovery of new materials and drugs. Much of the critical information in patent docu-ments and scientiﬁc articles is contained in ﬁgures, depict-ing the molecule structures. However, automatically pars-ing the exact chemical structure is a formidable challenge, due to the amount of detailed information, the diversity of drawing styles, and the need for training data. In this work, we introduce MolGrapher to recognize chemical structures visually. First, a deep keypoint detector detects the atoms.
Second, we treat all candidate atoms and bonds as nodes and put them in a graph. This construct allows a natural graph representation of the molecule. Last, we classify atom and bond nodes in the graph with a Graph Neural Network.
To address the lack of real training data, we propose a syn-thetic data generation pipeline producing diverse and real-istic results. In addition, we introduce a large-scale bench-mark of annotated real molecule images, USPTO-30K, to spur research on this critical topic. Extensive experiments on ﬁve datasets show that our approach signiﬁcantly out-performs classical and learning-based methods in most set-tings. Code, models, and datasets are available 1. 1.

Introduction
The creation of an open-source database offering a uni-ﬁed view of our current knowledge of all studied molecules, would greatly accelerate research and development in nu-merous ﬁelds, ranging from the pharmaceutical industry to semiconductor manufacturing. Currently, information about a molecule’s properties is distributed across vari-ous databases, research articles, and chemical patents, each measuring different subsets of properties.
In such docu-ments, molecules are most often described using images, by drawing their molecular structures. Automatic parsing of molecules from document images, known as Optical Chem-1https://github.com/DS4SD/MolGrapher (cid:33)(cid:93)(cid:89)(cid:73)(cid:69)(cid:107)(cid:89)(cid:60)(cid:103)(cid:3)(cid:104)(cid:106)(cid:103)(cid:107)(cid:69)(cid:106)(cid:107)(cid:103)(cid:73) (cid:33)(cid:93)(cid:89)(cid:23)(cid:103)(cid:60)(cid:100)(cid:80)(cid:73)(cid:103) (cid:33)(cid:93)(cid:89)(cid:23)(cid:103)(cid:60)(cid:100)(cid:80)(cid:73)(cid:103)
Figure 1. MolGrapher extracts the chemical structure, including all atoms and bonds, from a molecule image in a document. Our approach constructs a supergraph of the molecule (bottom right), containing all detected atom and bond candidates. These nodes are then classiﬁed by a Graph Neural Network in order to retrieve the chemical structure. ical Structure Recognition (OCSR), is thus a critical task in the quest towards establishing a large-scale digital molecule database.
OCSR, however, poses multiple key challenges, which limit the accuracy of current solutions. First, a molecule can be drawn with a variety of styles and conventions. Even the projection of the molecular structure from 3-D onto a 2-D drawing is not unique, leading to the development of var-ious projection algorithms with diverse results. Secondly,
OCSR requires the extraction of detailed information from the image. Molecules often contain even hundreds of atoms and bonds, which all need to be correctly classiﬁed and linked. Thirdly, molecules have a virtually endless diver-sity stemming from the combinatorical explosion of possi-bilities, presenting particular challenges to data-driven deep learning methods. Lastly, available real training datasets are extremely limited, further complicating the application of deep learning.
the followed
Initial OCSR approaches graph reconstruction paradigm.
These methods start by ex-tracting the fundamental components of molecules, such as atoms, bonds, and charges, often using hand-crafted image processing algorithms [8, 29, 21]. Then, rules are applied to connect these elements to reconstruct a graph represen-tation of the molecule. Some recent works [19, 33, 38] introduce deep learning elements into the atom and bond detection steps. However, these approaches still rely on hand-crafted rules to link the recognized constituents, and thus not fully beneﬁt from the advantages brought by deep learning.
Most recently, approaches instead follow the image captioning [4, 24, 34] paradigm by applying a deep net-work to directly output a character string identifying the molecule, e.g. in the form of SMILES [32]. However, these methods do not explicitly exploit the rich priors and invari-ances provided by the graph structure. The SMILES rep-resentation does not encode the geometrical and neighbor-hood structure of the molecule graph in a natural manner.
While a recent work [36] predicts a graph in an autoregres-sive manner, adding one atom at a time prevents from fully exploiting the graph structure. Partially due to the lack of such a strong inductive bias, image captioning based meth-ods still lag behind from the performance of state-of-the-art rule-based methods [8, 29, 21] on standard benchmarks
[8, 9, 28, 22]. Moreover, the performance of captioning based methods severely degrade when increasing the size and complexity of the molecule, as they struggle to recover the detailed information in the image.
We introduce MolGrapher for Optical Chemical Struc-ture Recognition, illustrated in Fig. 1. Our approach explic-itly utilizes the graph structure as a strong inductive bias, while also allowing for the ﬁnal molecule structure itself to be predicted by a deep learning model. MolGrapher oper-ates in three steps. First, we locate atoms and abbreviations in the image with a keypoint detector network. Given the estimated locations of the atoms, we form a supergraph of the molecular structure, where two types of nodes represent candidate atoms and bonds respectively (see Fig. 1). Unlike previous approaches, we do not commit to a ﬁnal molecule structure at this point, instead extracting a larger set of candidate bonds, forming a superset of the ﬁnal molecu-lar graph. Candidates that do not correspond to any bond are removed in the ﬁnal prediction step by including a ‘no bond’ class.
In the ﬁnal step, we input the constructed supergraph into a Graph Neural Network (GNN). We ﬁrst extract deep node embeddings through a backbone network. The GNN then operates on the neighborhood structure provided by the supergraph in order to integrate visual information with learned chemistry priors. We then read-out the results with
MLPs, classifying each node into a set of atom and bond classes. We also identify abbreviations through a separate class, which are parsed by an OCR component. Since train-ing data is scarce, we develop, and release, a synthetic train-ing data generation pipeline, capable of generating diverse and challenging examples to ensure robust generalization to a wide variety of drawing styles.
To further aid the research in the community, we in-troduce USPTO-30K, a large-scale benchmark dataset of annotated real molecule images. It contains separate sub-sets, in order to independently study the recognition of sim-ple molecules, abbreviated molecules and extremely large molecules. We perform comprehensive experiments on
ﬁve benchmarks: our USPTO-30K, USPTO [8], Maybridge
UoB [28], CLEF-2012 [22] and JPO [9]. We outperform all deep learning based methods that only utilizes synthetic training. Our approach even surpass previous methods that rely on ﬁnetuning on real data on most benchmarks, and outperform the longstanding state-of-the-art by rule-based methods [8, 29, 21] in most settings. 2.