Abstract
Deep metric learning has attracted much attention in recent years, due to seamlessly combining the distance metric learning and deep neural network. Many endeavors are devoted to design different pair-based angular loss functions, which decouple the magnitude and direction information for embedding vectors and ensure the training and testing measure consistency. However, these traditional angular losses cannot guarantee that all the sample embeddings are on the surface of the same hypersphere during the training stage, which would result in unstable gradient in batch optimization and may inﬂuence the quick convergence of the embedding learning. In this paper, we ﬁrst investigate the effect of the embedding norm for deep metric learning with angular distance, and then propose a spherical embedding constraint (SEC) to regularize the distribution of the norms. SEC adaptively adjusts the embeddings to fall on the same hypersphere and performs more balanced direction update. Extensive experiments on deep metric learning, face recognition, and contrastive self-supervised learning show that the SEC-based angular space learning strategy signiﬁcantly improves the performance of the state-of-the-art. 1

Introduction
The objective of distance metric learning is to learn an embedding space where semantically similar instances are encouraged to be closer than semantically different instances [1, 2]. In recent years, with the development of deep learning, deep metric learning (DML) demonstrates evident improvements by employing a neural network as the embedding mapping. With an appropriate distance metric, it is convenient to handle many visual understanding tasks, such as face recognition [3, 4] and
ﬁne-grained image retrieval [5, 6, 7]. In regard to the research in DML, an active direction is to design a discriminative loss function for model optimization. A family of pair-based loss functions are proposed, which are constructed by similarities of instance pairs in a mini-batch, such as contrastive loss [8], triplet loss [9, 4], lifted structured loss [5], N -pair loss [10], and multi-similarity loss [11].
Theoretically, either Euclidean distance or angular distance could be employed to measure the similarity between two embeddings in an embedding space, while in the existing DML loss functions, angular distance is usually adopted to disentangle the norm and direction of an embedding, which ensures the training and testing measure consistency. However, this traditional setup usually ignores the importance of the embedding norm for gradient computation. For example, considering a cosine distance which measures the angular distance between two embeddings fi and fj, its gradient to an embedding fi is computed as follows: 1
||fi||2 where ˆf denotes the l2-normalized embedding of f .
∂(cid:104) ˆfi, ˆfj(cid:105)
∂fi
= ( ˆfj − cos θij ˆfi), (1)
∗Corresponding author 34th Conference on Neural Information Processing Systems (NeurIPS 2020), Vancouver, Canada.
Figure 1: We train models on CUB200-2011 and Cars196 datasets, all with a triplet loss using a cosine distance. Here we show the distribution of learned embeddings’ norms with and without SEC.
From the above gradient analysis, we see that the embedding norm plays an important role in the gradient magnitude, which is also mentioned in [12]. When angular distances are optimized in the loss function, it requires the embeddings to have similar norms to achieve a balanced direction update.
However, most existing angular loss-based methods cannot guarantee that all the sample embeddings are on the surface of the same hypersphere during the training stage. As shown in Figure 1, the distribution of learned embeddings’ norms with the angular triplet loss have a large variance in the training stage. Consequently, the gradient correspondingly would become unstable in batch optimization and may inﬂuence the quick convergence of the embedding learning. For example, the direction updating is relatively slower for embeddings with larger norms.
To address the above limitation, in this paper, we propose a spherical embedding constraint (SEC) method for better embedding optimization. SEC attempts to make the embeddings to fall on the surface of the same hypersphere by adaptively adjusting the norms of embeddings. Instead of directly constraining these norms to be a ﬁxed value, which represents the radius of the hypersphere, SEC
ﬂexibly reduces the variance of the embedding norm and constrains these norms to be similar. During training, SEC operates on each mini-batch and all embedding norms are pushed to their average value.
As shown in Figure 1, the variance of the embedding norms are reduced so that a balanced direction update is performed. Extensive evaluations are conducted on deep metric learning, face recognition, and contrastive self-supervised learning to investigate the performance of angular space learning with
SEC. The experiment results on several public datasets show that the proposed method signiﬁcantly improves the performance of the state-of-the-art. 2