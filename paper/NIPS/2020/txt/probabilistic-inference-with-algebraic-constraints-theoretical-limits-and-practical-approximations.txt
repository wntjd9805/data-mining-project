Abstract
Weighted model integration (WMI) is a framework to perform advanced probabilistic inference in hybrid domains, i.e., on distributions over mixed continuous-discrete random variables and in the presence of complex logical and arithmetic constraints.
In this work, we advance the WMI framework on both the theoretical and algorithmic side. First, we trace the boundaries of tractability for WMI inference in terms of two key properties of a WMI problem’s dependency structure: sparsity and diameter.
We prove that exact inference is only eﬃcient if that structure is tree-shaped with logarithmic diameter. While this result deepens our theoretical understanding of
WMI it hinders the practical applicability of exact WMI solvers to large problems.
To overcome this, we propose the ﬁrst approximate WMI solver that does not resort to sampling, but performs exact inference on an approximate model. Our solution iteratively performs message passing in a relaxed problem structure to recover lost dependencies. As our experiments show, it scales to problems that are out of the reach of exact WMI solvers while delivering accurate approximations. 1

Introduction
Consider an autonomous agent operating under uncertainty in a real-world scenario, for instance a self-driving vehicle. It has to model both continuous variables like the speed and position of other cars and discrete ones like the color of traﬃc lights and the number of pedestrians. Moreover, in order to make decisions, it needs to perform advanced probabilistic reasoning. For example, it has to reason about physical constraints while computing the probability of a grounded scene described via complex algebraic constraints, such as the geometry of vehicles and the roads ahead.
Performing probabilistic inference in these constrained and hybrid (mixed continuous-discrete) scenarios goes beyond the limited inference capabilities of intractable probabilistic models such as variational autoencoders [28] and generative adversarial networks [25]. This is also the case for classical probabilistic graphical models for hybrid domains [27, 32] and more recent tractable alternatives [33, 38, 40] which struggle to either perform inference over complex algebraic constraints or make too simplistic representational or distributional assumptions.
∗Authors contributed equally. This research was performed while F.Y. and P.M. were visiting UCLA.
†This work was partially carried out when P.M. was working at the University of Trento. 34th Conference on Neural Information Processing Systems (NeurIPS 2020), Vancouver, Canada.
On the other hand, Weighted Model Integration (WMI) [8, 34] is a modeling and inference framework that supports general hybrid probabilistic reasoning over algebraic constraints, by design. Indeed, in the WMI framework, mixed complex continuous-discrete interactions can be easily expressed in the language of Satisﬁability Modulo Theories (SMT) [7] and answering probabilistic queries involving algebraic constraints can be naturally cast as integration of certain weight functions over the regions that satisfy those constraints.
In this paper we advance the WMI framework on two fronts. First, we deepen the theoretical understanding of the complexity of WMI inference on real-world problems by proving hardness results. Second, we deliver an eﬃcient and accurate approximate WMI solver as a practical algorithmic solution to deploy WMI inference at a larger scale.
Speciﬁcally, we study the dependency structure of WMI problems as speciﬁed by the primal graph of their SMT formula [22]. We prove that performing exact inference is #P-hard if the primal graph has a treewidth larger than one or a diameter that is linear in the number of variables. Second, to overcome these negative results, we introduce ReCoIn , a practical algorithmic solution that extends the relax-compensate-and-recover framework [14, 16, 17] for approximate discrete inference to hybrid inference scenarios with algebraic constraints. As our experiments suggest ReCoIn candidates as the best alternative, in terms of scalability and accuracy of the delivered approximations, in the current panorama of general-purpose WMI solvers.
The rest of the paper is organized as follows. In Section 2 we introduce the notation and background needed to later prove our theoretical results in Section 3 and to introduce ReCoIn in Section 4. Before evaluating ReCoIn in Section 6 we discuss related work in Section 5. 2