Abstract
Recent studies have shown that the performance of forgery detection can be im-proved with diverse and challenging Deepfakes datasets. However, due to the lack of Deepfakes datasets with large variance in appearance, which can be hardly produced by recent identity swapping methods, the detection algorithm may fail in this situation. In this work, we provide a new identity swapping algorithm with large differences in appearance for face forgery detection. The appearance gaps mainly arise from the large discrepancies in illuminations and skin colors that widely exist in real-world scenarios. However, due to the difﬁculties of modeling the complex appearance mapping, it is challenging to transfer ﬁne-grained appear-ances adaptively while preserving identity traits. This paper formulates appearance mapping as an optimal transport problem and proposes an Appearance Optimal
Transport model (AOT) to formulate it in both latent and pixel space. Speciﬁcally, a relighting generator is designed to simulate the optimal transport plan. It is solved via minimizing the Wasserstein distance of the learned features in the latent space, enabling better performance and less computation than conventional optimization.
To further reﬁne the solution of the optimal transport plan, we develop a segmenta-tion game to minimize the Wasserstein distance in the pixel space. A discriminator is introduced to distinguish the fake parts from a mix of real and fake image patches.
Extensive experiments reveal that the superiority of our method when compared with state-of-the-art methods and the ability of our generated data to improve the performance of face forgery detection. 1

Introduction
Face forgery detection refers to detect whether a given image has been altered. However, recent detection baselines are data-driven [42, 39, 34, 11, 1], and the lack of Deepfake datasets with large differences in appearance may render these detection algorithms ineffective in this situation. In this work, we provide a new identity swapping algorithm with large differences in appearance to improve the robustness of face forgery detection methods.
Recently, many identity swapping works have been devoted to addressing the recombination difﬁculty of identities and attributes in the source and the target faces. Earlier works either directly warp a source face to a target pose [16] or leverage 3D models to ﬂexibly align the source face with a target video [10, 36, 43]. More recently, beneﬁting from the success of deep learning, further identity swapping progress has been achieved [30, 41, 44, 32].
∗Equal contribution
†Corresponding author 34th Conference on Neural Information Processing Systems (NeurIPS 2020), Vancouver, Canada.
Figure 1: Comparisons with DeepFaceLab [46] and conventional optimal transport [15]. These two methods degrade signiﬁcantly under complex appearance conditions. Obvious artifacts and inconsistent appearances with the target faces are observed (the third and the fourth columns). In contrast, our proposed AOT achieves more realistic results in various situations.
However, the appearance gaps between the source and target faces, as a challenging and essential problem in identity swapping, have rarely been studied. As presented in Fig. 1 (the ﬁrst and the second columns), the appearance gaps mainly arise from large discrepancies in skin colors and illuminations. Unfortunately, existing identity swapping methods often degrade signiﬁcantly when facing such an intractable case, as exempliﬁed in Fig. 1 (the third column).
Natural appearances transferred results can help researchers investigate a powerful forgery detection method. However due to the difﬁculties of modeling the precise mapping for extremely complex appearances, it is challenging to transfer ﬁne-grained appearances with preservation of identity traits, and the swapped images tend to have obvious artifacts and inaccurate skin colors or illuminations. To achieve a vivid appearance transferred result, we consider ﬁnding a map between color histogram pairs with minimum cost. By manipulating the histogram distribution, i.e., mapping the histogram distribution of the source image to that of the target, we can not only capture color differences but also preserve structures of the source image. Therefore, optimal transport (OT) is a natural idea that aims to solve a transport plan γ to map one probability distribution to another with minimal cost [27].
Nevertheless, the conventional optimal transport plan is solved via optimization-based methods
[15, 19], which makes it challenging to directly apply the OT to identity swapping due to the following facts. (1) Calculating OT between images with unbalanced pixel histograms may derive a mismatching mapping and further result in a discontinuous synthesized image (see the fourth column of Fig. 1 (a, b)). (2) Facial geometry information is neglected during the transport process, which makes it difﬁcult to perform a ﬁne-grained appearance translation (see the fourth column of Fig. 1 (c, d)). (3) The heavy computational burden of OT restricts its application in large-scale identity swapping.
In this paper, we propose a novel way, named as Appearance Optimal Transport model (AOT), which provides a new method to generate data for face forgery detection. AOT aims to tackle the appearance gaps for identity swapping, We formulate the appearance mapping as an OT problem and formulate it in both latent space and pixel space. We ﬁrst propose a two-branch perceptual encoder as shown in Fig. 2. The feature encoder encodes the images into the high-level features. In addition, corresponding coordinates and normals are extracted from the 3D ﬁtting model to present facial geometry and lighting orientational information [56], respectively. Furthermore, a Neural
Optimal Transport Plan Estimation (NOTPE) is designed to solve the OT problem by minimizing 2
the Wasserstein distance (WD) of the features in the latent space, and it enables more continuous synthesis and reduced computation. Subsequently, the relighting generator decodes the features into the pixel space and further reﬁnes the results via a segmentation game [68, 54]. A discriminator is introduced to predict the real parts from the real-fake mixture image blocks, while the relighting generator attempts to disturb the discriminator via generating more realistic images. By this approach, we force the pixel space of the synthesized image and that of the target image to be as similar as possible. Finally, it is worth emphasizing that the proposed AOT can be ﬂexibly applied to existing identity swapping methods [46, 44] to improve their performance. This means that our model can produce diverse and realistic Deepfakes to improve the performance of detection algorithms. Our contributions can be summarized as follows:
• We formulate the rather challenging appearance transfer in identity swapping as an optimal transport problem and formulate it via the proposed AOT. It can be ﬂexibly applied to recent identity swapping methods and thus produce various results. To the best of our knowledge, we are the ﬁrst to thoroughly study the appearance gap problem in identity swapping.
• We propose to tackle optimal transport in the latent space via neural optimal transport plan estimation, enabling better performance and reduced computation.
• We develop a segmentation game to further minimize the Wasserstein distance in the pixel space, forcing the generator to synthesize photorealistic results.
• Extensive experiments on FF++ [53] and DPF-1.0 [25] demonstrate the superiority of our method over state-of-the-art identity swapping methods [46, 44] in the situation of large appearance gaps and the ability of our generated data to improve face forgery detection methods. 2