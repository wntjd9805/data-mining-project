Abstract
In barter exchanges, participants swap goods with one another without exchanging money; these exchanges are often facilitated by a central clearinghouse, with the goal of maximizing the aggregate quality (or number) of swaps. Barter exchanges are subject to many forms of uncertainty–in participant preferences, the feasibility and quality of various swaps, and so on. Our work is motivated by kidney exchange, a real-world barter market in which patients in need of a kidney transplant swap their willing living donors, in order to ﬁnd a better match. Modern exchanges include 2- and 3-way swaps, making the kidney exchange clearing problem NP-hard. Planned transplants often fail for a variety of reasons–if the donor organ is rejected by the recipient’s medical team, or if the donor and recipient are found to be medically incompatible. Due to 2- and 3-way swaps, failed transplants can
“cascade” through an exchange; one US-based exchange estimated that about 85% of planned transplants failed in 2019. Many optimization-based approaches have been designed to avoid these failures; however most exchanges cannot implement these methods, due to legal and policy constraints. Instead, we consider a setting where exchanges can query the preferences of certain donors and recipients–asking whether they would accept a particular transplant. We characterize this as a two-stage decision problem, in which the exchange program (a) queries a small number of transplants before committing to a matching, and (b) constructs a matching according to ﬁxed policy. We show that selecting these edges is a challenging combinatorial problem, which is non-monotonic and non-submodular, in addition to being NP-hard. We propose both a greedy heuristic and a Monte Carlo tree search, which outperforms previous approaches, using experiments on both synthetic data and real kidney exchange data from the United Network for Organ Sharing. 1

Introduction
We consider a multi-stage decision problem in which a decision-maker uses a ﬁxed policy to solve a hard (stochastic) problem. Before using the policy, the decision-maker can ﬁrst measure some of the uncertain problem parameters–in a sense, guiding the policy toward a better solution. Our primary motivation is kidney exchange, a process where patients in need of a kidney transplant swap their 34th Conference on Neural Information Processing Systems (NeurIPS 2020), Vancouver, Canada.
(willing) living donors, in order to ﬁnd a better match. Many government-run kidney exchanges match patients and donors using a matching algorithm that follows strict policy guidelines [9]; this matching algorithm is often written into law or policy, and is not easily modiﬁed. Modern kidney exchanges use both cyclical swaps and chain-like structures (initiated by an unpaired altruistic donor) [25], and identifying the max-size or max-weight set of transplants is both NP- and APX-hard [1, 7].
In kidney exchange–as in many resource allocation settings–information used by the decision-maker is subject to various forms of uncertainty. Here we are primarily concerned with uncertainty in the feasibility of potential transplants: if a donor is matched with a potential recipient, will the transplant actually occur? Planned transplants may fail for a variety of reasons: for example, medical testing may reveal that the donor and recipient are incompatible (a positive crossmatch); the recipient or their medical team may reject a donor organ in order to wait for a better match; or the donor may decide to donate elsewhere before the exchange is planned. Failed transplants are especially troublesome in kidney exchange, due to the cycle and chain structures used: for example, suppose that a cyclical swap is planned between three patient/donor pairs; if any one of the planned transplants fails, then none of the other transplants in that cycle can occur. Unfortunately, it is quite common for planned transplants to fail. For example, the United Network for Organ Sharing (UNOS1) estimates that in FY2019, about 85% of their planned kidney transplants failed [18].
Various matching algorithms have been proposed that aim to mitigate transplant failures (for exam-ple, using stochastic optimization [15, 3], robust optimization [22], or conditional value at risk [6]).
However, implementing these strategies would require modifying ﬁelded matching algorithms–which in many cases would require changing law or policy. One way to avoid failures without modifying the matching algorithm is to pre-screen potential transplants [18, 10, 11], by communicating with the recipients’ medical team and possibly using additional medical tests. Pre-screening transplants is costly, as it requires scarce time and resources. Furthermore, there are often many thousand potential transplants in any given exchange; selecting which transplants to screen is not easy.
In this paper we investigate methods for selecting a limited number of transplants to pre-screen, in order to “guide” the matching algorithm to a better outcome. We formalize this as a multistage stochastic optimization problem, and we consider both an ofﬂine setting (where screenings are selected all at once), and an online setting (where screenings are selected sequentially).