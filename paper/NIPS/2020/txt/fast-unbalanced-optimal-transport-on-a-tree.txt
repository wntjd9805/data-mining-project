Abstract
This study examines the time complexities of the unbalanced optimal transport problems from an algorithmic perspective for the ﬁrst time. We reveal which prob-lems in unbalanced optimal transport can/cannot be solved efﬁciently. Speciﬁcally, we prove that the Kantorovich Rubinstein distance and optimal partial transport in the Euclidean metric cannot be computed in strongly subquadratic time under the strong exponential time hypothesis. Then, we propose an algorithm that solves a more general unbalanced optimal transport problem exactly in quasi-linear time on a tree metric. The proposed algorithm processes a tree with one million nodes in less than one second. Our analysis forms a foundation for the theoretical study of unbalanced optimal transport algorithms and opens the door to the applications of unbalanced optimal transport to million-scale datasets. 1

Introduction
The optimal transport (OT) distance is an effective tool to compare measures and is used in a variety of ﬁelds. The applications of OT include image processing [45, 50, 23], natural language processing
[38, 52], biology [57, 43, 26], and generative models [4, 54]. However, one of the major limitations of OT is that it cannot handle measures with different total mass.
We illustrate two speciﬁc issues here. First, the amount of mass is an important signal, e.g., in shape analysis
[58, 17] and comparing persistence diagrams [39, 61].
Secondly, the OT distance is susceptible to noise because we must transport noise mass with high costs if noise occurs far away from other mass. In many cases, the mea-sures are normalized so that they become probabilistic measures for applying the OT distance to them. However, normalization loses the information of the amount of mass and does not solve the noise problem, as illustrated in Figure 1, where blue and red bars represent two input measures, and the gray bar represents destructed mass.
Figure 1: Illustrative example.
To overcome these issues, many variants of the OT distance in the unbalanced setting have been proposed, such as the optimal partial transport [12, 27] and Kantorovich Rubinstein distance [41, 31].
We ﬁrst propose a uniﬁed framework to discuss these problems as the generalized Kantorovich
Rubinstein (GKR) distance, which encompasses many existing unbalanced OT distances. min
π∈U −(µ,ν) (cid:90)
X ×X c(x, y)dπ(x, y) + (cid:90)
X
λd(x)d(µ − proj1π)(x) + (cid:90)
X
λc(y)d(ν − proj2π)(y).
The formal notations will be provided later. Intuitively, the GKR distance can destruct a unit mass at cost λd(x) and create a unit mass at cost λc(x) at x ∈ X . Therefore, λc = λd = ∞ recovers 34th Conference on Neural Information Processing Systems (NeurIPS 2020), Vancouver, Canada.
the standard OT distance. We investigate the GKR distance in the light of ﬁne-grained complexity
[62, 63]. Fine-grained complexity shows that some problem is not solvable within O(nc−ε) time under some hypothesis, just like NP-hard problems are shown to be not solvable efﬁciently under the P (cid:54)= NP hypothesis. In this paper, we prove that important special cases of the GKR distance, namely the optimal partial transport and Kantorovich Rubinstein distance, are not solvable in strongly subquadratic time under the strong exponential time hypothesis (SETH) [32, 63].
Thanks to this theorem, we can avoid fruitless efforts pursuing efﬁcient algorithms for unbalanced
OT in the Euclidean space, and this theorem motivates us to consider other spaces. It is known that the OT distance in the Euclidean space can be efﬁciently approximated by the OT distance in the 1-dimensional Euclidean space [50, 36, 13] or tree metrics [33, 14, 40]. We consider the GKR distance on tree metrics in this paper. It is noteworthy that tree metrics include 1-dimensional space because 1-dimensional space can be seen as a path graph, which is a special case of a tree. We prove that the GKR distance on a quadtree metric can approximate the GKR distance on the Euclidean metric theoretically and empirically. Although it is easy to compute the OT distance in tree metrics in linear time, it is not trivial how to compute the GKR distance in tree metrics efﬁciently. In this paper, we propose an efﬁcient algorithm to compute the GKR distance in tree metrics in O(n log2 n) time, where n is the number of nodes in a tree. Therefore, our algorithm solves many existing unbalanced
OT problems on tree metrics efﬁciently. In practice, our algorithm processes a tree with more than one million nodes in less than one second on a laptop computer. Our code including a C++ implementation and Python wrapper for our algorithm is available at https://github.com/joisino/treegkr.
The contributions of this paper are as follows. Framework: We propose the GKR distance, a general framework for unbalanced OT problems. Hardness result: We prove that existing unbalanced OT problems cannot be solved in strongly subquadratic time under SETH. Efﬁcient algorithm: We propose a quasi-linear time algorithm for the GKR distance in tree metrics. 2