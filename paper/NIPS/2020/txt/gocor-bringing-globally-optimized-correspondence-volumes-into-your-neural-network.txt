Abstract
The feature correlation layer serves as a key neural network module in numerous computer vision problems that involve dense correspondences between image pairs.
It predicts a correspondence volume by evaluating dense scalar products between feature vectors extracted from pairs of locations in two images. However, this point-to-point feature comparison is insufﬁcient when disambiguating multiple similar regions in an image, severely affecting the performance of the end task. We propose GOCor, a fully differentiable dense matching module, acting as a direct replacement to the feature correlation layer. The correspondence volume generated by our module is the result of an internal optimization procedure that explicitly accounts for similar regions in the scene. Moreover, our approach is capable of effectively learning spatial matching priors to resolve further matching ambigu-ities. We analyze our GOCor module in extensive ablative experiments. When integrated into state-of-the-art networks, our approach signiﬁcantly outperforms the feature correlation layer for the tasks of geometric matching, optical ﬂow, and dense semantic matching. The code and trained models will be made available at github.com/PruneTruong/GOCor. 1

Introduction
Finding pixel-wise correspondences between pairs of images is a fundamental problem in many computer vision domains, including optical ﬂow [14, 19, 21, 28, 51, 52, 55], geometric matching [13, 37, 41, 42, 55], and disparity estimation [11, 33, 40, 61]. Most recent state-of-the-art approaches rely on feature correlation layers, evaluating dense pair-wise similarities between deep representations of two images. The resulting four-dimensional correspondence volume captures dense matching conﬁdences between every pair of image locations. It serves as a powerful cue in the prediction of, for instance, optical ﬂow. This encapsulation of dense correspondences has further achieved wide success within semantic matching [9, 12, 18, 23, 25, 26, 27, 43, 55], video object segmentation [10, 17, 39, 57], and few-shot segmentation [36, 58]. The feature correlation layer thus serves as a key building block when designing network architectures for a diverse range of important computer vision applications.
In the feature correlation layer, each conﬁdence value in the correspondence volume is obtained as the scalar product between two feature vectors, extracted from speciﬁc locations in the two images, here called the reference and the query images. However, the sole reliance on point-to-point feature comparisons is often insufﬁcient in order to disambiguate multiple similar regions in an image.
As illustrated in Fig. 1, in the case of repetitive patterns, the feature correlation layer generates undistinctive and inaccurate matching conﬁdences (Fig. 1d), severely affecting the performance of the end task. This remains the key limitation of feature correlation layers, since repetitive patterns, low-textured regions, and co-occurring similar objects are all pervasive in computer vision applications.
We design a new dense matching module, aiming to address the aforementioned issues by exploring information not exploited by the feature correlation layer. We observe that a conﬁdence value in
∗Both authors contributed equally 34th Conference on Neural Information Processing Systems (NeurIPS 2020), Vancouver, Canada.
(b) Query image (a) Reference image
Figure 1: Visualization of the matching conﬁdences (c)-(e) computed between the indicated location (green) in the reference image (a) and all locations of the query image (b). The feature correlation (d) generates undistinctive and inaccurate conﬁdences due to similar regions and repetitive patterns. In contrast, our GOCor (e) predicts a distinct high-conﬁdence value at the correct location. (c) Ideal Correlation (d) Feat. Correlation (e) GOCor (Ours) the correspondence volume generated by the feature correlation layer only depends on the feature vectors extracted at one pair of locations in the reference and query. However, the reference also contains the appearance information of other image locations, that are likely to occur in the query image. This includes the appearance of similar regions in the scene, opening the opportunity to actively identify and account for such similarities when estimating each matching conﬁdence value.
Moreover, the feature correlation layer ignores prior knowledge and constraints that can be derived from the query, e.g. the uniqueness and spatial smoothness of correspondences. Our matching module encapsulates the aforementioned information and constraints into a learnable objective function. Our enhanced correspondence volume is obtained by minimizing this objective during the forward-pass of the network. This allows us to predict globally optimised correspondence volumes, effectively accounting for similar image regions and matching constraints, as visualized in Fig. 1e.
Contributions: We introduce GOCor, a differentiable neural network module that generates the correspondence volume between a pair of images, acting as a direct replacement to the feature correlation layer. Our main contributions are as follows. (i) Our module is formulated as an internal optimization procedure that minimizes a customizable matching-objective during inference, thereby providing a general framework for effectively integrating both explicit and learnable matching constraints. (ii) We propose a robust objective that integrates information about similar regions in the scene, allowing our GOCor module to better disambiguate such cases. (iii) We introduce a learnable objective for capturing constraints and prior information about the query frame. (iv) We apply effective unrolled optimization, paired with accurate initialization, ensuring efﬁcient end-to-end training and inference. (v) We perform extensive experiments on the geometric matching and optical ﬂow tasks by integrating our module into state-of-the-art network architectures. Our approach outperforms the feature correlation layer in terms of both accuracy and robustness. In particular, our
GOCor module demonstrates better domain generalization properties. 2