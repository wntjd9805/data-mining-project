Local features have been a significant technology in computer vision, enabling various applications such as Structure-from-Motion (SfM) and SLAM. While deep learning has revolutionized many areas, sparse hand-crafted solutions in 3D reconstruction still outperform dense learned counterparts. This is because it is challenging to design end-to-end methods with a differentiable training objective that aligns well with the downstream task. In this paper, we propose a new approach that leverages the expressive power of CNNs by bridging the gap between training and inference. Our method involves using a network to generate keypoint heatmaps and dense descriptors, sampling discrete keypoints from the heatmap and using geometric ground truth to assign rewards to each match. Through carefully modeled gradients, we are able to train models from scratch and achieve better performance than state-of-the-art methods.