Areas under ROC (AUROC) and precision-recall curves (AUPRC) are common metrics for evaluating classiﬁcation performance for imbalanced problems. Com-pared with AUROC, AUPRC is a more appropriate metric for highly imbalanced datasets. While stochastic optimization of AUROC has been studied extensively, principled stochastic optimization of AUPRC has been rarely explored. In this work, we propose a principled technical method to optimize AUPRC for deep learning. Our approach is based on maximizing the averaged precision (AP), which is an unbiased point estimator of AUPRC. We cast the objective into a sum of coupled compositional functions with inner functions dependent on random vari-ables of the outer level. We propose efﬁcient adaptive and non-adaptive stochastic algorithms named SOAP with provable convergence guarantee under mild con-ditions by leveraging recent advances in stochastic compositional optimization.Extensive experimental results on image and graph datasets demonstrate that our proposed method outperforms prior methods on imbalanced problems in terms ofAUPRC. To the best of our knowledge, our work represents the ﬁrst attempt to optimize AUPRC with provable convergence. The SOAP has been implemented in the libAUC library at https://libauc.org/. 