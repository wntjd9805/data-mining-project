Abstract
Predicting stable 3D conformations from 2D molecular graphs has been a long-standing challenge in computational chemistry. Recently, machine learning ap-proaches have demonstrated very promising results compared to traditional experi-mental and physics-based simulation methods. These approaches mainly focus on modeling the local interactions between neighboring atoms on the molecular graphs and overlook the long-range interactions between non-bonded atoms. However, these non-bonded atoms may be proximal to each other in 3D space, and modeling their interactions is of crucial importance to accurately determine molecular con-formations, especially for large molecules and multi-molecular complexes. In this paper, we propose a new approach called Dynamic Graph Score Matching (DGSM) for molecular conformation prediction, which models both the local and long-range interactions by dynamically constructing graph structures between atoms according to their spatial proximity during both training and inference. Speciﬁcally, the
DGSM directly estimates the gradient ﬁelds of the logarithm density of atomic coordinates according to the dynamically constructed graphs using score matching methods. The whole framework can be efﬁciently trained in an end-to-end fashion.
Experiments across multiple tasks show that the DGSM outperforms state-of-the-art baselines by a large margin, and it is capable of generating conformations for a broader range of systems such as proteins and multi-molecular complexes. 1

Introduction
Graph-based representations of molecules has become prevalent in a variety of tasks such as property prediction [13, 31] and molecule generation [17, 33, 45]. However, a more natural and intrinsic representation of a molecule is its 3D geometry or conformation, which represents a molecule as a set of 3D coordinates. The 3D representation of molecules is central to many tasks, such as molecular properties prediction and virtual screening. Nevertheless, determining the conformation of a molecule remains a challenging task — both computational approaches, e.g., molecular dynamics (MD) [9], and experimental approaches, e.g., crystallography, are expensive and time-consuming.
Recently, machine learning approaches have demonstrated promising performance for molecular conformation generation. Pioneering methods such as GRAPHDG [36] and CGCF [43] ﬁrst predict interatomic distances between bonded atoms and then solve 3D coordinates from the predicted distances via a post-processing algorithm. Very recently, Shi et al. proposed the CONFGF [34], which employs the score matching technique [38] to learn pseudo-forces between bonded atoms and iteratively applies the forces to a randomly initialized 3D structure until convergence. CONFGF gets
*Equal contribution. Work was done during Shitong’s internship at Mila. 35th Conference on Neural Information Processing Systems (NeurIPS 2021), virtual.
Figure 1: Three molecular systems where long-range interactions are crucial for their conformations. rid of the two-stage fashion in prior works and signiﬁcantly improves the performance. Nevertheless, these approaches have a common major limitation — they mainly focus on modeling the local inter-actions between bonded atoms deﬁned by the input molecular graphs but fail to capture long-range interactions between non-bonded atoms1, as they only model distances (or gradients) between bonded atoms. While in molecular mechanics, the potential energy of a molecule that alters conformations can be modeled as a sum of four parts [22]:
E = Ebond + Eangle + Etorsion + Enon-bonded, (1) where Ebond, Eangle, and Etorsion model local interactions between bonded atoms, which are modeled in previous methods [34, 36, 43]. Long-range interactions between non-bonded atoms, denoted as
Enon-bonded, are also non-trivial, which shape the molecular geometry via non-negligible electrostatic forces or van der Waals forces, etc. For multi-molecular complexes, non-bonded interactions dominate complexes’ geometry. An ideal solution to conformation generation should therefore capture both the local and long-range interactions. In Figure 1, we present three typical molecular systems where long-range interactions play a key role in determining their conformations.
To tackle the aforementioned challenge of modeling long-range interactions, in this paper, we propose the Dynamic Graph Score Matching (DGSM) for molecular conformation generation, following the principle of CONFGF [34] that learns the gradients of the logarithm density of atomic coordinates.
Instead of relying on the static input molecular graph as existing work, the basic idea is to dynamically construct graph structures between atoms based on their spatial proximity during both training and inference. This allows the model to (1) dynamically learn molecular graph representations with evolved graph structures that take long-range interactions into consideration, and (2) dynamically determine a set of interatomic distances that contribute to gradients of the current atomic coordinates.
Speciﬁcally, the edges in the dynamic graph consist of two parts. The ﬁrst part of edges are determined by covalent bonds, which capture local interactions between atoms (Ebond, Eangle and Etorsion). The second part of edges are determined dynamically by spatial proximity between atoms at each training or sampling step, i.e., two atoms are connected as long as they are proximal, no matter whether they are bonded. Such a strategy is able to effectively capture non-local interactions (Enon-bonded) since the magnitude of long-range interactions is inversely correlated with distances between atoms [30].
It remains meanwhile scalable as we avoid connecting all the atom-pairs, which has quadratic complexity. In addition, modeling non-bonded interactions enable the model to sample conformations for multi-molecular complexes, which represent a broader range of problems.
We conduct extensive experiments and compare DGSM against previous state-of-the-art methods on both standard conformation generation and property prediction tasks. Numerical results show that DGSM outperforms previous methods by a clear margin, conﬁrming the beneﬁt of modeling long-range interactions. Besides, to further demonstrate the advantage of DGSM, we bring attention to two more challenging tasks — protein sidechain conformation prediction and multi-molecular complex structure prediction. These two new tasks represent two classes of practical challenges: predicting structures for macro-molecules and multi-molecular complexes. 2