Abstract
Multi-agent control is a central theme in the Cyber-Physical Systems (CPS). How-ever, current control methods either receive non-Markovian states due to insuf-ﬁcient sensing and decentralized design, or suffer from poor convergence. This paper presents the Delayed Propagation Transformer (DePT), a new transformer-based model that specializes in the global modeling of CPS while taking into account the immutable constraints from the physical world. DePT induces a cone-shaped spatial-temporal attention prior, which injects the information prop-agation and aggregation principles and enables a global view. With physical constraint inductive bias baked into its design, our DePT is ready to plug and play for a broad class of multi-agent systems. The experimental results on one of the most challenging CPS – network-scale trafﬁc signal control system in the open world – show that our model outperformed the state-of-the-art ex-pert methods on synthetic and real-world datasets. Our codes are released at: https://github.com/VITA-Group/DePT. 1

Introduction
The Cyber-Physical System (CPS) is ubiquitous in our modern society; examples include intelligent transportation systems, power grids, autonomous automobile systems, industrial control systems, and robotic swarms. A CPS consists of multiple physical agents that interact and cooperate from time to time; as well as a cyberspace that is responsible for monitoring the status of the physical system, predicting future states, and/or assigning control actions to the physical agents [1, 2]. How to effectively execute multi-agent control over CPS is an open problem of vital importance.
In general, there are two types of methods to solve the CPS multi-agent control problem: decentralized and centralized ones. The decentralized methods usually design an individual controller for each agent based on local states. Due to the agents’ continuous interaction, the features and the inﬂuence of actions propagate between agents, hence the state transition for each agent relies on not only the locally observed states and local actions but also states and actions of other agents. Therefore, the locally observed states alone cannot make up a Markov Decision Process (MDP) [3, 4], which requires the controller to balance the global as well as the local features [5, 6, 7]. Existing methods tackle this issue by either complementing local information with information from the node’s immediate neighbors or self history, or using Graph Convolutional Networks (GCNs) instead to recursively model information propagation and aggregation. However, no aforementioned method is free of the 35th Conference on Neural Information Processing Systems (NeurIPS 2021).
Figure 1: Illustration of the typical impact propagation pattern of an event in a Cyber-Physical System (CPS). Analogous to the “light cone" concept in the special theory of relativity, the correlation pattern in the space-time spans a cone-shaped distribution, which could be set as our prior for DePT. limited localized horizon issue: an n-layer GCNs can view at most n-hop neighbors away; meanwhile, deeper GCNs usually suffer from the “bottleneck phenomenon" [8] and “over-smoothness” issues [9], which make GNNs practically hard to train and perform well. Hence, such methods are inherently restricted to making a complete MDP state. In addition, the edges in a CPS graph often have physical directions to propagating information. That caused “feature mismatching" [10, 11] when modelling by normal GCNs, and several methods [12, 13, 14] have studied directed graph modeling as remedies.
In contrast to decentralized methods, centralized methods partially avoided the non-Markovian barrier introduced by mutual interactions. However, due to the incomplete coverage/deployment of sensors and the sensing limitations, the ideal MDP assumption cannot always be met by real-world CPS observations [15, 16]. Moreover, it is difﬁcult for the traditional centralized methods to converge due to the huge state and action spaces [17]. If one considers N agents with dS dimensional state space and dA actions per agent, then the state space size is dS ∗ N , and the total number of actions (i.e., number of logits in the output layer of traditional centralized model) will become (dA)N .
Fortunately, the booming of transformer models shed a new light on addressing the aforementioned difﬁculties [18, 19, 20, 21, 22, 23, 24, 25, 26]. The Transformer architectures belong to the centralized methods due to their global view in the attention mechanism. Their global views free them from the locality inductive bias of GCNs, and make them promising candidates for globally controlling multi-agent CPS problems. Also thanks to the tokenization and decentralized processing of each tokens, transformers are also free from the huge state/action space issues: given dS dimensional state space and dA actions for each agent, transformer’s input/output are still dS/dA, regardless of the agent quantity N . However, the traditional transformer is not immediately ready to be plugged in tackling CPS control problems due to the following two arising challenges:
#1. Lack of physics in the attention modeling. The classical transformers beneﬁt from their fully
ﬂexible self-attention mechanisms to capture the complex interactions within data. This free-form is desirable for vision and NLP tasks [27, 28], but no longer valuable when it comes to real CPS due to its unawareness of many physical constraints. One example is the directional propagation and direction-feature coupling issue previously mentioned. For another prominent example, the real passage of information ﬂow between nodes and the propagation of the effect of past actions are subject to the physical propagation speed. Previous studies about graph learning using transformers mainly focus on non-physical systems and encourage between-node communication without any notion of physical latency [29, 30]. In CPS, however, features take time to propagate through the physical world. Without that important physical delay constraint in mind, the learned self-attention might mislead the attention to non-relevant temporal events or physically disjoint node pairs.
#2. The difﬁculty of training and convergence under noisy CPS data. Transformers are strong universal representers free of inductive bias, such as those in convolutions or recurrence. But the blessing of unprecedented ﬂexibility and larger capacity can turn into the curse at training: transformers take a much longer time to converge. They are resource-heavier and much more data-hungry compared to classical convolutional, or recurrent networks [24, 26]. In CPS control problems, the training data will suffer from even higher variance due to the unavoidable randomness in state transitions. Such issue is further ampliﬁed in the multi-agent setting. How to properly train transformers to stable convergence in this scenario can still present a daunting challenge. 2
In view of the above, we propose to model the delayed propagation effect in CPS by enforcing the physical constraints into the transformer, via a cone-shaped temporal-spatial prior – that the features propagation in physical world process naturally forms the cone shape in the time-space [31, 32].
We customized a multi-level heterogeneous attention mechanism that has the cone shaped prior baked into its design. With such design, the attention between input tokens now have a physical interpretation, hence guiding the controller to learn more effectively in exploring the collaborative strategy across agents. Our main technical innovations are summarized below:
• We model the CPS control problem under a transformer-based framework. This is a naturally motivated step: transformers are free from the locality restrictions, and learn inter-agent correlations across the whole system with constant state/action space size.
• We propose the Delayed Propagation Transformer (DePT), a new type of transformer with spatio-temporal priors baked into the attention design, to better characterize the inductive bias of physical information propagation latency, accompanied with better interpretability.
• We build a CPS controller based on DePT, and take the well-received CPS benchmark – transportation signal control system as a study case. The proposed controller achieves the state-of-the-art performance in the challenging urban scale trafﬁc signal control task. 2