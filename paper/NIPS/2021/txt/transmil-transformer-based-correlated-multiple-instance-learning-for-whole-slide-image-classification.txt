Abstract
Multiple instance learning (MIL) is a powerful tool to solve the weakly super-vised classiﬁcation in whole slide image (WSI) based pathology diagnosis. How-ever, the current MIL methods are usually based on independent and identical distribution hypothesis, thus neglect the correlation among different instances.
To address this problem, we proposed a new framework, called correlated MIL, and provided a proof for convergence. Based on this framework, we devised a Transformer based MIL (TransMIL), which explored both morphological and spatial information. The proposed TransMIL can effectively deal with unbal-anced/balanced and binary/multiple classiﬁcation with great visualization and in-terpretability. We conducted various experiments for three different computational pathology problems and achieved better performance and faster convergence com-pared with state-of-the-art methods. The test AUC for the binary tumor classi-ﬁcation can be up to 93.09% over CAMELYON16 dataset. And the AUC over the cancer subtypes classiﬁcation can be up to 96.03% and 98.82% over TCGA-NSCLC dataset and TCGA-RCC dataset, respectively. Implementation is avail-able at: https://github.com/szc19990412/TransMIL. 1

Introduction
The advent of whole slide image (WSI) scanners, which convert the tissue on the biopsy slide into a gigapixel image fully preserving the original tissue structure [1], provides a good opportunity for the application of deep learning in the ﬁeld of digital pathology [2, 3, 4]. However, the deep learning based biopsy diagnosis in WSI has to face a great challenges due to the huge size and the lack of pixel-level annotations[5]. To address this problem, multiple instance learning (MIL) is usually adopted to take diagnosis analysis as a weakly supervised learning problem.
In deep learning based MIL, one straightforward idea is to perform pooling operation [6, 7] on instance feature embeddings extracted by CNN. Ilse et al. [8] proposed an attention based aggrega-tion operator, giving each instance additional contribution information through trainable attention weights. In addition, Li et al. [9] introduced non-local attention into the MIL problem. By calculat-ing the similarity between the highest-score instance and the others, each instance is given different
∗Contributed equally: {shaozc0412,h2495067728,sky374263410}@gmail.com.
†Corresponding author: ybzhang08@hit.edu.cn. 35th Conference on Neural Information Processing Systems (NeurIPS 2021).
Figure 1: Decision-making process. MIL Attention Mechanism: follow the i.i.d. assumption. Self-attention Mechanism: under the correlated MIL framework. attention weight and the interpretable attention map can be obtained accordingly. There were also other pioneering works [10, 11, 12, 13, 14] in weakly supervised WSI diagnosis.
However, all these methods are based on the assumption that all the instances in each bag are inde-pendent and identically distributed (i.i.d.). While achieving some improvements in many tasks, this i.i.d. assumption was not entirely valid [15] in many cases. Actually, pathologists often consider both the contextual information around a single area and the correlation information between differ-ent areas when making a diagnostic decision. Therefore, it would be much desirable to consider the correlation between different instances in MIL diagnosis.
At present, Transformer is widely used in many vision tasks [16, 17, 18, 19, 20, 21] due to the strong ability of describing correlation between different segments in a sequence (tokens) as well as modelling long distance information. As shown in Figure 1, different from bypass attention network in the existing MIL, the Transformer adopts self-attention mechanism, which can pay attention to the pairwise correlation between each token within a sequence. However, traditional Transformer sequences are limited by their computational complexity and can only tackle shorter sequences (e.g., less than 1000) [22]. Therefore, it is not suitable for large size images such as WSIs.
To address these challenges mentioned above, we proposed a correlated MIL framework, including the convergence proof and a generic three-step algorithm. In addition, a Transformer based MIL (TransMIL) was devised to explore both morphological and spatial information between different instances. Great performance over various datasets demonstrate the validity of the proposed method. 2