Abstract
The ratio of two probability densities, called a density-ratio, is a vital quantity in machine learning. In particular, a relative density-ratio, which is a bounded extension of the density-ratio, has received much attention due to its stability and has been used in various applications such as outlier detection and dataset compari-son. Existing methods for (relative) density-ratio estimation (DRE) require many instances from both densities. However, sufﬁcient instances are often unavailable in practice. In this paper, we propose a meta-learning method for relative DRE, which estimates the relative density-ratio from a few instances by using knowledge in related datasets. Speciﬁcally, given two datasets that consist of a few instances, our model extracts the datasets’ information by using neural networks and uses it to obtain instance embeddings appropriate for the relative DRE. We model the relative density-ratio by a linear model on the embedded space, whose global optimum solution can be obtained as a closed-form solution. The closed-form solution enables fast and effective adaptation to a few instances, and its differentiability enables us to train our model such that the expected test error for relative DRE can be explicitly minimized after adapting to a few instances. We empirically demonstrate the effectiveness of the proposed method by using three problems: relative DRE, dataset comparison, and outlier detection. 1

Introduction
The ratio of two probability densities, called a density-ratio, has been used in various applications such as outlier detection [14, 1], dataset comparison [49], covariate shift adaptation [42], change point detection [30], positive and unlabeled (PU) learning [19, 18], density estimation [46], and generative adversarial networks [47]. Thus, density-ratio estimation (DRE) is attracting a lot of attention. A naive approach to DRE is to estimate each density and then take the ratio. However, this approach does not work well since density estimation is a hard problem [48]. Therefore, direct DRE without going through density estimation has been extensively studied [44, 17, 35, 13].
Although direct DRE is useful, its fundamental weakness is that the density-ratio is unbounded, i.e., it can take inﬁnity, which causes stability issues [29]. To cope with this problem, a relative density-ratio has been proposed, which is a smoothed and bounded extension of the density-ratio [49]. In the above applications, the density-ratio can be replaced with the relative density-ratio, and relative DRE has shown excellent performance [49, 30, 6, 37, 47].
Existing methods for (relative) DRE require many instances from both densities. However, sufﬁcient instances are often unavailable for various reasons. For example, it is difﬁcult to instantly collect many instances from new data sources such as new users or new systems. Collecting instances is 35th Conference on Neural Information Processing Systems (NeurIPS 2021).
expensive in some applications such as clinical trials or crash tests, where DRE can be used for dataset comparison to investigate the effect of drugs/car conditions. In such cases, existing methods cannot work well.
In this paper, we propose a meta-learning method for relative DRE. To estimate the relative density-ratio from a few instances in target datasets, the proposed method uses instances in different but related datasets, called source datasets. When these datasets are re-lated, we can transfer useful knowledge from source datasets to target ones [31]. Figure 1 shows our prob-lem formulation.
We model the relative density-ratio by using neural networks that enable us to perform accurate DRE thanks to their high expressive capabilities. Since each dataset has a different property, incorporating it to the model is essential. To achieve this, given two datasets that consist of a few instances, called support instances, our model ﬁrst calculates a latent vector representation of each dataset. This vector is calculated by using permutation-invariant neural networks that can take a set of instances as input [50].
Since the vector is obtained from a set of instances in the dataset, it contains information of the dataset.
With the two latent vectors of datasets, each instance is non-linearly mapped to an embedding space that is suitable for relative DRE on the datasets. Using the embedded instances, we perform relative
DRE, where the relative density-ratio is represented by a linear model on the embedded space. With the squared loss, the global optimal solution of the linear model can be obtained as a closed-form solution, which enables us to perform more stable and faster adaptation to support instances than numerical solutions.
Figure 1: Our problem formulation. In a train-ing phase, our model is trained with source datasets. In a test phase, the learned model estimates relative density-ratio rα(x) =
αpA(x)+(1−α)pB (x) , (0 ≤ α < 1) with tar-get datasets A and B that are generated from densities pA(x) and pB(x), respectively. pA(x)
The neural networks of our model are trained by minimizing the expected test squared error of relative
DRE after adapting to support instances that is calculated using instances in the source datasets.
Since the closed-form solution of the linear model is differentiable, this training can be performed by gradient-based methods such as ADAM [20]. Since all parameters of our model are shared across all datasets, which enables knowledge to be shared between all datasets, the learned model can be applied to unseen target datasets. This training explicitly improves the relative DRE performance for test instances after estimating the relative density-ratio using support instances. Thus, the learned model can accurately estimate the relative density-ratio from a few instances.
Our main contributions are as follows: (1) To the best of knowledge, our work is the ﬁrst attempt at meta-learning for (relative) DRE. (2) We propose a model that performs accurate relative DRE from a few instances by effectively adapting both embeddings and linear model to the instances. (3)
We empirically demonstrate the effectiveness of the proposed method with three popular problems: relative DRE, dataset comparison, and outlier detection. 2