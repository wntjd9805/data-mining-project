Abstract
This work investigates the use of robust optimal transport (OT) for shape matching.
Speciﬁcally, we show that recent OT solvers improve both optimization-based and deep learning methods for point cloud registration, boosting accuracy at an affordable computational cost. This manuscript starts with a practical overview of modern OT theory. We then provide solutions to the main difﬁculties in us-ing this framework for shape matching. Finally, we showcase the performance of transport-enhanced registration models on a wide range of challenging tasks: rigid registration for partial shapes; scene ﬂow estimation on the Kitti dataset; and nonparametric registration of lung vascular trees between inspiration and expira-tion. Our OT-based methods achieve state-of-the-art results on Kitti and for the challenging lung registration task, both in terms of accuracy and scalability.
We also release PVT1010, a new public dataset of 1,010 pairs of lung vascular trees with densely sampled points. This dataset provides a challenging use case for point cloud registration algorithms with highly complex shapes and deformations.
Our work demonstrates that robust OT enables fast pre-alignment and ﬁne-tuning for a wide range of registration models, thereby providing a new key method for the computer vision toolbox. Our code and dataset are available online at: https://github.com/uncbiag/robot. 1

Introduction
Shape registration is a fundamental but difﬁcult problem in computer vision. The task is to determine plausible spatial correspondences between pairs of shapes, with use cases that range from pose estimation for noisy point clouds [14] to the nonparametric registration of high-resolution medical images [17]. As illustrated in Fig. 1, most existing approaches to this problem consist of a combination of three steps, possibly fused together by some deep learning (DL) methods: (1) feature extraction; (2) feature matching; and (3) regularization using a class of acceptable transformations that is speciﬁed through a parametric or nonparametric model. This work discusses how tools derived from
∗Equal Contribution. 35th Conference on Neural Information Processing Systems (NeurIPS 2021).
optimal transport (OT) theory [87] can improve the second step of this pipeline (feature matching) on challenging problems. To put these results in context, we ﬁrst present an overview of related methods. 1. Feature extraction. To establish spatial correspondences, one ﬁrst computes descriptive local features. When dealing with (possibly annotated) point clouds, a simple choice is to rely on Cartesian coordinates (x, y, z) [3, 26]. Going further, stronger descriptors capture local geometric and topo-logical properties: examples include shape orientation and curvatures [21, 96], shape contexts [6], spectral eigenvalues [84, 70] and annotations such as color [76] or chemical ﬁngerprints [43, 113].
Recently, expressive feature representations have also been learned using deep neural networks (DNN): see [16] and subsequent works on geometric deep learning. Generally, feature extractors are designed to make shape registration as unambiguous as possible. In order to get closer to the ideal case of landmark matching [11], we associate discriminative features to the salient points of our shapes: this increases the robustness of the subsequent matching and regularization steps. 2. Feature matching. Once computed on both of the source and target shapes, feature vectors are put in correspondence with each other. This assignment is often encoded as an explicit mapping between the two shapes; alternatively, the vector ﬁeld relating the shapes can be deﬁned implicitly as the gradient of a geometric loss function that quantiﬁes discrepancies between two distributions of features [35]: a) A ﬁrst major approach is to rely on nearest neighbor projections and the related chamfer
[12] and Hausdorff distances [13], as in the Iterative Closest Point (ICP) algorithm [7].
This method can be softened through the use of a softmax (log-sum-exp) operator as in the many variants of the Coherent Point Drift (CPD) method [81, 73, 72, 44], or made robust to outliers in the speciﬁc context of rigid and afﬁne registrations [41, 129, 128, 14]. b) Alternatively, a second approach is to rely on convolutional kernel norms such as the
Energy Distance [94], which are also known as Maximum Mean Discrepancies (MMD) in statistics [48]. These loss functions are common in imaging science [88] and computational anatomy [115, 21] but are prone to vanishing gradients [40, 39]. c) Finally, a third type of approach is to rely on optimal transport (OT) theory [87] and solutions of the earth mover’s problem [97]. This method is equivalent to a nearest neighbor projection under a global constraint of bijectivity that enforces consistency in the matching.
On the one hand, OT has been known to provide reliable correspondences in computer vision for more than two decades [26, 47, 64]. On the other hand, it has often faced major issues of scalability and robustness to outliers on noisy data. As detailed below, the main purpose of this work is to overcome these limitations and enable the widespread use of OT tools for challenging registration problems. 3. Regularization with a deformation model. The output of the two steps above is a non-smooth vector ﬁeld that may not be suitable for downstream tasks due to e.g. tears and compression artifacts.
As a third step, most registration methods thus rely on regularization to obtain plausible deformations.
This process is task-speciﬁc, with applications that range from rigid registration [133, 46, 30, 2, 121, 122] to free-form motion estimation [91, 126, 69, 49]. In Sec. 3, we address the interaction of OT matching layers with a varied collection of regularization strategies – from optimization-based spline and diffeomorphic models to DNNs.
Recent progresses. Research works on shape registration combine ideas from the three paragraphs above to best ﬁt the characteristics of computer vision problems [71, 31, 107]. Over the past few years, signiﬁcant progress has been made on all fronts. On the one hand, (geometric) deep learning networks have been used to deﬁne data-driven feature maps [92, 92, 123] and multiscale regularization modules
[126, 68, 108], sometimes fused within end-to-end architectures [133, 91, 132, 30]. On the other hand, nearest neighbor projections, kernel convolutions and transport-based matching strategies have all been generalized to take advantage of these modern descriptors: they can now be used in high-dimensional feature spaces [59, 37].
Challenges. Nevertheless, state-of-the-art (SOTA) methods in the ﬁeld still have important limitations.
First, modern deep learning pipelines are often hard to train to “pixel-perfect” accuracy on non-smooth shapes, with diminishing returns in terms of model size and training data [2]. Second, scaling up point neural networks to ﬁnely sampled shapes (N > 10k points) remains a challenging research topic [49, 135, 37]. Third, the impact of the choice of a speciﬁc feature matching method on the performance of deep learning models remains only partially understood [58]. 2
Figure 1: Robust Optimal Transport (RobOT) generalizes sorting to spaces of dimension D (cid:62) 1. (a) RobOT is equivalent to a nearest neighbor projection subject to mass distribution constraints that make it robust to translations and small deformation. We demonstrate that RobOT is now ready to be part of the standard toolbox in computer vision with extensive numerical experiments for 3D scene
ﬂow estimation (b) and lung registration (c). Rendering done with Paraview [1] and PyVista [112].