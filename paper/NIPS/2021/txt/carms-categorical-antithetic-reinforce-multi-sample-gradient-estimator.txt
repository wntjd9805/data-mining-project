Abstract
Accurately backpropagating the gradient through categorical variables is a chal-lenging task that arises in various domains, such as training discrete latent variable models. To this end, we propose CARMS, an unbiased estimator for categorical random variables based on multiple mutually negatively correlated (jointly anti-thetic) samples. CARMS combines REINFORCE with copula based sampling to avoid duplicate samples and reduce its variance, while keeping the estimator unbiased using importance sampling. It generalizes both the ARMS antithetic estimator for binary variables, which is CARMS for two categories, as well as
LOORF/VarGrad, the leave-one-out REINFORCE estimator, which is CARMS with independent samples. We evaluate CARMS on several benchmark datasets on a generative modeling task, as well as a structured output prediction task, and find it to outperform competing methods including a strong self-control baseline. The code is publicly available.1 1

Introduction
When optimizing an expectation based objective of the form Ez∼qϕ(z)[f (z)], we sometimes require the gradients with respect to the parameters ϕ of the distribution. This is challenging for discrete variables, because the commonly used reparameterization gradient does not directly work, unless the discrete distribution is approximated by a continuous and reparameterizable one [Jang et al., 2017,
Maddison et al., 2017]. A significant part of this field has thus been score function (REINFORCE) based estimators [Glynn, 1990, Williams, 1992, Fu, 2006], which are general and do not require f to be the differentiable.
In this paper, we focus on the case when z is a high dimensional categorical variable with logits ϕ. An common example of this form is the evidence lower bound (ELBO) [Jordan et al., 1998], which arises in variational inference and is used for training variational autoencoders [Kingma and Welling, 2014, Rezende et al., 2014]. Because their latent space consists of a large number of categorical variables, they require Monte Carlo gradients with respect to the parameters of the stochastic distribution, but have excellent performance, as a categorical VAE has in practice achieved state-of-the-art zero-shot image generation [Ramesh et al., 2021].
Our main contribution is a novel unbiased and low-variance gradient estimator for categorical variables. The Categorical-Antithetic-REINFORCE-Multi-Sample (CARMS) estimator uses a copula to generate any number of antithetic (mutually negatively correlated) [Owen, 2013] categorical samples, and constructs an unbiased estimator by combining them into a baseline for variance reduction. This approach is inspired by the ARMS estimator [Dimitriev and Zhou, 2021], which also uses multiple antithetic samples, but only works for binary variables. For two categories, CARMS 1https://github.com/alekdimi/carms 35th Conference on Neural Information Processing Systems (NeurIPS 2021).
reduces to it, while for independent samples, CARMS reduces to the leave-one-out-REINFORCE (LOORF) estimator. Our approach achieves higher ELBO with VAE models than the state of the art, as well as higher log likelihood for conditional image completion.