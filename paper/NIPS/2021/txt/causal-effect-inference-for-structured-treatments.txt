Abstract
We address the estimation of conditional average treatment effects (CATEs) for structured treatments (e.g., graphs, images, texts). Given a weak condition on the effect, we propose the generalized Robinson decomposition, which (i) isolates the causal estimand (reducing regularization bias), (ii) allows one to plug in arbitrary models for learning, and (iii) possesses a quasi-oracle convergence guarantee under mild assumptions. In experiments with small-world and molecular graphs we demonstrate that our approach outperforms prior work in CATE estimation. 1

Introduction
Estimating feature-level causal effects, so-called conditional average treatment effects (CATEs), from observational data is a fundamental problem across many domains. Examples include understanding the effects of non-pharmaceutical interventions on the transmission of COVID-19 in a speciﬁc region
[12], how school meal programs impact child health [13], and the effects of chemotherapy drugs on cancer patients [52]. Supervised learning methods face two challenges in such settings: (i) missing interventions, the fact that we only observe one treatment for each individual means models must extrapolate to new treatments without access to ground truth, and (ii) confounding factors that affect both treatment assignment and the outcome means that extrapolation from observation to intervention requires assumptions. Many approaches have been proposed to overcome these issues
[1, 2, 3, 4, 5, 6, 7, 9, 10, 15, 18, 19, 21, 22, 23, 25, 27, 29, 33, 39, 41, 42, 45, 52, 56, 57, 60, 64, 67].
In many cases, treatments are naturally structured. For instance, a drug is commonly represented by its molecular structure (graph), the nutritional content of a meal as a food label (text), and geographic regions affected by a new policy as a map (image). Taking this structure into account can provide several advantages: (i) higher data-efﬁciency, (ii) capability to work with many treatments, and (iii) generalizing to unseen treatments during test time. However, the vast majority of prior work operates on either binary or continuous scalar treatments (structured treatments are rarely considered, a notable exception to this trend is Harada & Kashima [16] which we describe in Section 2).
To estimate CATEs with structured interventions, our contributions include:
• Generalized Robinson decomposition (GRD): A generalization of the Robinson decomposition
[47] to treatments that can be vectorized as a continuous embedding. This GRD reveals a learnable
∗Correspondence to jean.kaddour.20@ucl.ac.uk 35th Conference on Neural Information Processing Systems (NeurIPS 2021).
Figure 1: Illustration of CATE estimation with structured treatments (e.g., molecular graphs).
Left: Problem setup with features X, treatment T, and outcome Y . Center: Observations the estimator has access to, typically containing only one outcome per individual. Right: The CATE is the difference between the expected outcomes given a ﬁxed individual and a pair of treatments. pseudo-outcome target that isolates the causal component of the observed signal by partialling out confounding associations. Further, it allows one to learn the nuisance and target functions using any supervised learning method, thus extending recent work on plug-in estimators [42, 29].
• Quasi-oracle convergence guarantee: A result that shows that given access to estimators of certain nuisance functions, as long as the estimates converge at an O(n−1/4) rate, the target estimator for the CATE achieves the same error bounds as an oracle who has ground-truth knowledge of both nuisance components, the propensity features, and conditional mean outcome.
• Structured Intervention Networks (SIN): A practical algorithm using GRD, representation learning, and alternating gradient descent. Our PyTorch [43] implementation is online.2
• Evaluation metrics designed for structured treatments. Since previous evaluation protocols of
CATE estimators have mostly focused on binary or scalar-continuous treatment settings, we believe that our proposed evaluation metrics can be useful for comparing future work.
• Experimental results with graph treatments in which SIN outperforms previous approaches. 2