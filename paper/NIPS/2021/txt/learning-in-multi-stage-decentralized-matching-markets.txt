Abstract
Matching markets are often organized in a multi-stage and decentralized manner.
Moreover, participants in real-world matching markets often have uncertain prefer-ences. This article develops a framework for learning optimal strategies in such settings, based on a nonparametric statistical approach and variational analysis. We propose an efﬁcient algorithm, built upon concepts of “lower uncertainty bound” and “calibrated decentralized matching,” for maximizing the participants’ expected payoff. We show that there exists a welfare-versus-fairness trade-off that is charac-terized by the uncertainty level of acceptance. Participants will strategically act in favor of a low uncertainty level to reduce competition and increase expected payoff.
We prove that participants can be better off with multi-stage matching compared to single-stage matching. We demonstrate aspects of the theoretical predictions through simulations and an experiment using real data from college admissions. 1

Introduction
Two-sided matching markets have played an important role in microeconomics for several decades
[34]. Matching markets are used to allocate indivisible “goods” to multiple decision-making agents based on mutual compatibility as assessed via sets of preferences. Such a market does not clear through prices. For example, a student applicant cannot simply demand the college she prefers but must also be chosen by the college. Matching markets are often organized in a decentralized way.
Each agent makes their decision independently of others’ decisions, and each agent can have multiple stages of interactions with the other side of the market. College admissions with waiting lists and academic job markets are notable examples. We refer to such markets as multi-stage decentralized matching markets.
Uncertain preference is ubiquitous in multi-stage decentralized matching markets. For instance, colleges competing for students lack information on students’ preferences. An admitted student may receive offers from other colleges. She needs to accept one or reject all offers within a short period during each stage of early, regular, and waiting-list admissions [5]. This admission process provides little opportunity for colleges to learn students’ preferences, which are uncertain due to competition among colleges and variability in the relative popularity of colleges over time. Such uncertain preferences pose a challenge for colleges in their attempt to formulate an optimal admission strategy. Consequently, colleges may end up enrolling too many or too few students relative to their capacity or having enrolled students overly far from the attainable optimum in quality.
This paper addresses the following two research questions: (i) Given the uncertain preferences on one side of the market (e.g., students), how can agents (e.g., colleges) learn an optimal strategy that maximizes expected payoffs based on historical data? (ii) What are the fundamental implications of multi-stage decentralized matching on the welfare and fairness for both sides of the market? We study these two questions using nonparametric statistical methodology and variational analysis.
We propose a new algorithm for maximizing agents’ expected payoffs that is based on learning 35th Conference on Neural Information Processing Systems (NeurIPS 2021).
stage-wise optimal strategies and calibrating state parameters based on historical data. In particular, our algorithm balances the opportunity cost and the penalty for exceeding the quota for calibration.
Based on the calibrated state, the algorithm efﬁciently learns an optimal strategy using statistical machine learning methods. The statistical model not only provides a foundation for the algorithm but it also provides an analytical framework for understanding the implications of the approach for welfare and fairness. We show that agents will favor arms with realistic and stable opportunities for matching instead of only targeting the top-ranked arms. Moreover, we show that agents are better off with multi-stage decentralized matching as compared to single-stage decentralized matching.
Adopting literature from the bandit literature, our model has a set of agents, each with limited capacity, and a set of arms. Each agent values two attributes of an arm: a “score" that is common to all agents and a “ﬁt" that is agent-speciﬁc and independent across agents. Agents rank arms according to their scores and ﬁts. An agent’s strategy consists of how many and which arms to pull at each stage. On the other hand, there is no restriction on the preferences of arms. The model allows uncertainty in the preferences, which is incorporated into the arms’ stage-wise acceptance probabilities. The acceptance probability depends on the unknown state of the world and the competition of agents at each stage.
We consider a simple timeline for multi-stage markets. At each stage, agents simultaneously pull sets of arms. Each arm accepts at most one of the agents that pulled it. The arms have to make irreversible decisions at each stage without knowing which other agents might select them in later stages.
Our contributions There are two main contributions in this paper, which correspond to the two questions above. Our ﬁrst contribution is to propose a new algorithm that maximizes the agent’s expected payoff in multi-stage decentralized matching markets. The algorithm sequentially learns the optimal strategy at each stage and is built upon notions of lower uncertainty bound (LUB) and calibrated decentralized matching (CDM). The key idea is to calibrate the state parameter in a data-driven approach and take the opportunity cost and penalty for exceeding the quota into account.
The calibration can be performed under both average-case and worst-case metrics, depending on whether we are maximizing the averaged or minimal expected payoff with respect to the uncertain state. Given the calibrated state, the algorithm efﬁciently learns the optimal strategy using historical data via statistical machine learning methods.
The second contribution is providing an analytical framework for understanding the welfare and fairness implications. We show that agents favor arms with low uncertainty in levels of acceptance, suggesting that agents prefer arms with a realistic and stable chance for matching instead of only targeting the top-ranked arms. Such strategic behavior improves the agent’s expected payoff since otherwise, by the time that arms have rejected that agent, the next-best arms that the agent has in mind may already have accepted other agents. However, the strategic behavior leads to unfair outcomes for arms because some arms are not pulled by their favorite agents even though these agents pull arms ranked below them. We prove that agents are better off in multi-stage decentralized matching markets compared to single-stage decentralized matching markets.