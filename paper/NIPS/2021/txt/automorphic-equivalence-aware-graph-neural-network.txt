Abstract
Distinguishing the automorphic equivalence of nodes in a graph plays an essential role in many scientiﬁc domains, e.g., computational biologist and social network analysis. However, existing graph neural networks (GNNs) fail to capture such an important property. To make GNN aware of automorphic equivalence, we
ﬁrst introduce a localized variant of this concept — ego-centered automorphic equivalence (Ego-AE). Then, we design a novel variant of GNN, i.e., GRAPE, that uses learnable AE-aware aggregators to explicitly differentiate the Ego-AE of each node’s neighbors with the aids of various subgraph templates. While the design of subgraph templates can be hard, we further propose a genetic algorithm to automatically search them from graph data. Moreover, we theoretically prove that GRAPE is expressive in terms of generating distinct representations for nodes with different Ego-AE features, which ﬁlls in a fundamental gap of existing GNN variants. Finally, we empirically validate our model on eight real-world graph data, including social network, e-commerce co-purchase network, and citation network, and show that it consistently outperforms existing GNNs. The source code is public available at https://github.com/tsinghua-fib-lab/GRAPE. 1

Introduction
The past few years have witnessed the phenomenal success of GNNs in numerous graph learning tasks, such as node classiﬁcation [24], link prediction [59], and community detection [19], which is largely due to their capability of simultaneously modelling the connecting patterns and feature distribution in each node’s local neighborhood. As a result, it leads to a surge of interests from both academia and industry to develop more powerful GNN models [52]. Despite of various architectures, the most popular GNNs, like GCN [24], GraphSAGE [19], GAT [48] and GIN [55], apply permutation invariant aggregate function on each node’s local neighborhood to learn node embeddings, which leads to concerns about their representational power [17, 55].
In this paper, we investigate GNN’s expressiveness from an important but largely overlooked angle, i.e., the capacity to distinguish automorphic equivalence within each node’s local neighborhood.
Automorphic equivalence (AE) [14] is a classic concept to differentiate the structural role of each node in a given graph. Speciﬁcally, two nodes are considered to be AE only if they are interchangeable in some index permutations that preserve the connection matrix, i.e., graph automorphisms [35]. AE can identify the nodes that exhibit identical structural features in a graph, which makes it a central topic in computational biologist, social network analysis and other scientiﬁc domains [33, 34]. For example, empirical studies show AE is an important indicator of social position and behavior similarity in social network [16, 37], which thus might signiﬁcantly beneﬁt GNN architecture design. 35th Conference on Neural Information Processing Systems (NeurIPS 2021).
Empirically efﬁcient heuristics have been proposed to identify the AE in moderate scale graphs by enumerating all the possible automorphisms [6, 45]. However, previous analytic methods only classify nodes into categorical equivalence sets. Although categorical features can be jointly optimized with
GNNs under various frameworks [30, 54], little previous efforts are invested to principally incorporate
AE into GNNs. Thus, we aim to design a novel GNN model that is provably expressive in capturing
AE features and can be tuned in a data-dependent manner based on the graph data and targeted applications, which will effectively allow us to learn expressive function to harness the power of AE feature.
Here, we propose GRaph AutomorPhic Equivalent network, i.e., GRAPE, a novel variant of GNN that can learn expressive representation by differentiating the automorphic equivalences of each node’s neighbors. First, GRAPE extends the classic AE concept into a localized setting, i.e., Ego-AE, to accommodate the local nature of GNNs. Speciﬁcally, Ego-AE identiﬁes the local neighborhoods of each node by mapping with given subgraph templates and then partitions the neighboring nodes into
Ego-AE sets based on the graph automorphisms in neighborhood. Second, we design a learnable AE-aware aggregators to model the node features in these Ego-AE sets, which adaptively assigns different weights to neighboring nodes in different Ego-AE sets and explicitly model the interdependency among them. Moreover, in order to capture complex structural features, GRAPE proposes to fuse the embeddings learned from Ego-AE sets identiﬁed by different subgraph templates with a squeeze-and-excitation module [22]. Finally, to alleviate the barrier of subgraph template design, we propose an efﬁcient genetic algorithm to automatically search for optimal subgraph templates. Speciﬁcally, it gradually optimizes a randomly initiated population of subgraph templates by iteratively exploring the adjacency of good performing candidates and eliminating the bad performing ones. To accelerate the search process, we further design an incremental subgraph matching algorithm that can leverage the similarity between subgraphs to greatly reduce the complexity of ﬁnding matched instances.
We theoretically prove that the proposed GRAPE is expressive in terms of learning distinct repre-sentations for nodes with different Ego-AE sets, which fundamentally makes up the shortcomings of popular GNN variants, e.g., GCN [24], GraphSAGE [19], GAT [48] and GIN [55]. Moreover, we empirically validate GRAPE on eight real-world datasets, which cover the scenarios of social network, citation network and e-commerce co-purchase network. Experiments show GRAPE is consistently the best performing model across all datasets with up to 26.7% accuracy improvement.
Besides, case studies indicate GRAPE can effectively differentiate the structural roles of each node’s neighbors. Moreover, the proposed genetic algorithm efﬁciently generates high quality subgraph templates that have comparable performance with the hand-crafted ones. 2