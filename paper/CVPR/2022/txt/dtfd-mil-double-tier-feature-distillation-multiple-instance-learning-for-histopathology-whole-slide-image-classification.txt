Abstract
Multiple instance learning (MIL) has been increasingly used in the classification of histopathology whole slide im-ages (WSIs). However, MIL approaches for this specific classification problem still face unique challenges, partic-ularly those related to small sample cohorts. In these, there are limited number of WSI slides (bags), while the resolu-tion of a single WSI is huge, which leads to a large number of patches (instances) cropped from this slide. To address this issue, we propose to virtually enlarge the number of bags by introducing the concept of pseudo-bags, on which a double-tier MIL framework is built to effectively use the intrinsic features. Besides, we also contribute to deriving the instance probability under the framework of attention-based MIL, and utilize the derivation to help construct and analyze the proposed framework. The proposed method out-performs other latest methods on the CAMELYON-16 by substantially large margins, and is also better in perfor-mance on the TCGA lung cancer dataset. The proposed framework is ready to be extended for wider MIL appli-cations. The code is available at: https://github. com/hrzhang1123/DTFD-MIL 1.

Introduction
The automation of whole slide images (WSIs) poses a significant challenge to the field of computer vision. The increasing use of WSIs in histopathology results in digital pathology providing huge improvements in workflow and diagnosis decision-making by pathologists [7,21,24,29,31], but it also stimulates the need for intelligent or automatic analytical tools of WSIs [11, 20, 36, 40, 44, 48, 49]. WSIs have enormous sizes, ranging from 100M pixels to 10G pix-els, and this unique characteristic makes it almost infeasible to directly transfer existing machine learning techniques to
Figure 1. Illustration of the difference between conventional MIL models and the proposed double-tier MIL model. their applications, since these existing techniques were ini-tially intended for natural images or medical images with much smaller sizes. When it comes to deep learning based models, large scale datasets and high quality annotations are the primary yet crucial conditions to train a high capacity model. However, the enormous sizes of WSIs bring along substantial burden for pixel-level annotation. This prob-lem in turn encourages researchers to develop deep learning based models trained with limited annotations, termed as
“Weakly Supervised” or “Semi-Supervised” [22,26,35,41].
A large proportion of existing weakly supervised works for
WSI classification are characterized as “multiple instance learning” (MIL) [1, 5, 8, 25]. Under the framework of MIL, a slide (or WSI), acting as a bag, constitutes multiple in-stances that are hundreds or thousands of patches cropped from the slide. With at least one instance being disease pos-itive, the slide is marked as positive, or otherwise negative.
There exist some successful attempts to solve the MIL problem in various computer vision tasks [19,27,28,30,32].
The innate characteristics of WSIs, however, make it less straightforward to develop MIL solution for WSI classifi-cation than the counterparts in other computer vision sub-fields, as the only direct guidance information for training
Figure 2. (A) Illustration of an image classification system of deep learning. Global average pooling is applied to the extracted feature maps of an image, leading to a feature vector representing the image. Then the feature vector is forwarded to a classifier which outputs the class logits, then class probabilities by softmax. (B) Illustration of the AB-MIL paradigm. The extracted feature of an instance is weighted by an attention score. The bag feature is obtained through the sum of the weighted instance features, and then fed into a classifier for the bag prediction. are the labels of a few hundred slides. The most notorious consequence is the over-fitting problem where a machine learning model tends to fall into local minima during op-timization while the learnt features are less relevant with respect to target disease, and as a result, the trained model has inferior generalization ability.
Most recent works of MIL for WSIs to tackle the overfit-ting issue are built on the essential idea of exploiting more information to learn in addition to the labels of the relatively small number of slides in a cohort. The mutual-instance relation is an important direction to explore for this pur-pose, and it has been empirically proven to be effective.
The mutual-instance relation can be specified as spatial [6] or feature distances [18, 35, 37, 46], or can be agnostically learnt by neural modules, such as recurrent neural networks (RNN) [3], transformer [34], and graph convolution net-work [51].
Many of the aforementioned methods belong to attention-based MIL (AB-MIL) [14], although they differ in the formulations of the attention scores. However, it was believed infeasible to explicitly infer instance probabilities under AB-MIL frameworks [18], and as an alternative, at-tention scores were usually used as the indications of posi-tive activation [10, 14, 18, 34]. In this paper, we argue that the attention score is not a rigorous metric for this purpose, and instead we contribute to deriving the instance probabil-ity under the framework of AB-MIL.
Given the huge size of a WSI, the units to be directly processed are the much smaller patches cropped from WSIs
[12]. MIL models for WSI classification essentially aim to recognize the most distinctive patches that correspond mostly to the slide label. However, there are a limited num-ber of slides while there are hundreds or even thousands of patches (instances) in a slide, and the information for learning are only the slide-level labels. Moreover, in many histopathology slides the positive regions corresponding to positive diseases only occupy small portions of tissue, lead-ing to a small ratio of positive instances of a slide. There-fore, it is challenging to guide a model to recognize positive instances under the condition of MIL, since these factors collectively contribute to deteriorating the over-fitting prob-lem.
Although most recent methods utilize mutual-instance relations to improve MIL, they do not explicitly confront the problems originated from the innate characteristics of WSIs as mentioned above. To alleviate the negative impacts of these problems, we introduce the concept of ‘pseudo-bag’ in the proposed framework. That is, we randomly split the instances (patches) of a bag (slide) into several smaller bags (pseudo-bags), and assign each pseudo bag the label of the original bag, termed as the parent bag. This strategy virtu-ally increases the number of bags while inside each pseudo bag there are fewer instances; it also enables Double-Tier
Feature Distillation MIL model (Fig.1). More specifically, a Tier-1 AB-MIL model is applied to the pseudo-bags of all the slides. However, it comes along the risk that a pseudo-bag from a positive parent bag may not be allocated with at least one positive instance, in which case a mislabeled pseudo-bag is introduced. To tackle this issue, we distill a feature vector from each pseudo-bag and establish a Tier-2 AB-MIL model upon the features distilled from all the pseudo-bags of a slide (See Fig.3). Through the distillation process, the Tier-1 model provides initial candidates of dis-tinct features for the Tier-2 model to generate a better rep-resentation for the corresponding parent bag. Furthermore, for the purpose of feature distillation, we derive the instance probability under the framework of AB-MIL, by harnessing the fundamental idea of Grad-CAM that was developed for visualizing deep learning features [33].
In essence, we deal with the MIL problem for WSI classification from another perspective with the proposed double-tier MIL framework. The main contributions are: (1). We introduce the concept of pseudo-bags to allevi-ate the issue of limited number of WSIs. (2) We derive the instance probability under the AB-MIL framework by utilizing the essential idea of Grad-CAM. Given AB-MIL is the base for many MIL works, the instance probability derivation can help with the extension studies of related
(3). By utilizing the instance probability
MIL methods. derivation, we formulate a double-tier MIL framework, and the experiments show its superiority to other latest methods on two large public histopathology WSI datasets. 2.