Abstract
Multi-agent trajectory prediction is critical for planning and decision-making in human-interactive autonomous sys-tems, such as self-driving cars. However, most prediction models are developed separately from their upstream per-ception (detection and tracking) modules, assuming ground truth past trajectories as inputs. As a result, their perfor-mance degrades significantly when using real-world noisy tracking results as inputs. This is typically caused by the propagation of errors from tracking to prediction, such as noisy tracks, fragments and identity switches. To allevi-ate this propagation of errors, we propose a new predic-tion paradigm that uses detections and their affinity matri-ces across frames as inputs, removing the need for error-prone data association during tracking. Since affinity ma-trices contain “soft” information about the similarity and identity of detections across frames, making prediction di-rectly from affinity matrices retains strictly more informa-tion than making prediction from the tracklets generated by data association. Experiments on large-scale, real-world autonomous driving datasets show that our affinity-based prediction scheme1 reduces overall prediction errors by up to 57.9%, in comparison to standard prediction pipelines that use tracklets as inputs, with even more significant er-ror reduction (up to 88.6%) if restricting the evaluation to challenging scenarios with tracking errors. 1.

Introduction
Tightly integrating multi-object tracking and trajectory prediction methods within an autonomy stack is a signifi-cant challenge due to the fact the most prior works develop multi-object tracking [5,14,17,28,38,39,41,42,49] and tra-jectory prediction [8, 12, 15, 16, 20, 32, 43, 46] approaches in isolation. Recently, [40, 45] showed that feeding the out-1Our project website is at https://www.xinshuoweng.com/ projects/Affinipred.
Figure 1.
In contrast to standard tracking-prediction pipelines, our affinity-based prediction (Affinipred) skips data association, directly using detections and affinity matrices as prediction inputs. puts of a modern tracking method directly into a predic-tion model can significantly degrade performance (e.g., up to 28× higher prediction error) in comparison to the com-mon idealized prediction setting using perfect inputs (i.e., ground truth trajectories). Unfortunately, this challenge of integration with an explicit consideration of robustness to tracking errors is still largely under-explored in the field.
Why does prediction accuracy significantly drop when using tracking results as inputs? Prior work [40, 45] has shown that tracking errors such as identity switches and fragments, which induce velocity or orientation estimation errors, are to blame. Typically, identity switches occur from mistakes in data association when two different objects are marked as the same due to ambiguity, e.g., their appear-ance or geometric features are similar or they are very close.
Fragments occur when data association fails to find a detec-tion to match with an existing tracklet.
Now, is there an effective way to avoid these tracking er-rors from propagating to prediction? In this work, we argue that there is: skip data association altogether as shown in
Fig. 1, since it may cause identity switches and fragments.
Our key insight can be summarized as follows: Broadly, data association converts a “soft” affinity matrix (comprised of scalars between 0 and 1) to a boolean matrix (containing only 0 or 1) through a “hard” matching. By removing the
data association step, we aim to preserve this “soft” infor-mation that is otherwise thrown away when “hard” match-ing is performed during data association. Because we skip the data association step, our method can be more accu-rate in the case where the affinity values are similar between two pairs of objects and it is ambiguous to perform correct matching and easy to make data association errors.
Contributions. We propose to directly use raw detec-tions and intermediate tracking results, i.e., affinity matri-ces, as inputs to prediction. To fully exploit the raw detec-tions and affinity matrices for prediction, we propose: (1) An Affinity-based prediction (Affinipred) framework that removes the need for input past trajectories and also the error-prone data association step. (2) A transformer architecture that models joint attention between all detections at all input frames and can deal with a variable size of detections across frames. (3) An affinity-based attention mechanism that directly in-corporates full object affinity information across time.
In addition to the above contributions, Affinipred also leverages advancements from prior work by using a con-ditional variational autoencoder (CVAE) [18] to produce multi-modal predictions [21, 32], performing joint interac-tion modeling in the decoder to produce scene-consistent predictions [11,35], and incorporating maps in the inputs to capture environmental information [47, 48]. 2.