Abstract
Self-training has greatly facilitated domain adaptive se-mantic segmentation, which iteratively generates pseudo labels on unlabeled target data and retrains the network.
However, realistic segmentation datasets are highly imbal-anced, pseudo labels are typically biased to the major-ity classes and basically noisy, leading to an error-prone and suboptimal model.
In this paper, we propose a sim-ple region-based active learning approach for semantic seg-mentation under a domain shift, aiming to automatically query a small partition of image regions to be labeled while maximizing segmentation performance. Our algorithm, Re-gion Impurity and Prediction Uncertainty (RIPU), intro-duces a new acquisition strategy characterizing the spa-tial adjacency of image regions along with the prediction confidence. We show that the proposed region-based se-lection strategy makes more efficient use of a limited bud-get than image-based or point-based counterparts. Further, we enforce local prediction consistency between a pixel and its nearest neighbors on a source image. Alongside, we develop a negative learning loss to make the features more discriminative. Extensive experiments demonstrate that our method only requires very few annotations to al-most reach the supervised performance and substantially outperforms state-of-the-art methods. The code is available at https://github.com/BIT-DA/RIPU . 1.

Introduction
Semantic segmentation, the task of comprehending an image at the pixel level, is the foundation for numerous ap-plications such as autonomous driving [63, 80], robot ma-nipulation [51, 67], and medical analysis [48, 62]. Learn-ing of segmentation models, however, relies heavily on vast quantities of data with pixel-wise annotations, which (cid:12)
Corresponding author (a) Target image (b) Image-based selection (100%) (c) Point-based selection (2.2%) (d) Region-based selection (2.2%)
Image-Figure 1.
Illustration of different selection strategies. based selection (e.g., MADA [41]) picks a few target samples and label the entire image, which is probably inefficient. Point-based selection (e.g., LabOR [54]) chooses scarce points about which the model is uncertain, while uncertainty estimation at point level is prone to lump pixels that come from particular categories. Our region-based selection asks for more annotations of regions with more categories as well as object boundaries in an effective way. is onerous and prohibitively expensive [9, 35]. Further, it remains a major challenge to guarantee a good generaliza-tion to diverse testing situations. Various research efforts have been directed to address the above issues, with domain adaptation being promising methods [14, 29, 37, 64, 65, 72].
Recently, self-training has boosted domain adaptation, which retrains the network with the pseudo labels generated from confident predictions on the target domain [8, 40, 75, 83, 85–87]. Nevertheless, this competitive approach faces an inherent challenge: class unbalance is usually extreme.
For instance, some classes e.g., “road” and “building”, ap-pear more frequently than others such as “rider” and “light”.
Thereby, pseudo labels are noisy and self-training would put heavy emphasis on classes with high frequency and sacrifice the performance on rare classes or small objects, resulting in undesired biases. Consequently, the performance lags far behind the supervised learning counterparts.
To overcome this obstacle and encourage maximizing
segmentation performance on the target domain, we show that a simple active learning strategy works well in adaptive semantic segmentation: annotating a small portion of im-age regions. Until recently, similar efforts have been made by Ning et al. [41] and Shin et al. [54]. The former uses multiple anchors to select representative target images to be labeled (Fig. 1b), which may be highly inefficient since it can waste the annotation budget on labeling redundant ar-eas within objects. The latter utilizes an inconsistent mask of the bi-classifier predictions to query scarce points in each image for annotation (Fig. 1c). Although this process re-duces human labor costs, under a severe domain shift, un-certainty estimation at the point level may be highly mis-calibrated [60] or lead to sampling redundant points from certain categories. Moreover, both works are straightfor-ward extensions of classification methods and weaken the significance of spatial proximity property in an image.
Driven by the above analysis, we present a simple, effec-tive, and efficient active learning method, Region Impurity and Prediction Uncertainty (RIPU), to assist domain adap-tive semantic segmentation. A key design element of RIPU is to select the most diverse and uncertain regions in an im-age (Fig. 1d), eventually boosting the segmentation perfor-mance. To be concrete, we first generate the target pseudo labels from the model predictions and excavate all possi-ble regions with the k-square-neighbors algorithm. Second, we take the entropy calculated on the percentage of internal pixels belonging to each distinct class as the region impurity score of each region. Finally, combining region impurity with the mean value of prediction uncertainty, i.e., the en-tropy of pixel prediction, a novel label acquisition strategy that jointly captures diversity and uncertainty is derived.
In this work, we introduce two labeling mechanisms for each target image, viz., “Region-based Annotating (RA)” (∼2.2% ground truth pixels) and “Pixel-based Annotating (PA)” (∼40 pixels). RA annotates every pixel in the se-lected regions—high annotation regime, while PA places its focus more on the labeling effort efficiency by selecting the center pixel within the region—low annotation regime. We further exploit local stability to enforce the prediction con-sistency between a certain pixel and its neighborhood pix-els on the source domain and develop a negative learning loss to enhance the discriminative representation learning on the target domain. We demonstrate that our method can not only help the model to achieve near-supervised perfor-mance but also reduce human labeling costs dramatically.
In a nutshell, our contributions can be summarized as:
• We benchmark the performance of prior methods for active domain adaptation regarding semantic segmen-tation and uncover that methods using image-based or point-based selection strategies are not effective.
• We propose a region-based acquisition strategy for do-main adaptive semantic segmentation, termed RIPU, that utilizes region impurity and prediction uncertainty to identify image regions that are both diverse in spa-tial adjacency and uncertain in prediction output.
• We experimentally show that, with standard segmenta-tion models, i.e., DeepLab-v2 and DeepLab-v3+, our method brings significant performance gains across two representative domain adaptation benchmarks, i.e., GTAV → Cityscapes, SYNTHIA → Cityscapes. 2.