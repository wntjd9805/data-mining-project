Abstract
Single-photon avalanche diodes (SPADs) are growing in popularity for depth sensing tasks. However, SPADs still struggle in the presence of high ambient light due to the effects of pile-up. Conventional techniques leverage fixed or asynchronous gating to minimize pile-up effects, but these gating schemes are all non-adaptive, as they are unable to incorporate factors such as scene priors and pre-vious photon detections into their gating strategy. We pro-pose an adaptive gating scheme built upon Thompson sam-pling. Adaptive gating periodically updates the gate posi-tion based on prior photon observations in order to mini-mize depth errors. Our experiments show that our gating strategy results in significantly reduced depth reconstruc-tion error and acquisition time, even when operating out-doors under strong sunlight conditions. 1.

Introduction
Single-photon avalanche diodes (SPADs) are an emerg-ing type of sensor [40] that possess single photon sensitiv-ity. Combined with ultrafast pulsed lasers and picosecond-accurate timing electronics, SPADs are becoming increas-ingly popular in LiDAR systems for 3D sensing applica-tions [15–17, 26]. SPAD-based LiDAR is used, e.g., on au-tonomous vehicles [2, 39] and consumer devices [1].
Unfortunately, SPAD-based LiDAR faces a fundamental challenge when operating under strong ambient light: back-ground photons due to ambient light can block the detection of signal photons due to the LiDAR laser, an effect know as pile-up [6,12,15,16,31,33]. This effect becomes more pro-nounced as scene depth increases, and results in potentially very inaccurate depth estimation.
A popular technique for mitigating pile-up is to use gat-ing mechanisms that can selectively activate and deactivate the SPAD at specific time intervals relative to laser pulse emissions. Gating can help prevent the detection of early-arriving background photons, and thus favor the detection of late-arriving signal photons. Prior work has proposed dif-ferent schemes for selecting gating times. A common such scheme is fixed gating, which uses for all laser pulses the same gating time (Figure 2(a)). If this gating time is close to the time-of-flight corresponding to scene depth, then fixed gating greatly increases the detection probability of signal photons, and thus depth estimation accuracy. Unfortunately, it is not always possible to know or approximate the time-of-flight of true depth ahead of time.
More recently, Gupta et al. [15] proposed a uniform gating scheme, which uniformly distributes gate times for successive laser pulses across the entire depth range (Fig-ure 2(b)). This helps “average-out” the effect of pile-up across all possible depths. Unfortunately, uniform gating does not take into account information about the true scene depth available from either prior knowledge, or from photon
Figure 1. Adaptive gating and adaptive exposure for depth imaging under sunlight. Adaptive gating reduces depth RMSE
≈ 3× compared to conventional methods for the same acquisition time. When used in conjunction with adaptive exposure, our meth-ods improves frame rate 3× while still achieving lower RMSE. detections during previous laser pulses.
We propose a new gating scheme for SPAD-based Li-DAR that we term adaptive gating. Two main building blocks underlie our gating scheme: First, a probabilistic model for the detection times recorded by SPAD-based Li-DAR. Second, the classical Thompson sampling algorithm for sequential experimental design. By combining these two components, our proposed adaptive gating scheme is able to select gating sequences that, at any time during LiDAR acquisition, optimally take advantage of depth information available at that time, either from previous photon detec-tions or from some depth prior. As a useful by-product of our framework, we introduce a variant of our adaptive gat-ing scheme that additionally adapts exposure time, as nec-essary to achieve some target depth accuracy. We build a
SPAD-based LiDAR prototype, and perform experiments both indoors, and outdoors under strong sunlight. Our ex-periments show that, compared to previous gating schemes, our adaptive gating scheme can reduce either depth estima-tion error or acquisition time (or both) by more than 50% (Figure 1), and can take advantage of prior depth informa-tion from spatial regularization or RGB images. To ensure reproducibility and facilitate follow-up research, we pro-vide our code and data on the project website [36].
2.