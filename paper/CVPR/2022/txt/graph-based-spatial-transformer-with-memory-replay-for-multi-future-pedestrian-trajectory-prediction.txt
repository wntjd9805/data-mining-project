Abstract
Pedestrian trajectory prediction is an essential and chal-lenging task for a variety of real-life applications such as autonomous driving and robotic motion planning. Besides generating a single future path, predicting multiple plausi-ble future paths is becoming popular in some recent work on trajectory prediction. However, existing methods typ-ically emphasize spatial interactions between pedestrians and surrounding areas but ignore the smoothness and tem-poral consistency of predictions. Our model aims to fore-cast multiple paths based on a historical trajectory by mod-eling multi-scale graph-based spatial transformers com-bined with a trajectory smoothing algorithm named “Mem-ory Replay” utilizing a memory graph. Our method can comprehensively exploit the spatial information as well as correct the temporally inconsistent trajectories (e.g., sharp turns). We also propose a new evaluation metric named
“Percentage of Trajectory Usage” to evaluate the compre-hensiveness of diverse multi-future predictions. Our exten-sive experiments show that the proposed model achieves state-of-the-art performance on multi-future prediction and competitive results for single-future prediction. Code re-leased at https://github.com/Jacobieee/ST-MR. 1.

Introduction
Trajectory prediction is an indispensable part of social behavior analysis for a variety of applications including autonomous driving [5, 49], motion tracking [28, 34] and robotic systems [33]. Such tasks require a high-level under-standing of videos and human social behaviors to precisely forecast the future locations of pedestrians based on the ob-served trajectories and scenes.
Trajectory prediction requires simultaneous processing of spatial and temporal information. While walking paths naturally exhibit a temporal consistency, it is also impor-tant to model spatial interactions among pedestrians such as talking, grouping and avoiding collisions. Other objects (a) (c) (b) (d)
Figure 1. Illustration of multi-future trajectory prediction and ex-isting issues. The yellow and green lines are the observed and ground truth trajectories. (a) Multiple future trajectories (red ar-rows) influenced by different intentions and destinations. (b) Mul-tiple options of paths (orange arrows) heading to the same des-tination. (c) An imperfect prediction (with heatmap) in Multi-verse [24] that goes through a vehicle. (d) An imperfect prediction (with heatmap in the red circle) in Multiverse [24] that violates temporal consistency. in a scene also affect the future paths, as pedestrians tend to avoid obstacles (e.g., street lamps, trees, vehicles) or un-necessary change of paths (e.g., walk from the pavement to the middle of the road). However, reactions to spatial in-teractions may also undermine the original intentions based on temporal information. Even if both of them are properly processed, it is still a conundrum to predict spatially reason-able trajectories while conforming to temporal consistency.
Real-world datasets [2, 19, 30] have enabled the research on trajectory prediction and current approaches [11, 25] have made great progress on single-future trajectory predic-tion, where the predicted trajectories are evaluated against the ground truth trajectories recorded in the videos. How-ever, the human mind is capricious and realistic situations are complicated. Given an observed trajectory, there can be multiple different destinations and multiple plausible future trajectories. Fig. 1(a) demonstrates that multiple intentions
and destinations can drive the pedestrian at the bottom to walk in different paths. Fig. 1(b) shows the pedestrian can select different paths to the same destination.
To evaluate models that generate multiple possible tra-jectories, Liang et al. [24] recently proposed a simulated dataset named “Forking Paths”, which provides multiple ground truth trajectories for the same historical trajectory.
And in the same work, a two-stage end-to-end probabilistic model named “Multiverse” is designed for multi-future tra-jectory prediction. However, there are still some issues with this model. For example, Fig. 1(c) shows a path through the vehicle; Fig. 1(d) is an example of temporal inconsis-tent prediction which violates the normal pattern of human motion with a sharp turn.
In this paper, we propose an encoder-decoder network to address the aforementioned issues. To effectively pro-cess the spatial information, we first construct a multi-scale graph to represent scene segmentation and trajectory fea-tures. Then, we design a graph-based spatial transformer to learn the interactions between a pedestrian and other pedestrians as well as scene objects. Moreover, to integrate global temporal information, we develop a “Memory Re-play” algorithm, which utilizes a memory graph to accu-mulate temporal information and “replay” it to the trans-former at each time step to ensure the smoothness of tra-In addition, we propose a new evaluation met-jectories. ric “Percentage of Trajectory Usage” to evaluate the com-prehensiveness of multi-future prediction, to complement the existing minADEK and minFDEK metrics in [24]. We show that our model achieves state-of-the-art performance on multi-future prediction on the Forking Paths dataset; and our results on single-future prediction are comparable to the current state-of-the-art models on the VIRAT/ActEV [2] dataset. We summarize our main contributions as follows: 1. We propose a graph-based spatial transformer for spa-tial interactions of pedestrians. By integrating the attention mechanism and graph structure, the spatial transformer can comprehensively generate and aggre-gate spatial features. 2. We design a novel trajectory smoothing algorithm,
Memory Replay, for improving the temporal consis-tency of predicted trajectories and minimizing the con-flicts between spatial and temporal information. 3. We define a new evaluation metric, Percentage of Tra-jectory Usage (PTU), to evaluate the comprehensive-ness of multi-future prediction. 2.