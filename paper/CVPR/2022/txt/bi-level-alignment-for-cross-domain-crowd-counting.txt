Abstract
Recently, crowd density estimation has received increasing attention. The main challenge for this task is to achieve high-quality manual annotations on a large amount of training data. To avoid reliance on such annotations, pre-vious works apply unsupervised domain adaptation (UDA) techniques by transferring knowledge learned from easily accessible synthetic data to real-world datasets. However, current state-of-the-art methods either rely on external data for training an auxiliary task or apply an expensive coarse-to-fine estimation. In this work, we aim to develop a new adversarial learning based method, which is simple and efficient to apply. To reduce the domain gap between the synthetic and real data, we design a bi-level alignment framework (BLA) consisting of (1) task-driven data align-ment and (2) fine-grained feature alignment. In contrast to previous domain augmentation methods, we introduce Au-toML to search for an optimal transform on source, which well serves for the downstream task. On the other hand, we do fine-grained alignment for foreground and background separately to alleviate the alignment difficulty. We evaluate our approach on five real-world crowd counting bench-marks, where we outperform existing approaches by a large margin. Also, our approach is simple, easy to implement and efficient to apply. The code is publicly available at https://github.com/Yankeegsj/BLA. (a) Style Transfer (b) Domain Randomization and Task-Driven Data Alignment
Figure 1. Comparison of three different ways for source domain augmentation. (a). Style transfer translates images from source to a target-like domain based on target style priors, but the translation is usually limited to color changes, and blind to the task objective. (b). Domain randomization augments the source domain randomly in a more diverse manner (colors, scales, etc.) but without any pri-ors from target; our proposed task-driven data alignment is more similar to domain randomization; but instead of random selection, we pick the most suitable augmentation based on the task objec-tive, which enables a more dynamic and robust model to the target domain. 1.

Introduction
Crowd counting aims to estimate the number of persons in crowded scenes. This task has gained a lot of attention
[10, 17] as it is useful for video surveillance, traffic control and human behavior analysis. Especially under pandemics such as COVID-19, it can be used to monitor and regulate
*Corresponding author the flow of people for safety reasons.
In recent years, many methods have been proposed for crowd counting. Most state-of-the-art approaches rely on ground truth density maps for a large number of training images, with each human head marked. However, it is ex-tremely expensive to annotate so many human heads and for high-density regions such manual labels can be noisy.
To reduce annotations costs, a large-scale synthetic dataset
GTA5 Crowd Counting (GCC) [24] was created, serving as a well-established training set with automatic annotations.
However, models trained on the synthetic dataset perform poorly due to the large domain gap between synthetic and real-world images. Thus, it is necessary to investigate how to adapt the models trained on the synthetic domain to the real domain, without requiring annotations on the latter, i.e. via unsupervised domain adaptation (UDA).
There are a few UDA methods proposed for crowd counting. For instance, SE Cycle-GAN [24] translates syn-thetic images to the real domain with improved Cycle-GAN and then trains purely on the translated images; Gaus-sian Process-based iterative learning (GP) [22] generates pseudo-labels on the target images via a Gaussian process to allow for supervised training on the target domain. More re-cently, better performance has been achieved by employing an adversarial framework to align features from both source and target domains [5, 7]. However, FSC [7] introduces an auxiliary task of semantic segmentation, relying on external labeled human body segmentation datasets for pre-training;
FADA [5] performs a coarse-to-fine estimation, making the inference less efficient.
In this paper, we aim to develop a new adversarial learn-ing based method, which is more effective and flexible. We investigate the key components to boost performance. Pre-vious methods employed either domain randomization or style transfer for source domain augmentation, using no pri-ors or the target style priors only.
In contrast, our task-driven data alignment is able to control the domain aug-mentation based on both the target style priors and the task objective such that it is optimized for our crowd counting task on the given target domain. We show a comparison of three different source domain augmentation methods in
Fig. 1. On the other hand, since the foreground and back-ground regions differ significantly in semantics, we propose a fine-grained feature alignment to handle them separately.
To summarize, the contributions of our work are as fol-lows: (1) For more effective and efficient synthetic to real adaptive crowd counting, we propose a novel adversarial learning based method, consisting of bi-level alignments: task-driven data alignment and fine-grained feature align-ment. (2) To the best of our knowledge, it is the first UDA approach to search for the optimal source data transform based on the downstream task performance on the target domain. (3) Experimental results on various real datasets show that our method achieves state-of-the-art results for synthetic-to-real domain adaptation; also, our method is simple and efficient to apply. 2.