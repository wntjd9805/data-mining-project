Abstract
Most face relighting methods are able to handle diffuse shadows, but struggle to handle hard shadows, such as those cast by the nose. Methods that propose techniques for handling hard shadows often do not produce geomet-rically consistent shadows since they do not directly lever-age the estimated face geometry while synthesizing them.
We propose a novel differentiable algorithm for synthesizing hard shadows based on ray tracing, which we incorporate into training our face relighting model. Our proposed al-gorithm directly utilizes the estimated face geometry to syn-thesize geometrically consistent hard shadows. We demon-strate through quantitative and qualitative experiments on
Multi-PIE and FFHQ that our method produces more geo-metrically consistent shadows than previous face relighting methods while also achieving state-of-the-art face relight-ing performance under directional lighting. In addition, we demonstrate that our differentiable hard shadow modeling improves the quality of the estimated face geometry over diffuse shading models. 1.

Introduction
Single image face relighting is a problem of great interest among the computer vision and computer graphics commu-nities. Relighting consumer photos has been a major driving factor in motivating the problem given widespread interest in photo editing. Face relighting also has applications in other areas such as Augmented Reality (AR) [29], where it can be used to modify facial illuminations to match the en-vironment lighting, and face recognition [16, 33], where it can relight images to frontal illuminations. It is thus rele-vant both for consumer interests and entertainment and for security applications such as authentication.
Earlier relighting methods [35, 43, 54] tend to make the simpliﬁed assumption that light is naturally scattered by the environment and thus diffuse in nature, and that human skin is a lambertian material. While this is sufﬁcient to model
*All of the data mentioned in this paper was downloaded and used at
Michigan State University. a) Input Image b) Target Image c) Hou [10] d) Proposed
Figure 1. Overview. We introduce a novel face relighting method that produces geometrically consistent shadows. By proposing a differentiable algorithm based on the principles of ray tracing that directly uses the face geometry for modeling hard shadows, our method produces physically correct hard shadows which the state-of-the-art face relighting method, Hou et al. [10], cannot produce. general lighting directions and soft shadows, it does not ac-count for non-lambertian effects such as hard shadows from strong directional lights. This is highly problematic since many light sources in the real world (e.g. the sun) are best modeled as directional lights. In AR/VR, the environment lighting is often also set to be directional lights. In order to enhance photorealism both for in-the-wild consumer photos and in AR/VR, proper hard shadow modeling is a necessity.
One important problem in face relighting is thus han-dling hard shadows. Most existing methods do not handle non-diffuse lighting and are unable to synthesize realistic hard shadows [35,43,54]. They generally use smooth light-ing conditions such as low-order Spherical Harmonics (SH) and train on images with diffuse lighting. While many illu-mination conditions in the wild are ambient or area-based, these assumptions do not account for the interactions of strong directional lights and point lights, which produce hard shadows. Among current methods that do model hard shadows [10, 29, 30], none are able to guarantee geometri-cally consistent cast shadows since they do not directly uti-lize the estimated face geometry to generate them. Without using the geometry directly, the shape of the cast shadows, such as those cast by the nose, may be incorrect.
We introduce a novel differentiable algorithm to estimate
the locations of cast shadows using the principles of ray tracing. We rely on the principle that cast shadows will be located on parts of the face where the projected ray to the light source intersects some occluding surface, such as the nose. Our method can thus leverage the estimated face geometry to produce geometrically consistent hard shad-ows (see Fig. 1). We further demonstrate that differentiably modeling hard shadows can improve the quality of the face geometry, especially in regions that produce hard shadows (e.g. the nose and near the boundary of the face), compared to models that assume diffuse shading. We therefore show that differentiable hard shadow modeling not only beneﬁts the realism of the relit image, but also the intrinsic compo-nent estimation which can beneﬁt other downstream tasks.
Our proposed method thus has four main contributions: (cid:5) We propose a single image face relighting method that can produce geometrically consistent hard shadows. (cid:5) We introduce a novel differentiable algorithm to esti-mate facial cast shadows based on the estimated geometry. (cid:5) We achieve SoTA relighting performance on 2 bench-marks quantitatively/qualitatively under directional lights. (cid:5) Our differentiable hard shadow modeling improves the estimated geometry over models that use diffuse shading. 2.