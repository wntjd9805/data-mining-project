Abstract
The large-scale whole-slide images (WSIs) facilitate the learning-based computational pathology methods. How-ever, the gigapixel size of WSIs makes it hard to train a conventional model directly. Current approaches typically adopt multiple-instance learning (MIL) to tackle this prob-lem. Among them, MIL combined with graph convolutional network (GCN) is a significant branch, where the sampled patches are regarded as the graph nodes to further discover their correlations. However, it is difficult to build corre-spondence across patches from different WSIs. Therefore, most methods have to perform non-ordered node pooling to generate the bag-level representation. Direct non-ordered pooling will lose much structural and contextual informa-tion, such as patch distribution and heterogeneous patterns, which is critical for WSI representation. In this paper, we propose a hierarchical global-to-local clustering strategy to build a Node-Aligned GCN (NAGCN) to represent WSI with rich local structural information as well as global distribu-tion. We first deploy a global clustering operation based on the instance features in the dataset to build the corre-spondence across different WSIs. Then, we perform a lo-cal clustering-based sampling strategy to select typical in-stances belonging to each cluster within the WSI. Finally, we employ the graph convolution to obtain the represen-tation. Since our graph construction strategy ensures the alignment among different WSIs, WSI-level representation can be easily generated and used for the subsequent classi-fication. The experiment results on two cancer subtype clas-sification datasets demonstrate our method achieves better performance compared with the state-of-the-art methods. 1.

Introduction
Histopathology plays an essential role in the clinical di-agnosis and understanding of the underlying reasons for
*Equal contribution. Y. Guan interned at Tencent AI Lab.
†Corresponding authors. specific treatments being deployed [35]. Whole-slide imag-ing, as the technique that translates the tissue specimens on glass slides into digital format without losing the tissue information, provides a comprehensive view of individual diseases and their effects on human tissues. Nowadays, the massive amount of whole-slide images (WSIs) makes the field of computational pathology an important application scenario for deep-learning-based computer aided diagnos-tic systems [14, 17, 18, 23, 27, 36, 39]. the characteristics of pathological
WSI classification is a fundamental task in digital pathol-ogy. However, im-ages pose unique challenges for deep-learning-based ap-proaches. For example, the ultra-high resolution of WSIs prevents them from being directly fed into deep neural net-works due to the huge memory consumption. In addition, since manual annotations require non-trivial effort and do-main knowledge from pathologists, usually only slide-level labels are available and pixel- or region-level annotations are missing. To tackle these challenges, current methods often adopt a two-stage multiple-instance learning (MIL) paradigm. In the first stage, a group of disjoint or overlap-ping ”tissue patches” cropped from WSIs are encoded into semantic features using an encoder. Then an aggregation algorithm is designed to integrate these instance-level fea-tures to obtain a bag-level (slide-level) representation.
There exist different ways of aggregating patch-level fea-tures. A simple yet efficient strategy is to directly pool the patch features in one WSI [12, 42]. However, WSIs con-tain tissues of varying morphologies and types. Brute force pooling of all patch features will dilute distinctive features, thus resulting in an inadequate representation of WSI. Bag of visual words (BOVW) is another classical method to de-scribe images, which has been widely used in image repre-sentation, classification and retrieval [13,44]. It provides an intuitive way to build descriptions for unstructured image data. Compared with pooling-based methods, BOVW can well delineate the global representation of WSI.
Despite the concise and straightforward definition, both pooling-based and BOVW-based methods are pre-defined and non-trainable. Recent approaches typically employ at-tention mechanisms to aggregate patch-level features, in which a trainable neural network is used to fit the weights of instances and then take the weighted average sum of all in-stance features as WSI representation. However, attention-based approach is essentially a weighted linear combina-tion of instances, which lacks the ability to reflect structural and contextual information of WSIs. Besides, since one
WSI usually contains thousands of patches, the vast number of redundant patches will make attention-based approaches computationally costly.
Graph-based MIL approach is another significant branch for weakly-supervised classification of WSIs, which em-ploys graphs to model the instance relationship and depict
WSI representation. Graph convolution network (GCN) provides a powerful analytical paradigm for MIL and histopathology image, which first selects the important in-stances using a sampling strategy such as feature similar-ity, cell density or attention mechanisms, and then con-structs a graph where graph nodes are selected instances and edges are the intrinsic relationship among instances [1, 37].
Adopting graphs to represent WSIs can reflect the complex contextual information, establish the dependency relation-ship between patches and reduce the gap between different data, which can be important for WSI diagnosis. However, existing graph-based WSI classification methods cannot en-sure the correspondence of graphs nodes derived from dif-ferent WSIs, which results in performing non-ordered pool-ing for global representation and classification.
In order to retain local structural information as well as global distribution, we propose a hierarchical global-to-local clustering strategy to build a Node-Aligned GCN (NAGCN§) for whole-slide image representation and classi-fication. First, to filter out redundant information and select discriminative instances, we borrow the idea from BOVW and construct a codebook by leveraging a global clustering operation to instance features in the dataset. The codebook is comprised of amounts of visual words, where each vi-sual word corresponds to a specific tissue type. Through the global clustering, we can divide instances from WSI bags into distinct sub-bags (each sub-bag corresponds to a visual word) and build correspondence across different
WSIs at the sub-bag level. Second, we perform a lo-cal clustering-based sampling strategy to select typical in-stances within sub-bags for each WSI and use them as graph nodes. Finally, different from BOVW which only uses a non-trainable frequency histogram to represent WSIs, we deploy the node-aligned graph to achieve trainable WSI em-beddings. Since our graph construction strategy ensures the alignment among different WSIs, WSI-level representation can be easily generated, which can be used for the subse-quent classification.
We summarize our technical contributions as follows:
§GitHub repository: https://github.com/YohnGuan/NAGCN 1. We introduce a novel node-aligned GCN for WSI rep-resentation and classification with only slide-level an-notations. Compared with other graph-based MIL methods that have to perform non-ordered pooling to generate slide-level representation, our aligned graphs can establish node correspondence among WSIs, thus having more options to get the global representation, such as flattening the nodes. 2. We leverage global clustering to divide instances from
WSI bags into distinct sub-bags and achieve corre-spondence at the sub-bag level across different WSIs.
The pre-built codebook can well distinguish the patho-logical structures and partially reflect the tissue distri-bution. 3. We propose a local-clustering-based sub-bag genera-tion strategy, which can sparsely sample typical in-stances within sub-bags. Combined with global clus-tering, the hierarchical global-to-local clustering can retain both local structural information and global dis-tribution. 2.