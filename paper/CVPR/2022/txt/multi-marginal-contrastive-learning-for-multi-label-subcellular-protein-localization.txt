Abstract
Protein subcellular localization(PSL) is an important task to study human cell functions and cancer pathogene-sis. It has attracted great attention in the computer vision community. However, the huge size of immune histochemi-cal (IHC) images, the disorganized location distribution in different tissue images and the limited training images are always the challenges for the PSL to learn a strong gener-alization model with deep learning. In this paper, we pro-pose a deep protein subcellular localization method with multi-marginal contrastive learning to perceive the same
PSLs in different tissue images and different PSLs within the same tissue image. In the proposed method, we learn the representation of an IHC image by fusing the global fea-tures from the downsampled images and local features from the selected patches with the activation map to tackle the oversize of an IHC image. Then a multi-marginal attention mechanism is proposed to generate contrastive pairs with different margins and improve the discriminative features of PSL patterns effectively. Finally, the ensemble prediction of each IHC image is obtained with different patches. The results on the benchmark datasets show that the proposed method achieves signiﬁcant improvements for the PSL task. 1.

Introduction
The protein subcellular localization(PSL) is essential to interpret and identify the functions of the proteins for re-vealing the pathology, which can provide valuable infor-mation in the target identiﬁcation process for drug discov-ery [33, 42]. Analyzing the spatial distributions of human proteins at the subcellular level can help us understand hu-man biology and diseases [14, 27, 32]. For example, the proteins localizing at mitochondria are likely to have the
*Corresponding author.
Liver
Kidney
Membranous Nuclear
Cytoplasmic
Figure 1.
IHC images from liver and kidney show that general structures from two tissues are quite different. The same proteins are displayed on both images using chemical dyes. The PSL labels of both images are nuclear membrane and cytoplasmic. Due to the dyed proteins in cytoplasmic, most of the images are brown.
The below detailed image shows that proteins also exist on nuclear membranes. functions of cellular aerobic respiration and energy produc-ing [13]. It also has demonstrated that the abnormalities of subcellular locations of protein are potentially involved in the pathogenesis of many human diseases [8, 22]. More-over, studying the occurrence of the protein mislocalization under normal and cancer states can help discover and deﬁne cancer markers [10].
However, methods that rely on human experts to recog-nize PSLs, such as wet-lab biological approaches, are time-consuming and expensive. Machine learning is widely used in subcellular pattern recognition to make annotations ef-In the past two decades, many studies have fo-ﬁciently. cused on PSL in combination with machine learning tech-niques [21]. According to the data type for PSL, the related researches can be roughly divided into two categories: a) models based on the amino acid sequence and b) models
based on protein high-throughput microscopic images.
Considering that protein functions depend on the amino acid sequence [1, 3, 7], sequence information is obtained to predict protein subcellular locations [15,19]. However, such methods have low sensitivity in the detection of the dynamic protein translocation, which has been proven to be essential in identifying cancerous biomarkers [2, 4, 16].
Image-based methods usually learn protein distributions with high-throughput microscopic images. Proteins are dis-played on images by using chemical dyes or ﬂuorescence, which clearly and concisely reﬂects protein distributions and spatial expression information [40]. The immunoﬂuo-rescence (IF) images [24] or immunohistochemistry (IHC) images are two popular images for PSL task.
IF images usually need to segment cell cultures or tissue images into single cells, and this task is remarkably challenging [26].
Tissue-based IHC images can show protein distributions from the tissue level to the cell level. Hence, IHC image has been the important source data for PSL task [34]. Com-pared to the sequence data, IHC images are conducive to studying PSL in healthy and diseased tissues [9].
We show the IHC images from the liver and kidney with the same dyed proteins in Figure 1. From Figure 1, we note that the morphological structures of cells in different tis-sues are very different despite they having the same PSL.
It also should note that the different PSLs in a tissue image may have similar morphological structures. In the light of the fact that nearly 20% of human proteins coexist in more than one subcellular location, many methods are developed for the PSL problem based on multi-label learning [28, 38].
However, the morphological structures with the same PSL cross tissue images and the subcellular differences within a tissue image make it hard to distinguish the distributions of different PSLs, and it is still a challenge to improve the performance of the multi-label PSL methods [26].
In this paper, we propose a new deep learning algorithm, termed the DeePSLoc, to identify protein subcellular loca-tions by using IHC images. To handle the huge size of IHC images, we propose to extract the feature of IHC images with downsampled images and cropped patches. The down-sampled image is used to keep the global features of IHC image while the cropped patches are used to keep the de-tails of the structures in the IHC image. Speciﬁcally, we use the downsampled image to generate an activation map.
Since the activation maps focus on the different morpholog-ical structures of the tissues, we select the cropped patches with the highest activation values. Then the global features and the local features can be effectively obtained to capture the morphological and subcellular differences.
To learn the discriminative features of different PSLs, we propose a multi-marginal contrastive learning method in the DeePSLoc architecture, denoted as multi-marginal attention mechanism. The multi-marginal attention mech-anism is derived from the self-attention mechanism. We use the contrastive loss with different margins to train such a mechanism. For each margin, we obtain an assignment matrix in which the elements represent how much does the sample pair improve the discriminative ability of fea-tures with contrastive learning. With all the positive sam-ples that have the same labels as the anchor sample, we can obtain a positive assignment matrix. Then we gener-ate a positive sample by the weighted average of the orig-inal positive samples for contrastive learning and the ele-ments in the assignment matrix are treated as weights. With different margins, we can generate a set of positive sam-ples as well as negative samples for contrastive learning.
In fact, these generated contrastive samples have consid-ered the different distributions by learning with different margins. Hence, the contrastive structure effectively re-duces the inﬂuence of different tissue morphologies whose proteins have the same subcellular locations. The code and models of DeePSLoc are made publicly available at https://github.com/ziniBRC/DeePSLoc. The main contributions of the paper can be summarized as:
• DeePSLoc develops an exciting framework to solve the huge size challenge of IHC images for PSL. It can learn the morphological and subcellular features of IHC images effectively.
• Inspired by the self-attention mechanism, we propose a novel multi-marginal contrastive learning method to generate the contrastive pairs, which can greatly im-prove the robustness and performance of deep network for PSL. To the best knowledge, this is the ﬁrst time to weightly aggregate original samples for generating contrastive pairs using attention mechanism.
• The proposed method outperforms the state-of-the-art methods signiﬁcantly in both single- and multi-label datasets.
The rest of the paper is organized as follows.