Abstract
Learning-based optical flow estimation has been domi-nated with the pipeline of cost volume with convolutions for flow regression, which is inherently limited to local corre-lations and thus is hard to address the long-standing chal-lenge of large displacements. To alleviate this, the state-of-the-art framework RAFT gradually improves its predic-tion quality by using a large number of iterative refinements, achieving remarkable performance but introducing linearly increasing inference time. To enable both high accuracy and efficiency, we completely revamp the dominant flow re-gression pipeline by reformulating optical flow as a global matching problem, which identifies the correspondences by directly comparing feature similarities. Specifically, we propose a GMFlow framework, which consists of three main components: a customized Transformer for feature enhancement, a correlation and softmax layer for global feature matching, and a self-attention layer for flow propa-gation. We further introduce a refinement step that reuses
GMFlow at higher feature resolution for residual flow pre-diction. Our new framework outperforms 31-refinements
RAFT on the challenging Sintel benchmark, while using only one refinement and running faster, suggesting a new paradigm for accurate and efficient optical flow estimation.
Code is available at https://github.com/haofeixu/gmflow. 1.

Introduction
Since the pioneering learning-based work, FlowNet [10], optical flow has been regressed with convolutions for a long time [15–17, 31, 36, 39, 46, 51]. To encode the match-ing information into the network, the cost volume (i.e., correlation) [13] was shown to be an effective component and thus has been extensively used in popular frameworks
[16, 36, 39]. However, such regression-based approaches have one major intrinsic limitation. That is, the cost volume requires a predefined size, as the search space is viewed as the channel dimension for subsequent regression with con-*Work done during Haofei’s internship at JD Explore Academy
Figure 1. Conceptual comparison of flow estimation ap-proaches. Most previous methods regress optical flow from a local cost volume (i.e., correlation) with convolutions, while we perform global matching with a Transformer and differentiable matching layer (i.e., correlation and softmax). volutions. This requirement restricts the search space to a local range, making it hard to handle large displacements.
To alleviate the large displacements issue, RAFT [39] proposes an iterative framework with a large number of it-erative refinements where convolutions are applied to dif-ferent local cost volumes at different iteration stages so as to gradually reach near-global search space, achieving out-standing performance on standard benchmarks. The cur-rent state-of-the-art methods [17,39,46,51] are all based on such an iterative architecture. Despite the excellent perfor-mance, such a large number of sequential refinements in-troduce linearly increasing inference time, which makes it hard for speed optimization and hinders its deployment in real-world applications. This raises a question: Is it pos-sible to achieve both high accuracy and efficiency without requiring such a large number of iterative refinements?
We notice that another visual correspondence problem, i.e., sparse matching between an image pair [34, 38, 43], which usually features a large viewpoint change, moves into a different track. The top-performing sparse methods (e.g.,
SuperGlue [34] and LoFTR [38]) adopt Transformers [41] to reason about the mutual relationship between feature de-scriptors, and the correspondences are extracted with an ex-plicit matching layer (e.g., softmax layer [43]).
Inspired by sparse matching, we propose to completely remove the additional convolutional layers operating on a predefined local cost volume, and reformulate optical flow
as a global matching problem, which is distinct from all previous learning-based optical flow methods. Fig. 1 pro-vides a conceptual comparison of these two flow estimation approaches. Our flow prediction is obtained with a differ-entiable matching layer, i.e., correlation and softmax layer, by comparing feature similarities. Such a formulation calls for more discriminative feature representations, for which the Transformer [41] becomes a natural choice.
We would like to point out that although our pipeline shares the conceptual major components (i.e., Transfromer and the softmax matching layer) with sparse matching [34, 38], our motivation is originated from the development of optical flow methods and the challenges associated with formulating optical flow as a global matching problem are quite different. Optical flow focuses on dense correspon-dences for every pixel and modern learning-based architec-tures are mostly designed by regression from a local cost volume. The scale and complexity of optical flow are much higher. Moreover, optical flow needs to deal with occluded and out-of-boundary pixels, for which the simple softmax-based matching layer will not be effective.
In this paper, we propose a GMFlow framework to real-ize the global matching formulation for optical flow. Specif-ically, the dense features extracted from a convolutional backbone network are fed into a Transformer that consists of self-, cross-attentions and feed-forward network to ob-tain more discriminative features. We then compare the feature similarities by correlating all pair-wise features. Af-ter that, the flow prediction is obtained with a differentiable softmax matching layer. To address occluded and out-of-boundary pixels, we incorporate an additional self-attention layer to propagate the high-quality flow prediction from matched pixels to unmatched ones by exploiting the feature self-similarity [17]. We further introduce a refinement step that reuses GMFlow at higher feature resolution for resid-ual flow prediction. Our full framework achieves compet-itive performance and higher efficiency compared with the state-of-the-art methods. Specifically, with only one refine-ment, GMFlow outperforms 31-refinements RAFT on the challenging Sintel [4] dataset, while running faster.
Our major contributions can be summarized as follows:
• We completely revamp the dominant flow regression pipeline by reformulating optical flow as a global matching problem, which effectively addresses the long-standing challenge of large displacements.
• We propose a GMFlow framework to realize the global matching formulation, which consists of three main components: a Transformer for feature enhancement, a correlation and softmax layer for global feature match-ing, and a self-attention layer for flow propagation.
• We further propose a refinement step to exploit higher resolution feature, which allows us to reuse the same
GMFlow framework for residual flow estimation.
• GMFlow outperforms 31-refinements RAFT on the challenging Sintel benchmark, while using only one refinement and running faster, suggesting a new paradigm for accurate and efficient flow estimation. 2.