Abstract
Learning-based image dehazing methods have achieved marvelous progress during the past few years. On one hand, most approaches heavily rely on synthetic data and may face difficulties to generalize well in real scenes, due to the huge domain gap between synthetic and real images. On the other hand, very few works have considered the varicolored haze, caused by chromatic casts in real scenes. In this work, our goal is to handle the new task: real-world varicolored haze removal. To this end, we propose a physically disentan-gled joint intra- and inter-domain adaptation paradigm, in which intra-domain adaptation focuses on color correction and inter-domain procedure transfers knowledge between synthetic and real domains. We first learn to physically disentangle haze images into three components complying with the scattering model: background, transmission map, and atmospheric light. Since haze color is determined by atmospheric light, we perform intra-domain adaptation by specifically translating atmospheric light from varicolored space to unified color-balanced space, and then reconstruct-ing color-balanced haze image through the scattering model.
Consequently, we perform inter-domain adaptation between the synthetic and real images by mutually exchanging the background and other two components. Then we can recon-struct both identity and domain-translated haze images with self-consistency and adversarial loss. Extensive experiments demonstrate the superiority of the proposed method over the state-of-the-art for real varicolored image dehazing. 1.

Introduction
Haze, as a common weather phenomenon, would result in low contrast and severe visibility degradation, which not only leads to poor visual quality but also does serious harm to high-level vision tasks, such as scene classification [35], object detection [25] and semantic segmentation [41]. The
*Corresponding author.
Figure 1. The visual examples of dehazing results for real-world varicolored haze images. The second and third column show the results of DA-Dehazing [42] and proposed method, respectively. haze procedure can be mathematically formulated via the well-known atmosphere scattering model [29, 34]:
I(x) = J(x)t(x) + A(1 − t(x)), (1) where I(x) is observed haze image, and J(x) is haze-free background to be restored. A and t(x) = e−βd(x) denote atmospheric light and transmission map, and β and d(x) represent scattering coefficient and depth respectively. The goal of dehazing is to estimate J(x) from hazy input I(x).
The image dehazing has been extensively studied during the past few years [6, 7, 11, 18, 25, 28, 31, 39, 50]. Benefitting from powerful representation ability of convolutional neural networks (CNNs), CNN-based supervised learning methods have made marvelous progress [8, 12, 13, 32, 37, 45]. Since it is difficult to obtain labeled clean groundtruth, it is widely accepted to simulate paired clean/haze images via the scat-tering model for CNN training. However, the inter-domain gap between real and synthetic data makes these supervised methods hard to generalize well for the real haze images. To overcome this issue, the semi-supervised [9, 27, 33, 42] and the unsupervised dehazing methods [17, 23, 24, 30, 46, 47] have been naturally proposed. The unsupervised methods mainly utilize the prior knowledge of the real images by min-imizing the unsupervised loss function, such as dark channel prior [18]. The semi-supervised methods not only utilize real images but also incorporate synthetic images for network training. The researchers [9, 27, 33, 42] mainly adopt the domain adaptation technique to transfer the knowledge from synthetic domain to the real haze domain. Although these methods have greatly alleviated the inter-domain shift issue, few of them have considered the intra-domain issue, namely the varicolored haze space in real-world scenes.
The varicolored haze is mainly caused by various parti-cles with different sizes and scattering characteristics [14], as shown in Fig. 1. Most of the previous methods employ the hand-crafted white balance and contrast enhancement tech-niques to eliminate the color distortion [1, 2, 19]. Recently, the learning-based varicolored image dehazing methods have been proposed [14, 40]. For example, Dudhane et al. [14] proposed a color correction module based on gray world assumption [38] to better estimate accurate illumination and restore color distortion. However, these supervised methods mainly utilize synthetic datasets for training, which may face difficulties in handling varicolored haze in real scenes. To our knowledge, we are the first to simultaneously consider the intra-domain gap within varicolored haze spaces and the inter-domain gap between synthetic and real images.
In this work, we formulate the challenging varicolored real hazy removal task into two easier yet physical meaning sub-problems and propose the physically disentangled joint intra- and inter-domain adaptation (PDI2A) framework for semi-supervised varicolored dehazing, as shown in Fig. 2.
Our model consists of three parts: two intra-domain adapta-tions for color correction on both real and synthetic inputs, and an inter-domain adaptation for cycle synthetic↔real translation. Specifically, in intra-domain adaptation, we dis-entangle haze image via scattering model and align color in simpler scalar space, not directly in complex image space. In inter-domain adaptation, disentanglement strategy is also employed to ease translation difficulty. Both physical-and learning-based reconstruction are designed to exchange knowledge between synthetic&real data for semi-supervised learning. Moreover, we apply self-consistency and adversar-ial loss for better information preserving and translation. We summarize the main contributions as follows:
• Our work focuses on a novel yet practical task: varicolored image dehazing in real scenes. Compared with existing methods which consider either intra-domain (varicolored spaces) or inter-domain gap (synthetic and real spaces), we are the first to joint consider both gaps simultaneously.
• We propose a semi-supervised joint intra- and inter-domain adaptation framework, which divides the challeng-ing varicolored real image dehazing into two easier yet physical meaning subproblems: intra-domain color align-ment and inter-domain synthetic-to-real haze removal, significantly easing the learning procedure.
• We propose to resolve the color/hazy artifacts in the sim-pler disentangled space, not the complex image space, in which the consistent background is well preserved and only the critical haze characteristics are transferred, sig-nificantly easing the translation difficulty. Extensive ex-periments on real and synthetic data demonstrate the supe-riority of our method both quantitatively and qualitatively. 2.