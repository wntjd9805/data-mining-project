Abstract
Deformable image registration (DIR), aiming to find spatial correspondence between images, is one of the most critical problems in the domain of medical image analysis. In this paper, we present a novel, generic, and accurate diffeomor-phic image registration framework that utilizes neural ordi-nary differential equations (NODEs). We model each voxel as a moving particle and consider the set of all voxels in a 3D image as a high-dimensional dynamical system whose trajectory determines the targeted deformation field. Our method leverages deep neural networks for their expressive power in modeling dynamical systems, and simultaneously optimizes for a dynamical system between the image pairs and the corresponding transformation. Our formulation al-*Equal contribution. lows various constraints to be imposed along the transfor-mation to maintain desired regularities. Our experiment results show that our method outperforms the benchmarks under various metrics. Additionally, we demonstrate the feasibility to expand our framework to register multiple im-age sets using a unified form of transformation,which could possibly serve a wider range of applications. 1.

Introduction
Deformable image registration (DIR) is a process for estab-lishing spatial correspondences between images. The term
“deformable” points to the nonlinear and dense nature of the required transformation. DIR has a broad range of applica-tions including normalization of population studies, quanti-fying changes in longitudinal imaging, accounting for mo-1
tions of organ, as a building block of other image analy-sis algorithms, etc. While there is usually no ground-truth for the optimal transformation, image registration is usually formulated according to and evaluated on three criteria: the accuracy of matching the source and target images in terms of a pre-defined similarity metric, the regularity of the trans-formation to ensure that it is well-behaved, such as topology preservation, and the speed of the algorithm [34, 37].
Traditional approaches solve DIR as a pair-wise op-timization problem. These methods enforce transforma-tion regularity through hard model assumptions. For ex-ample, Large Deformation Diffeomorphic Metric Mapping (LDDMM) [7, 23], one of the most influential approaches, solves for diffeomorphisms by formulating the registration problem using a flow Partial Differential Equation (PDE), where the intergral of time-varying velocity fields produces the final deformation. These methods, however, can be challenging to apply if both speed and accuracy are desired, and they potentially limit the performance if different model assumptions are needed [34].
With rapid advancement in machine learning and abun-dance of medical imaging data, there is increased interest in developing deep learning based methods to solve the DIR problem [6, 11, 12, 25, 45]. These methods significantly reduce the runtime of registration through using neural net-works to learn a good sharing representation of a training dataset. Registration on a new image pair then becomes a rapid inference process. However, the generalizablity to un-seen data is a long-standing challenge of recent data driven learning based methods, precluding their straightforward application in practice.
Recent development in scientific machine learning has shown promising results in modeling differential equations using neural networks [17, 47], which can describe any sys-tem that evolves with “time”. Given the demonstrated utility of flow-based approaches as in LDDMM [7] and the known advantages in expressive power of deep neural networks, we ask: can we integrate the merits of both? We attempt to analyze this possibility from the following perspectives. (i) The image registration problem can be viewed as a system-identification problem. Specifically, our task is to find a differential equation whose solution gives the trans-formation between the images. By imposing few assump-tions on the dynamical system, we are able to explore var-ious classes of systems and their solutions to achieve the desired registration while ensuring certain solution proper-ties on demand, such as topology preservation. (ii) Traditional model-based approaches are naturally constrained by the models they assume and implement. The hard constraints imposed by a given model may potentially be relaxed for better model capacity and regularity. In par-ticular, a learnable flow that allows for penalties on its tra-jectory may serve as an alternative framework. (iii) Adopting deep learning in DIR may not require ad-ditional data. The expressive power of deep learning stems from its compositional rule of functions. Much of the ex-isting DL-based registration work builds on the foundations of feature learning, which learns the map or flow from su-pervised labels or a sufficient number of image pairs. An-other easily overlooked utility of neural networks is they can serve as a ’parametric’ backbone for general optimiza-tion problems. For the DIR problem, we can use a network to parameterize the system we aim to identify in (i-ii).
Motivated by the analysis above, we propose NODEO, a neural ordinary differential equation based optimization framework that formulates the velocity field optimization as a neural network optimization. Specifically, we treat the set of all pixel/voxel locations in an image as one single evolving system, and parametrize the system’s evolving dy-namics with a deep neural network. The registration task therefore becomes finding a system whose trajectory’s end point is the deformation field that minimizes the dissimilar-ity between images.
The benefits of our approach are twofold. First, start-ing from the generalized flow field approach and then spe-cializing to image registration, our framework provides enhanced flexibility. Our framework makes embedding proper dynamical constraints (such as spatial smoothness) straightforward, allowing flexibility in terms of defining task-specific “goodness” for our transformations, and pro-ducing solutions with the desired properties. We can also easily incorporate boundary conditions on demand. By im-posing loss penalties on the intermediate states of the tra-jectory, our model permits great flexibility in the type and number of assumptions one can impose on the solution.
Thus, our framework is straightforward to extend from im-age pairs to multiple-image sets by adding intermediate su-pervision. Second, we explicitly model the image grid as one high-dimensional system, so that convolutional layers can be naturally leveraged to allow particles to spatially in-teract with each other within the system dynamics. The pro-posed solution brings the full expressive power of neural nets, as demonstrated in Figure 1. Note that our approach falls under the family of pair-wise optimization approaches, i.e. network parameters are optimized without any addi-tional data.
Overall, the contributions of this paper are: (1) gener-alization of the flow field approach to registration through high-dimensional dynamical system modeling, (2) unifying the optimization problem of discovering differential equa-tions and their solutions (velocity fields) in one network without training data, (3) enhanced flexibility and effective-ness of adding desired regularizations and constraints on so-lution transformations, and (4) demonstration that the pro-posed framework can be serve as an alternative approach to optimization-based registration tool that have proven utility 2
across numerous application domains, with state-of-the-art performance over a variety of evaluation metrics. 2.