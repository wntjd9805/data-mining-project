Abstract
This paper probes intrinsic factors behind typical failure cases (e.g. spatial inconsistency and boundary confusion) produced by the existing state-of-the-art method in face parsing. To tackle these problems, we propose a novel De-coupled Multi-task Learning with Cyclical Self-Regulation (DML-CSR) for face parsing. Specifically, DML-CSR de-signs a multi-task model which comprises face parsing, bi-nary edge, and category edge detection. These tasks only share low-level encoder weights without high-level inter-actions between each other, enabling to decouple auxiliary modules from the whole network at the inference stage. To address spatial inconsistency, we develop a dynamic dual graph convolutional network to capture global contextual information without using any extra pooling operation. To handle boundary confusion in both single and multiple face scenarios, we exploit binary and category edge detection to jointly obtain generic geometric structure and fine-grained semantic clues of human faces. Besides, to prevent noisy la-bels from degrading model generalization during training, cyclical self-regulation is proposed to self-ensemble several model instances to get a new model and the resulting model then is used to self-distill subsequent models, through al-ternating iterations.
Experiments show that our method achieves the new state-of-the-art performance on the Helen,
CelebAMask-HQ, and Lapa datasets. The source code is available at https://github.com/deepinsight/ insightface/tree/master/parsing/dml_csr. 1.

Introduction
Face parsing, as a fine-grained semantic segmentation task, intends to assign a pixel-wise label for each facial component, e.g., eyes, nose, and mouth. The detailed anal-ysis of semantic facial parts is essential in many high-level applications, such as face swapping [28], face editing [15],
This work is done when Qingping Zheng is an intern at Huawei.
Image
GT
EAGRNet
Ours
Image
GT
Image
GT
Figure 1. The first three rows show typical failure cases of spatial inconsistency and boundary confusion when applying EARGNet
[36] to face parsing. The last row displays noisy labels on the training datasets. and facial makeup [29]. Benefit from the learning capac-ity of deep Convolutional Neural Networks (CNNs) and the labor effort put in pixel-level annotations [15, 21, 35], methods based on Fully Convolutional Networks (FCNs)
[7, 10, 18–20, 23, 36, 47, 48] have achieved a promising per-formance on the fully supervised face parsing. Neverthe-less, the local characteristic of the convolutional kernel pre-vents FCNs from capturing global contextual information
[25], which is crucial for semantically parsing facial com-ponents in an image.
To address this issue, most of the region-based face pars-ing methods [10,20,47] integrate CNN features into variant
CRFs to learn global information. However, these methods do not consider the correlation among various objects. To this end, Te et al. [36] proposes the EAGRNet method to model a region-level graph representation over a face image by propagating information across all vertices on the graph.
Even though EAGRNet enables reasoning over non-local regions to get global dependencies between distant facial
components and achieves state-of-the-art performance, it still faces the problems of spatial inconsistency and bound-ary confusion. In EAGRNet, PSP module [45] adopts an av-erage pooling layer [22] to capture the global context prior, leading to an inconsistent spatial topology. Moreover, EA-GRNet integrates additional clues of binary edges into con-text embedding to improve the parsing results. However, it is hard for EAGRNet to handle boundaries between highly irregular facial parts (e.g. hair and cloth in Figure 1) and dis-tinguish clear boundaries between different face instances in the crowded scenarios (multi-faces in Figure 1).
Besides, learning a reliable model for face parsing re-quires accurate pixel-level annotations. Nonetheless, there inevitably exist careless manual labeling errors on the train-ing dataset as shown in the last row of Figure 1. Te et al. [36] employ the traditional fully supervised learning scheme to train EAGRNet, failing to locate label noise be-cause all pixels in the ground truth are processed equally.
Notably, overlooking such incomplete annotations restricts the model generalization and prevents the performance from increasing to a higher level.
In this paper, we propose an end-to-end face parsing method, which is based on Decoupled Multi-task Learn-ing with Cyclical Self-Regulation (DML-CSR). Specifi-cally, given an input of facial image, the ResNet-101 [8] pre-trained on ImageNet is taken as the backbone to extract features from different levels. Afterwards, our multi-task model consists of three tasks, namely face parsing, binary edge detection, and category edge detection. These tasks share low-level weights from the backbone but do not have high-level interactions. Therefore, our multi-task learning approach can detach additional edge detection tasks from face parsing at the inference stage. To tackle spatial incon-sistency raised by the pooling operation, we develop a Dy-namic Dual Graph Convolutional Network (DDGCN) in the face parsing branch to capture long-range contextual infor-mation. The proposed DDGCN contains no extra pooling operation and it can dynamically fuse the global context ex-tracted from GCNs in both spatial and feature spaces. To solve the boundary confusion in both single-face and multi-face scenarios, the proposed category-aware edge detection module exploits more semantic information than the binary edge detection module used in EARGNet [36].
To address the problem caused by noisy labels in train-ing datasets, we introduce a cyclically learning scheduler inspired by self-training [3, 16, 34, 41, 42, 42, 49] to achieve advanced cyclical self-regulation. The proposed CSR con-tains a self-ensemble strategy that can aggregate a set of his-torical models to obtain a new reliable model and another self-distillation method that exploits the soft labels gener-ated by the aggregated model to guide the successive model learning. Finally, the proposed CSR iteration alternates be-tween these two procedures, correcting the noisy labels dur-ing training and promoting the model generalization. The proposed CSR can significantly promote the reliability of the model and labels in a cyclical training scheduler with-out introducing extra computation costs.
To summarize, our main contributions are as follows:
• We propose a decoupled multi-task network includ-ing face parsing, binary edge detection, and category edge detection. The face parsing branch introduces a
DDGCN without any extra pooling operation to solve the problem of spatial inconsistency, and an additional category edge detection branch is designed to handle the boundary confusion.
• We introduce a cyclical self-regulation mechanism during training. The iteration alternates between one self-ensemble procedure, boosting model generaliza-tion progressively, and another self-distillation pro-cessing, regulating noisy labels.
• Our method establishes new state-of-the-art perfor-mance on the Helen [35] (93.8% overall F1 score),
LaPa [21] (92.4% mean F1) and CelebAMask-HQ [15] (86.1% mean F1) datasets. Compared to EARGNet
[36], our method utilizes fewer computation resources as the edge prediction modules can be decoupled from the whole network, decreasing the inference time from 89ms to 31ms but achieving much better performance. 2.