Abstract
Locating 3D objects from a single RGB image via
Perspective-n-Points (PnP) is a long-standing problem in computer vision. Driven by end-to-end deep learning, re-cent studies suggest interpreting PnP as a differentiable layer, so that 2D-3D point correspondences can be partly learned by backpropagating the gradient w.r.t. object pose.
Yet, learning the entire set of unrestricted 2D-3D points from scratch fails to converge with existing approaches, since the deterministic pose is inherently non-differentiable.
In this paper, we propose the EPro-PnP, a probabilistic PnP layer for general end-to-end pose estimation, which out-puts a distribution of pose on the SE(3) manifold, essen-tially bringing categorical Softmax to the continuous do-main. The 2D-3D coordinates and corresponding weights are treated as intermediate variables learned by minimiz-ing the KL divergence between the predicted and target pose distribution. The underlying principle uniﬁes the ex-isting approaches and resembles the attention mechanism.
EPro-PnP signiﬁcantly outperforms competitive baselines, closing the gap between PnP-based method and the task-speciﬁc leaders on the LineMOD 6DoF pose estimation and nuScenes 3D object detection benchmarks.3 1.

Introduction
Estimating the pose (i.e., position and orientation) of 3D objects from a single RGB image is an important task in computer vision. This ﬁeld is often subdivided into spe-ciﬁc tasks, e.g., 6DoF pose estimation for robot manipula-tion and 3D object detection for autonomous driving. Al-though they share the same fundamentals of pose estima-tion, the different nature of the data leads to biased choice of methods. Top performers [29, 42, 44] on the 3D object
*Part of work done during an internship at Alibaba Group.
†Corresponding authors: Pichao Wang, Wei Tian. 3Code: https://github.com/tjiiv-cprg/EPro-PnP
Figure 1. EPro-PnP is a general solution to end-to-end 2D-3D correspondence learning.
In this paper, we present two distinct networks trained with EPro-PnP: (a) an off-the-shelf dense cor-respondence network whose potential is unleashed by end-to-end training, (b) a novel deformable correspondence network that ex-plores new possibilities of fully learnable 2D-3D points. detection benchmarks [6, 14] fall into the category of direct 4DoF pose prediction, leveraging the advances in end-to-end deep learning. On the other hand, the 6DoF pose esti-mation benchmark [19] is largely dominated by geometry-based methods [20, 46], which exploit the provided 3D object models and achieve a stable generalization perfor-mance. However, it is quite challenging to bring together the best of both worlds, i.e., training a geometric model to learn the object pose in an end-to-end manner.
There has been recent proposals for an end-to-end frame-work based on the Perspective-n-Points (PnP) approach [2, 4, 7, 10]. The PnP algorithm itself solves the pose from a set of 3D points in object space and their corresponding 2D projections in image space, leaving the problem of con-structing these correspondences. Vanilla correspondence learning [9, 23, 24, 30, 30–32, 35, 40, 46] leverages the ge-ometric prior to build surrogate loss functions, forcing the network to learn a set of pre-deﬁned correspondences. End-to-end correspondence learning [2, 4, 7, 10] interprets the
PnP as a differentiable layer and employs pose-driven loss function, so that gradient of the pose error can be backprop-agated to the 2D-3D correspondences.
However, existing work on differentiable PnP learns only a portion of the correspondences (either 2D co-ordinates [10], 3D coordinates [2, 4] or corresponding weights [7]), assuming other components are given a priori.
This raises an important question: why not learn the entire set of points and weights altogether in an end-to-end man-ner? The simple answer is: the solution of the PnP prob-lem is inherently non-differentiable at some points, causing training difﬁculties and convergence issues. More speciﬁ-cally, a PnP problem can have ambiguous solutions [27,33], which makes backpropagation unstable.
To overcome the above limitations, we propose a gener-alized end-to-end probabilistic PnP (EPro-PnP) approach that enables learning the weighted 2D-3D point correspon-dences entirely from scratch (Figure 1). The main idea is straightforward: deterministic pose is non-differentiable, but the probability density of pose is apparently differen-tiable, just like categorical classiﬁcation scores. Therefore, we interpret the output of PnP as a probabilistic distribution parameterized by the learnable 2D-3D correspondences.
During training, the Kullback-Leibler (KL) divergence be-tween the predicted and target pose distributions is com-puted as the loss function, which is numerically tractable by efﬁcient Monte Carlo pose sampling.
As a general approach, EPro-PnP inherently uniﬁes ex-isting correspondence learning techniques (Section 3.1).
Moreover, just like the attention mechanism [38], the corre-sponding weights can be trained to automatically focus on important point pairs, allowing the networks to be designed with inspiration from attention-related work [8, 43, 48].
To summarize, our main contributions are as follows:
• We propose the EPro-PnP, a probabilistic PnP layer for general end-to-end pose estimation via learnable 2D-3D correspondences.
• We demonstrate that EPro-PnP can easily reach top-tier performance for 6DoF pose estimation by simply inserting it into the CDPN [24] framework.
• We demonstrate the ﬂexibility of EPro-PnP by propos-ing deformable correspondence learning for accurate 3D object detection, where the entire 2D-3D corre-spondences are learned from scratch. 2.