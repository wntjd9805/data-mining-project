Abstract
It’s been a long history that most object detection meth-ods obtain objects by using the non-maximum suppression (NMS) and its improved versions like Soft-NMS to remove redundant bounding boxes. We challenge those NMS-based methods from three aspects: 1) The bounding box with highest conﬁdence value may not be the true positive hav-ing the biggest overlap with the ground-truth box. 2) Not only suppression is required for redundant boxes, but also conﬁdence enhancement is needed for those true positives. 3) Sorting candidate boxes by conﬁdence values is not nec-essary so that full parallelism is achievable.
In this paper, inspired by belief propagation (BP), we propose the Conﬁdence Propagation Cluster (CP-Cluster) to replace NMS-based methods, which is fully parallelizable as well as better in accuracy. In CP-Cluster, we borrow the message passing mechanism from BP to penalize redundant boxes and enhance true positives simultaneously in an iter-ative way until convergence. We veriﬁed the effectiveness of CP-Cluster by applying it to various mainstream detec-tors such as FasterRCNN, SSD, FCOS, YOLOv3, YOLOv5,
Centernet etc. Experiments on MS COCO show that our plug and play method, without retraining detectors, is able to steadily improve average mAP of all those state-of-the-art models with a clear margin from 0.3 to 1.9 respectively when compared with NMS-based methods. 1.

Introduction
The occurrence of convolutional neural networks has brought in revolutionary improvements in various object de-tection tasks [10, 14, 24, 41]. Generally, two-stage/multi-stage detectors [4, 9, 15, 31, 51] can achieve higher accu-racy, while one-stage detectors [1, 16, 23, 26, 30, 37, 38] take better accuracy-performance balance. Recently, other than achieving better state-of-the-art results and less infer-ence cost, some research attentions are also paid to simplify
*Equal contributions. training and inference pipelines. [21,36,46,52] got rid of the predeﬁned anchors. [5, 34, 39, 52, 55] designed speciﬁc one-one label assignment strategies to train end-to-end detection models without need of post-processing methods. [8, 52] make use of only one output feature map.
Nowadays some NMS-free methods have gained reason-able accuracies, but they still suffer from more or less sacri-ﬁce in accuracies, performance, training time and ﬂexibility of design choices. Especially, when real-time inference is not required, the ensembles of detection models equipped with NMS are used to achieve better results [33, 54]. Be-sides, in autonomous vehicles systems, researchers usually apply NMS to combine objects detected from multiple sen-sors. Therefore the majority of those mainstream detec-tors [23, 31, 36, 37] still employ NMS or Soft-NMS [2] to remove redundant bounding boxes in inference stage. Stan-dard NMS greedily suppresses all neighboring bounding boxes around the box with highest conﬁdence value. Fol-lowing this, researchers proposed several methods to im-prove the standard NMS accuracy [2, 19, 25, 50]. Among them, Soft-NMS [2] was proved to achieve general im-provements for various detectors, while others are either de-signed for speciﬁc detectors or require retraining with spe-ciﬁc tricks. In addition, some methods are proposed to par-allelize the NMS [3, 49], while those methods still rely on conﬁdence sorting in their pipelines.
With those NMS-based methods, all candidate boxes are
ﬁrstly sorted according to their detection scores, and then the bounding box with the highest score in each cluster is se-lected as a representative. Other objects with slightly lower scores are simply thrown away or assigned with a smaller conﬁdence, as does not make full use of relations between candidate boxes.
In this paper, we aim to replace the NMS-based meth-ods with a better clustering framework (CP-Cluster) for object detectors, as is able to achieve better accuracy and meanwhile fully parallelizable. As illustrated by Fig. 1,
CP-Cluster ﬁrstly constructs a graph set from all candidate boxes based on their overlaps, then both positive messages and negative messages are propagated among boxes belong-Figure 1. Overall pipeline of CP-Cluster. CP-Cluster converts all candidate boxes from an object detector into a set of graphs. Positive messages (blue arrows) and negative messages (orange arrows) are propagated within each graph iteratively, amplifying true positives and suppressing redundant boxes simultaneously. ing to the same graph to tune each box’s conﬁdence value
In detail, to conquer the deﬁciencies until convergence. of NMS-based methods, CP-Cluster is sophisticatedly de-signed to incorporate below strategies: 1) To make full use of relationships between candidate boxes, we propagate messages among them to tune their conﬁdence values. Speciﬁcally, CP-Cluster gen-erates positive messages to enhance true positive boxes and composes negative messages to penalize redun-dant boxes simultaneously. 2) To further maximize the conﬁdence margin between true positives and redundant boxes, the conﬁdence message propagations are performed multiple times it-eratively. 3) To achieve full parallelism, the message propagation is restricted within neighboring candidate boxes, so that each candidate box manages to update itself indepen-dently.
We summarize our contributions as below: 1) We propose a new fully parallelizable clustering framework (CP-Cluster) applicable for all object de-tectors which require post-processing, and this new clustering framework outperforms NMS-based meth-ods in accuracies. 2) We apply CP-Cluster to various mainstream detectors without retraining them, including FasterRCNN [31],
SSD [26], FCOS [36], yolov5 [37] etc. On MS COCO, experimental results show general improvement for all mainstream detectors by just setting CP-Cluster as post-processing step. 3) By applying CP-Cluster to CenterNet [52], we show that some of NMS-free detectors can also be explicitly improved by this clustering framework.
To our knowledge, after Soft-NMS [2], CP-Cluster is the only bounding box clustering method which manages to achieve general improvements on most of mainstream ob-ject detectors in a plug and play manner. Furthermore, it shows huge potential to be applied in real-time tasks due to its full parallelism. 2.