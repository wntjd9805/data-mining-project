Abstract
Human behavior has the nature of indeterminacy, which requires the pedestrian trajectory prediction system to model the multi-modality of future motion states. Unlike ex-isting stochastic trajectory prediction methods which usu-ally use a latent variable to represent multi-modality, we explicitly simulate the process of human motion variation from indeterminate to determinate. In this paper, we present a new framework to formulate the trajectory prediction task as a reverse process of motion indeterminacy diffu-sion (MID), in which we progressively discard indetermi-nacy from all the walkable areas until reaching the desired trajectory. This process is learned with a parameterized
Markov chain conditioned by the observed trajectories. We can adjust the length of the chain to control the degree of in-determinacy and balance the diversity and determinacy of the predictions. Speciﬁcally, we encode the history behav-ior information and the social interactions as a state em-bedding and devise a Transformer-based diffusion model to capture the temporal dependencies of trajectories. Exten-sive experiments on the human trajectory prediction bench-marks including the Stanford Drone and ETH/UCY datasets demonstrate the superiority of our method. Code is avail-able at https://github.com/gutianpei/MID. 1.

Introduction
Human trajectory prediction plays a crucial role in human-robot interaction systems such as self-driving vehi-cles and social robots, since human is omnipresent in their environments. Although signiﬁcant progresses have been achieved over past few years [6,28,29,32,38,45,49,53], pre-dicting the future trajectories of pedestrians remains chal-lenging due to the multi-modality of human motion.
The future trajectories of pedestrians are full of indeter-minacy, because human can change future motion accord-ing to their will or adjust their movement direction based on the surroundings. Given a history of observed trajecto-*Equal contribution. †Corresponding author.
Figure 1.
Illustration of the reverse diffusion process for hu-man motion indeterminacy variation. Under high indeterminacy, the trajectory distribution can be regarded as a noise Gaussian distribution which denotes ambiguous walkable areas. With the decreasing of indeterminacy, this distribution gradually approxi-mates the real data distribution to generate desired trajectory. This process from high indeterminacy to low indeterminacy is deﬁned as a reverse diffusion process, in which we learn a Markov chain to progressively discard the indeterminacy. By adjusting the length of the chain, we can make a trade-off between diversity and deter-minacy, where the longer chain leads to lower diversity and higher determinacy. Best viewed in color. ries, there exist many plausible paths that pedestrians could move in the future. Facing this challenge, most of prior researches apply the generative model to represent multi-modality by a latent variable. For instance, some meth-ods [6,9,12,19,37,43,54] utilize generative adversarial net-works (GANs) to spread the distribution over all possible future trajectories, while other methods [3,16,20,25,38,46] exploit conditional variational auto-encoder (CVAE) to en-code the multi-modal distribution of future trajectories. De-spite the remarkable progress, these methods still face in-herent limitations, e.g., training process could be unstable for GANs due to adversarial learning, and CVAE tends to produce unnatural trajectories.
In this paper, we propose a new trajectory prediction framework, called motion indeterminacy diffusion (MID), to model the indeterminacy of human behavior. Inspired by
non-equilibrium thermodynamics, we consider the future positions as particles in thermodynamics in our framework.
The particles (positions) gather and deform to a clear trajec-tory under low indeterminacy, while stochastically spread over all walkable areas under high indeterminacy. The pro-cess of particles evolving from low indeterminacy to high indeterminacy is deﬁned as the diffusion process. This pro-cess can be simulated by gradually adding noise to the tra-jectory until the path is corrupted as Gaussian noise. The goal of our MID is to reverse this diffusion process by pro-gressively discarding indeterminacy, and converting the am-biguous prediction regions into a deterministic trajectory.
We illustrate the reverse diffusion process of motion inde-terminacy in Figure 1. Contrary to other stochastic pre-diction methods that add a noise latent variable on the tra-jectory feature to obtain indeterminacy, we explicitly simu-late the motion indeterminacy variation process. Our MID learns a Markov chain with parameterized Gaussian transi-tion to model this reverse diffusion process and train it using variational inference conditioned on the observed trajecto-ries. By choosing different lengths of the chain, we can ob-tain the predictions with a ﬂexible indeterminacy that is ca-pable of adapting to dynamic environment. Moreover, our method is more efﬁcient to train than GANs, and is capable of producing more high-quality samples than CVAEs.
To be more speciﬁc, we encode the history human tra-jectories and the social interactions as state embedding via a spatial-temporal graph network. Then, we exploit this state embedding as condition in the Markov chain to guide the learning of reverse diffusion process. To model the temporal dependencies in trajectories, we carefully design a Transformer-based architecture as the core network of
MID framework. In the training process, we optimize the model with the variational lower bound, and during the in-ference, we sample the reasonable trajectories by progres-sive denoising from a noise distribution. Extensive experi-ments demonstrate that our method accurately forecasts rea-sonable future trajectories with multi-modality, achieving state-of-the-art results on Stanford Drone and ETH/UCY datasets. We summarize the main contributions of this pa-per as follows:
• We present a new stochastic trajectory predic-tion framework with motion indeterminacy diffusion, which gradually discards the indeterminacy to obtain desired trajectory from ambiguous walkable areas.
• We devise a Transformer-based architecture for the proposed framework to capture the temporal depen-dencies in trajectories.
• The proposed method achieves state-of-the-art perfor-mance on widely used human trajectory prediction benchmarks and provides a potential direction for bal-ancing the diversity and accuracy of predictions. 2.