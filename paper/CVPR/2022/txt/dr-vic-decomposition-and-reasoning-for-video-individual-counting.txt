Abstract
Pedestrian counting is a fundamental tool for under-standing pedestrian patterns and crowd flow analysis. Ex-isting works (e.g., image-level pedestrian counting, cross-line crowd counting et al.) either only focus on the image-level counting or are constrained to the manual annotation
In this work, we propose to conduct the pedes-of lines. trian counting from a new perspective - Video Individual
Counting (VIC), which counts the total number of individ-ual pedestrians in the given video (a person is only counted once). Instead of relying on the Multiple Object Tracking (MOT) techniques, we propose to solve the problem by de-composing all pedestrians into the initial pedestrians who existed in the first frame and the new pedestrians with sep-arate identities in each following frame. Then, an end-to-end Decomposition and Reasoning Network (DRNet) is designed to predict the initial pedestrian count with the density estimation method and reason the new pedestrian’s count of each frame with the differentiable optimal trans-port. Extensive experiments are conducted on two datasets with congested pedestrians and diverse scenes, demonstrat-ing the effectiveness of our method over baselines with great superiority in counting the individual pedestrians. Code: https://github.com/taohan10200/DRNet. 1.

Introduction
The world population has witnessed rapid growth, along with the accelerated urbanization. It is expected that around 70% of the world’s population will live in cities [10, 51], which brings significant challenges in the city management, such as transport management, public space design, evacua-tion planning, and public safety. To tackle these challenges, accurately obtaining the number of pedestrians of any re-gion in a period of time, e.g., the number of people passed
† Equal contribution.
* Corresponding author.
Figure 1.
Illustration of different crowd counting paradigms.
Video Individual Counting count all pedestrians appearing in the video and each person is only counted once, e.g. count ①②③④ to get counting result 4. Single Image Crowd Counting targets on the image-level. Directly applying it to video individual counting will cause over-count, e.g., count pedestrians ①②③ at frame t and
②③④ at frame t + 1 getting result 6. Cross-line Crowd Count-ing targets on the video level but only focuses on the pedestrians passed the red virtual line, e.g., count ③ to get result 1. the intersection in the past 10 minutes, is a basic problem.
Automatically estimating the pedestrian number from images/videos is a practical solution and attracts attentions of researchers from different perspectives. Specifically,
Single Image Crowd Counting (SICC) [9, 18, 27, 39, 54] estimates the crowd number in the image level, which can reflect the degree of crowdedness at a certain time point. Video Crowd Counting (VCC) [15,58,59] further en-hances SICC by exploring the information from the histori-cal frames to achieve a more accurate and robust counting in the target frame. Different from SICC and VCC, the cross-line crowd counting techniques [11, 38, 63, 64] focuses on estimating the pedestrians in a period of time from videos.
By manually setting a proper virtual line (e.g., the red line as illustrated in Fig. 1), cross-line crowd counting discov-ers the pedestrians passed this line, which could reflect the crowdness and total crowd number in the video.
Different from the settings of the works discussed above, this work targets a similar but different task –Video Indi-vidual Counting (VIC), which counts the total number of pedestrians in the given video with separate identities. As illustrated in Fig. 1, people come from all directions into the
camera view should be counted through time and each per-son should only be counted once. The output of VIC is the common concept regarding the total pedestrian number in a scene during a period of time (i.e., video length), which ac-curately measures the crowdness and popularity of an area, and thus is valuable for numerous applications, e.g., count the people attending an event, or measure the total pedestri-ans of an intersection.
While sharing similarities, Video Individual Counting is challenging and cannot be directly solved by existing image-level pedestrian counting and cross-line counting methods. Image level pedestrian counting methods will in-evitably count the same person multiple times in adjacent frames and hugely over-estimates the pedestrian number if directly summing the number of crowd at each frame.
Cross-line counting methods only count the pedestrians passing the line and thus will miss the crowd staying in the video or disjointing with the line. Besides, it requires manual annotation of the line for different camera settings, which is not in accordance with the aim of computer vi-sion researchers in making crowd counting automated, and is also time consuming when considering a single city like
London might have 500,000+ CCTV cameras.
The potential existing solution for VIC is the Multi-Object Tracking (MOT) methods [50,61], which is a general technique to identify and track all objects in the video and has been explored for specific area (e.g., counting for bus entrance [49]). The number and states of tracks in MOT can be employed to not only reveal the total number of crowd in the video, but also the inflows and outflows (the number of people getting into and out of the scene, respectively) of a period. However, since MOT is designed for tracking in-stead of pedestrian counting, the accuracy and efficiency of using MOT for this task would be inferior for two reasons.
For accuracy, the object association in MOT depends on the detection results of multiple frames and extremely suffers from the ID switch, which heavily influence the counting performance by over-counting. For efficiency, most MOT operates on each frame, which is time-consuming and not necessary for the crowd counting task.
We propose a new paradigm for Video Individual Count-ing without relying on the MOT. Instead of associating all pedestrians in the whole video as MOT, we only associate each pair of frames to identify the inflow (i.e., new pedes-trians) of each time slot. Specifically, we decompose all pedestrians into the initial pedestrians existed in the first frame and the new pedestrians with separate identities in the following frames. The rational behind this idea is the obser-vation that the crowd normally stay in or pass through a re-gion (e.g., camera view region). Only in few cases, people may pop in and out of the camera view, which is neglectable compared with the counting error. Take CroHD [50] dataset as an example, only 17 pedestrians leave and re-enter the camera view region after an interval of 75 frames, while the total pedestrians number in the videos is 5230.
Based on this idea, an efficient and end-to-end video individual counting framework named Decomposition and
Reasoning Network (DRNet) is proposed. DRNet first sam-ples frames from the video with a time window. Then each pair of frames formed by the adjacent frames are separately fed into neural networks for generating two CNN feature maps, based on which two density maps reflecting the head locations at each frame can be predicted separately. In the next step, two sets of features containing the descriptors of each located head are sampled from the CNN feature maps and then used by a pedestrian inflow reasoning module implemented with differentiable Optimal Transport, from which the inflow (pedestrians joining the latter frame) and outflow (pedestrians leaving the former frame) of the input frame pair can be predicted. Finally, the total pedestrian count in the whole video can be obtained by integrating the crowd count of the first frame and all pedestrian inflows in the following sampled frame pairs.
Our core contributions are summarized as follows:
• We propose to decompose video individual pedestrians into the initial pedestrians and the new pedestrians at following frames, which avoids the complicated and error-prone video-level association in MOT and opens a new direction for pedestrian counting.
• We propose an efficient and end-to-end framework to achieve video individual counting, directly obtaining the new pedestrians of a frame by reasoning it with the preceding frame using differentiable optimal transport.
• Extensive experiments are conducted on two datasets covering congested crowds and diverse scenes. The experimental results demonstrate the effectiveness of the proposed methods over strong baselines. 2.