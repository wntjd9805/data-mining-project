Abstract
State-of-the-art methods for counting people in crowded scenes rely on deep networks to estimate crowd density.
While effective, these data-driven approaches rely on large amount of data annotation to achieve good performance, which stops these models from being deployed in emergen-cies during which data annotation is either too costly or cannot be obtained fast enough.
One popular solution is to use synthetic data for train-ing. Unfortunately, due to domain shift, the resulting mod-els generalize poorly on real imagery. We remedy this shortcoming by training with both synthetic images, along with their associated labels, and unlabeled real images. To this end, we force our network to learn perspective-aware features by training it to recognize upside-down real im-ages from regular ones and incorporate into it the abil-ity to predict its own uncertainty so that it can gener-ate useful pseudo labels for fine-tuning purposes. This yields an algorithm that consistently outperforms state-of-the-art cross-domain crowd counting ones without any extra computation at inference time. Code is publicly available at https : / / github . com / weizheliu / Cross -Domain-Crowd-Counting. 1.

Introduction
Crowd counting is important for applications such as video surveillance and traffic control. For example during the current COVID-19 pandemic, it has a role to play in monitoring social distancing and slowing down the spread of the disease. Most state-of-the-art approaches rely on re-gressors to estimate the local crowd density in individual images, which they then proceed to integrate over portions of the images to produce people counts. The regressors typ-ically use Random Forests [37], Gaussian Processes [4], or more recently Deep Networks [3,28,39,44,50,51,59,63,69– 71, 74, 77, 79, 94, 105, 106, 111], with most state-of-the-art approaches now relying on the latter.
Unfortunately, training such deep networks in a tradi-tional supervised manner requires much ground-truth an-notation. This is expensive and time-consuming and has (a) (c) (b) (d)
Figure 1. Motivation. (a): Time, expense, and robustness. An-notating dense crowd is extremely time-consuming.
It can take hours for someone to annotate a single image and the process is error prone. (b) Accuracy: For region far away from the camera where people are very small and bunched up, it is almost impossi-ble for human beings to annotate accurately. (c): Privacy issues.
Real images feature real people and information about them will be exposed to the annotator, which can create ethical concerns. (d): Solution. All of these problems can be solved by using syn-thetic data. slowed down the deployment of data-driven approaches, as illustrated by Fig. 1. One way around this difficulty is to use synthetic data for training purposes. However there is usually too much domain shift—change in statis-tical properties—between real and synthetic images for net-works trained in this manner to perform well.
In this paper, we remedy this shortcoming by training with both synthetic images, along with their associated la-bels, and unlabeled real images. We force our network to learn perspective-aware features on the real images and build into it the ability to use these features to predict its own uncertainty using a fast variant of the ensemble method [14] to effectively use pseudo labels for fine-tuning.
We train it as follows: 1. Initially we use synthetic images, unlabeled real im-ages, and upside-down version of the latter. We train the network not only to give good results on the syn-thetic images but also to recognize if the real images
are upside-up or upside-down. This simple approach to self-supervision forces the network to learn features that are perspective-aware on the real images. 2. At the end of this first training phase in which we perform image-wise self supervision on the real im-ages, our network is semi-trained and the uncertain-ties attached to the people densities it estimates have meaning. We exploit them to provide pixel-wise self-supervision by treating the densities the network is confident about as pseudo labels, that we use as if they were ground-truth labels to re-train the network. We iterate this process until convergence.
Our contribution is therefore a novel approach to self-supervision for cross-domain crowd counting that relies on stochastic density maps, that is, maps with uncertainties at-tached to them, instead of the more traditional deterministic density maps. Furthermore, it explicitly leverages a speci-ficity of the crowd counting problem, namely the fact that perspective distortion affects density counts. We will show that it consistently outperforms the state-of-the-art cross-domain crowd counting methods. 2.