Class-agnostic counting (CAC) is a task that involves counting instances in a query image using a small number of exemplars. The traditional approach involves extracting visual features from exemplars and using a fixed similarity metric to match them with query images. However, this approach often leads to inaccurate matching and affects counting performance.   To address this issue, we propose a similarity-aware CAC framework that simultaneously learns feature representation and similarity metric. We begin by introducing a baseline method called Bilinear Matching Network (BMNet), which uses a learnable bilinear similarity metric as its main component. To further enhance the framework, we extend BMNet to BMNet+ by considering three aspects of similarity: 1) representing instances based on their self-similarity to improve feature robustness against intra-class variations, 2) dynamically comparing similarity to focus on key patterns of each exemplar, and 3) learning from supervision signals to impose explicit constraints on matching results.   We conduct extensive experiments on the FSC147 dataset, which is commonly used for CAC evaluation, and our models demonstrate superior performance compared to state-of-the-art CAC approaches. Furthermore, we validate the effectiveness of BMNet and BMNet+ on a different car counting dataset called CARPK, indicating their cross-dataset generality. The code for our models is available at tiny.one/BMNet.