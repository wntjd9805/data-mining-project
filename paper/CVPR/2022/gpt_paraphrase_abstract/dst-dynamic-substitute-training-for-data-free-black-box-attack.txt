With the increasing use of deep neural network models in computer vision tasks, researchers have been exploring the vulnerability of these models to adversarial examples. Previous methods for data-free black box attacks have relied on knowledge distillation, training a substitute model to learn from the target model using generated data. However, these substitute models have a fixed network structure, limiting their effectiveness against various target models and tasks. In this study, we present a new approach called dynamic substitute training attack, which aims to enhance the substitute model's learning from the target model. We propose a dynamic substitute structure learning strategy that generates an optimal substitute model structure using a dynamic gate based on the specific target model and task. Additionally, we introduce a task-driven graph-based structure information learning constraint to improve the quality of the generated training data and enable the substitute model to learn the structural relationships from the multiple outputs of the target model. Extensive experiments validate the effectiveness of our attack method, demonstrating superior performance compared to existing state-of-the-art approaches on several datasets.