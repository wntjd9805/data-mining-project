We propose a novel variational Bayesian formulation for diffeomorphic non-rigid registration of medical images, which learns in an unsupervised way a data-speciÔ¨Åc sim-ilarity metric. The proposed framework is general and may be used together with many existing image registra-tion models. We evaluate it on brain MRI scans from theUK Biobank and show that use of the learnt similarity met-ric, which is parametrised as a neural network, leads to more accurate results than use of traditional functions, e.g.SSD and LCC, to which we initialise the model, without a negative impact on image registration speed or transfor-mation smoothness. In addition, the method estimates the uncertainty associated with the transformation. The code and the trained models are available in a public repository: https://github.com/dgrzech/learnsim. 