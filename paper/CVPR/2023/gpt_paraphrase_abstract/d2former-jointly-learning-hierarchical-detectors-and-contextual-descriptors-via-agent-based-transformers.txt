A new image matching method called D2Former is introduced to address the challenges of achieving robust image matching in computer vision applications. The method includes a contextual feature descriptor learning (CFDL) module and a hierarchical keypoint detector learning (HKDL) module. The CFDL module effectively models long-range contexts using descriptor agents, while the HKDL module generates keypoint detectors in a hierarchical manner to detect keypoints with varying levels of structure. Experimental results on four benchmarks demonstrate that the proposed method outperforms existing image matching methods.