In this paper, we study a real-world JPEG image restora-tion problem with bit errors on the encrypted bitstream.The bit errors bring unpredictable color casts and block shifts on decoded image contents, which cannot be resolved by existing image restoration methods mainly relying on pre-defined degradation models in the pixel domain. To address these challenges, we propose a robust JPEG de-coder, followed by a two-stage compensation and align-ment framework to restore bitstream-corrupted JPEG im-ages. Specifically, the robust JPEG decoder adopts an error-resilient mechanism to decode the corrupted JPEG bitstream. The two-stage framework is composed of the self-compensation and alignment (SCA) stage and the guided-compensation and alignment (GCA) stage. The SCA adap-tively performs block-wise image color compensation and alignment based on the estimated color and block offsets via image content similarity. The GCA leverages the ex-tracted low-resolution thumbnail from the JPEG header to guide full-resolution pixel-wise image restoration in a coarse-to-fine manner. It is achieved by a coarse-guided pix2pix network and a refine-guided bi-directional Lapla-cian pyramid fusion network. We conduct experiments on three benchmarks with varying degrees of bit error rates. Ex-perimental results and ablation studies demonstrate the supe-riority of our proposed method. The code will be released at https://github.com/wenyang001/Two-ACIR. 