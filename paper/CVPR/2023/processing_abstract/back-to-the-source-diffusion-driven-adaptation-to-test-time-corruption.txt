Test-time adaptation harnesses test inputs to improve the accuracy of a model trained on source data when tested on shifted target data. Most methods update the source model by (re-)training on each target domain. While re-training can help, it is sensitive to the amount and order of the data and the hyperparameters for optimization. We update the target data instead, and project all test inputs to-ward the source domain with a generative diffusion model.Our diffusion-driven adaptation (DDA) method shares its models for classiﬁcation and generation across all domains, training both on source then freezing them for all targets, to avoid expensive domain-wise re-training. We augment dif-fusion with image guidance and classiﬁer self-ensembling to automatically decide how much to adapt. Input adapta-tion by DDA is more robust than model adaptation across a variety of corruptions, models, and data regimes on theImageNet-C benchmark. With its input-wise updates, DDA succeeds where model adaptation degrades on too little data (small batches), on dependent data (correlated orders), or on mixed data (multiple corruptions). 