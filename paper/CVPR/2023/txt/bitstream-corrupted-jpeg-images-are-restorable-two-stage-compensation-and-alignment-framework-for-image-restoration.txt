Abstract
In this paper, we study a real-world JPEG image restora-tion problem with bit errors on the encrypted bitstream.
The bit errors bring unpredictable color casts and block shifts on decoded image contents, which cannot be resolved by existing image restoration methods mainly relying on pre-defined degradation models in the pixel domain. To address these challenges, we propose a robust JPEG de-coder, followed by a two-stage compensation and align-ment framework to restore bitstream-corrupted JPEG im-ages. Specifically, the robust JPEG decoder adopts an error-resilient mechanism to decode the corrupted JPEG bitstream. The two-stage framework is composed of the self-compensation and alignment (SCA) stage and the guided-compensation and alignment (GCA) stage. The SCA adap-tively performs block-wise image color compensation and alignment based on the estimated color and block offsets via image content similarity. The GCA leverages the ex-tracted low-resolution thumbnail from the JPEG header to guide full-resolution pixel-wise image restoration in a coarse-to-fine manner. It is achieved by a coarse-guided pix2pix network and a refine-guided bi-directional Lapla-cian pyramid fusion network. We conduct experiments on three benchmarks with varying degrees of bit error rates. Ex-perimental results and ablation studies demonstrate the supe-riority of our proposed method. The code will be released at https://github.com/wenyang001/Two-ACIR. 1.

Introduction
Image restoration is a long-standing problem in computer vision that has been extensively studied. Given a degraded image, e.g., noisy, downscaled, hazing, or masked image, existing image restoration works in image deblur [2, 23], de-hazing [26], inpainting [16, 37], superresolution (SR) [6, 36] are capable of restoring the high-quality counterpart, respec-tively. These methods are mainly based on pre-defined image degradation models in the pixel domain, but few attempts
∗Corresponding authors
Figure 1. (a) Our work considers a real-world JPEG image restoration problem with bit errors on the encrypted bitstream, where En/De represent
JPEG encoding/decoding and EK /DK represent encryption/decryption employed in disks with the secret key K. We propose a robust JPEG decoder, followed by a two-stage compensation and alignment framework to address this problem. (b) Comparison of the standard decoder results with our robust decoder results and our proposed two-stage framework results.
The proposed robust decoder can decode the corrupted JPEG bitstream and the proposed two-stage framework can ultimately restore high-quality images gradually from the decoded color-casted and misaligned images. have been made in JPEG image restoration with the cor-rupted bitstream. The big challenge of bitstream-corrupted image restoration is the incurred JPEG decoding failures make the decoding process stop at the bit errors and the following bits cannot be decoded, as shown in Fig. 1 (b1).
In the real world, bit errors occur naturally in JPEG bit-stream stored in digital devices, and as memory cells wear out [27], uncorrectable bit errors are exposed externally.
NAND flash memory, as a type of non-volatile storage tech-nology, is widely used in portable devices to store users’ data. Due to technology trends, it exhibits progressively shorter lifetimes and increasingly relies on error correction codes (ECC) to ensure the data storage integrity [20,24]. It is well-known that [20,33] raw bit error rate (RBER) of NAND flash memory grows rapidly as the program/erase cycle, tem-perature, and retention years increase. As a result, bit errors
may exceed ECC’s error correction capability and cause un-recoverable bit errors. In addition, if the storage device is severely damaged, or the ECC controller is not functioning correctly, standard data reading [32] may not be possible.
Chip-off analysis [31] is often required to expose data in this case, but it may more likely result in unpredictable bit errors in the resolved data.
File carving [22] is an essential memory forensic tech-nique that allows files to be recovered from unreliable NAND flash memory. While existing JPEG file carving meth-ods [7, 21, 29, 30] mainly focus on JPEG file carving in the absence of filesystem metadata, few consider the situation when the JPEG file itself is corrupted. Bit errors in the JPEG bitstream can severely deteriorate the decoded image quality by two kinds of error propagation [12]. In addition, from An-droid 5.0, full-disk encryption (FDE) [10,11] is introduced to protect users’ privacy. Once an Android device is encrypted, all user-created data will be automatically encrypted before committing it to disk and automatically decrypted before accessing it from disk. For encrypted files stored in an An-droid device, bit errors caused by the unreliable NAND flash memory are directly reflected on the encrypted data, making bit errors of the decrypted file become much more serious.
This issue brings a significant challenge to existing works.
Recently, deep learning methods [16, 36, 37, 41] have shown great power in image restoration problems due to their powerful feature representation ability. However, existing image restoration methods may not be apt for the above-mentioned problem because of unpredictable color casts and block shifts of decoded image contents caused by bit errors.
As Fig. 1 (b1, b2) shows, decoders fail to generate visually consistent images that may not be directly used for the end-to-end training of existing image restoration methods.
Given the facts above, it is natural to raise a question: given a corrupted JPEG bitstream, is it possible to restore the image contents? With consideration of the FDE employed in smartphones for privacy, the damaged JPEG image y in the pixel domain can be formulated as: y = De(DK(Bitf lip(EK(En(x)))) (1) where x represents the initial JPEG image, DK and EK represent decryption and encryption of FDE, De and En represent JPEG decoding and encoding, EK(En(x)) repre-sents the corresponding encrypted JPEG bitstream by the secret key K, and Bitf lip represents random bit errors on the encrypted data. To simplify the problem, we assume the secret key is already known.
In this paper, we propose a robust JPEG decoder, followed by a two-stage compensation and alignment framework to restore bitstream-corrupted JPEG images. Specifically, the robust decoder adopts an error-resilient mechanism, which can decode the corrupted JPEG bitstream completely (see
Fig. 1 (b2)), compared to the aborting of JPEG decoding in the standard decoder (see Fig. 1(b1)). To further resolve the color cast and block shift problem in our decoded images, we propose a two-stage compensation and alignment frame-work, i.e., self-compensation and alignment (SCA) stage and guided-compensation and alignment (GCA) stage. In the first stage, SCA cast the problem as a segment detec-tion problem and adaptively estimates suitable color and block offsets for each segment to perform block-wise im-age color compensation and alignment via image content similarity. In the second stage, GCA leverages the extracted low-resolution thumbnail (normally 160×120 [9, 25]) from the JPEG header to guide full-resolution pixel-wise image restoration. The GCA is achieved by coarse-to-fine neural networks, including a coarse-guided pix2pix network and a refine-guided bi-directional Laplacian pyramid fusion net-work. As Figs. 1 (b3, b4) show, the proposed two-stage framework deals with the color cast and block shift problem and restores high-quality images ultimately. In summary, our contributions are as follows:
• To the best of our knowledge, this is the first work to restore the JPEG image with bit errors on the encrypted bitstream. Unlike existing works based on pre-defined degradation models in the pixel domain, the discussed problem in the bitstream domain causes unpredictable color casts and block shifts on decoded images, which is challenging and of great practical value.
• We propose a two-stage compensation and alignment scheme for this problem, where the SCA stage and GCA stage are proposed and combined into an end-to-end architecture. The SCA is based on image content simi-larity without training data, and the GCA employs the coarse-guided pix2pix network and the refine-guided bi-directional Laplacian pyramid fusion network to gradu-ally restore full-resolution images.
• Extensive experiments and ablation studies have been conducted to demonstrate the superiority of our pro-posed method. Even for 2k-resolution images, our pro-posed method can restore high-fidelity images with faithful details, achieving PSNR up to 38.92 dB with 5.52 dB significant improvement compared to the base-line EPDN method [26]. 2.