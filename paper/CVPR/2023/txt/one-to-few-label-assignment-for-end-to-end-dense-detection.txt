Abstract
One-to-one (o2o) label assignment plays a key role for transformer based end-to-end detection, and it has been re-cently introduced in fully convolutional detectors for end-to-end dense detection. However, o2o can degrade the fea-ture learning efficiency due to the limited number of posi-tive samples. Though extra positive samples are introduced to mitigate this issue in recent DETRs, the computation of self- and cross- attentions in the decoder limits its practi-cal application to dense and fully convolutional detectors.
In this work, we propose a simple yet effective one-to-few (o2f) label assignment strategy for end-to-end dense de-tection. Apart from defining one positive and many neg-ative anchors for each object, we define several soft an-chors, which serve as positive and negative samples simul-taneously. The positive and negative weights of these soft anchors are dynamically adjusted during training so that they can contribute more to “representation learning” in the early training stage, and contribute more to “duplicated prediction removal” in the later stage. The detector trained in this way can not only learn a strong feature representa-tion but also perform end-to-end dense detection. Exper-iments on COCO and CrowdHuman datasets demonstrate the effectiveness of the o2f scheme. Code is available at https://github.com/strongwolf/o2f. 1.

Introduction
Object detection [31, 36, 38, 48] is a fundamental com-puter vision task, aiming to localize and recognize the ob-jects of predefined categories in an image. Owing to the rapid development of deep neural networks (DNN) [14–16, 41,44–46], the detection performance has been significantly improved in the past decade. During the evolution of object detectors, one important trend is to remove the hand-crafted components to achieve end-to-end detection.
One hand-crafted component in object detection is the design of training samples. For decades, anchor boxes have
*Corresponding author.
Figure 1. The positive and negative weights of different anchors (A, B, C and D) in the classification loss during early and later training stages. Each anchor has a positive loss weight t (in orange color) and a negative loss weight 1 − t (in blue color).
In our method, A is a fully positive anchor, D is a fully negative anchor, and B and C are ambiguous anchors. One can see that for o2o and o2m label assignment schemes, the weights for all anchors are fixed during the training process, while for our o2f scheme, the weights for ambiguous anchors are dynamically adjusted. been dominantly used in modern object detectors such as
Faster RCNN [38], SSD [31] and RetinaNet [28]. How-ever, the performance of anchor-based detectors is sensitive to the shape and size of anchor boxes. To mitigate this is-sue, anchor-free [19,48] and query-based [5,8,34,61] detec-tors have been proposed to replace anchor boxes by anchor points and learnable positional queries, respectively.
Another hand-crafted component is non-maximum sup-pression (NMS) to remove duplicated predictions. The ne-cessity of NMS comes from the one-to-many (o2m) label assignment [4,13,18,25,26,58], which assigns multiple pos-itive samples to each GT object during the training process.
This can result in duplicated predictions in inference and impede the detection performance. Since NMS has hyper-parameters to tune and introduces additional cost, NMS-free end-to-end object detection is highly desired.
With a transformer architecture, DETR [5] achieves competitive end-to-end detection performance. Subsequent studies [43, 51] find that the one-to-one (o2o) label as-signment in DETR plays a key role for its success. Con-sequently, the o2o strategy has been introduced in fully convolutional network (FCN) based dense detectors for lightweight end-to-end detection. However, o2o can im-pede the training efficiency due to the limited number of
positive samples. This issue becomes severe in dense de-tectors, which usually have more than 10k anchors in an im-age. What’s more, two semantically similar anchors can be adversely defined as positive and negative anchors, respec-tively. Such a ‘label conflicts’ problem further decreases the discrimination of feature representation. As a result, the performance of end-to-end dense detectors still lags behind the ones with NMS. Recent studies [7, 17, 22] on DETR try to overcome this shortcoming of o2o scheme by introducing independent query groups to increase the number of positive samples. The independency between different query groups is ensured by the self-attention computed in the decoder, which is however infeasible for FCN-based detectors.
In this paper, we aim to develop an efficient FCN-based dense detector, which is NMS-free yet end-to-end trainable.
We observe that it is inappropriate to set the ambiguous an-chors that are semantically similar to the positive sample as fully negative ones in o2o. Instead, they can be used to com-pute both positive and negative losses during training, with-out influencing the end-to-end capacity if the loss weights are carefully designed. Based on the above observation, we propose to assign dynamic soft classification labels for those ambiguous anchors. As shown in Fig. 1, unlike o2o which sets an ambiguous anchor (anchor B or C) as a fully negative sample, we label each ambiguous anchor as par-tially positive and partially negative. The degrees of positive and negative labels are adaptively adjusted during training to keep a good balance between ‘representation learning’ and ‘duplicated prediction removal’. In particular, we be-gin with a large positive degree and a small negative degree in the early training stage so that the network can learn the feature representation ability more efficiently, while in the later training stage, we gradually increase the negative de-grees of ambiguous anchors to supervise the network learn-ing to remove duplicated predictions. We name our method as a one-to-few (o2f) label assignment since one object can have a few soft anchors. We instantiate the o2f LA into dense detector FCOS, and our experiments on COCO [29] and CrowHuman [40] demonstrate that it achieves on-par or even better performance than the detectors with NMS. 2.