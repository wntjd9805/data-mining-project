Abstract
Image recognition models that work in challenging en-vironments (e.g., extremely dark, blurry, or high dynamic range conditions) must be useful. However, creating train-ing datasets for such environments is expensive and hard due to the difficulties of data collection and annotation. It is desirable if we could get a robust model without the need for hard-to-obtain datasets. One simple approach is to ap-ply data augmentation such as color jitter and blur to stan-dard RGB (sRGB) images in simple scenes. Unfortunately, this approach struggles to yield realistic images in terms of pixel intensity and noise distribution due to not consider-ing the non-linearity of Image Signal Processors (ISPs) and noise characteristics of image sensors. Instead, we propose a noise-accounted RAW image augmentation method.
In essence, color jitter and blur augmentation are applied to a
RAW image before applying non-linear ISP, resulting in re-alistic intensity. Furthermore, we introduce a noise amount alignment method that calibrates the domain gap in the noise property caused by the augmentation. We show that our proposed noise-accounted RAW augmentation method doubles the image recognition accuracy in challenging en-vironments only with simple training data. 1.

Introduction
Although image recognition has been actively studied, its performance in challenging environments still needs im-provement [15]. Sensitive applications such as mobility sensing and head-mounted wearables need to be robust to various kinds of difficulties, including low light, high dy-namic range (HDR) illuminance, motion blur, and cam-era shake. One possible solution is to use image enhance-ment and restoration methods. A lot of DNN-based low-light image enhancement [12, 20, 29, 30, 46, 54], denois-ing [32, 43, 53], and deblurring [43, 48, 52] methods are proposed to improve the pre-captured sRGB image qual-ity. While they are useful for improving pre-captured image
RAW image luminance+noise
ISP (Contrast) augmentation (a) Usual training pipeline
Noise correction unrealistic intensity unrealistic noise realistic intensity realistic noise
RAW image luminance+noise (Contrast) augmentation
ISP (b) Noise-accounted RAW augmentation pipeline
Figure 1. The concept of the proposed noise-accounted RAW aug-mentation. Conventional augmentation (a) is applied to the output of an ISP; due to the nonlinear operations in the ISP, it produces images that cannot be captured at any ambient light intensities.
Instead, ours (b) applies augmentation before an ISP. It generates realistic pixel intensity distribution that can be captured when the light intensity is different. Moreover, the noise amount is also cor-rected to minimize the domain gap between real and augmented ones. quality, a recent work [15] shows that using them as prepro-cessing for image recognition models has limited accuracy gains since they already lost some information, and restor-ing the lost information is difficult.
Another possible solution is to prepare a dataset for dif-ficult environments [3, 33]. However, these datasets only cover one or a few difficulties, and creating datasets in various environments is too expensive. Especially, man-ual annotation of challenging scenes is difficult and time-consuming. For example, we can see almost nothing in usual sRGB images under extremely low-light environ-ments due to heavy noise. In addition, some regions in HDR scenes suffer from halation or blocked-up shadows because the 8-bit range of usual sRGB images cannot fully preserve the real world, which is 0.000001 [cd/m2] under starlight and 1.6 billion [cd/m2] under direct sunlight [37]. Heavy
motion blur and camera shake also make annotation diffi-cult. Some works capture paired short-exposure and long-exposure images, and the clean long-exposure images are used for annotation or ground truth [15–17, 19]. The limi-tation is that the target scene needs to be motionless if the pairs are taken sequentially with one camera [15], and posi-tional calibration is required if the pairs are taken with syn-chronized cameras [16,17]. Some works use a beam splitter to capture challenging images and their references without calibration [19, 45]. However, they are difficult to apply in dark scenes. Moreover, HDR images cannot be taken in the same way because some regions become overexposed or underexposed in both cameras.
To this end, we aim to train image recognition mod-els that work in various environments only using a train-ing dataset in simple environments like bright, low dynamic range, and blurless. In this case, image augmentation or do-main adaptation is important to overcome the domain gap between easy training data and difficult test data. However, we believe usual augmentations on sRGB space are inef-fective because it does not take into account the nonlinear mapping of ISPs. In particular, tone mapping significantly changes the RAW image values, which are roughly propor-tional to physical brightness [44]. Contrast, brightness, and hue augmentation on sRGB space result in unrealistic im-ages that cannot be captured under any ambient light inten-sity as shown in Fig. 1(a). In contrast, we propose augmen-tation on RAW images.
In other words, augmentation is applied before ISPs to diminish the domain shift as shown in Fig. 1(b).
Oher possible sources of the domain gap are differences in noise amount and noise distribution. To tackle these problems, we propose a method to align both light inten-sity and noise domains. Recent works show that adding physics-based realistic noise improves the performance of
DNN-based denoisers [2, 44, 47, 50] and dark image recog-nition [4, 15]. Although their proposed sensor noise mod-elings are accurate, they assume that the original bright im-ages are noise free. In contrast, we propose to modify the noise amount after contrast, brightness, and hue conversion considering the noise amount in the original images. It en-ables a more accurate alignment of the noise domain. Even bright images may have dark areas due to shadows or object colors, and their prior noise cannot be ignored. Another merit of our method is that it is possible to take dark im-ages that already contain a lot of noise as input. In addition to noise alignment after color jitter augmentation, we show the importance of noise alignment after blur augmentation, which is proposed for the first time in this paper.
Our contributions are as follows:
• It is the first work to emphasize the importance of aug-mentation before ISP for image recognition to the best of our knowledge.
• Noise amount alignment method is proposed to reduce the noise domain gap after RAW image augmentation.
In contrast to previous works, our proposed method takes into account prior noise in the input image. It en-ables more accurate alignment and use of any strength of augmentation and even already noisy input.
• We show qualitative analysis for the validity of our sensor noise modeling and corresponding noise-accounted augmentation. We prove that our proposed noise-accounted RAW augmentation has the edge over the previous methods. 2.