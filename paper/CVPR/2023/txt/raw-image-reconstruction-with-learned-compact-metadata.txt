Abstract
While raw images exhibit advantages over sRGB images (e.g., linearity and fine-grained quantization level), they are not widely used by common users due to the large stor-age requirements. Very recent works propose to compress raw images by designing the sampling masks in the raw image pixel space, leading to suboptimal image represen-tations and redundant metadata. In this paper, we propose a novel framework to learn a compact representation in the latent space serving as the metadata in an end-to-end man-ner. Furthermore, we propose a novel sRGB-guided con-text model with the improved entropy estimation strategies, which leads to better reconstruction quality, smaller size of metadata, and faster speed. We illustrate how the pro-posed raw image compression scheme can adaptively al-locate more bits to image regions that are important from a global perspective. The experimental results show that the proposed method can achieve superior raw image re-construction results using a smaller size of the metadata on both uncompressed sRGB images and JPEG images.
The code will be released at https://github.com/ wyf0912/R2LCM . 1.

Introduction
As an unprocessed and uncompressed data format di-rectly obtained from camera sensors, raw images has unique advantages for computer vision tasks in practice. For exam-ple, it is easier to model the distribution of real image noise in raw space, which enables generalized deep real denoising networks [1, 40]; As pixel values in raw images have a lin-ear relationship with scene radiance, they own benefits to re-cover shadows and highlights without bringing in the grainy noise usually associated with high ISO [12, 16, 33, 35], which greatly contributes to the low-light image enhance-ment. Besides, with richer colors, raw images offer more room for correction and artistic manipulation.
*Corresponding author. (a) Previous SOTA methods sample in the raw space [26, 30]. (b) The proposed method samples in the latent space.
Figure 1. The comparison between the previous SOTA methods (in blue) and our proposed method (in green). Different from the pre-vious work where the sampling strategy is hand-crafted or learned by a pre-defined sampling loss, we learn the sampling and recon-struction process in a unified end-to-end manner. In addition, the sampling of previous works is in the raw pixel space, which in fact still includes a large amount of spatial redundancy and precision redundancy. Instead, we conduct sampling in the feature space, and more compact metadata is obtained for pixels in the feature space via the adaptive allocation. The saved metadata is annotated in dashed box.
Despite of these merits, raw images are not widely adopted by common users due to large file sizes. In addi-tion, since raw images are unprocessed, additional post pro-cessing steps, e.g., demosaicing and denoising, are always needed before displaying them. For fast image rendering in practice, a copy of JPEG image is usually saved along with its raw data [2]. To improve the storage efficiency, raw-image reconstruction problem attracts more and more atten-tion, i.e., how to minimize the amount of metadata required for de-rendering sRGB images back to raw space. Classic metadata-based raw image reconstruction methods model the workflow of image signal processing (ISP) pipeline and save the required parameters in ISP as metadata [27]. To further reduce the storage and computational complexity to-wards a lightweight and flexible reverse ISP reconstruction,
(a) Simplified ISP adopted from [21] (b) Processed Raw (c) Quantized sRGB (d) Quantization error map
Figure 2. An illustration of the information loss caused by the ISP. (a) A simplified ISP suffers from the information loss caused by nonlinear transformations. (b) Raw image after process to better display the details. (c) Quantized sRGB image after ISP which suffers information loss, e.g., the red bounding box area. (d) The quantization error map. As we can see from the above figures, the information loss caused by the quantization is non-uniformly dis-tributed in both over-exposed areas and normally-exposed areas. very recent methods focus on sparse sampling of raw image pixels [26, 30]. Specifically, in [30], a uniform sampling strategy is proposed to combine with an interpolation al-gorithm that solves systems of linear equations. The work in [26] proposes a sampling network and approximates the reconstruction process by deep learning to further improve the sampling strategy.
Though lots of progress has been made, existing sparse sampling based raw image reconstruction methods still face limitations in terms of coding efficiency and image recon-struction quality. Specifically, the bit allocation should be adaptive and globally optimized for the image contents, given the non-linear transformation and quantization steps in ISP as shown in Fig. 2. For example, the smooth regions of an image can be well reconstructed with much sparser samples, comparing to the texture-rich regions which de-serve denser sampling. In constrast, in existing practices, even for the state-of-the-art method [26] where the sampling is enforced to be locally non-uniform, it is still almost uni-form from the global perspective, which causes metadata redundancy and limits the reconstruction performance. In addition, very recent works [26, 30] sample in a fixed sam-pling space, i.e., raw image space, with a fixed bit depth of sampled pixels, leading to limited representation ability and precision redundancy.
To address the above issues, instead of adopting a pre-defined sampling strategy or sampling loss, e.g., super-pixel loss [37], we propose a novel end-to-end learned raw im-age reconstruction framework based on encoded latent fea-tures. Specifically, the latent features are obtained by mini-mizing the reconstruction loss and its bitstream cost simul-taneously. To further improve the rate-distortion perfor-mance, we propose an sRGB-guided context model based on a learnable order prediction network. Different from the commonly used auto-regressive models [9, 24] which en-code/decode the latent features pixel-by-pixel in a sequen-tial way, the proposed sRGB-guided context requires much fewer steps (reduce by more than 106-fold) with the aid of a learned order mask, which makes the computational cost feasible while maintaining comparable performance. Fig. 1 compares the proposed raw image reconstruction method with the previous strategies [9, 24].
Our contributions are summarized as follows, 1. We propose the first end-to-end deep encoding frame-work for raw image reconstruction, by fully optimizing the use of stored metadata. 2. A novel sRGB-guided context model is proposed by introducing two improved entropy estimation strate-gies, which leads to better reconstruction quality, smaller size of metadata, and faster speed. 3. We evaluate our method over popular raw image datasets. The experimental results demonstrate that we can achieve better reconstruction quality with less metadata required comparing with SOTA methods. 2.