Abstract
The accuracy of crowd counting in images has improved greatly in recent years due to the development of deep neu-ral networks for predicting crowd density maps. However, most methods do not further explore the ability to localize people in the density map, with those few works adopting simple methods, like finding the local peaks in the density map. In this paper, we propose the optimal transport mini-mization (OT-M) algorithm for crowd localization with den-sity maps. The objective of OT-M is to find a target point map that has the minimal Sinkhorn distance with the in-put density map, and we propose an iterative algorithm to compute the solution. We then apply OT-M to gener-ate hard pseudo-labels (point maps) for semi-supervised counting, rather than the soft pseudo-labels (density maps) used in previous methods. Our hard pseudo-labels pro-vide stronger supervision, and also enable the use of recent density-to-point loss functions for training. We also propose a confidence weighting strategy to give higher weight to the more reliable unlabeled data. Extensive experiments show that our methods achieve outstanding performance on both crowd localization and semi-supervised counting. Code is available at https://github.com/Elin24/OT-M . 1.

Introduction
Crowd understanding gains much attention due to its wide applications in surveillance [33, 61] and crowd dis-aster prevention. Most studies in this area concentrate on crowd counting, whose objective is to provide the to-tal number and distribution of crowds in a scene automat-ically. Due to the development of deep learning, recent methods [5,58,59,62,67] have achieved success on a variety of counting benchmarks [50, 61, 62, 66]. Counting methods can be extended to other applications, such as traffic man-agement [63], animal protection [2], and health care [32].
Although crowd counting has been greatly developed, most methods do not explore further applications of the estimated density maps after obtaining the count. Specifi-Figure 1. The relationship between crowd counting CNNs and OT-M algorithm. CNNs are trained to generate density maps (soft la-bels). OT-M produces point maps (hard labels) from the predicted density maps, without needing training. cally, there is limited research on crowd localization, track-ing, or group analysis with predicted density maps. Taking crowd localization as an example, only a few methods, such as local maximum [13, 58, 65], integer programming [36], or Gaussian mixture models (GMM) [14], have been pro-posed to locate pedestrians or tiny objects from density maps. Moreover, recent localization methods ignore the counting density map, and instead are based on point de-tection [40, 54], blob segmentation [1, 10, 17], or inverse distance maps [24]. However, this will increase the inef-ficiency of a crowd understanding system, since separate networks are required for counting and localization.
To broaden the application of density maps for localiza-tion, in this paper we propose a parameter-free algorithm,
Optimal Transport Minimization (OT-M), to estimate the point map indicating locations of objects from a counting density map (see Fig. 1). OT-M minimizes the Sinkhorn distance [7] between the density map (source) and point lo-calization map (target), through an alternating scheme that estimates the optimal transport plan from the current point map (the OT-step), and updates the point map by minimiz-ing their transport cost (the M-step). OT-M is parameter-free and requires no training, and thus can be applied to any crowd-counting method using density maps.
To demonstrate the applicability of density-map based localization, we apply OT-M to semi-supervised counting.
In previous work, [38] builds a baseline for semi-supervised counting based on the mean-teacher framework [55], but finds it ineffective. Looking closely, we note that the base-line in [38] uses a soft pseudo-label (density map) to super-vise the student model, whereas successful semi-supervised classification [52] or segmentation [6, 55] methods usually
are based on hard pseudo-labels (e.g., class labels or binary segmentation masks).
In the context of semi-supervised crowd counting, the hard label is the point map in which each person is pseudo-annotated with a point. Thus, in this paper we generate hard pseudo-labels using OT-M for the unlabeled crowd images for semi-supervised crowd count-ing. As an additional benefit, the hard pseudo-labels al-low training CNNs under semi-supervised learning using recent density-to-point loss functions (e.g., Bayesian loss (BL) [34] or generalized loss (GL) [58]), which are more effective than traditional losses, e.g. L2.
Similar to other semi-supervised tasks, some estimated pseudo labels may be inaccurate due to limitations of the current trained model. To reduce the effect of these noisy pseudo-labels, we propose a confidence-weighted GL (C-GL) for semi-supervised counting. Specifically, we com-pute the unbalanced optimal transport plan between the stu-dent’s predicted density map (source) and the hard pseudo-labels from the teacher (target), and then define the pixel-wise and point-wise confidences based on the consistencies between source, target and the plan. Experiments show that the trained model is more robust with our C-GL.
In summary, the contributions of this paper are 3-fold:
• We propose an OT-M algorithm to estimate the loca-tions of objects from density maps, which is based on minimizing the Sinkhorn distance between the den-sity map and the target point map. Since OT-M is parameter-free, it can be applied to any density map without training.
• We use OT-M to produce hard pseudo-labels for semi-supervised counting, which conforms with schemes in other semi-supervised tasks. The hard label also al-lows applying density-to-point loss like GL to unla-beled data for more effective training.
• To mitigate risks brought by inaccurate pseudo-labels, we propose a confidence-weighted Generalized Loss to reduce the influence of inconsistencies between the teacher’s and student’s predictions. Experiments show that our loss improves semi-supervised counting per-formance. 2.