Abstract
Collective insights from a group of experts have al-ways proven to outperform an individual’s best diagnostic for clinical tasks. For the task of medical image segmen-tation, existing research on AI-based alternatives focuses more on developing models that can imitate the best indi-vidual rather than harnessing the power of expert groups.
In this paper, we introduce a single diffusion model-based approach that produces multiple plausible outputs by learn-ing a distribution over group insights. Our proposed model generates a distribution of segmentation masks by leverag-ing the inherent stochastic sampling process of diffusion us-ing only minimal additional learning. We demonstrate on three different medical image modalities- CT, ultrasound, and MRI that our model is capable of producing several possible variants while capturing the frequencies of their occurrences. Comprehensive results show that our pro-posed approach outperforms existing state-of-the-art am-biguous segmentation networks in terms of accuracy while preserving naturally occurring variation. We also propose a new metric to evaluate the diversity as well as the ac-curacy of segmentation predictions that aligns with the in-terest of clinical practice of collective insights. Implemen-tation code: https://github.com/aimansnigdha/Ambiguous-Medical-Image-Segmentation-using-Diffusion-Models. 1.

Introduction
Diagnosis is the central part of medicine, which heavily relies on the individual practitioner assessment strategy. Re-cent studies suggest that misdiagnosis with potential mor-tality and morbidity is widespread for even the most com-mon health conditions [32, 49]. Hence, reducing the fre-quency of misdiagnosis is a crucial step towards improving healthcare. Medical image segmentation, which is a cen-tral part of diagnosis, plays a crucial role in clinical out-comes. Deep learning-based networks for segmentation are now getting traction for assisting in clinical settings, how-ever, most of the leading segmentation networks in the lit-erature are deterministic [17, 23, 34, 36, 41, 42, 44], mean-ing they predict a single segmentation mask for each in-put image. Unlike natural images, ground truths are not
Figure 1. a) Deterministic networks produce a single output for an input image. b) c-VAE-based methods encode prior informa-tion about the input image in a separate network and sample latent variables from there and inject it into the deterministic segmenta-tion network to produce stochastic segmentation masks. c) In our method the diffusion model learns the latent structure of the seg-mentation as well as the ambiguity of the dataset by modeling the way input images are diffused through the latent space. Hence our method does not need an additional prior encoder to provide latent variables for multiple plausible annotations. deterministic in medical images as different diagnosticians can have different opinions on the type and extent of an anomaly [1,15,37,39]. Due to this, the diagnosis from med-ical images is quite challenging and often results in a low inter-rater agreement [22, 24, 56]. Depending on only pixel-wise probabilities and ignoring co-variances between the pixels might lead to misdiagnosis. In clinical practice, ag-gregating interpretations of multiple experts have shown to improve diagnosis and generate fewer false negatives [57].
In fact, utilizing the aptitude of multiple medical ex-perts has been a part of long-standing clinical traditions such as case conferences, specialist consultations, and tu-mor boards. By harnessing the power of collective intelli-gence, team-based decision-making provides safer health-care through improved diagnosis [32, 40]. Although collec-tive insight is gaining traction in healthcare for its potential
in enhancing diagnostic accuracy, the method and its im-plication remain poorly characterized in automated medical vision literature. It has been suggested that the use of artifi-cial intelligence can optimize these processes while consid-ering physician workflows in clinical settings [40].
In recent times, there has been an outstanding improve-ment in specialized deterministic models for different med-ical image segmentation tasks [13, 44, 52–55, 61]. Deter-ministic models are notorious for choosing the most likely hypothesis even if there is uncertainty which might lead to sub-optimal segmentation. To overcome this, some models incorporate pixel-wise uncertainty for segmentation tasks, however, they produce inconsistent outputs [25,26]. Condi-tional variational autoencoders (c-VAE) [48], a conditional generative model, can be fused with deterministic segmen-tation networks to produce unlimited numbers of predic-tions by sampling from the latent space conditioned on the input image. Probabilistic U-net and its variants use this technique during the inference process. Here, the latent spaces are sampled from a prior network which has been trained to be similar to c-VAE [8, 29, 30]. This dependency on a prior network as well as injecting stochasticity only at the highest resolution of the segmentation network pro-duces less diverse and blurry segmentation predictions [46].
To overcome this problem, we introduce a single inherently probabilistic model without any additional prior network that represents the collective intelligence of several experts to leverage multiple plausible hypotheses in the diagnosis pipeline (visualized in Figure 1).
Diffusion probabilistic models are a class of generative models consisting of Markov chains trained using varia-tional inference [21]. The model learns the latent structure of the dataset by modeling the diffusion process through la-tent space. A neural network is trained to denoise noisy image blurred using Gaussian noise by learning the reverse diffusion process [50]. Recently, diffusion models have been found to be widely successful for various tasks such as image generation [14], and inpainting [35]. Certain ap-proaches have also been proposed to perform semantic seg-mentation using diffusion models [6,59]. Here, the stochas-tic element in each sampling step of the diffusion model using the same pre-trained model paves the way for gen-erating multiple segmentation masks from a single input image. However, there is still no exploration of using dif-fusion models for ambiguous medical image segmentation despite its high potential.
In this paper, we propose the
CIMD (Collectivly Intelligent Medical Diffusion), which addresses ambiguous segmentation tasks of medical imag-ing. First, we introduce a novel diffusion-based probabilis-tic framework that can generate multiple realistic segmen-tation masks from a single input image. This is motivated by our argument that the stochastic sampling process of the diffusion model can be harnessed to sample multiple plausi-ble annotations. The stochastic sampling process also elim-inates the need for a separate ‘prior’ distribution during the inference stage, which is critical for c-VAE-based segmen-tation models to sample the latent distribution for ambigu-ous segmentation. The hierarchical structure of our model also makes it possible to control the diversity at each time step hence making the segmentation masks more realistic as well as heterogeneous. Lastly, in order to assess ambigu-ous medical image segmentation models, one of the most commonly used metrics is known as GED (Generalized En-ergy Distance), which matches the ground truth distribu-tion with prediction distribution.
In real-world scenarios for ambiguous medical image segmentation, ground truth distributions are characterized by only a set of samples. In practice, the GED metric has been shown to reward sam-ple diversity regardless of the generated samples’ fidelity or their match with ground truths, which can be potentially harmful in clinical applications [30]. In medical practice, individual assessments are manually combined into a single diagnosis and evaluated in terms of sensitivity. When real-time group assessment occurs, the participant generates a consensus among themselves. Lastly, the minimum agree-ment and maximum agreement among radiologists are also considered in clinical settings. Inspired by the current prac-tice in collective insight medicine, we coin a new metric, namely the CI score (Collective Insight) that considers total sensitivity, general consensus, and variation among radiolo-gists. In summary, the following are the major contributions of this work:
• We propose a novel diffusion-based framework: Col-lectively Intelligent Medical Diffusion (CIMD), that realistically models heterogeneity of the segmentation masks without requiring any additional network to pro-vide prior information during inference unlike previ-ous ambiguous segmentation works.
• We revisit and analyze the inherent problem of the current evaluation metric, GED for ambiguous models and explain why this metric is insufficient to capture the performance of the ambiguous models. We intro-duce a new metric inspired by collective intelligence medicine, coined as the CI Score (Collective Insight).
• We demonstrate across three medical imaging modal-ities that CIMD performs on par or better than the existing ambiguous image segmentation networks in terms of quantitative standards while producing supe-rior qualitative results. 2.