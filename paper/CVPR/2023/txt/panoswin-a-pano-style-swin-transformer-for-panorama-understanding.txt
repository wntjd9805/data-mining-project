Abstract
In panorama understanding, the widely used equirectan-gular projection (ERP) entails boundary discontinuity and spatial distortion. It severely deteriorates the conventional
CNNs and vision Transformers on panoramas. In this pa-per, we propose a simple yet effective architecture named
PanoSwin to learn panorama representations with ERP. To deal with the challenges brought by equirectangular projec-tion, we explore a pano-style shift windowing scheme and novel pitch attention to address the boundary discontinu-ity and the spatial distortion, respectively. Besides, based on spherical distance and Cartesian coordinates, we adapt absolute positional embeddings and relative positional bi-ases for panoramas to enhance panoramic geometry infor-mation. Realizing that planar image understanding might share some common knowledge with panorama understand-ing, we devise a novel two-stage learning framework to facilitate knowledge transfer from the planar images to panoramas. We conduct experiments against the state-of-the-art on various panoramic tasks, i.e., panoramic object detection, panoramic classification, and panoramic layout estimation. The experimental results demonstrate the effec-tiveness of PanoSwin in panorama understanding. 1.

Introduction
Panoramas are widely used in many real applications, such as virtual reality, autonomous driving, civil surveil-lance, etc. Panorama understanding has attracted increas-ing interest in the research community [5, 27, 34]. Among these methods, the most popular and convenient represen-tation of panorama is adopted via equirectangular projec-tion (ERP), which maps the latitude and longitude of the spherical representation to horizontal and vertical grid co-ordinates. However, the inherent omnidirectional vision re-mains the challenge of the panorama understanding. Al-though convolutional neural networks (CNNs) [11, 14, 28] have shown outstanding performances on planar image un-derstanding, most CNN-based methods are unsuitable for panoramas because of two fundamental problems entailed
Figure 1. (1). Fig. a is how a panoramic image looks, just like a planar world map, where top/bottom regions are connected to the earth’s poles; the right side is connected to the left. (2). Our
PanoSwin is based on window attention [19]. Fig. a also shows the original window partition in dotted orange, where the two windows in bold orange are separated by equirectangular projec-tion(ERP). (3). Fig. b shows pano-style shift windowing scheme, which brings the two departed regions together. (4). Fig. c shows our pitch attention module, which helps a distorted window to in-teract with an undistorted one. by ERP: (1) polar and side boundary discontinuity and (2) spatial distortion. Specifically, the north/south polar region in spherical representations are closely connected. But the converted region covers the whole top/bottom boundaries.
On this account, polar boundary continuity is destroyed by
ERP. Similarly, side boundary continuity is also destroyed since the left and right sides are split by ERP. Meanwhile, spatial distortion also severely deforms the image content, especially in polar regions.
A common solution is to adapt convolution to the spher-ical space [4, 5, 24, 34]. However, these methods might suf-fer from high computation costs from the adaptation pro-cess. Besides, Spherical Transformer [2] and PanoFormer
[22] specially devise patch sampling approaches to remove
the specially designed panoramic distortion. However, patch sampling approaches might not be feasible for planar images. In our experiments, we demonstrate that exploiting planar knowledge can boost the performance of panorama understanding.
Inspired by Swin Transformer to reduce
[19], we propose
PanoSwin Transformer the distortion of panoramic images, as briefly shown in Fig. 1. To cope with boundary discontinuity, we explore a pano-style shift win-dowing scheme (PSW). In PSW, side continuity is estab-lished by horizontal shift. To establish polar continuity, we first split the panorama in half and then rotate the right half counterclockwise. To overcome spatial distortion, we first rotate the pitch of the panorama by 0.5π. So the polar re-gions of the original feature map are “swapped” with some equator regions of the rotated panorama. For each win-dow in the original panorama, we locate a corresponding window in the rotated panorama. Then we perform cross-attention between these two windows. We name the module pitch attention (PA), which is plug-and-play and can be in-serted in various backbones. Intuitively, pitch attention can help a window “know” how it looks without distortion.
To leverage planar knowledge, some works [24, 25] proposed to make novel panoramic kernel mimick out-puts from planar convolution kernel layer by layer. How-ever, PanoSwin is elaborately designed to be compati-ble with planar images: PanoSwin can be switched from pano mode to vanilla swin mode. Let PanoSwin in these two modes be denoted as PanoSwinp and PanoSwins.
PanoSwinp/PanoSwins can be adopted to process panora-mas/planar images, details about which will be introduced in Sec. 3.6. In our paper, PanoSwin is under pano mode by default. The double-mode feature of PanoSwin makes it possible to devise a simple two-stage learning paradigm based on knowledge preservation to leverage planar knowl-edge: we first pretrain PanoSwins with planar images; then we switch it to PanoSwinp and train it with a knowledge preservation (KP) loss and downstream task losses. This paradigm is able to facilitate transferring common visual knowledge from planar images to panoramas.
Our main contributions are summarized as follows: (1)
We propose PanoSwin to learn panorama features, in which
Pano-style Shift Windowing scheme (PSW) is proposed to resolve polar and side boundary discontinuity; (2) we pro-pose pitch attention module (PA) to overcome spatial dis-tortion introduced by ERP; (3) PanoSwin is designed to be compatible with planar images. Therefore, we proposed a
KP-based two-stage learning paradigm to transfer common visual knowledge from planar images to panoramas; (4) we conduct experiments on various panoramic tasks, including panoramic object detection, panoramic classification, and panoramic layout estimation on five datasets. The results have validated the effectiveness of our proposed method. 2.