Abstract
Localization in a pre-built map is a basic technique for robot autonomous navigation. Existing mapping and local-ization methods commonly work well in small-scale envi-ronments. As a map grows larger, however, more mem-ory is required and localization becomes inefficient. To solve these problems, map sparsification becomes a prac-tical necessity to acquire a subset of the original map for localization. Previous map sparsification methods add a quadratic term in mixed-integer programming to enforce a uniform distribution of selected landmarks, which requires high memory capacity and heavy computation. In this pa-per, we formulate map sparsification in an efficient linear form and select uniformly distributed landmarks based on 2D discretized grids. Furthermore, to reduce the influence of different spatial distributions between the mapping and query sequences, which is not considered in previous meth-ods, we also introduce a space constraint term based on 3D discretized grids. The exhaustive experiments in different datasets demonstrate the superiority of the proposed meth-ods in both efficiency and localization performance. The relevant codes will be released at https://github. com/fishmarch/SLAM_Map_Compression. 1.

Introduction
To realize autonomous navigation for robots, localiza-tion in a pre-built map is a basic technique. Lots of algo-rithms have been proposed for mapping and localization us-ing different sensors, including camera [20] and lidar [27].
These algorithms commonly work well in some small-scale environments now. When applied in large-scale environ-ments or in long-term, however, new challenges appear and need to be settled for practical applications. Some of these problems are time and memory consuming.
When using cameras, visual simultaneous localization and mapping (SLAM) is a commonly used method to build maps.
In visual SLAM, redundant features are extracted from images and then constructed as landmarks in a map,
Figure 1. Localization results in a compact map. The original map is constructed from sequence 00 of the KITTI dataset [14].
The original map consists of 141K landmarks, indicated by gray points; while the compact map consists of only 5K landmarks, indicated by blue points. 96.15% of the query images are localized successfully in the compact map, indicted by green poses. such that camera poses can be tracked robustly and accu-rately. These redundant landmarks promise good localiza-tion results in small-scale environments. As more and more images are received when working in large-scale environ-ments or in long-term, however, memory consumption is increasing unboundedly. Localizing in such large maps will also be more time-consuming. These problems are espe-cially severe for some low-cost robots.
Actually, not all landmarks are necessary for robots to localize in pre-built maps. In theory, even only 4 matched landmarks can determine a camera pose using EPnP [16] (more landmarks are commonly used for robust and ac-curate estimation). This reveals that maps can be com-pressed and still retain comparable performance for local-ization. Map compression can be classified into two types: descriptor compression [5, 18, 22] and landmark sparsifica-tion [17, 23]. The research of this paper falls in the latter
one, which is to find a subset of an original map while main-taining comparable localization performance. A subset map is called compact map in this paper. For example, as indi-cated in Fig. 1, only 3.91% of the original landmarks are selected as the compact map, in which more than 96% of the query images can still be localized successfully.
To select an optimal subset for localization, map sparsi-fication is related to a K-cover problem [17], which means the number of landmarks in a compact map is minimized while keeping the number of associated landmarks in each image larger than a threshold (i.e., K). To solve the K-cover problem, it can be formulated as mixed-integer lin-ear programming, through which an optimal subset is ob-tained. The original formulation only considers the number of landmarks for localization, while their distribution also affects localization performance. Therefore, some works design and add quadratic terms, formulating mixed-integer quadratic programming to enforce a more uniform distri-bution of selected landmarks [11, 23]. However, these quadratic terms slow down the optimization speed heav-ily. The required high memory capacity and heavy com-putation become severe limitations of these map sparsifica-tion methods. For example, in our experiments, the mixed-integer quadratic programming methods cannot be used for the maps containing more than 55K landmarks, because all computer memory has been consumed.
To select uniformly distributed landmarks and at the same time maintain the computation efficiency, we keep map sparsification formulation in a linear form in this pa-per. We firstly discretize images into 2D fix-sized grids.
Then for all observed landmarks, we can find which cells they fall in. Therefore, more occupied cells reflect a more uniform distribution of landmarks. This can be formulated in a linear form easily. In this way, uniformly distributed landmarks are selected efficiently, and thus the localization performance in compact maps will be better.
Another severe limitation is that all of past works assume the spatial distribution of the query sequence is close to that of the mapping sequence. Then landmarks are selected only based on their association with the images of the mapping sequence. However, this assumption cannot be guaranteed in real robotic applications. The perspective difference be-tween query and mapping sequences may cause the local-ization in compact maps to fail unexpectedly.
To ensure more query images from whole 3D space can be localized successfully in compact maps, we propose to select landmarks based on not only their association with mapping images but also their visibility in 3D space. The visibility region of a landmark is defined based on its view-ing angle and distance. The 3D space is also discretized into a 3D discretized grid. For each 3D cell, all visible land-marks are collected, and a constraint on the number of visi-ble landmarks is added into map sparsification formulation.
In this way, landmarks are selected to maintain localization performance for query images from the whole space.
In summary, the contributions of this paper are as fol-lows: 1) We propose an efficient map sparsification method formulating uniform landmark distribution in a linear form to keep the computation efficiency. 2) We propose to per-form map sparsification involving the visibility of land-marks to achieve better localization results for the query images from the whole space. 3) We conduct exhaustive ex-periments in different datasets and compare with other state-of-the-art methods, showing the effectiveness and superior-ity of our methods for different kinds of query sequences. 2.