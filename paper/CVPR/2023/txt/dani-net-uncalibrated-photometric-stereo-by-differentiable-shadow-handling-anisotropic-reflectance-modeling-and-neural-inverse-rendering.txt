Abstract
Uncalibrated photometric stereo (UPS) is challenging due to the inherent ambiguity brought by the unknown light.
Although the ambiguity is alleviated on non-Lambertian ob-jects, the problem is still difficult to solve for more general objects with complex shapes introducing irregular shad-ows and general materials with complex reflectance like anisotropic reflectance. To exploit cues from shadow and reflectance to solve UPS and improve performance on gen-eral materials, we propose DANI-Net, an inverse render-ing framework with differentiable shadow handling and anisotropic reflectance modeling. Unlike most previous methods that use non-differentiable shadow maps and as-sume isotropic material, our network benefits from cues of shadow and anisotropic reflectance through two differen-tiable paths. Experiments on multiple real-world datasets demonstrate our superior and robust performance. 1.

Introduction
Photometric stereo (PS) [48] aims at recovering the sur-face normal from several images captured under varying
It has been ap-light conditions with a fixed viewpoint. plied to many fields (e.g., movies production [6], indus-trial quality inspection [47], and biometrics [53]) due to its advantage in recovering fine-detailed surfaces over other approaches [10, 16] (e.g., multi-view stereo [38], active sensor-based solutions [61]). Light calibration is crucial to the performance [52]. However, it is also tedious, restricting the applicability of PS. Therefore, uncalibrated photometric stereo (UPS) methods estimating surface normal with un-known lights have been widely studied in the literature.
*Corresponding author
Uncalibrated photometric stereo suffers from General
Bas-Relief (GBR) ambiguity [4] for an integrable, Lam-bertian surface. However, GBR ambiguity is alleviated on a non-Lambertian surface [13]. Therefore, recent ad-vances in UPS (e.g., [26,56]) adopt the isotropic reflectance model accounting for non-Lambertian effects to solve UPS.
Nonetheless, such a model restricts methods’ performance on objects with more general (e.g., anisotropic) materials, while modeling general reflectance is challenging due to extra unknowns, which eventually make UPS intractable.
Other works (e.g., [25, 56, 57]) notice the benefits of the shadow cues in utilizing global shape-light information to solve PS/UPS because the shadow reflects the interaction of shape and light [24, 59]. However, these methods either fail to exploit the shadow cues due to the lack of a differ-entiable path from the shadow to the concerned unknowns like shape [25], or the shadow cues have limited effects on the visible shape reconstruction due to the implicit shape representation [56, 57].
To this end, this paper proposes the DANI-Net, which solves UPS by Differentiable shadow handling, Anisotropic reflectance modeling, and Neural Inverse Rendering.
DANI-Net builds the differentiable path in the sequence of inverse rendering errors, shadow maps, and surface nor-mal maps (or light conditions) (Fig. 1) to fully exploit the shadow cues to solve UPS. Since those cues facilitate solv-ing extra unknowns introduced by a more sophisticated reflectance model, DANI-Net manages to build up such a model (Fig. 1) to improve the performance on general materials. During optimization, DANI-Net propagates in-verse rendering errors via two paths of shadow cues and anisotropic reflectance, respectively, and simultaneously optimizes the shape (i.e., the depth map and surface nor-mal map), anisotropic reflectance model, shadow map, and light conditions (i.e., direction and intensity). As a result,
may refer to [40, 54, 65] for more summaries on supervised
PS methods and neural reflectance representation methods.
Unsupervised calibrated photometric stereo. The baseline method (LS [48]) assumes Lambertian surface and solves PS via least squares optimization. A category of tra-ditional methods considers the non-Lambertian reflectance as outliers [3, 12, 49, 50]. Another category of tradi-tional methods either adopt analytic models (e.g., Torrance-Sparrow [13], Ward [1, 12, 14], Bi-polynomial [64], etc.) or utilize the general reflectance features (e.g., isotropy [2], monotonicity [17], anisotropic properties [14, 18]). Tradi-tional methods rely on optimizers tailored to specific as-sumptions, making them computationally efficient but less accurate. In contrast, although learning-based approaches are more computationally demanding, they could offer su-perior performance on general objects. Recently, a group of learning-based unsupervised methods (TM18 [43] and
LL22 [25]) has been proposed to estimate the spatially vary-ing BRDFs and the surface normal with known lights.
Uncalibrated photometric stereo. Early works either hold the Lambertian assumption and exploit extra clues from reflectance [28, 39, 58] or make additional assump-tions of light source distribution [28, 34, 39, 51, 66] to al-leviate GBR ambiguity [4] in UPS. Supervised methods (CH19 [8], CW20 [10], and SK22 [37]) achieve promis-ing performance on public benchmark datasets. However, these methods assume the light intensity distributing in a pre-defined range (i.e., [0.2, 2]) and solve UPS in two-stage, making them suffer from the data bias (between synthetic training data and real-world ones) and the accumulating er-rors. Recently, SCPS-NIR [26] utilizes the neural inverse rendering method to jointly optimize light and surface nor-mal in an unsupervised manner based on local reflectance information, free from data bias and accumulating errors.
The proposed DANI-Net also addresses UPS in an unsuper-vised manner, but it differs from all previous works in two aspects. 1) Our method builds a differentiable path in the sequence of inverse rendering errors, shadow maps, and sur-face normal maps (or light conditions), which fully exploits shadow cues containing global shape-light information to solve UPS. 2) Our method introduces the anisotropic re-flectance model in solving UPS, which improves the perfor-mance on general materials. Besides, as compared with [26] that calculates shadow maps by image binarization and fixes them during training, our method computes shadow maps from shapes and constantly updates them during training.
Shadow handling in photometric stereo. Supervised learning-based methods [8, 10, 37] handle shadow implic-itly by learning priors from training data, while unsu-pervised ones often consider the shadow as the outliers (e.g., [25, 26, 34, 43, 48, 60]). Aware of useful cues in the shadow, several works utilize the shadow information ex-plicitly by involving the shadow in inverse rendering to
Figure 1. The proposed DANI-Net differs from other PS or UPS methods in two aspects: 1) Shadow Handling. The path in the se-quence of inverse rendering errors, shadow maps, and surface nor-mal maps (or light conditions) of the DANI-Net is differentiable; 2) Reflectance Modeling. DANI-Net adopts an anisotropic re-flectance model. The state-of-the-art UPS method SCPS-NIR [26] is compared in this figure. As can be observed, the proposed
DANI-Net produces a smoother and more realistic shadow map of copper BUNNY thanks to the differentiable shadow handling and renders a more realistic copper BALL image and Bidirectional Re-flectance Distribution Function (BRDF) sphere (of the reference point) due to the anisotropic reflectance modeling. Data of copper
BUNNY and BALL are from DILIGENT102 [36].
DANI-Net achieves state-of-the-art performance on several real-world benchmark datasets. In a nutshell, our contribu-tions are summarized as follows:
• We propose a differentiable shadow handling method that facilitates exploiting shadow cues with global shape-light information to solve UPS. Experimental results demonstrate its effectiveness in shadow map re-covery and surface normal estimation.
• We introduce an anisotropic reflectance model that de-scribes both isotropic and anisotropic materials to im-prove performance on general materials. Experimental results demonstrate its effectiveness on surface normal estimation for objects with a broad range of isotropic and anisotropic materials.
• We propose the DANI-Net that simultaneously opti-mizes shape, anisotropic reflectance, shadow map, and light conditions in an unsupervised manner, propagat-ing inverse rendering errors through two paths involv-ing the shadow cues and anisotropic reflectance, re-spectively. DANI-Net achieves state-of-the-art perfor-mance on several real-world benchmark datasets. 2.