Abstract
During industrial processing, unforeseen defects may arise in products due to uncontrollable factors. Although unsupervised methods have been successful in defect local-ization, the usual use of pre-trained models results in low-resolution outputs, which damages visual performance. To address this issue, we propose PyramidFlow, the first fully normalizing flow method without pre-trained models that enables high-resolution defect localization. Specifically, we propose a latent template-based defect contrastive lo-calization paradigm to reduce intra-class variance, as the pre-trained models do. In addition, PyramidFlow utilizes pyramid-like normalizing flows for multi-scale fusing and volume normalization to help generalization. Our com-prehensive studies on MVTecAD demonstrate the proposed method outperforms the comparable algorithms that do not use external priors, even achieving state-of-the-art perfor-mance in more challenging BTAD scenarios. 1.

Introduction
Due to the uncontrollable factors in the complex in-dustrial manufacturing process, unforeseen defects will be brought to products inevitably. As the human visual system has the inherent ability to perceive anomalies [25], quality control relies on manual inspection for a long time. How-ever, large-scale images and tiny defects are challenging for manual inspection, so increasing research is focused on au-tomated machine vision inspection. Among all the meth-ods, supervised deep learning has achieved great success.
It relies on annotated datasets to learn discriminative fea-tures, effectively overcoming the hand-crafted shortcom-ings. However, because of insufficient negative samples, the high demand for labels, and the absence of prior knowl-edge, those approaches based on supervised learning may
Illustration of various anomaly localization methods.
Figure 1. (a) Reconstruction-based method. (b) Anomaly-based method, where NF denotes normalizing flow. (c) Our PyramidFlow, which combines latent templates and normalizing flow, enables high-resolution localization. suffer in identifying unseen defects in practices,
Recently, unsupervised methods have been applied to defect detection, as shown in Fig. 1(a,b). Reconstruction-based methods [4, 15, 23, 29] are the most famous, which take reconstructed images as templates and then apply ex-plicit contrast in image space to achieve high-resolution lo-calization. However, reconstructing using decoders is an ill-posed inverse problem, it is hard to reconstruct com-plex details. To overcome the above limitations, anomaly-based methods [6, 7] utilizing texture-aware pre-trained models achieves high image-level performance, which also damages pixel-level visual performance. One of the most promising methods is convolutional normalizing flows [10, 22, 27], which models the probability distribution further from pre-trained features, earning higher performance.
In this paper, a Pyramid Normalizing Flow (Pyramid-Flow) is proposed. It develops the idea of templates from image space into latent space by normalizing flow, then performing contrast ∆zd for high-resolution anomaly lo-calization, as shown in Fig. 1(c). Specifically, we propose the multi-scale Pyramid Coupling Block, which includes
invertible pyramid and volume normalization, as the crit-ical module to construct volume-preserving PyramidFlow.
To the best of our knowledge, PyramidFlow is the first
UNet-like fully normalizing flow specifically designed for anomaly localization, analogous to UNet [19] for biomed-ical image segmentation. Our main contributions can be summarized as follows.
• We propose a latent template-based defect contrastive localization paradigm. Similar to the reconstruction-based methods, we perform contrast localization in la-tent space, which avoids the ill-posedness and reduces intra-classes variance efficiently.
• We propose PyramidFlow, which includes invertible pyramids and pyramid coupling blocks for multi-scale fusing and mapping, enabling high-resolution defect localization. Additionally, we propose volume normal-ization for improving generalization.
• We conduct comprehensive experiments to demon-strate that our advanced method outperforms compa-rable algorithms that do not use external priors, and even achieves state-of-the-art performance in complex scenarios. 2.