Abstract
One-to-one set matching is a key design for DETR to establish its end-to-end capability, so that object detection does not require a hand-crafted NMS (non-maximum sup-pression) to remove duplicate detections. This end-to-end signature is important for the versatility of DETR, and it has been generalized to broader vision tasks. However, we note that there are few queries assigned as positive sam-ples and the one-to-one set matching significantly reduces the training efficacy of positive samples. We propose a sim-ple yet effective method based on a hybrid matching scheme that combines the original one-to-one matching branch with an auxiliary one-to-many matching branch during training.
Our hybrid strategy has been shown to significantly im-prove accuracy. In inference, only the original one-to-one match branch is used, thus maintaining the end-to-end merit and the same inference efficiency of DETR. The method is named
-DETR, and it shows that a wide range of rep-resentative DETR methods can be consistently improved across a wide range of visual tasks, including Deformable-DETR, PETRv2, PETR, and TransTrack, among others.
Code is available at: https://github.com/HDETR.
H 1.

Introduction
Since the success of pioneering work DEtection TRans-former (DETR) [4] on object detection tasks, DETR-based approaches have achieved significant progress on various fundamental vision recognition tasks such as object detec-tion [46, 53, 77, 83], instance segmentation [11, 12, 22, 73], panoptic segmentation [8, 28, 59, 70, 74], referring expres-sion segmentation [64, 69], video instance segmentation [7, 60, 65], pose estimation [23, 54, 55], multi-object track-ing [6, 45, 56], monocular depth estimation [16, 26], text detection & layout analysis [42, 50, 51, 80], line segment detection [66], 3D object detection based on point clouds
†Equal contribution. ♮: Core contribution.
‡(cid:0) {yuhui.yuan,hanhu}@microsoft.com or multi-view images [1,27,47,62], visual question answer-ing [19, 43], and so on.
Many follow-up efforts have improved DETR from var-ious aspects, including redesigning more advanced trans-former encoder [13, 83] or transformer decoder architec-tures [3,14,46,76,83] or query formulations [21,33,63,77].
Different from most of these previous efforts, we focus on the training efficacy issues caused by one-to-one matching, which only assigns one query to each ground truth. For ex-ample, Deformable-DETR typically only selects less than 30 queries from a pool of 300 queries to match with the ground truth for each image, as nearly 99% of the COCO images consist of less than 30 bounding boxes annotations, while the remaining more than 270 queries will be assigned as ∅ and are supervised with only classification loss, thus suffering from very limited localization supervision.
To overcome the drawbacks of one-to-one matching and unleash the benefits of exploring more positive queries, we present a very simple yet effective hybrid match-ing scheme, which introduces an additional one-to-many matching branch that assigns multiple queries to each pos-itive sample. In inference, we only use the original one-to-one decoder branch supervised with the one-to-one match-ing loss. We find that this simple approach can substan-tially improve the training efficacy, especially regarding the fitting of positive queries. Since only the original one-to-one matching branch is used in inference, the merits of the original DETR framework are almost all maintained, for ex-ample, avoiding NMS. Our approach also has no additional computation overhead compared to the original version.
H
We dub the hybrid matching approach as
-DETR, and extensively verify its effectiveness using a variety of vision tasks that adopt DETR methods or the variants, as well as different model sizes ranging from ResNet-50/Swin-T to Swin-L. The visual tasks and the corresponding DETR-based approaches include Deformable-DETR [83] for im-age object detection, PETRv2 [36] for 3D object detection from multi-view images, PETR [54] for multi-person pose estimation, and TransTrack [56] for multi-object tracking.
-DETR achieves consistent gains over all of them, as
The
H
Figure 1. Illustrating the improvements of our hybrid matching scheme across five challenging vision tasks including 2D object detection, 2D panoptic segmentation, 2D pose estimation, 3D object detection, and multi-object tracking (from left to right). Our hybrid matching scheme gains +1.7%, +1.1%, +1.5%, +1.6%, +1.7%, and +1.6% over various DETR-based approaches on 6× benchmarks respectively.
All the improvements are obtained under the same training epochs and do not require any additional computation cost during evaluation.
We choose VoVNetV2 [20]/ResNet50 for PETRv2/all other methods as the backbone following their original settings. shown in Figure 1. Specifically, our approach can improve the Deformable DETR framework (R50) on COCO object detection by +1.7% mAP (48.7% v.s. 47.0%), the PETR framework (R50) on COCO pose estimation by +1.6% mAP (70.9% v.s. 69.3%). In particular, we achieve 59.4% mAP on COCO object detection, which is the highest accu-racy on COCO object detection among DETR-based meth-ods that use the Swin-L model. We achieve 52.38% on nuScenes val, which is +1.7% higher than a very recent state-of-the-art approach of PETRv2. 2.