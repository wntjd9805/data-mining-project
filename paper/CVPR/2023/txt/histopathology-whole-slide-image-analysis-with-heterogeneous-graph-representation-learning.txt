Abstract
Graph-based methods have been extensively applied to whole slide histopathology image (WSI) analysis due to the advantage of modeling the spatial relationships among dif-ferent entities. However, most of the existing methods fo-cus on modeling WSIs with homogeneous graphs (e.g., with homogeneous node type). Despite their successes, these works are incapable of mining the complex structural re-lations between biological entities (e.g., the diverse inter-action among different cell types) in the WSI. We propose a novel heterogeneous graph-based framework to lever-age the inter-relationships among different types of nu-clei for WSI analysis. Specifically, we formulate the WSI as a heterogeneous graph with “nucleus-type” attribute to each node and a semantic similarity attribute to each edge.
We then present a new heterogeneous-graph edge attribute transformer (HEAT) to take advantage of the edge and node heterogeneity during massage aggregating. Further, we design a new pseudo-label-based semantic-consistent pooling mechanism to obtain graph-level features, which can mitigate the over-parameterization issue of conven-tional cluster-based pooling. Additionally, observing the limitations of existing association-based localization meth-ods, we propose a causal-driven approach attributing the contribution of each node to improve the interpretability of our framework. Extensive experiments on three pub-lic TCGA benchmark datasets demonstrate that our frame-work outperforms the state-of-the-art methods with consid-erable margins on various tasks. Our codes are available at https://github.com/HKU-MedAI/WSI-HGNN. 1.

Introduction
Histopathology slides provide rich information on diag-nosis and treatment planning for many cancer diseases. The
*The first two authors contributed equally to this work.
Figure 1. Left: Input WSI. Middle: A WSI with selected patches and associated node types. (Black - no label; cyan - neoplastic; red - inflammatory; blue - connective; yellow - dead; green - non-neoplastic epithelial). Right: Constructed heterogeneous graph with different types of nodes and edge attributes (Illustrative). recent technological advancements in tissue digital scanners facilitate the development of whole slide histopathology im-age (WSI) analysis. However, traversing through the WSI with diverse magnifications is time-consuming and tedious for pathologists due to the large-scale nature of the WSI (e.g., its typical size is 60,000 × 60,000 pixels). Hence deep learning techniques play an important role as they introduce accurate and automated analysis of WSIs, which can signif-icantly relieve the workload of pathologists.
Since it is difficult to fit the complete WSI into the mem-ory, most of the works adopt multiple instance learning (MIL) to divide the WSI into instances and then aggre-gate them for WSI analysis. However, these methods op-erate on bags of instances that do not emphasize the inter-relationships between these instances. Recently, the emer-gence of graph neural networks (GNNs) has made large progress in representing the spatial relationships between instances. As a result, there are many attempts to represent the WSIs as graphs of instances. Figure 1 presents an exam-ple of a graph constructed from WSI. Unlike convolutional neural networks (CNNs) that aggregate features based on locality in the Euclidean space, GNNs focus on locality on graph topology, which offers more flexibility in analyzing the deep connections between features in the image data be-yond the spatial locality [1]. For example, GNNs are able to learn relational information and distinguish cells based on their apposition to tumor cells, or normal stroma (i.e., cells which are tumor-infiltrating lymphocytes or from an adjacency inflammatory response), which are important for prognosis [5, 27].
However, existing paradigms on graph-based WSI anal-ysis focus on representing the WSI with a homogeneous graph structure and then predicting the response via vanilla
GNNs with cluster-based pooling (i.e., based on similarities of node embeddings). Despite their successes, these meth-ods suffer from several drawbacks: (i) GNNs on homoge-neous graphs focus on aggregating direct relational infor-mation from neighboring nodes, where the complex rela-tional information of the graphs is often neglected. (ii) For different graphs, the clusters defined by similarities between node embeddings have inconsistent meanings. This intro-duces a large degree of freedom in parameters and leads to over-parameterization issue [2]. Therefore, GNNs tend to easily overfit due to a lack of identifiability [14].
In view of these limitations, we propose a novel frame-work for WSI analysis, which leverages a heterogeneous graph to learn the inter-relationships among different types of nodes and edges. The heterogeneous graph introduces a
“nucleus-type” attribute to each node, which can serve as an effective data structure for modeling the structural inter-actions among the nuclei in the WSI. To tackle the aggrega-tion process in the heterogeneous graph, we propose a novel heterogeneous-graph edge attribute transformer (HEAT) ar-chitecture which can take advantage of the edge and node heterogeneity. Thus, the diverse structural relations among different biological entities in the WSI can be incorporated to guide the GNN for more accurate prediction. Further, to obtain the graph-level representations for slide-level pre-diction, we propose a semantic-consistent pooling mecha-nism — pseudo-label (PL) pooling, which pools node fea-tures to graph level based on clusters with a fixed definition (i.e., nucleus type). The proposed PL pooling can regularize the graph pooling process by distilling the context knowl-edge (i.e., pathological knowledge) from a pretrained model to alleviate the over-parameterization issue [2]. Addition-ally, we propose a Granger causality [13] based localization method to identify the potential regions of interest with clin-ical relevance to provide more insights to pathologists and promote the clinical usability of our approach.
We extensively evaluate our method on three TCGA pub-lic benchmark datasets, including colon adenocarcinoma cancer (COAD) and breast invasive carcinoma (BRCA) datasets from the TCGA project [35] and the Camelyon 16 dataset [3], and compare to various latest state-of-the-art (SOTA) methods. Our method outperforms the competitors on cancer staging, cancer classification, cancer typing, and localization tasks. 2.