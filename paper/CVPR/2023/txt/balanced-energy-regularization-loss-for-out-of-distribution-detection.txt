Abstract
In the field of out-of-distribution (OOD) detection, a pre-vious method that use auxiliary data as OOD data has shown promising performance. However, the method pro-vides an equal loss to all auxiliary data to differentiate them from inliers. However, based on our observation, in various tasks, there is a general imbalance in the distribution of the auxiliary OOD data across classes. We propose a balanced energy regularization loss that is simple but generally ef-fective for a variety of tasks. Our balanced energy regular-ization loss utilizes class-wise different prior probabilities for auxiliary data to address the class imbalance in OOD data. The main concept is to regularize auxiliary samples from majority classes, more heavily than those from minor-ity classes. Our approach performs better for OOD detec-tion in semantic segmentation, long-tailed image classifica-tion, and image classification than the prior energy regular-ization loss. Furthermore, our approach achieves state-of-the-art performance in two tasks: OOD detection in seman-tic segmentation and long-tailed image classification. 1.

Introduction
Deep neural networks are used in a variety of fields such as image classification [22] and semantic segmenta-tion [11]. However, there is a challenge in the practical use of deep neural networks in areas where safety is crucial, such as autonomous driving and medical diagnosis [20, 25].
In particular, deep neural networks have the issue of provid-ing high confidence to out-of-distribution (OOD) samples that are not used for training [15]. As a result, Maximum softmax probability (MSP) score has been proposed to iden-tify these OOD samples [17]. Based on the score, OOD de-tection performance is evaluated by metrics (e.g. AUROC,
FPR). Both in image classification [18, 24, 26, 29, 30, 38, 40, 43, 46](including long-tailed image classification [43]) and semantic segmentation [1–3, 5, 10, 12, 16, 19, 28, 33, 36, 41],
*Work done as an intern at RideFlux. different approaches have been suggested to enhance the
OOD detection performance. Among them, we concentrate on the methods using auxiliary data as OOD data which in-dicate superior OOD detection performance to the previous methods that only use in-distribution samples.
Outlier Exposure (OE) utilizes an auxiliary dataset of outliers to improve OOD detection performance [18]. The auxiliary data is consist of classes that do not overlap with the in-distribution data and the test OOD data. OE leverages the cross-entropy loss for the existing training data and the regularization loss for the auxiliary data. The cross-entropy loss that results from giving the auxiliary data a uniform label is the regularization loss of OE. Meanwhile, a new energy score has been introduced in Energy-based OOD detection (EnergyOE) which replaces the MSP score [29].
Furthermore, EnergyOE suggests an energy regularization loss that differs from that of OE to enhance performance.
The squared hinge loss for energy with every existing (in-distribution) piece of data and every auxiliary (OOD) piece of data is added to create the energy regularization loss.
Similarly, in semantic segmentation, the OOD detection performance is enhanced by using the auxiliary dataset of the outlier. Meta-OOD [5] organized the auxiliary dataset of the outlier by scenes of the COCO dataset [27]. Although the process of creating the auxiliary data is different from image classification, the training loss is comparable. Meta-OOD adopts the regularization loss proposed by OE. Re-cently, PEBAL [41] also adopts energy regularization loss proposed by EnergyOE.
However, when regularizing auxiliary data, the existing methods for OOD detection do not take into account varia-tions between auxiliary data samples. The variations are se-vere especially on real data such as semantic segmentation for autonomous driving. As seen in Figure 1a, for the pre-trained model, the class distribution of the auxiliary OOD data is not uniform across classes, i.e., imbalanced. To ad-dress the imbalanced problem, we regularize the auxiliary data differently for each sample. To achieve this, we pro-pose a balanced energy regularization loss to apply higher regularization to majority classes than minority classes in
(a) (b)
Figure 1. Overview of our approach in semantic segmentation task (a): Class distribution of cut-pasted OOD pixels collected from 10000 synthesized scene images ; (b): OOD detection result in Fishyscapes validation sets. Our balanced energy PEBAL(Ours) is the method that substitutes the energy regularization loss in PEBAL [41] with our balanced energy regularization loss. auxiliary data. In other words, auxiliary samples of major-ity classes receive a larger energy constraint than samples of minority classes. We introduce the term Z, which indicates whether a sample belongs to the majority or minority of a class. Z is the weighted sum of the softmax output of the classification model for a sample (i.e., the posterior prob-ability of a class for a given sample), where the weight is the prior probability for the class. Unlike the existing en-ergy regularization loss, our balanced energy regularization loss adjusts to the value of Z for an auxiliary data sample.
Two adaptive loss components make up our loss: loss mar-gin and loss weight. The adaptive loss margin provides an additional Z-proportional margin in the squared hinge loss for auxiliary data. The adaptive loss weight gives a weight proportional to Z to the squared hinge loss.
We confirm our novel loss in three tasks: semantic seg-mentation, long-tailed image classification, and image clas-sification. The proposed loss is simple but generally effec-tive for various tasks. Figure 1b illustrates how our method outperforms the previous state-of-the-art (SOTA) algorithm
PEBAL in the semantic segmentation task by replacing the energy regularization loss with our loss. OOD detection per-formance is also enhanced when using our loss compared to the baseline (EnergyOE) which use only energy regular-ization loss. In all image classification tasks, we evaluate our method on semantically coherent OOD detection (SC-OOD) benchmark [46]. In long-tailed image classification task, our approach reveals superior OOD performance com-pared to both OE and EnergyOE methods which use auxil-iary data. In addition, our approach outperforms the pre-vious SOTA method PASCL [43], Similarly, in the image classification task, we demonstrate the superiority of our loss by outperforming both OE and EnergyOE, which make use of auxiliary data. The contributions are summarized as:
• By making inferences based on previously trained models, we explain the imbalanced distribution of aux-iliary OOD data.
• We suggest a novel balanced energy regularization loss to address the class imbalance in auxiliary OOD data.
• The proposed balanced loss performs better for OOD detection than the previous energy regularization loss.
• The SOTA performance for OOD detection in two tasks is achieved by our OOD detection method. 2.