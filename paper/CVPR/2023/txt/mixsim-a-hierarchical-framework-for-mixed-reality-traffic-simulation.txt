Abstract
The prevailing way to test a self-driving vehicle (SDV) in simulation involves non-reactive open-loop replay of real world scenarios. However, in order to safely deploy SDVs to the real world, we need to evaluate them in closed-loop.
Towards this goal, we propose to leverage the wealth of interesting scenarios captured in the real world and make them reactive and controllable to enable closed-loop SDV evaluation in what-if situations. In particular, we present
MIXSIM, a hierarchical framework for mixed reality traf-ﬁc simulation. MIXSIM explicitly models agent goals as routes along the road network and learns a reactive route-conditional policy. By inferring each agent’s route from the original scenario, MIXSIM can reactively re-simulate the scenario and enable testing different autonomy sys-tems under the same conditions. Furthermore, by vary-ing each agent’s route, we can expand the scope of test-ing to what-if situations with realistic variations in agent behaviors or even safety critical interactions. Our exper-iments show that MIXSIM can serve as a realistic, reac-tive, and controllable digital twin of real world scenar-ios. For more information, please visit the project website: https://waabi.ai/research/mixsim/ 1.

Introduction
During your commute to work, you encounter an erratic driver. As you both approach a merge, the erratic driver sud-denly accelerates and nearly collides with you. Your heart skips a beat and you feel uneasy. While you’ve avoided an accident, you can’t help but wonder: What if the erratic driver was a bit more aggressive? Would you have needed to swerve? Would other drivers be able to react to you?
Having the ability to test a self-driving vehicle (SDV) in these what-if situations would be transformational for safely deploying SDVs to the real world. However, the cur-rent approach for testing SDVs in simulation lacks this abil-*Indicates equal contribution.
Figure 1. In mixed reality trafﬁc simulation, given a real world scenario, we aim to build a reactive and controllable digital twin of how its trafﬁc agents behave. This enables us to re-simulate the original scenario and answer what-if questions like: What if the
SDV lane changes? What if the agent cuts in front of the SDV? ity. In particular, the self-driving industry largely relies on non-reactive open-loop replay of real world scenarios; traf-ﬁc agents do not react to the SDV and so the SDV cannot observe the consequences of its actions. This limits the re-alism and interpretability of the tests. Clearly, naively re-playing real world scenarios in simulation is not enough!
In this paper, we propose to leverage the wealth of inter-esting scenarios captured in the real world and make them reactive and controllable to enable closed-loop SDV evalu-ation in what-if situations. We call this task mixed reality trafﬁc simulation. Speciﬁcally, given a recorded scenario, we aim to build a reactive and controllable digital twin of how its trafﬁc agents behave (see Fig. 1). The digital twin should preserve the high-level behaviors and interactions of the original scenario; e.g., a driver cutting in front of the SDV. But it should also react to changes in the envi-ronment in a realistic manner. This allows us to reactively re-simulate the original scenario to test different autonomy systems in the same conditions. It also expands the scope of testing to include what-if situations with realistic variations of agent behaviors or even safety critical interactions.
To incorporate reactivity into replaying recorded scenar-ios, the self-driving industry commonly relies on heuristic models [18, 19, 21, 38] and trajectory optimization-based
methods [14, 15]. Complementary to this, [39] use black box optimization over agent trajectories to ﬁnd safety criti-cal variations of the original scenario. The common pitfall of these methods is that the resulting scenarios do not ex-hibit human-like driving behaviors. The large sim-to-real gap precludes us from drawing meaningful conclusions of how the SDV will behave in the real world. On the other hand, recent works [2, 17, 36] capture human-like driving by learning generative models of trafﬁc scenarios from real data but can only generate free-ﬂow trafﬁc given the initial scenario context, without preserving the behaviors and in-teractions in the original scenario. This motivates the need for a simulation framework that learns human-like driving while being controllable at the behavior level.
Towards this goal, we propose MIXSIM, a hierarchical framework for mixed reality trafﬁc simulation. In our ap-proach, we explicitly disentangle an agent’s high-level goal (e.g., taking an off-ramp) from its reactive low-level ma-neuvers (e.g., braking to avoid collisions). We use routes along the road network as the goal representation and learn a reactive route-conditional policy to recover human-like driving behavior. This enables high-level controllability via specifying the agent’s route, while the low-level pol-icy ensures realistic interaction in closed-loop simulation.
MIXSIM re-simulates a recorded scenario by ﬁrst inferring each agent’s route from its original trajectory and then un-rolling the route-conditional policy. Furthermore, it enables synthesizing what-if situations by conditioning on routes sampled from a learned route-generating policy or routes optimized to induce safety critical interactions.
To understand the suitability of MIXSIM for mixed real-ity trafﬁc simulation, we conduct an analysis of its sim2real domain gap on both urban and highway trafﬁc scenarios.
Our experiments show that MIXSIM exhibits greater real-ism, reactivity, and controllability than the competing base-lines. Notably, MIXSIM achieves the lowest reconstruc-tion error when re-simulating a given scenario and the low-est collision rate when reacting to diverse SDV behaviors.
We also demonstrate MIXSIM’s ability to simulate use-ful what-if scenarios for autonomy development. Speciﬁ-cally, MIXSIM can sample diverse yet realistic what-if sit-uations that cover the space of what could have happened and generate safety critical scenarios that are far more re-alistic than existing methods. Altogether, MIXSIM unlocks closed-loop SDV evaluation in what-if scenarios of varying severity. This represents an exciting ﬁrst step towards a new paradigm for ofﬂine autonomy evaluation. 2.