Abstract
Detection-based methods have been viewed unfavorably in crowd analysis due to their poor performance in dense crowds. However, we argue that the potential of these meth-ods has been underestimated, as they offer crucial informa-tion for crowd analysis that is often ignored. Specifically, the area size and confidence score of output proposals and bounding boxes provide insight into the scale and density of the crowd. To leverage these underutilized features, we propose Crowd Hat, a plug-and-play module that can be easily integrated with existing detection models. This mod-ule uses a mixed 2D-1D compression technique to refine the output features and obtain the spatial and numerical distribution of crowd-specific information. Based on these features, we further propose region-adaptive NMS thresh-olds and a decouple-then-align paradigm that address the major limitations of detection-based methods. Our exten-sive evaluations on various crowd analysis tasks, including crowd counting, localization, and detection, demonstrate the effectiveness of utilizing output features and the poten-tial of detection-based methods in crowd analysis. Our code is available at https://github.com/wskingdom/
Crowd-Hat. 1.

Introduction
Crowd analysis is a critical area in computer vision due to its close relation with humans and its wide range of appli-cations in public security, resource scheduling, crowd mon-itoring [18, 28, 33]. This field can be divided into three concrete tasks: crowd counting [12, 17, 27], crowd local-ization [1, 23, 26], and crowd detection [16, 20, 30]. While most existing methods mainly focus on the first two tasks due to the extreme difficulty of detecting dense crowds, simply providing the number of the crowd or representing each person with a point is insufficient for the growing real-world demand. Crowd detection, which involves localiz-ing each person with a bounding box, supports more down-stream tasks, such as crowd tracking [24] and face recogni-* Indicates equal contribution
Figure 1. Our approach involves extracting output features from the detection outputs and refining them into 2D compressed matri-ces and 1D distribution vectors. These features are then encoded into local and global feature vectors to regress region-adaptive
NMS thresholds and the crowd count. We select the final output bounding boxes using the decouple-then-align paradigm. tion [35]. Therefore, constructing a comprehensive crowd analysis framework that addresses all three tasks is essential to meet real-world demands.
Although object detection may seem to meet the de-mands above, most relevant research views it pessimisti-cally, especially in dense crowds [12, 23, 27, 28, 37]. First and foremost, compared to general object detection sce-narios with bounding box annotations, most crowd analy-sis datasets only provide limited supervision in the form of point annotations. As a result, detection methods are restricted to using pseudo bounding boxes generated from point labels for training [16, 20, 30]. However, the inferior quality of these pseudo bounding boxes makes it difficult for neural networks to obtain effective supervision [1, 23].
Secondly, the density of crowds varies widely among images, ranging from zero to tens of thousands [6, 20, 22, 28, 38], and may vary across different regions in the same image, presenting a significant challenge in choosing the allowed overlapping region in Non-Maximum-Suppression (NMS). A fixed NMS threshold is often considered a hy-perparameter, but it yields a large number of false positives within low-density crowds and false negatives within high-density crowds, as criticized in [23].
Thirdly, current detection methods adopt the detection-counting paradigm [17, 27] for crowd counting, where the number of humans is counted by the bounding boxes ob-tained from the detection output. However, the crowd de-tection task is extremely challenging without bounding box labels for training, resulting in a large number of mislabeled and unrecognized boxes in crowds [23, 28]. This inaccurate detection result makes the detection-counting paradigm per-form poorly, yielding inferior counting results compared to density-based methods.
In this paper, we ask: Has the potential of object de-tection been fully discovered? Our findings suggest that crucial information from detection outputs, such as the size and confidence score of proposals and bounding boxes, are largely disregarded. This information can provide valuable insights into crowd-specific characteristics. For instance, in dense crowds, bounding boxes tend to be smaller with lower confidence scores due to occlusion, while sparse crowds tend to produce boxes with higher confidence scores.
To this end, we propose the a module on top of the Head of detection pipeline to leverage these underutilized detec-tion outputs. We name this module as “Crowd Hat” be-cause it can be adapted to different detection methods, just as a hat can be easily put on different heads. Specifically, we first introduce a mixed 2D-1D compression to refine both spatial and numerical distribution of output features from the detection pipeline. We further propose a NMS decoder to learn region-adaptive NMS thresholds from these fea-tures, which effectively reduces false positives under low-density regions and false negatives under high-density re-gions. Additionally, we use a decouple-then-align paradigm to improve counting performance by regressing the crowd count from output features and using this predicted count to guide the bounding box selection. Our Crowd Hat module can be integrated into various one-stage and two-stage object detection methods, bringing significant perfor-mance improvements for crowd analysis tasks. Extensive experiments on crowd counting, localization and detection demonstrate the effectiveness of our proposed approach.
Overall, the main contributions of our work can be sum-marized as the following:
• To the best of our knowledge, we are the first to con-sider detection outputs as valuable features in crowd analysis and propose the mixed 2D-1D compression to refine crowd-specific features from them.
• We introduce region-adaptive NMS thresholds and a decouple-then-align paradigm to mitigate major draw-backs of detection-based methods in crowd analysis.
• We evaluate our method on public benchmarks of localization, and detection tasks, crowd counting, showing our method can be adapted to different de-tection methods while achieving better performance. 2.