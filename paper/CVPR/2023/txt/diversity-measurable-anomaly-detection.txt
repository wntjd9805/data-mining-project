Abstract
Reconstruction-based anomaly detection models achieve their purpose by suppressing the generalization ability for anomaly. However, diverse normal patterns are conse-quently not well reconstructed as well. Although some ef-forts have been made to alleviate this problem by modeling sample diversity, they suffer from shortcut learning due to
In this undesired transmission of abnormal information. paper, to better handle the tradeoff problem, we propose
Diversity-Measurable Anomaly Detection (DMAD) frame-work to enhance reconstruction diversity while avoid the undesired generalization on anomalies. To this end, we design Pyramid Deformation Module (PDM), which mod-els diverse normals and measures the severity of anomaly by estimating multi-scale deformation fields from recon-structed reference to original input. Integrated with an in-formation compression module, PDM essentially decouples deformation from prototypical embedding and makes the fi-nal anomaly score more reliable. Experimental results on both surveillance videos and industrial images demonstrate the effectiveness of our method. In addition, DMAD works equally well in front of contaminated data and anomaly-like normal samples. 1.

Introduction
Visual anomaly detection is a fundamental and important problem in computer vision community, with wide applica-tions in video surveillance and industrial inspection. It aims to detect outliers from seen classes and novel patterns from unseen classes. This task is very challenging because abnor-mal data is diversely distributed and expensive to collect. So we have to construct models based on only normal samples under unsupervised setting, targeting at high discrimination between normal and abnormal samples.
During the past decade, reconstruction-based methods have achieved great progress in anomaly detection. These methods use Autoencoders (AEs) [8, 9, 20, 24, 26, 29, 40] or
Generative Adversarial Networks (GANs) [1, 19, 32] to re-Figure 1. Illustration of difficulty in anomaly detection in MNIST dataset. The prototype is indicated by orange triangle and the anomaly by red point.
In this case, the anomaly can hardly be detected based on reconstruction error or distance in high-dimensional feature space. Our solution is illustrated in Fig. 2. construct the normal counterparts from any input images or video frames. AE-based methods firstly compress the in-puts to discard the information beyond normal prototypes, and then decode the embedding to reconstruct the inputs.
According to the estimated reconstruction error, the anoma-lies can be detected.
However, the performance of reconstruction-based methods for anomaly detection has long been limited by a tough problem, i.e. the tradeoff between reconstructing di-verse normals and detecting unknown anomalies. In order to discriminate anomalies more easily, previous works [8] imposes more constraints to suppress abnormal information during autoencoding, which leads to high reconstruction er-ror for diverse normal instances. For example, in Figs. 1 and 2g, the severely deformed normal (a.k.a. anomaly-like) sample “7” has even higher error than the abnormal sam-ple “4”. To better reconstruct diverse normals, each query vector correspond to multiple prototypes in the memory, which may be combined into abnormal embedding even if abnormal projection is far away from the prototype. As a consequence, anomalies that distribute in low likelihood area between prototypical embedding are difficult to iden-tify from diverse normals. MNAD [29] introduces skip-connection for diverse reconstruction and additional con-straints to get round the incorrect combination problem.
But the latter forces model transmit more unrestrained in-from the abnormal ones. Therefore, we design PDM to model the diversity of normals as well as the severity of anomalies. More specifically, PDM learns hierarchical two-dimensional deformation fields (Fig. 2c,d) that describe the pixel-level transformation direction and distance from ref-erence (Fig. 2b, which is reconstructed from prototypes in memory) to original input. In ICM, we learns compressed representation as sparse prototypes. As a result, a sin-gle memory item is enough to represent each normal clus-ter. This is more compact than other memory-based works which require multiple memory items.
Integrating PDM with ICM, DMAD essentially decouples the deformation information (Fig. 2e) from class prototypes and makes the final anomaly score more discriminative (Fig. 2f).
We evaluate our anomaly detection framework in scenar-ios of video surveillance and industrial defect detection. To apply DMAD in the latter scenario, we propose a variant of
PDM, PPDM, to deal with the false positive issue in texture reconstruction. Extensive experimental results verify the ef-ficacy of our approach. Moreover, our method works well even in front of contaminated data and anomaly-like nor-mals. The main contributions of our work are as follows:
• We introduce diversity-measurable anomaly detection framework which allows reconstruction-based models to achieve better tradeoff between reconstructing diverse normals and detecting unknown anomalies.
• We propose pyramid deformation module to implement diversity measurement, in which the deformation infor-mation is explicitly separated from compact class pro-totypes and the resulting diversity measure is positively correlated to abnormality.
• Our approach outperforms previous works on video anomaly detection and industrial defect detection, and works well in front of contaminated data and anomaly-like normals, demonstrating its broad suitability and ro-bustness. 2.