Abstract
Deep learning has been utilized in knowledge-based ra-diotherapy planning in which a system trained with a set of clinically approved plans is employed to infer a three-dimensional dose map for a given new patient. However, previous deep methods are primarily limited to simple sce-narios, e.g., a ﬁxed planning type or a consistent beam an-gle conﬁguration. This in fact limits the usability of such approaches and makes them not generalizable over a larger set of clinical scenarios. Herein, we propose a novel con-ditional generative model, Flexible-Cm GAN, utilizing ad-ditional information regarding planning types and various beam geometries. A miss-consistency loss is proposed to deal with the challenge of having a limited set of condi-tions on the input data, e.g., incomplete training samples.
To address the challenges of including clinical preferences, we derive a differentiable shift-dose-volume loss to incor-porate the well-known dose-volume histogram constraints.
During inference, users can ﬂexibly choose a speciﬁc plan-ning type and a set of beam angles to meet the clinical re-quirements. We conduct experiments on an illustrative face dataset to show the motivation of Flexible-Cm GAN and fur-ther validate our model’s potential clinical values with two radiotherapy datasets. The results demonstrate the supe-rior performance of the proposed method in a practical het-erogeneous radiotherapy planning application compared to existing deep learning-based approaches. 1.

Introduction
Radiation therapy (RT) is an essential modality for can-cer treatment and is applicable to about 50% of patients
[12, 25]. However, many studies demonstrate that millions of patients currently do not have access to radiotherapy due to limited infrastructures and trained experts to handle com-plex planning procedures [15, 20, 59].
RT treatment planning is a process that involves a multi-disciplinary team (e.g., oncologists, therapists, physicists) to ﬁgure out the treatment beam conﬁgurations and intensity for cancer patients [25]. The modern RT treatments can be
Figure 1. Vanilla image-to-image translation (a) and dose predic-tion (b)-(d). (a) has a clear shape match between the source and target domains. (b)-(d) illustrate our challenges, including hetero-geneous patterns, no clear match between source and target, and 3D data (showing 2D for simplicity) is harder than 2Ds. divided into two broad categories using static- or dynamic-beams. The intensity modulated radiotherapy (IMRT) [56] and volumetric modulated arc therapy (VMAT) [48, 57] are the most common static- and dynamic- beam types, respec-tively [10]. IMRT uses several personalized but ﬁxed beam angles, delivering radiation precisely to the tumor while sparing the surrounding normal tissues according to the lo-cation of the tumor and anatomical organs at risk (OARs).
During VMAT, the treatment beam is on while its treatment head is moving on an arc trajectory [10]. As shown in Fig-ure 1, the dose maps of static- and dynamic- beam RT plans can look signiﬁcantly different, which results from differ-ent delivery nature energy ﬂuences in those two modes.
Moreover, even using the same planning mode, different conﬁgurations (e.g., beam angles, isocenter) are needed for different patients due to different tumor locations/shapes, anatomy structures, and other clinical parameters.
Knowledge-based planning (KBP) aims to use computer technologies to reduce the time for individualized treatment plans [6, 43]. Historically, KBP technologies relied on sta-tistical models or handcrafted features [46, 54]. While pro-viding promising results, these methods are hard to gener-alize beyond an inherently targeted limited set of scenar-ios [33]. Advanced artiﬁcial intelligence (e.g., deep learn-ing [37]) has shown great potential to alter the way oncol-ogy therapies are administered [25, 53]. An integral part of
KBP methods is to predict the dose distribution that should be delivered to a patient [6,32,59]. Three-dimensional (3D) deep learning models have been applied in dose map pre-diction across different cancers [7, 32, 33, 41, 45, 55] where the inputs are generally computed tomography (CT) im-age/volume and masks of organs at risk (OARs) / planning target volume (PTV). However, the existing automatic dose prediction models mainly focus on relatively simple scenar-ios, e.g., single planning mode or/and consistent angle con-ﬁguration, which signiﬁcantly limits the model ﬂexibility.
In this paper, we propose a novel conditional generative model, ﬂexible-multiple-condition GAN, short for Flexible-Cm GAN or FCGAN, for precise 3D dose prediction in heterogeneous RT contexts. In addition to the conditions (CT, PTV/OAR masks) that other methods in literature have used, we further integrate two conditions: the planning mode (i.e., static- or dynamic- beam) and the angle conﬁg-uration. Furthermore, we show that our model is robust in those scenarios where angle conﬁguration may not be avail-able. Brieﬂy, our contributions include
• We proposed a novel GAN variant, FCGAN, that con-siders multi-level conditions and handles missing con-dition values with a new miss-consistency loss.
• We derived a differentiable and spatially-unbiased loss function from a widely applied dose-volume histogram and show its effectiveness within the deep learning training for 3D dose prediction.
• We introduced the deep 3D dose prediction for prac-tical heterogeneous treatment scenarios (i.e., multi-type, multi-beam conﬁguration), which enables easy and fast user-interaction by changing input conditions and checking results interactively during inference.
• We conducted experiments on two clinical radiother-apy datasets and a face dataset, validating that our ap-proach is superior to state-of-the-art deep models. 2.