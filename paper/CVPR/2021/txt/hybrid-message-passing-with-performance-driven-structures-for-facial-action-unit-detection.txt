Abstract
Message passing neural network has been an effective method to represent dependencies among nodes by propa-gating messages. However, most of message passing algo-rithms focus on one structure and messages are estimated by one single approach. For real-world data, like facial action units (AUs), the dependencies may vary in terms of different expressions and individuals. In this paper, we propose a novel hybrid message passing neural network with performance-driven structures (HMP-PS), which com-bines complementary message passing methods and cap-tures more possible structures in a Bayesian manner. Par-ticularly, a performance-driven Monte Carlo Markov Chain sampling method is proposed for generating high perfor-mance graph structures. Besides, hybrid message passing is proposed to combine different types of messages, which provide the complementary information. The contribution of each type of message is adaptively adjusted along with different inputs. The experiments on two widely used bench-mark datasets, i.e., BP4D and DISFA, validate that our pro-posed method can achieve the state-of-the-art performance. 1.

Introduction
Facial action units (AUs) detection is an essential tech-nique to analyze human expressions in the ﬁeld of artiﬁcial intelligence. Ekman proposed Facial Action Coding Sys-tem (FACS) [10] to model the relation between facial mus-cle movements, i.e., AUs, and facial expressions. There-fore, more studies estimate the human emotions and facial behaviors via facial AU detection.
Convolutional neural networks (CNN) [15, 27, 41, 26, 44] have been extensively applied to various classiﬁcation and regression tasks because of the powerful local feature representation capabilities. However, for facial AU detec-tion, the structural information and dependencies among
Figure 1. Some facial images and AU occurrences for happiness expression. The AUs with blue nodes are common AU occur-rences and the AUs with green nodes are different AU occurrences.
Even for the same expression, the AU occurrences and dependen-cies may be different. For example, AU6 (Cheek Raiser) occurs in the ﬁrst image and does not occur in the second image. different AUs [17] should be taken into consideration dur-ing AU detection. CNN can not fully characterize the re-lationships among different AUs. Recently, graph neural networks [13, 7, 9], also called message passing neural net-works (MPNN), have been popular algorithm to charac-terize the objects and their dependencies. Recent studies
[23, 11] employ message passing neural networks to solve facial AU related tasks.
Generally, previous studies [17, 38] utilized prior knowl-edge from FACS or training labels to deﬁne the graph structure so as to represent the dependencies among AUs.
These common dependencies among AUs can provide use-ful structural information. However, one type of constant relationship among AUs is not sufﬁcient to fully character-ize the sophisticated correlations among AUs. The depen-dencies among AUs may vary given different expressions.
Besides, individual difference is also a factor to induce dif-ferent correlations among AUs. Even for the same expres-sion, as shown in Figure 1, AU occurrences can be differ-ent. Therefore, different graph structures should be taken into consideration for effectively capturing different types of dependencies for AU detection. 6267
For the graph structure of MPNN, some studies focused on gradient-based methods to learn the discrete structure by bilevel training [12]. However, the gradient-based is easy to fall into the local optimal solution. Another popular graph structure learning strategy is sampling-based method.
Metropolis-Hasting Monte Carlo Markov Chain sampling (MH-MCMC) [14] is commonly applied to structure learn-ing in probabilistic graphical model, which can sample an ensemble of graph structures with the goodness of ﬁt to data. To improve the effectiveness of message passing neu-ral networks, more effective ways to generate graph struc-tures from data are necessary to be exploited.
Although there are many different ways to deﬁne mes-sages, most of message passing neural networks [13, 39] propagate information by only providing one type of mes-sage. For facial AUs, some AUs are positively correlated, like AU4 (brow lower) and AU7 (lid tightener), and some
AUs are negatively correlated, like AU12 (lip corner puller) and AU15 (lip corner depressor). Apparently, traditional message passing algorithms can not fully characterize these different relationships among AUs. More message cate-gories and more effective ways to combine different mes-sages should be provided to represent diverse dependencies and propagate the complementary information.
Based on aforementioned considerations, in this paper, we propose a novel hybrid message passing neural net-work with performance-driven structures (HMP-PS) for fa-cial AU detection, which generates the predictions by con-sidering different graph structures in a Bayesian manner.
For the structure of MPNN, traditional MH-MCMC sam-pling draws the distribution of graph structure based on data likelihood. Different from MH-MCMC, we focus on sam-pling graph structures based on their performances on facial
AU detection. Therefore, we propose performance-driven
Monte Carlo Markov Chain sampling (P-MCMC) to gener-ate the graph structures with high performance. And then, the graph structures with high performance can be used for
MPNN. Besides, we propose the hybrid message passing to dynamically combine three types of messages such that more complementary information can be dynamically prop-agated among different nodes.
The contributions of this paper can be summarized as follows:
• We propose performance-driven Monte Carlo Markov
Chain sampling to generate high performance graph structures.
• We propose the hybrid message passing to dynami-cally combine different types of messages to exploit their complementary information.
• Our method achieves better performance than the state-of-the-art methods on two widely used bench-mark datasets, i.e., BP4D and DISFA. 2.