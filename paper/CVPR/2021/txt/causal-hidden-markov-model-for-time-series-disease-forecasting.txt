Abstract
We propose a causal hidden Markov model to achieve robust prediction of irreversible disease at an early stage, which is safety-critical and vital for medical treatment in early stages. Speciﬁcally, we introduce the hidden variables which propagate to generate medical data at each time step.
To avoid learning spurious correlation (e.g., confounding bias), we explicitly separate these hidden variables into three parts: a) the disease (clinical)-related part; b) the dis-ease (non-clinical)-related part; c) others, with only a),b) causally related to the disease however c) may contain spu-rious correlations (with the disease) inherited from the data provided. With personal attributes and disease label re-spectively provided as side information and supervision, we prove that these disease-related hidden variables can be disentangled from others, implying the avoidance of spu-rious correlation for generalization to medical data from other (out-of-) distributions. Guaranteed by this result, we propose a sequential variational auto-encoder with a refor-mulated objective function. We apply our model to the early prediction of peripapillary atrophy and achieve promising results on out-of-distribution test data. Further, the abla-tion study empirically shows the effectiveness of each com-ponent in our method. And the visualization shows the ac-curate identiﬁcation of lesion regions from others. 1 1.

Introduction
Future disease forecasting is especially important for those irreversible diseases, such as Alzheimer’s Disease
[25] and eye diseases [1]. Forecasting at an early stage provides the doctors with a window to implement medi-cal treatment/intervention such as drug or physical exer-cise, in order to slow down or alleviate the disease progres-sion. However, such early forecasting can face the follow-1This project is released on: https://sites.google.com/view/causal-hmm ing challenges: i) the incomplete information for forecast-ing, i.e., the lack of medical observation of the future stage; ii) the medical data (such as images and clinical measure-ments) can suffer from distributional change across popu-lations or hospitals, the forecasting on which is known as out-of-distribution (OOD) generalization that can fail many existing supervised learning models (such as adversarial at-tack [6]).
Existing works for future disease forecasting can be roughly categorized into two classes: 1) forecasting with additional supervisions; 2) forecasting based on generation of future image. For the ﬁrst class(e.g., [12, 21, 11, 27]), this additional supervision can refer to disease labels at each time step or the target image at future stage. Therefore, they can not be adopted to scenarios when these supervi-sions are lacked (e.g., the disease label at the current stage is unprovided due to labeling cost). For the second class(e.g.,
[19], they aim to exploit latent space to generate the sequen-tial medical images, which can be followed by a disease classiﬁer for disease prediction. Although these methods can achieve accurate generation [19], they may suffer from learning spurious correlated features due to biases inherited from the data provided. These biases can refer to corre-lated but disease-unrelated information such as background or clinical attributes, which are data-dependent and hence may not be robust to other data distributions (i.e., out-of-distribution).
To avoid spurious correlation to enable robust forecast-ing, we propose Causal Hidden Markov Model (Causal-HMM) in which we explicitly separate the disease-causative features from others, and model them using hid-den variables that propagate to generate the medical obser-vation, as encapsulated in the causal graph in Fig. 1. Specif-ically as shown, among all hidden variables, i.e., s, v, z that generate the medical image x, only s, v are causally related to the disease label y. Taking peripapillary atrophy disease
[15] as an example, the v is related to the clinical measure-ments that are relevant to the disease (denoted as A, e.g., 112105
Axial length, Corneal thickness, Corneal curvature) and the s is related to other disease-related aspects that beyond clin-ical measurements but can be reﬂected in the retinal image (e.g., Maculopathy, Fundus morphology, choroidal vessels).
The propagation of these hidden variables are confounded by personal attributes (denoted as B such as age, gender, etc.), making the z spuriously correlated with the disease and can be learned according to intrinsic bias from observed data. We theoretically show that the hidden variables (i.e., s, v) can be possibly identiﬁed from observational distri-bution, beneﬁted from the explicit separation of s, v and z. To the best of our knowledge, we are the ﬁrst to provide the identiﬁability result for sequential data in the supervised scenario. For practical inference, we reformulate a new se-quential VAE framework that conforms to the causal model above. The disentangled disease-related hidden variables are used for future disease prediction.
We apply our method on an in-house dataset of peripapil-lary atrophy (PPA) which is related to many irreversible eye diseases. The dataset is divided into training set, validation set and test set with the ﬁrst two share the same distribu-tion. The empirical results show that compared with other methods, our Causal-HMM can achieve much better pre-diction accuracy on the out-of-distribution test set, imply-ing the ability to handle spurious correlation of our method.
The ablative studies show the effectiveness of each compo-nent in our method. The visualization further shows that the identiﬁed disease-causative hidden variables by our model are concentrated on the disease-related regions. Our contri-bution can be summarized as follows:
• Methodologically, we propose a novel Causal Hidden
Markov Model of sequential data for future disease forecasting;
• Algorithmically, we reformulate a new sequential
VAE framework, which is aligned with the causal model above;
• Theoretically, we provide an identiﬁability result, the which implicitly ensures disentanglement of disease-causative latent features from others;
• Experimentally, we achieve SOTA prediction result for the peripapillary atrophy forecasting problem, on the out-of-distribution test dataset. 2.