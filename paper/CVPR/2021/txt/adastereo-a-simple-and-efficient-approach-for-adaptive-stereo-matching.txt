Abstract
Recently, records on stereo matching benchmarks are con-stantly broken by end-to-end disparity networks. However, the domain adaptation ability of these deep models is quite poor. Addressing such problem, we present a novel domain-adaptive pipeline called AdaStereo that aims to align multi-level representations for deep stereo matching networks.
Compared to previous methods for adaptive stereo match-ing, our AdaStereo realizes a more standard, complete and effective domain adaptation pipeline. Firstly, we propose a non-adversarial progressive color transfer algorithm for input image-level alignment. Secondly, we design an efﬁcient parameter-free cost normalization layer for internal feature-level alignment. Lastly, a highly related auxiliary task, self-supervised occlusion-aware reconstruction is presented to narrow down the gaps in output space. Our AdaStereo mod-els achieve state-of-the-art cross-domain performance on multiple stereo benchmarks, including KITTI, Middlebury,
ETH3D, and DrivingStereo, even outperforming disparity networks ﬁnetuned with target-domain ground-truths. 1.

Introduction
The stereo matching task aims to ﬁnd all corresponding pixels in a stereo pair, and the distance between correspond-ing pixels is known as disparity [12]. Based on the epipolar geometry, stereo matching enables stable depth perception, hence it supports further applications such as scene under-standing, object detection, odometry, and SLAM.
Recent stereo matching methods typically adopt fully con-volutional networks [21] to regress disparity maps directly and have achieved state-of-the-art performance on stereo benchmarks [7, 25, 30]. However, the performance of these methods adapted from synthetic data to real-world scenes is limited. As shown in Fig. 1, the PSMNet [4] pretrained on
⋆ indicates equal contribution.
Figure 1. Overview examples. Left-right: KITTI [25] and Middle-bury [30]. Top-down: left image, disparity maps predicted by the
SceneFlow-pretrained PSMNet [4], and by our Ada-PSMNet. the SceneFlow dataset [24] fails to produce good results on the Middlebury [30] and KITTI [25] datasets. Therefore, in-stead of designing complicated networks for higher accuracy on speciﬁc datasets, how to obtain effective domain-adaptive stereo matching models is more desirable now.
In this work, we aim at the important but less explored problem of domain adaptation in stereo matching. Consider-ing the fact that there are a great number of synthetic data but only a small number of realistic data with ground-truths, we focus on domain gaps between synthetic and realistic domains. We ﬁrst analyse main differences between these two domains, as shown in Fig. 2. At the input image level, color and brightness are the obvious gaps. By making statis-tics on the internal cost volumes, we also ﬁnd signiﬁcant differences in distributions. Moreover, geometries of the output disparity maps are inconsistent as well. In order to bridge the domain gaps at these levels (input image, internal cost volume, and output disparity), we propose AdaStereo, a standard and complete domain adaptation pipeline for stereo 10328
matching, in which three particular modules are presented:
• For input image-level alignment, the non-adversarial progressive color transfer algorithm is presented to align input color space between source and target do-mains during training. It is the ﬁrst attempt that adopts a non-adversarial style transfer method to align input-level inconsistency for stereo domain adaptation, avoid-ing harmful side-effects of geometrical distortions from
GAN-based methods [56]. Furthermore, the proposed progressive update strategy enables capturing represen-tative target-domain color styles during adaptation.
• For internal feature-level alignment, the cost normal-ization layer is proposed to align matching cost dis-tribution. Oriented to the stereo matching task, two normalization operations are designed and embedded in this layer: (i) channel normalization reduces the in-consistency in scaling of each feature channel; and (ii) pixel normalization further regulates the norm distribu-tion of pixel-wise feature vector for binocular match-ing. Compared to previous general normalization layers (e.g. IN [42], DN [54]), our cost normalization layer is parameter-free and adopted only once in the network.
• For output-space alignment, we conduct self-supervised learning through a highly related auxiliary task, self-supervised occlusion-aware reconstruction, which is the ﬁrst proposed auxiliary task for stereo domain adap-tation. Concretely, a self-supervised module is attached upon the main disparity network, to perform image reconstructions on the target domain. To address the ill-posed occlusion problem in reconstruction, we also de-sign a domain-collaborative learning strategy for occlu-sion mask predictions. Through occlusion-aware stereo reconstruction, more informative geometries from tar-get scenes are involved in model training, thus beneﬁt-ing disparity predictions across domains.
Figure 2. Comparisons of input images, internal cost volumes, and output disparity maps between synthetic and real-world datasets.
Left-right: SceneFlow [24] and Middlebury [30]. Top-down: input image, internal cost volume, and output disparity map. Disparity maps are rendered by the same color map.
• We propose a novel domain adaptation pipeline, includ-ing three modules to narrow down the gaps at input image level, internal feature level, and output space.
• Our domain-adaptive models outperform other domain-invariant methods, and even ﬁnetuned disparity net-works on multiple stereo matching benchmarks. 2.