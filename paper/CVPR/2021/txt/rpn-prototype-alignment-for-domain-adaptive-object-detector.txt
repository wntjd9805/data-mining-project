Abstract
Recent years have witnessed great progress of object de-tection. However, due to the domain shift problem, apply-ing the knowledge of an object detector learned from one speciﬁc domain to another one often suffers severe perfor-mance degradation. Most existing methods adopt feature alignment either on the backbone network or instance clas-siﬁer to increase the transferability of object detector. Dif-ferently, we propose to perform feature alignment in the
RPN stage such that the foreground and background RPN proposals in target domain can be effectively distinguished.
Speciﬁcally, we ﬁrst construct one set of learnable RPN pro-totpyes, and then enforce the RPN features to align with the prototypes for both source and target domains. It essentially cooperates the learning of RPN prototypes and features to align the source and target RPN features. Particularly, we propose a simple yet effective method suitable for RPN fea-ture alignment to generate high-quality pseudo label of pro-posals in target domain, i.e., using the ﬁltered detection re-sults with IoU. Furthermore, we adopt Grad CAM to ﬁnd the discriminative region within a foreground proposal and use it to increase the discriminability of RPN features for alignment. We conduct extensive experiments on multiple cross-domain detection scenarios, and the results show the effectiveness of our proposed method against previous state-of-the-art methods. 1.

Introduction
Object detection is a fundamental task in computer vi-sion, which aims to identify and localize objects of inter-est in an image. In the past decade, a great progress has been witnessed for object detection due to the advance of large-scale benchmarks and modern CNN-based detection frameworks, such as Fast/Faster R-CNN [15, 41]. Cur-rently, state-of-the-art detectors generally require massive training samples with annotations of bounding boxes and semantic labels. Particularly, the detection model learned
∗Corresponding author (a) Comparison of detection performance among
Figure 1.
”Source only”, ”SWDA” [42], ”Ours”, and ”Oracle”, where the normal case and adding ground truth boxes are tested. (b) Com-parison of recall among different methods with the IoU threshold of 0.5. Here Sim10k [24]→Cityscapes [7] is adopted as the bench-mark. Best viewed in color. from the data in a domain (i.e., source domain) would in-cur severe performance degradation when facing some new environment (i.e., target domain) where object appearance, background, or weather condition make a difference [49].
At the same time, accurately annotating all new samples usually involve heavy labor and high cost. To address this challenge, unsupervised domain adaptation (UDA) [37] is developed to adapt the model learned from the annotated source samples to the target samples, i.e., enabling the model work well in target domain by incorporating unla-beled samples.
Evidently, UDA need learn the knowledge useful for tar-get domain from the data of source domain. A common practice is to build invariant feature representation across domains, which essentially enforces to align the feature distributions of two domains. To this end, the measure of domain shift is usually minimized, e.g., correlation dis-tances [32, 39, 34, 62]. Recently, domain adversarial learn-ing is widely adopted and achieves promising performance by conducting a min-max game between object detector and domain discriminator [13, 33, 21, 50]. Along previous works [6, 42], we particularly focus on the domain adapta-tion problem of two-stage object detectors in this paper.
Regarding cross-domain object detection, several works learning into have attempted to incorporate adversarial 12425
mainstream detection frameworks, e.g., Faster R-CNN.
Typically, a two-stage object detector can be split into three main modules, i.e., backbone network, region proposal net-work (RPN), and region proposal classiﬁer (RPC). Due to locality nature of the object detection task, current meth-ods usually minimize the domain disparity at multiple lev-els via adversarial feature adaptation, such as image and in-stance alignment [6], strong-local and weak-global align-ment [42], and multi-level feature alignment [19, 58]. Most of these works conduct feature alignment in either backbone network or RPC, and hold a common belief that in domain adversarial learning, the foreground regions should be given more attentions to increase the transferability of interested objects and meanwhile alleviate the negative effect of back-ground noises. Different from previous methods, we focus on the transerability of RPN across domains in this work.
Actually, RPN plays an important role in domain adap-tion of object detectors. To intuitively show its effect, here we particularly conduct an analysis experiment to investi-gate the upper bound of RPN. To be speciﬁc, we add the ground-truth bounding boxes into the RPN proposals in the test phase, and then use them to infer the ﬁnal detection results as usual. Figure 1(a) give the performance compari-son of before and after adding ground truth, where different methods are used, including source only, SWDA [42], our method, and Oracle. Comparing source only and Oracle, we can observe that the quality of RPN proposals is espe-cially important for cross-domain object detection. In ad-dition, SWDA can reduce the performance gap although it only performs feature alignment in backbone network. This is because SWDA actually can produce higher quality pro-posals with larger RPN recall than source only, as shown in Figure 1(b). However, only aligning features in back-bone network is not enough to generate high-quality RPN proposals since domain adversarial learning on backbone network ignores to distinguish the discriminability of fore-ground and background.
In object detection, an RPN proposal commonly con-tains the foreground and background contents, and their ra-tio varies a lot for different proposals. Such a characteristic makes RPN feature alignment very challenging since the foreground features are inevitably contaminated by various background noises. Moreover, the interested objects usu-ally involve many semantic categories, but they would be uniﬁed into foreground in RPN. In RPN feature alignment, therefore, we need carefully balance different object classes in order to make the ﬁnal detection work well.
In this paper, we propose a novel RPN prototype align-ment method to separately align foreground and back-ground RPN features. Speciﬁcally, we ﬁrst construct a set of learnable RPN prototpyes, and then enforce the RPN fea-tures in both source and target domains to align with the corresponding prototypes. Through cooperating with RPN prototype learning, the RPN features in source and target domains can be effectively aligned. In this paradigm, the pseudo label of proposals in target domain need be ﬁrst gen-erated, and we propose a simple yet effective method suit-able for RPN feature alignment. To be speciﬁc, we ﬁrst
ﬁlter the detection results after RPC to only reserve the high-conﬁdence ones, where a class-agnostic ﬁlter ratio is adopted to balance different classes. Then we use the ﬁl-tered detection results to generate the pseudo label of RPN proposals, in which IoU is used to assign proposal labels rather than the predicted scores in previous methods. Fur-thermore, to increase the discriminability of RPN features for alignment, we propose to use Grad CAM to ﬁnd the discriminative regions of a proposal and then adjust RPN features by spatially weighting. Consequently, foreground and background RPN features are better aligned, and more accurate proposals can be obtained.
The main contributions of this work are summarized as follows:
• We propose a novel RPN prototype alignment method which can signiﬁcantly improve the transferability of
RPN and further generate high-quality RPN proposals for target domain.
• We propose a simple yet effective pseudo label gen-eration method suitable for feature alignment of RPN proposals, which can effectively guide the learning of
RPN prototypes and features.
• We propose a discriminability-aware prototype align-ment module, which can improve the quality of RPN features for alignment by paying more attention on dis-criminative regions within a proposal.
• We conduct extensive experiments on multiple bench-mark scenarios, and the results demonstrate the ef-fectiveness of our proposed method against previous state-of-the-art methods. 2.