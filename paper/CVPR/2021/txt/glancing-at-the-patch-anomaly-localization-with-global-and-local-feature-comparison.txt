Abstract
Anomaly localization, with the purpose to segment the anomalous regions within images, is challenging due to the large variety of anomaly types. Existing methods typically train deep models by treating the entire image as a whole yet put little effort into learning the local distribution, which is vital for this pixel-precise task. In this work, we propose an unsupervised patch-based approach that gives due consideration to both the global and local information. More concretely, we employ a Local-Net and
Global-Net to extract features from any individual patch and its surrounding respectively. Global-Net is trained with the purpose to mimic the local feature such that we can easily detect an abnormal patch when its feature mismatches that from the context. We further introduce an Inconsistency Anomaly Detection (IAD) head and a
Distortion Anomaly Detection (DAD) head to sufﬁciently spot the discrepancy between global and local features.
A scoring function derived from the multi-head design facilitates high-precision anomaly localization. Extensive experiments on a couple of real-world datasets suggest that our approach outperforms state-of-the-art competitors by a sufﬁciently large margin. 1.

Introduction
Its primary goal
Anomaly detection has received broad attention in recent years due to its wide applications in industrial inspection [6, 7, 48, 11, 10, 32], medical diagnosis [51, 5, 46, 42], and surveillance [27, 30, 36]. is to identify anomalies from normal samples, usually treated as a bi-classiﬁcation problem. Considering the ambiguous deﬁnition of anomaly types as well as the great imbalance between sufﬁcient normal data and scarce abnormal data, a common practice is to learn the distribution of anomaly-free data and then use it as a criterion to detect outliers [43, 38, 42, 41, 14, 48].
Recent development of deep neural networks has signiﬁ-cantly advanced this task with a more powerful capability (a) (b) surrounding match / mismatch
Global-Net multi-heads
Local-Net patch global feature local feature (a) Anomaly localization results where our approach
Figure 1.
From top to can precisely segment the anomalous regions. bottom: abnormal samples, ground-truth, and anomaly score maps (b) Concept diagram of global produced by our algorithm. and local feature comparison. Local-Net and Global-Net are employed to extract features from a patch and its surrounding respectively. Multiple anomaly detection heads are designed to determine whether the global and local features match or not. in representation learning [7, 48, 28]. Most existing algorithms deploy deep models to spot anomalies at the instance level (i.e., abnormal images belongs to different categories against normal ones) by extracting global feature from the entire image [14, 38, 49, 22, 37, 43, 2]. However, in many real cases, the anomalies simply differ from the regular data at some local areas [6, 32], as shown in Fig. 1a.
From this perspective, localizing the anomalous regions at the pixel level is far more practical.
To solve this pixel-precise task, one feasible solution is to adopt generative models, such as Generative Adver-sarial Networks (GANs) [42, 41, 47] and Auto-Encoders 254
(AEs) [8, 11, 12, 51], which can produce images with per-pixel generation. But these approaches still treat each training image as a whole, omitting the learning of local information. An alternative solution is to pick patches from the image and then perform inspection on every patch to see whether there exists a defect [7, 10]. But this kind of approach does not consider the correlation between the patch and its surrounding. As a result, they can only detect the anomalous patches that have some ﬂaws inside, but fail to handle the ordinary patches that are placed in the wrong position, like the second example shown in Fig. 1a where the top cable should be in green color.
In this work, we propose a novel framework for un-supervised anomaly localization with due consideration to both the global and local information. At the training stage, given a normal image, we randomly crop a patch and introduce a Local-Net and Global-Net to extract features from this patch and its surrounding respectively, as shown in Fig. 1b. Concretely, we develop the global feature to match the local feature, encouraging the Global-Net to conjecture the feature of the missing patch based on the context. For this purpose, we learn Global-Net jointly with an Inconsistency Anomaly Detection (IAD) head and a Distortion Anomaly Detection (DAD) head, leading to a fused metric to better measure the similarity between the global and local features. At the inference stage, a scoring function developed from the multi-head feature comparison is capable of producing an adequate score map from a test image to help localize anomalous regions, as shown in
Fig. 1a. In summary, our contributions are:
• We propose a novel unsupervised anomaly localization approach by collecting both the global and local in-formation from training data. In particular, the local feature extracted from an image patch is regressed by the global feature extracted from its surrounding.
• We introduce the multi-head feature comparison where the IAD head targets at spotting the mismatch between patches and surroundings while the DAD head aims to detect subtle defects occurring in the patch. We further derive a scoring function from this multi-head design, facilitating high-precision anomaly localization.
• We achieve state-of-the-art performances on a couple of real-world datasets, signiﬁcantly surpassing existing methods. For example, on the recent MVTec AD dataset [6], which is speciﬁcally designed to bench-mark the anomaly localization task, we beat the second competitor by 4.7% improvement (i.e., from 91.4% to 96.1%) under the per-region-overlap (PRO) metric [6]. 2.