Abstract
Existing inpainting methods have achieved promising performance in recovering defective images of speciﬁc scenes. However, ﬁlling holes involving multiple seman-tic categories remains challenging due to the obscure se-mantic boundaries and the mixture of different semantic textures. In this paper, we introduce coherence priors be-tween the semantics and textures which make it possible to concentrate on completing separate textures in a semantic-wise manner. Speciﬁcally, we adopt a multi-scale joint op-timization framework to ﬁrst model the coherence priors and then accordingly interleaving optimize image inpaint-ing and semantic segmentation in a coarse-to-ﬁne manner.
A Semantic-Wise Attention Propagation (SWAP) module is devised to reﬁne completed image textures across scales by exploring non-local semantic coherence, which effectively mitigates the mix-up of textures. We also propose two coher-ence losses to constrain the consistency between the seman-tics and the inpainted image in terms of the overall structure and detailed textures. Experimental results demonstrate the superiority of our proposed method for challenging cases with complex holes. 1.

Introduction
High-quality image inpainting aims to ﬁll in missing re-gions with synthetic content [1, 2, 5]. It requires both se-mantically meaningful structures and visually pleasing tex-tures. To this end, deep learning-based methods [24, 39, 42, 44, 46, 47] resort to encoder-decoder based networks to infer the context of a corrupted image and then reﬁne the texture details in the initial inference of a missing region by some tools, such as non-local algorithms. Although current image inpainting methods have made signiﬁcant progress, it still poses technical challenges in completing complex holes, particularly when a missing region involves multi-ple sub-regions with different semantic classes. The main reason falls in the failure of modeling the prior distributions
Figure 1: Upper part: Mapping between image textures and edges/semantics (Dot arrow - extraction of edges/semantics; solid arrow - texture generation). Notice that two similar edge patches in a green circle could be mapped to completely different semantic textures, but one semantic will be clearly mapped to a certain tex-ture category. Lower part: an example showing two similar edge patches map to two different semantic textures. of a mixture of different semantic regions, which usually result in blurry boundaries and unrealistic textures [15, 16].
A feasible approach is to adopt structural information, such as edges [12, 21], contours [38], and smooth im-ages [26], as guidance to complete missing structures and textures in two steps. The assumption is that structures of-fer semantic clues for inferring an unknown scene, mak-ing them suitable for guiding the ﬁlling of textures. How-ever, we notice that the correspondence between structural information and textures is not apparent, making the ﬁlled textures still highly rely on the local correlation around the missing region. Figure 1 demonstrates the ambiguity of the mapping from mid-level structures (e.g., the edges) to the textures, which can signiﬁcantly degrade the visual authen-ticity of the generated textures. 6539
Compared with mid-level structures, high-level seman-tic information offers more vital semantic clues to the ob-ject textures. For example, in Figure 1, the semantic animal leads to ﬂuffy fur while the semantic tree leads to green leaf in the image, which cannot be usually distinguished solely from their mid-level structures.
In contrast, object textures have been shown to provide sufﬁcient information about the semantic classes [7, 11]. Thus we characterize the relationships between the semantics and textures of objects as coherence priors and build our inpainting method on the coherence priors to complete complex holes while ensuring the mutual consistency between the predicted semantics and textures.
Based on the above motivation, we propose to utilize co-herence priors between semantics and textures to facilitate joint optimization of semantic segmentation and image in-painting. To this end, our framework extracts a shared fea-ture to represent the common information of the two tasks, and characterize the interaction between scales to enable the utilization of coherence priors to optimize the two tasks jointly. Speciﬁcally, two novel designs are proposed: 1)
A Semantic-Wise Attention Propagation (SWAP) module is used to explicitly capture the semantic relevance between an unknown (missing) area and the known regions. As a result, when mapping semantics to image textures, ﬁlling in an un-known patch only refers to those known patches with the same semantic, rather than to the entire image, to avoid ir-relevant texture ﬁlling. 2) We devise two loss terms to learn the global and local coherence relationships, respectively.
The image-level structure coherence loss is used to super-vise the structural matching between the inpainted image and the corresponding segmentation map to generate clear boundaries in the inpainted image. Besides, the non-local patch-level coherence loss aims to assess the distribution of patch textures in the semantic domain to encourage the gen-erated textures to be as similar as the matched known patch of the same semantics.
Unlike the existing semantics-guided inpainting meth-ods, such as SPG-Net [28] and SGE-Net [15], which syn-thesize textures by convolution to involve the local seman-tic information, our proposed method predicts the textures and the semantics simultaneously, and borrows the known texture feature of the same semantic to ﬁll in a missing region by a semantics-guided non-local means, which not only ensures realistic textures but also is valuable for se-mantic recognition.
The main contributions of our paper are three-fold:
• We propose a novel semantic-wise attention propa-gation module, which generates semantically realistic textures by capturing distant relationships and refer-ring to the texture feature of the same semantic in the feature maps.
• Our approach outperforms existing state-of-the-art im-age inpainting methods [15, 21, 43, 45] on completing complex hole with multiple semantic regions in terms of the sharpness of boundaries and the coherence and visual plausibility of textures. 2.