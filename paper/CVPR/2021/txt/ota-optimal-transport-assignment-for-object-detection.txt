Abstract
Recent advances in label assignment in object detec-tion mainly seek to independently deﬁne positive/negative training samples for each ground-truth (gt) object. In this paper, we innovatively revisit the label assignment from a global perspective and propose to formulate the assign-ing procedure as an Optimal Transport (OT) problem – a well-studied topic in Optimization Theory. Concretely, we deﬁne the unit transportation cost between each deman-der (anchor) and supplier (gt) pair as the weighted sum-mation of their classiﬁcation and regression losses. After formulation, ﬁnding the best assignment solution is con-verted to solve the optimal transport plan at minimal trans-portation costs, which can be solved via Sinkhorn-Knopp
Iteration. On COCO, a single FCOS-ResNet-50 detector equipped with Optimal Transport Assignment (OTA) can reach 40.7% mAP under 1× scheduler, outperforming all other existing assigning methods. Extensive experiments conducted on COCO and CrowdHuman further validate the effectiveness of our proposed OTA, especially its superior-ity in crowd scenarios. The code is available at https:
//github.com/Megvii-BaseDetection/OTA. 1.

Introduction
Current CNN-based object detectors [27, 30, 21, 47, 33, 29, 36] perform a dense prediction manner by predicting the classiﬁcation (cls) labels and regression (reg) offsets for a set of pre-deﬁned anchors1. To train the detector, deﬁning cls and reg targets for each anchor is a necessary procedure, which is called label assignment in object detection.
Classical label assigning strategies commonly adopt pre-deﬁned rules to match the ground-truth (gt) object or back-ground for each anchor. For example, RetinaNet [21] adopts
Intersection-over-Union (IoU) as its thresholding criterion
*Corresponding author 1For anchor-free detectors like FCOS [38], the feature points can be viewed as shrunk anchor boxes. Hence in this paper, we collectively refer to anchor box and anchor point as “anchor”.
GT1
GT2
GT1
GT2
GT BBoxes
A Set of Ambiguous Anchor Points
Figure 1. An illustration of ambiguous anchor points in object de-tection. Red dots show some of the ambiguous anchors in two sample images. Currently, the assignment of these ambiguous an-chors is heavily based on hand-crafted rules. for pos/neg anchors division. Anchor-free detectors like
FCOS [38] treat the anchors within the center/bbox re-gion of any gt object as the corresponding positives. Such static strategies ignore a fact that for objects with different sizes, shapes or occlusion condition, the appropriate posi-tive/negative (pos/neg) division boundaries may vary.
Motivated by this, many dynamic assignment strategies have been proposed. ATSS [47] proposes to set the divi-sion boundary for each gt based on statistical characteris-tics. Other recent advances [48, 19, 51, 16] suggest that the predicted conﬁdence scores of each anchor could be a proper indicator to design dynamic assigning strategies, i.e., high conﬁdence anchors can be easily learned by the net-works and thus be assigned to the related gt, while anchors with uncertain predictions should be considered as nega-tives. Those strategies enable the detector to dynamically choose positive anchors for each individual gt object and achieve state-of-the-art performance.
However, independently assigning pos/neg samples for each gt without context could be sub-optimal, just like the lack of context may lead to improper prediction. When dealing with ambiguous anchors (i.e., anchors that are qual-iﬁed as positive samples for multiple gts simultaneously as seen in Fig. 1.), existing assignment strategies are heav-ily based on hand-crafted rules (e.g., Min Area [38], Max
IoU [16, 21, 47].). We argue that assigning ambiguous an-1303
chors to any gt (or background) may introduce harmful gra-dients w.r.t. other gts. Hence the assignment for ambiguous anchors is non-trivial and requires further information be-yond the local view. Thus a better assigning strategy should get rid of the convention of pursuing optimal assignment for each gt independently and turn to the ideology of global optimum, in other words, ﬁnding the global high conﬁdence assignment for all gts in an image.
DeTR [3] is the ﬁrst work that attempts to consider label assignment from global view. It replaces the detection head with transformer layers [39] and considers one-to-one as-signment using the Hungarian algorithm that matches only one query for each gt with global minimum loss. However, for the CNN based detectors, as the networks often pro-duce correlated scores to the neighboring regions around the object, each gt is assigned to many anchors (i.e., one-to-many), which also beneﬁts to training efﬁciency. In this one-to-many manner, it remains intact to assign labels with a global view.
To achieve the global optimal assigning result under the one-to-many situation, we propose to formulate label as-signment as an Optimal Transport (OT) problem – a special form of Linear Programming (LP) in Optimization Theory.
Speciﬁcally, we deﬁne each gt as a supplier who supplies a certain number of labels, and deﬁne each anchor as a de-mander who needs one unit label.
If an anchor receives sufﬁcient amount of positive label from a certain gt, this anchor becomes one positive anchor for that gt .
In this context, the number of positive labels each gt supplies can be interpreted as “how many positive anchors that gt needs for better convergence during the training process”. The unit transportation cost between each anchor-gt pair is de-ﬁned as the weighted summation of their pair-wise cls and reg losses. Furthermore, as being negative should also be considered for each anchor, we introduce another supplier – background who supplies negative labels to make up the rest of labels in need. The cost between background and a cer-tain anchor is deﬁned as their pair-wise classiﬁcation loss only. After formulation, ﬁnding the best assignment solu-tion is converted to solve the optimal transport plan, which can be quickly and efﬁciently solved by the off-the-shelf
Sinkhorn-Knopp Iteration [5]. We name such an assigning strategy as Optimal Transport Assignment (OTA).
Comprehensive experiments are carried out on MS
COCO [22] benchmark, and signiﬁcant improvements from OTA demonstrate its advantage. OTA also achieves the SOTA performance among one-stage detectors on a crowded pedestrian detection dataset named CrowdHu-man [35], showing OTA’s generalization ability on different detection benchmarks. 2.