Abstract
Mainstream object detectors based on the fully convolu-tional network has achieved impressive performance. While most of them still need a hand-designed non-maximum sup-pression (NMS) post-processing, which impedes fully end-to-end training. In this paper, we give the analysis of dis-carding NMS, where the results reveal that a proper label assignment plays a crucial role. To this end, for fully con-volutional detectors, we introduce a Prediction-aware One-To-One (POTO) label assignment for classiﬁcation to en-able end-to-end detection, which obtains comparable per-formance with NMS. Besides, a simple 3D Max Filtering (3DMF) is proposed to utilize the multi-scale features and improve the discriminability of convolutions in the local region. With these techniques, our end-to-end framework achieves competitive performance against many state-of-the-art detectors with NMS on COCO and CrowdHuman datasets. The code is available at https://github. com/Megvii-BaseDetection/DeFCN . 1.

Introduction
Object detection is a fundamental topic in computer vi-sion, which predicts a set of bounding boxes with pre-deﬁned category labels for each image. Most of main-stream detectors [9, 22, 30, 54] utilize some hand-crafted designs such as anchor-based label assignment and non-maximum suppression (NMS). Recently, a quite number of methods [46, 58, 5] have been proposed to eliminate the pre-deﬁned set of anchor boxes by using distance-aware and distribution-based label assignments. Although they achieve remarkable progress and superior performance, there is still a challenge of discarding the NMS post-processing, which hinders the fully end-to-end training.
To tackle this issue, Learnable NMS [13], Soft NMS [1] and other NMS variants [12, 24, 15], and CenterNet [5] are
*Equal contribution.
†This work was done at Megvii Technology.
Figure 1. As shown in the dashed box, most detectors based on the fully convolutional network adopt multiple predictions and NMS post-processing for each instance. With the proposed prediction-aware one-to-one label assignment and 3D Max Filtering, our end-to-end detector can directly perform a single prediction for each instance without post-processing. proposed to improve the duplicate removal, but they still do not provide an effective end-to-end training strategy. Mean-while, many approaches [43, 35, 26, 32, 36] based on re-current neural networks have been introduced to predict the bounding box for each instance by using an autoregressive decoder. These approaches give naturally sequential model-ing for the prediction of bounding boxes. But they are only evaluated on some small datasets without modern detectors, and the iterative manner makes the inference process inefﬁ-cient.
Recently, DETR [3] introduces a bipartite matching based training strategy and transformers with the parallel decoder to enable end-to-end detection. It achieves compet-itive performance against many state-of-the-art detectors.
However, DETR currently suffers from much longer train-ing duration to coverage and relatively lower performance on the small objects. To this end, this paper explores a new perspective: could a fully convolutional network achieve competitive end-to-end object detection?
In this paper, we attempt to answer this question in two dimensions, i.e., label assignment and network architec-ture. As shown in Fig. 1, most of fully convolutional detec-15849
tors [22, 46, 50, 21] adopt a one-to-many label assignment rule, i.e., assigning many predictions as foreground samples for one ground-truth instance. This rule provides adequate foreground samples to obtain a strong and robust feature representation. Nevertheless, the massive foreground sam-ples lead to duplicate predicted boxes for a single instance, which prevents end-to-end detection. To demonstrate it, we ﬁrst give an empirical comparison of different existing hand-designed label assignments. We ﬁnd that the one-to-one label assignment plays a crucial role in eliminating the post-processing of duplicate removal. However, there is still a drawback in the hand-designed one-to-one assignment.
The ﬁxed assignment could cause ambiguity issues and re-duce the discriminability of features, since the predeﬁned regions of an instance may not be the best choice [17] for training. To solve this issue, we propose a prediction-aware one-to-one (POTO) label assignment, which dynamically assigns the foreground samples according to the quality of classiﬁcation and regression simultaneously.
Furthermore, for the modern FPN based detector [46], the extensive experiment demonstrates that the duplicate bounding boxes majorly come from the nearby regions of the most conﬁdent prediction across adjacent scales. There-fore, we design a 3D Max Filtering (3DMF), which can be embedded into the FPN head as a differentiable module.
This module could improve the discriminability of convo-lution in the local regions by using a simple 3D max ﬁl-tering operator across adjacent scales. Besides, to provide adequate supervision for feature representation learning, we modify a one-to-many assignment as an auxiliary loss.
With the proposed techniques, our end-to-end detec-tion framework achieves competitive performance against many state-of-the-art detectors. On COCO [23] dataset, our end-to-end detector based on FCOS framework [46] and
ResNeXt-101 [49] backbone remarkably outperforms the baseline with NMS by 1.1% mAP. Furthermore, our end-to-end detector is more robust and ﬂexible for crowded detec-tion. To demonstrate the superiority in the crowded scenes, we construct more experiments on CrowdHuman [37] dataset. Under the ResNet-50 backbone, our end-to-end de-tector achieves 3.0% AP50 and 6.0% mMR absolute gains over FCOS baseline with NMS. 2.