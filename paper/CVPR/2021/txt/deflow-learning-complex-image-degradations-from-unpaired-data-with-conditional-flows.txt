Abstract
The difﬁculty of obtaining paired data remains a ma-jor bottleneck for learning image restoration and enhance-ment models for real-world applications. Current strate-gies aim to synthesize realistic training data by modeling noise and degradations that appear in real-world settings.
We propose DeFlow, a method for learning stochastic im-age degradations from unpaired data. Our approach is based on a novel unpaired learning formulation for con-ditional normalizing ﬂows. We model the degradation pro-cess in the latent space of a shared ﬂow encoder-decoder network. This allows us to learn the conditional distribu-tion of a noisy image given the clean input by solely min-imizing the negative log-likelihood of the marginal distri-butions. We validate our DeFlow formulation on the task of joint image restoration and super-resolution. The mod-els trained with the synthetic data generated by DeFlow outperform previous learnable approaches on three recent datasets. Code and trained models will be made available at: https://github.com/volflow/DeFlow 1.

Introduction
Deep learning based methods have demonstrated as-tonishing performance for image restoration and enhance-ment when large quantities of paired training data are avail-able. However, for many real-world applications, obtaining paired data remains a major bottleneck. For instance, in real-world super-resolution [23, 8, 9] and denoising [2, 3], collecting paired data is cumbersome and expensive, re-quiring careful setups and procedures that are difﬁcult to scale. Moreover, such data is often limited to certain scenes and contains substantial misalignment issues.
In many settings, including enhancement of existing image collec-tions or restoration of historic photographs, the collection of paired data is even impossible.
To tackle this fundamental problem, one promising di-rection is to generate paired training data by applying syn-a t a
D y s i o
N
DeFlow
DeFlow
Clean Data
Different Degraded Samples
Figure 1. DeFlow is able to learn complex image degradation pro-cesses from unpaired training data. Our approach can sample dif-ferent degraded versions of a clean input image (bottom) that faith-fully resemble the noise of the real data (top). thesized degradations and noise to high-quality images. The degraded image then has a high-quality ground-truth, allow-ing effective supervised learning techniques to be applied directly to the synthesized pairs. However, in most practi-cal applications the degradation process is unknown. It gen-erally constitutes a complex combination of sensor noise, compression, and post-processing artifacts. Modeling the degradation process by hand is therefore a highly challeng-ing problem, calling for learnable alternatives.
Since paired data is unavailable, learning the degradation process requires unpaired or unsupervised techniques. Sev-eral approaches resort to hand-crafted strategies tailored to speciﬁc types of degradations [17]. Existing learnable solu-tions mostly adopt generative adversarial networks (GANs) with cycle-consistency constraints [39, 23, 7] or domain-aware adversarial objectives [12, 34, 6] for unpaired train-ing. However, these approaches require careful tuning of several losses. Moreover, cycle-consistency is a weak con-straint that easily leads to changes in color and content [10].
Importantly, the aforementioned works rely on fully de-terministic mappings, completely ignoring the fundamen-tal stochasticity of natural degradations and noise. In this 94  
work, we therefore take a radically different approach.
We propose DeFlow: a novel conditional normalizing
ﬂow based method for learning degradations from unpaired data. DeFlow models the conditional distribution p(y|x) of a degraded image y given its clean counterpart x. As shown in Fig. 1, this allows us to sample multiple degraded versions y of any clean image x, which closely resemble the characteristics of the unknown degradations. However, conventional conditional ﬂow models [35, 26, 5, 1] require sample pairs (x, y) for supervised training. We therefore propose a novel formulation for conditional ﬂows, capable of unpaired learning. Speciﬁcally, we treat the unpaired set-ting as the problem of learning the conditional distribution p(y|x) from observations of the marginals p(x) and p(y).
By modeling both domains x and y in the latent space of a joint ﬂow network, we ensure sufﬁcient constraints for effective unpaired learning while preserving ﬂexibility for accurate modeling of p(y|x). We additionally introduce a method for conditioning the ﬂow on domain invariant in-formation derived from either x or y to further facilitate the learning problem.
We apply our DeFlow formulation to the problem of joint image restoration and super-resolution in the real-world setting. DeFlow is tasked with learning complex im-age degradations, which are then used to synthesize train-ing data for a baseline super-resolution model. We perform comprehensive experiments and analysis on the AIM2019
[25] and NTIRE2020 [24] real-world super-resolution chal-lenge datasets. Our approach sets a new state-of-the-art among learning-based approaches by outperforming GAN-based alternatives for generating image degradations from unpaired data on three datasets. 2.