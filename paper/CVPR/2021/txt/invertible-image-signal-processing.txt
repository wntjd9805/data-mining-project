Abstract
Unprocessed RAW data is a highly valuable image for-mat for image editing and computer vision. However, since the ﬁle size of RAW data is huge, most users can only get ac-cess to processed and compressed sRGB images. To bridge this gap, we design an Invertible Image Signal Processing (InvISP) pipeline, which not only enables rendering visually appealing sRGB images but also allows recovering nearly perfect RAW data. Due to our framework’s inherent re-versibility, we can reconstruct realistic RAW data instead of synthesizing RAW data from sRGB images without any memory overhead. We also integrate a differentiable JPEG compression simulator that empowers our framework to re-construct RAW data from JPEG images. Extensive quan-titative and qualitative experiments on two DSLR demon-strate that our method obtains much higher quality in both rendered sRGB images and reconstructed RAW data than alternative methods. 1.

Introduction
Professional photographers can choose to process RAW images by themselves instead of RGB images to produce images with better visual effects as the RAW data captures unprocessed scene irradiance at each in 12-14 bits by a cam-era. Due to its linear relationship with scene irradiance, raw sensor data is also a better choice than RGB images for many image editing and computer vision tasks, such as photometric stereo, intrinsic image decomposition, im-age denoising, reﬂection removal, and image super resolu-tion [4, 7, 27, 16, 30, 39, 40, 45]. However, accessing RAW images can be quite hard due to their memory-demanding property: RAW images may be discarded during the pro-cess of data storing, transferring, and sharing. In this paper, we are interested in the question: can users get access to the real RAW data without explicitly storing it?
Due to the great advantages of RAW images, there have been many approaches to provide the mapping from sRGB images to their RAW counterparts [2, 7, 29, 31, 36, 44].
Nguyen et al. [31] suggest explicitly storing the parameters
∗Joint ﬁrst authors of sRGB-RAW mapping functions into the JPEG metadata for the prospective RAW reconstruction. Brooks et al. [7] use the prior information of the cameras (e.g., color cor-rection matrices and digital gains) to reverse the ISP step-by-step. Another line of work [29, 36, 44] follows the in-verse order of ISP and proposes learning-based methods to synthesize RAW data from sRGB images. However, these methods still rely on the underlying lossy in-camera ISP pipeline, and the recovered RAW images are inaccurate and may be different from the original ones.
In this work, we propose a novel and effective learned solution by redesigning the camera image signal process-ing pipeline as an invertible one, which can be aptly called
Invertible ISP (InvISP). Our learning-based InvISP enables rendering visually appealing RGB images in the forward process, and recovering nearly perfect quality raw sensor data from compressed RGB images through the inverse process. Our reconstructed RAW data is nearly identical with real RAW data and enables computer vision applica-tions, such as image retouching and HDR reconstruction, as shown in Figure 1.
Designing an invertible ISP is not a trivial task for at least three reasons. First, some steps in the traditional ISP, such as denoising, tone mapping, and quantization, can lead to inevitable information lost from wide-range (12-bit or 14-bit) raw sensor data to 8-bit RGB images. Second, the invertible ISP should not produce visual artifacts such as halo and ghosting artifacts [18]. To render visually appeal-ing sRGB images, denoising, demosaicing, color correc-tion, white balance gain, tone mapping, and color enhance-ment must be designed carefully in ISP. Third, modern dig-ital cameras store RGB images in the JPEG format, where the lossy compression process makes reconstructing high-quality RAW data highly challenging.
To overcome these challenges, we take advantage of the inherent reversibility of normalizing-ﬂow-based mod-els [12, 25] and design both the RAW-to-RGB and RGB-to-RAW mapping in our invertible ISP with one single in-vertible neural network. We deeply analyze the properties of traditional ISP and design speciﬁc modules that can not only well approximate the camera ISP but also reconstruct almost identical RAW data with the camera RAW data. 6287
Figure 1. Our ISP model can not only render visually pleasing RGB images but also recover RAW images that are nearly the same as the original RAW data. The recovered RAW data are valuable for photographers and beneﬁt a number of computer vision tasks such as HDR reconstruction [32], image retouching [22], and RAW compression. Here, the RAW images are visualized with bilinear demosaicing.
Speciﬁcally, we design our model with the composition of a stack of afﬁne coupling layers and utilize the invertible 1
× 1 convolution as the learnable permutation function be-tween the coupling layers. Besides, to empower our model to recover realistic RAW data from JPEG images, we in-tegrate a differentiable JPEG simulator into our invertible neural network. We leverage the idea from Fourier transfor-mation to replace the non-differentiable quantization step in JPEG compression. Thus, our end-to-end InvISP frame-work bypasses traditional ISP modules and minimizes the information loss for the RAW data and RGB image conver-sion. We bidirectionally train our network to optimize the
RGB and RAW reconstruction process jointly. We experi-mentally prove that our framework can recover much better
RAW data than state-of-the-art baselines without sacriﬁcing the RGB reconstruction performance.
To the best of our knowledge, our framework is the
ﬁrst attempt for RAW data reconstruction from the perspec-tive of redesigning the camera ISP as an invertible one.
Our method can address the information loss issue in ISP modules and is robust to the JPEG compression step. We demonstrate the effectiveness of our method on two DSLR cameras and show that our method outperforms state-of-the-art baselines to a large extent. Moreover, we also exhibit potential applications through RAW data compression, im-age retouching, and HDR reconstruction. 2.