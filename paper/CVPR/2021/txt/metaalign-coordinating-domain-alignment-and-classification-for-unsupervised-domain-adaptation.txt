Abstract
For unsupervised domain adaptation (UDA), to allevi-ate the effect of domain shift, many approaches align the source and target domains in the feature space by adversar-ial learning or by explicitly aligning their statistics. How-ever, the optimization objective of such domain alignment is generally not coordinated with that of the object clas-siﬁcation task itself such that their descent directions for optimization may be inconsistent. This will reduce the ef-fectiveness of domain alignment in improving the perfor-mance of UDA. In this paper, we aim to study and allevi-ate the optimization inconsistency problem between the do-main alignment and classiﬁcation tasks. We address this by proposing an effective meta-optimization based strategy dubbed MetaAlign, where we treat the domain alignment objective and the classiﬁcation objective as the meta-train and meta-test tasks in a meta-learning scheme. MetaAlign encourages both tasks to be optimized in a coordinated way, which maximizes the inner product of the gradients of the two tasks during training. Experimental results demon-strate the effectiveness of our proposed method on top of various alignment-based baseline approaches, for tasks of object classiﬁcation and object detection. MetaAlign helps achieve the state-of-the-art performance. 1.

Introduction
With the advance of deep convolutional neural networks (CNN), computer vision tasks such as image classiﬁcation and object detection have gained signiﬁcant improvement
[28, 48, 20]. In general, the trained models perform well on the testing dataset of which the distribution bears a resem-blance to that of training dataset. However, in many prac-tical scenarios, directly applying such trained models to a new domain usually suffers from signiﬁcant performance degradation. There exist differences in data characteris-∗This work was done when Guoqiang was an intern at MSRA.
†Corresponding Author. tics/distributions between the training and testing domains, which are known as domain shift [60, 56]. This makes it hard to directly transfer knowledge learned from source to target. Annotation on the samples of the target domain can alleviate this problem but is expensive and time-consuming.
Without the requirement of annotation on target samples, unsupervised domain adaption (UDA) attracts a lot of at-tention, which allows us to learn to adapt the model trained on source to target by exploiting the unlabeled target sam-ples.
There has been a large spectrum of UDA methods devel-oped in the literature. The major line among them attempts to align the distributions of source and target domains by learning domain-invariant representations, through directly minimizing the discrepancy between feature distributions of two domains [62, 36, 57, 56, 16, 71] or adversarially learning to enforce the feature representations to be indis-tinguishable by a domain discriminator [14, 15, 43, 37, 67, 5, 9, 41]. The former category of methods usually align do-main distributions by employing explicit distribution sim-ilarity metrics, e.g., momentum distance [44, 69], or the second-order correlation [56, 57, 45], between the source and target domains. The latter one borrows ideas from
Generative Adversarial Networks [18] and use adversarial training to learn aligned feature representations. However, these alignment constraints/strategies are actually not de-signed specially for the object classiﬁcation task. There is a lack of efﬁcient coordination between the optimizations of these two tasks. During training, the optimization pro-cedure of alignment may be inconsistent with that of the object classiﬁcation task itself, which could hurt the learn-ing of discriminative object features for classiﬁcation and thus results in inferior object classiﬁcation performance.
In this work, we aim to address this pervasive prob-lem/challenge faced by alignment-based unsupervised do-main adaptation methods, i.e., the optimization inconsis-tency between the domain alignment task and the classiﬁca-tion task itself. We propose a meta-learning [53, 58] based method dubbed MetaAlign to mitigate such inconsistency.
Particularly, as illustrated in Fig. 1 (b), we treat the domain 16643
Figure 1: Illustration of our MetaAlign strategy which aims to encourage the optimization consistency between the domain alignment task and the object classiﬁcation task for efﬁcient UDA. (a) Previous approaches directly combine the optimization objective functions of the two tasks together (i.e., Ldom + Lcls), where the descent directions for optimizing the shared network parameters θ from the two tasks may be inconsistent. (b) In contrast, we treat one of these two tasks as meta-train task and the other as meta-test task. We leverage this meta-optimization based strategy to enforce the consistency between their optimization gradients w.r.t. θ. MetaAlign is generic and applicable to various domain alignment based UDAs. alignment objective and the classiﬁcation objective as two tasks in a meta-learning scheme, where we take one task as meta-train task to optimize the network and meanwhile we validate the optimization result on the other task (i.e., meta-test task) for the same set of samples, during training.
Meta-optimization across these two tasks encourages both to be optimized in a coordinated way. The theoretical anal-ysis reveals that MetaAlign achieves this optimization co-ordination by maximizing the inner product of the gradients of the two tasks during training.
We summarize our contributions as follows:
• We pinpoint the problem/challenge in existing alignment-based UDA methods: the optimization inconsistency be-tween the domain alignment task and the classiﬁcation task itself. To address the problem, we propose a meta-optimization based strategy named MetaAlign to mitigate the inconsistency.
• The proposed MetaAlign strategy is generic and can be applied to various domain alignment based UDA meth-ods for object classiﬁcation and detection to enforce domain alignment while preserving the discrimination power of features for the recognition task.
We validate the effectiveness of MetaAlign on the im-age classiﬁcation (unsupervised domain adaptation and do-main generalization) and object detection (unsupervised do-main adaptation) tasks. For image classiﬁcation, we imple-ment MetaAlign on top of various domain alignment based
UDA baselines. Extensive experimental results demonstrate the effectiveness and applicability of MetaAlign and we achieve the state-of-the-art performance. 2.