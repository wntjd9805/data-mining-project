Abstract
Weakly Supervised Semantic Segmentation (WSSS) with image-level annotation uses class activation maps from the classiﬁer as pseudo-labels for semantic segmentation.
However, such activation maps usually highlight the local discriminative regions rather than the whole object, which deviates from the requirement of semantic segmentation. To explore more comprehensive class-speciﬁc activation maps, we propose an Embedded Discriminative Attention Mecha-nism (EDAM) by integrating the activation map generation into the classiﬁcation network directly for WSSS. Speciﬁ-cally, a Discriminative Activation (DA) layer is designed to explicitly produce a series of normalized class-speciﬁc masks, which are then used to generate class-speciﬁc pixel-level pseudo-labels demanded in segmentation. For learn-ing the pseudo-labels, the masks are multiplied with the fea-ture maps after the backbone to generate the discriminative activation maps, each of which encodes the speciﬁc infor-mation of the corresponding category in the input images.
Given such class-speciﬁc activation maps, a Collaborative
Multi-Attention (CMA) module is proposed to extract the collaborative information of each given category from im-ages in a batch. In inference, we directly use the activation masks from the DA layer as pseudo-labels for segmenta-tion. Based on the generated pseudo-labels, we achieve the mIoU of 70.60% on PASCAL VOC 2012 segmentation test-set, which is the new state-of-the-art, to our best knowledge.
Code and pre-trained models are available online soon. 1.

Introduction
Driven by Deep Neural Networks (DNNs), signiﬁcant progress [32, 6, 7] has been made in fully supervised seman-*Equal contribution.
†Corresponding author. This work was supported mainly by the Na-tional Natural Science Foundation of China under Grant 61972036, in part by grants under Grant 91746210, and in part by Beijing Science and Tech-nology Project. (No. Z181100008918018).
Figure 1. Illustration of our motivation. (a) The heatmap from
CAM [52] tends to only highlight the local discriminative regions instead of the whole object. (b) In our model, the DA layer ex-tracts class-speciﬁc activation maps, called discriminative activa-tion maps, of multi-images. For each category, the CMA mod-ule exploits the collaborative information based on the intra-image and inter-image homogeneity of activation maps. Note that the black, pink and grey lines indicate the information ﬂow of back-ground, person and car, respectively. Best viewed in color. tic segmentation, for which however, it is time-consuming and costly to attain pixel-level annotations. To deal with this problem, researchers seek to leverage weaker supervi-sion, such as bounding boxes [34], scribbles [29], points [3], and even image-level labels [35], for semantic segmen-tation, namely, Weakly Supervised Semantic Segmenta-tion (WSSS). In this paper, we mainly focus on the image-level labels based WSSS.
Previous WSSS methods [21, 45, 40, 4] with image-level labels often use a classiﬁcation network to generate the initial segmentation response, such as the Class Activa-tion Map (CAM) [52], to highlight the corresponding fore-ground. However, the initial response from the classiﬁer usually focuses on the discriminative object regions, rather than the whole object, which deviates from a desirable seg-mentation result. Some approaches improve quality of such initial responses by region erasing [46, 18], region grow-16765
ing [20], or multi-scale feature map fusion [48, 21], which easily lead to the background regions incorrectly high-lighted as well. The latest trend is to add auxiliary tasks, in-cluding consistency regularization [45], sub-category clas-siﬁcation [4] and mining cross-image semantics [40], to train jointly with the classiﬁcation network for reﬁning ob-ject responses. However, these auxiliary tasks usually ex-plore information in an implicit manner, leading to a com-plex training process and a non-optimal inference result.
In this work, we propose an Embedded Discrimina-tive Attention Mechanism (EDAM) to explicitly infer class-speciﬁc masks for WSSS by exploring the intra-image and inter-image homogeneity. The EDAM consists of a Dis-criminative Activation layer (DA layer) and a Collabora-tive Multi-Attention module (CMA module), which is il-lustrated in Fig. 1.
In the DA layer, we ﬁrst predict the class-speciﬁc masks for foreground categories and back-ground, which explicitly represent the probability of each pixel belonging to a speciﬁc category, and can directly serve as the initial segmentation responses for WSSS. These nor-malized masks are then multiplied with the original feature maps to generate discriminative activation maps, each of which encodes the information of each category or back-ground. After that, the CMA module is used to explore the collaborative information of the corresponding foreground object by applying self-attention to the activation maps of multi-images. We then apply average pooling on the at-tended activation map of each image, and feed the pool-ing result into the binary classiﬁer of the corresponding cat-egory for prediction. Note that the CMA module is only required in the training stage, as we can acquire the initial segmentation response via the class-speciﬁc masks as afore-mentioned.
In tradition, post-processing is often applied, where saliency maps are widely used for result enhance-ment [11, 25, 44, 40]. However, due to the class-agnostic property, the saliency map usually wrongly highlights the non-target objects, or suppresses the insigniﬁcant target ob-jects. Therefore, we also develop a new strategy for post-processing in our method as well for further improvement.
We claim that the proposed EDAM enjoys two advan-tages for WSSS. First, using a class-speciﬁc activation map eliminates some impact of other irrelevant categories or background, and thus beneﬁts the classiﬁcation accu-racy. Also, as the collaborative information for classiﬁca-tion stems from the discriminative activation maps, optimiz-ing the classiﬁers is able to directly enhance the prediction of class-speciﬁc masks.
Our main contributions can be summarized as follows:
• The Embedded Discriminative Attention Mecha-nism (EDAM) is proposed to seamlessly integrate the semantic segmentation task into the classiﬁcation net-work. To our best knowledge, this work is the ﬁrst trail of explicitly modeling the semantic segmentation in classiﬁcation networks for WSSS.
• Different from the existing attention-based meth-ods [40, 45], we explore the collaborative information based on the intra-image and inter-image homogene-ity of discriminative activation maps simultaneously, which can make full use of the supervision informa-tion of image-level labels.
• We propose a new strategy for post-processing, includ-ing the foreground pop-up and background suppres-sion, which further enhances the quality of pseudo-labels for training segmentation networks.
• On the PASCAL VOC 2012, our approach achieves the new state-of-the-art, with mIoU of 70.9% and 70.6% on validation and test sets respectively. 2.