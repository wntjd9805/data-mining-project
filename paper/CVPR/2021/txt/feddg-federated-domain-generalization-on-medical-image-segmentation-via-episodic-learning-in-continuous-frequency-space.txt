Abstract
Federated learning allows distributed medical institu-tions to collaboratively learn a shared prediction model with privacy protection. While at clinical deployment, the models trained in federated learning can still suffer from performance drop when applied to completely unseen hos-pitals outside the federation. In this paper, we point out and solve a novel problem setting of federated domain gener-alization (FedDG), which aims to learn a federated model from multiple distributed source domains such that it can directly generalize to unseen target domains. We present a novel approach, named as Episodic Learning in Contin-uous Frequency Space (ELCFS), for this problem by en-abling each client to exploit multi-source data distributions under the challenging constraint of data decentralization.
Our approach transmits the distribution information across clients in a privacy-protecting way through an effective con-tinuous frequency space interpolation mechanism. With the transferred multi-source distributions, we further carefully design a boundary-oriented episodic learning paradigm to expose the local learning to domain distribution shifts and particularly meet the challenges of model generalization in medical image segmentation scenario. The effectiveness of our method is demonstrated with superior performance over state-of-the-arts and in-depth ablation experiments on two medical image segmentation tasks. The code is avail-able at https://github.com/liuquande/FedDG-ELCFS. 1.

Introduction
Data collaboration across multiple medical institutions is increasingly desired to build accurate and robust data-driven deep networks for medical image segmentation [7, 18, 50].
Federated learning (FL) [20] has recently opened the door for a promising privacy-preserving solution, which allows training a model on distributed datasets while keeping data
*Corresponding author
: Source domain
: Unseen domain
: Data parivacy
: Central server
: Model
?
?
Local client k
Local episodic learning
Local data 
Transformed data with multi-source distributions
... (a) 
Amplitude spectrum  (frequency space)
... (b) 
Figure 1. (a) The novel problem setting of federated domain gen-eralization (FedDG), which aims to learn a federated model from multiple decentralized source domains such that it can directly (b) Our main generalize to completely unseen target domains. idea to tackle FedDG by transferring distribution information in frequency space and episodic learning at each local client. locally. The paradigm works in a way that each local client (e.g., hospital) learns from their own data, and only aggre-gates the model parameters at a certain frequency at the cen-tral server to generate a global model. All the data samples are kept within each local client during federated training.
Although FL has witnessed some pilot progress on med-ical image segmentation tasks [4, 44, 49], all existing works only focus on improving model performance on the internal clients, while neglecting model generalizability onto unseen domains outside the federation. This is a crucial problem impeding wide applicability of FL models in real practice.
The testing medical images encountered in unseen hospi-tals can differ signiﬁcantly from the source clients in terms of data distributions, due to the variations in imaging scan-ners and protocols. How to generalize the federated model under such distribution shifts is technically challenging yet unexplored so far. In this work, we identify the novel prob-lem setting of Federated Domain Generalization (FedDG), which aims to learn a federated model from multiple decen-tralized source domains such that it can directly generalize to completely unseen domains, as illustrated in Fig. 1 (a).
Unseen domain generalization (DG) is an active research topic with different methods being proposed [3, 8, 11, 24, 25, 26, 29, 37, 43], but the federated paradigm with dis-1013  
tributed data sources poses new challenges for DG. With the goal to extract representations that are robust to distri-bution shift, existing DG approaches usually require access to multi-source distributions in the learning process. For in-stance, adversarial feature alignment methods [26, 29] have to train the domain discriminator with samples from differ-ent source datasets. Meta-learning based methods [8, 24] need to use multi-source data of different distributions to construct virtual training and virtual testing domains within each minibatch. Whereas in federated paradigm, data are stored distributedly and the learning at each client can only access its local data. Therefore, current DG methods are typically not applicable in FedDG scenario. In addition, the local optimization would make model biased to its own data distribution, thus less generalizable to new target domains.
To solve this FedDG problem, our insight is to enable each client to access multi-source data distributions in a privacy-protecting way. The idea is motivated by the knowl-edge that the low-level distributions (i.e., style) and high-level semantics of an image can be respectively captured by amplitude and phase spectrum in the frequency space, as revealed by visual psychophysics [13, 42, 57]. We can con-sider exchanging these amplitude spectrum across clients to transmit the distribution information (cf. Fig. 1 (b)), while keeping the phase spectrum with core semantics locally for privacy protection. Based on this, we also devise a con-tinuous frequency space interpolation mechanism, which interpolates between the local and transferred distributions for enriching the established multi-domain distributions for each local client. This promotes the local training to gain domain-invariance beneﬁting from a dedicated dense distri-bution space. With these established distributions, we ex-pose the local learning to domain distribution shifts via an episodic training paradigm to enhance the generalizability of local parameters. A novel meta-update objective function is designed to guide cross-domain optimization attending to the boundary area. This is notably important for medical image segmentation applications where generalization er-rors often come from imprecise predictions at ambiguous boundary of anatomies.
Our main contributions are highlighted as follows:
• We tackle the novel and practical problem of Feder-ated Domain Generalization. To the best of our knowl-edge, this is the ﬁrst work to improve generalizability on completely unseen domains for federated models.
• We propose a privacy-preserving solution to learn the generalizable FL model under decentralized datasets, through an effective continuous frequency space inter-polation mechanism across clients.
• We present a novel boundary-oriented episodic learn-ing scheme for the local training at a client, which ex-poses local optimization to domain shifts and enhances model generalizability at ambiguous boundary area.
• We conduct extensive experiments on two typical med-ical image segmentation tasks, i.e., retinal fundus im-age segmentation (four datasets) and prostate MRI seg-mentation (six datasets). Our achieved superior per-formance over state-of-the-arts and in-depth analytical experiments demonstrate the efﬁcacy of our approach. 2.