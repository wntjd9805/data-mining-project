Abstract
Deep learning based methods have shown dramatic im-provements in image rain removal by using large-scale paired data of synthetic datasets. However, due to the var-ious appearances of real rain streaks that may differ from those in the synthetic training data, it is challenging to di-rectly extend existing methods to the real-world scenes. To address this issue, we propose a memory-oriented semi-supervised (MOSS) method which enables the network to explore and exploit the properties of rain streaks from both synthetic and real data. The key aspect of our method is designing an encoder-decoder neural network that is augmented with a self-supervised memory module, where items in the memory record the prototypical patterns of rain degradations and are updated in a self-supervised way.
Consequently, the rainy styles can be comprehensively de-rived from synthetic or real-world degraded images with-∗Corresponding Author out the need for clean labels. Furthermore, we present a self-training mechanism that attempts to transfer derain-ing knowledge from supervised rain removal to unsuper-vised cases. An additional target network, which is updated with an exponential moving average of the online deraining network, is utilized to produce pseudo-labels for unlabeled rainy images. Meanwhile, the deraining network is opti-mized with supervised objectives on both synthetic paired data and pseudo-paired noisy data. Extensive experiments show that the proposed method achieves more appealing re-sults not only on limited labeled data but also on unlabeled real-world images than recent state-of-the-art methods. 1.

Introduction
Single image deraining (SID), also known as image rain removal, refers to restoring clean and rain-free background scenes from a single rainy image.
It is signiﬁcant for a wide range of outdoor computer-vision tasks, such as au-7732
tonomous driving and video surveillance, where images captured in rainy days are often heavily degraded in visual quality. SID is a difﬁcult problem since degraded images in the real world may contain rain streaks and accumulation of complex patterns and various appearances.
Recently, deep learning based methods have been intro-duced into single image deraining and contributed to dra-matic improvements. However, most of these CNN based methods [8, 31, 37, 33, 23, 3, 14] rely on paired rain/clean images to train their networks in a fully supervised way.
Since the intractability to obtain labeled real rainy images, existing methods are typically trained on synthetic rain datasets [8, 41]. But there are signiﬁcant gaps between synthetic and real rainy images, where the authentic degra-dations are much more complex. As a result, the mod-els trained on synthetic datasets may generalize poorly to practical applications in the real world. To address this is-sue, Wei et al. [29] ﬁrstly propose a semi-supervised learn-ing framework to simultaneously utilize supervised and un-supervised knowledge for image deraining. They model the real rain residual through a likelihood term imposed on a Gaussian mixture model and minimize the Kullback-Lerbler divergence between the distributions of synthetic and real rain. Subsequently, Yasarla et al. [34] propose a
Gaussian-process (GP) based semi-supervised method that uses GP to model the latent features of rainy images and cre-ate pseudo-labels for the unlabeled data. Although existing semi-supervised methods [29, 34] have achieved promising results, it is still challenging to model various appearances of rain and separate complex overlappings of rain and back-ground information for real-world degraded images. For ex-ample, as shown in Fig. 1, it is difﬁcult to correctly estimate the rain degradations when background textures (like the trafﬁc markings) have similar appearances with rain streaks.
Therefore, real-world rain removal remains an open and challenging problem, leaving much room for improvement.
In this paper, we present a memory-oriented semi-supervised (MOSS) learning framework to fully utilize unlabeled real-world images for better generalization of rain removal. Speciﬁcally, we design a memory-oriented encoder-decoder network (MOEDN) to learn the patterns of rain and recover rain-free background images. As il-lustrated in Fig. 2, MOEDN consists of an encoder to ex-tract rain features from an input image, a memory mod-ule to model the appearances of rain degradations, and a decoder to recover rain-free background images. Between the encoder and decoder, a skip-connection following by a subtraction operation is added to ensure that the encoding should focus on rain degradations rather than background information. The memory module is employed to record various appearances of rain, where each item in the mem-ory corresponds to prototypical features of rainy patterns.
The encoding of MOEDN is served as a query to retrieve the most relevant items in the memory, and then these items are aggregated based on soft-attentive reading. The memory module is updated in a self-supervised way, i.e., each mem-ory item is updated using an exponential moving average of such query features that the memory item is the nearest one to them. In the training phase, we iteratively optimize the memory module and the rest parts of the network, making it possible to deeply explore the patterns of rain degradations without the need for clean labels.
In addition, we present a self-training mechanism to su-pervise the unlabeled data by transferring deraining knowl-edge of rain removal on synthetic datasets. We employ an additional target network, which is updated with an exponential moving average of the online deraining net-work (i.e., MOEDN) to produce pseudo-labels for unla-beled rainy images. Then, we generate noisy data and their labels by randomly mixing the synthetic/real images as the background and the synthetic or pseudo rain residuals. Fi-nally, the online network is trained by supervised objectives, i.e., the pixel-wise L1 loss, on both synthetic paired data and pseudo-paired noisy data. Furthermore, we adopt a Total-Variance loss function to slightly regularize the smoothness of unsupervised rain removal. The self-training mechanism augments the diversity of rain degradations from both syn-thetic and real-world rainy images, thus leading to robust-ness towards complex and volatile rainy scenes in the wild.
The main contributions are summarized as follows:
• A novel memory-oriented transfer learning framework is proposed to conduct semi-supervised image derain-ing on both labeled synthetic data and unlabeled real-world data.
• A memory-oriented encoder-decoder network is pro-posed to recover rain-free background images. A self-supervised memory module is presented to adaptively model various appearances of rain degradations.
• A self-training mechanism is proposed to transfer knowledge from supervised deraining to unsupervised cases. The use of noisy data paired with pseudo-labels generated by a target network improves the robustness of image deraining.
• Extensive experiments on different datasets demon-strate that the proposed approach outperforms existing methods both quantitatively and qualitatively. 2.