Unsupervised domain adaptation (UDA) in semantic segmentation is a task that aims to eliminate the need for manual annotation by adapting models trained on a source domain to perform well on a target domain. However, the problem of domain shifts, which refer to differences between the source and target domains, can negatively impact the segmentation performance. These domain shifts can be categorized into image-level domain shifts, which arise from differences in imaging conditions, and category-level domain shifts, which result from variations in object category configurations. In this study, we propose a new UDA pipeline that tackles both image-level and category-level domain shifts in a step-by-step manner. First, at the coarse level, we introduce a photometric alignment module that uses a set of image-level operators to align an image from the source domain with a reference image from the target domain. This alignment helps to reduce the differences in imaging conditions between the two domains. At the fine level, we propose a category-oriented triplet loss, which applies a soft constraint to regularize the category centers in the source domain. This regularization encourages the model to learn category-specific features that are consistent across domains. Additionally, we utilize a self-supervised consistency regularization method in the target domain to further improve the model's ability to generalize to unseen data.Through experiments, we demonstrate that our proposed pipeline enhances the generalization capability of the final segmentation model and surpasses previous state-of-the-art methods in terms of performance.