Crowd counting and localization have gained significant attention due to their practical applications in various domains such as surveillance, transport management, and business. Existing algorithms for crowd counting predict a density map from a crowd image, where the crowd count is determined by the summation of the density map. The generation of the ground-truth density map typically involves placing a Gaussian kernel on each person's dot annotation. The training of density map estimators is commonly performed using pixel-wise regression methods with L2 loss.However, L2 loss and other traditional loss functions assume fixed ground-truth representations, such as Gaussian density kernels. Recent studies have shown that the choice of the intermediate density map representation significantly impacts the counting performance. To address this limitation and improve localization and compactness, this paper proposes a generalized loss function based on an unbalanced optimal transport (OT) framework. The proposed loss measures the transport cost between the predicted density map and the ground-truth dot annotations.This novel loss function offers several advantages over previous approaches. Firstly, it learns the density map representation using an optimized transport matrix. Secondly, it does not require special design considerations for background regions and naturally pushes predicted density away from the background towards the annotations. Thirdly, it produces compact density maps suitable for localization. Finally, it is less sensitive to hyperparameters such as the blur factor.The proposed loss function is shown to be a generalization of both the traditional L2 loss with Gaussian density kernels and Bayesian loss. Extensive experiments on crowd counting demonstrate that the proposed loss outperforms traditional loss functions on three large-scale datasets. Additionally, the low-resolution predicted density maps achieve the best localization performance on two benchmark datasets.In conclusion, this paper introduces a generalized loss function based on unbalanced optimal transport theory for crowd counting and localization. The proposed loss function demonstrates superior performance compared to traditional loss functions, with improved accuracy and compactness of density maps. The perspective-guided transport cost further enhances the handling of perspective effects in crowd images, resulting in better crowd counting and localization outcomes.